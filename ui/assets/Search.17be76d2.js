import{a7 as createDirective,a8 as getPortalProxy,a9 as closePortals,p as isKeyCode,c as computed,Z as openBlock,aa as createElementBlock,ab as normalizeClass,ac as normalizeStyle,r as ref,a as onUnmounted,a6 as createBaseVNode,ad as toDisplayString,a3 as unref,d as defineComponent,m as withDirectives,ae as vShow,f as createVNode,a1 as createTextVNode,af as useCssVars,B as nextTick,ag as pushScopeId,ah as popScopeId,ai as createCommentVNode,g as getCurrentInstance,U as reactive,aj as withModifiers,w as watch,o as onMounted,$ as withCtx,F as Fragment$1,ak as renderList,al as Transition,am as useAttrs,an as mergeProps,_ as createBlock,ao as withKeys,ap as useQuasar,aq as QCard,a2 as QBtn,ar as QDialog,Q as QIcon,as as QCardSection,at as QCheckbox,au as QCardActions,av as watchEffect,aw as QInput}from"./index.78b68d71.js";import{l as lookup}from"./index.a1ffc747.js";import{s as showInfo,a as showError,Q as QItemLabel,b as QItem,c as QItemSection,d as QChip,e as showTips}from"./QChip.c971860d.js";import{Q as QImg,a as QList}from"./QList.29f4c29e.js";import{Q as QToolbar,a as QToolbarTitle,b as QSpace}from"./QToolbar.6fa43934.js";import{_ as _export_sfc$1,c as commonjsGlobal}from"./_commonjsHelpers.dd4c501b.js";function getDepth(r){if(r===!1)return 0;if(r===!0||r===void 0)return 1;const e=parseInt(r,10);return isNaN(e)?0:e}var ClosePopup=createDirective({name:"close-popup",beforeMount(r,{value:e}){const t={depth:getDepth(e),handler(i){t.depth!==0&&setTimeout(()=>{const s=getPortalProxy(r);s!==void 0&&closePortals(s,i,t.depth)})},handlerKey(i){isKeyCode(i,13)===!0&&t.handler(i)}};r.__qclosepopup=t,r.addEventListener("click",t.handler),r.addEventListener("keyup",t.handlerKey)},updated(r,{value:e,oldValue:t}){e!==t&&(r.__qclosepopup.depth=getDepth(e))},beforeUnmount(r){const e=r.__qclosepopup;r.removeEventListener("click",e.handler),r.removeEventListener("keyup",e.handlerKey),delete r.__qclosepopup}}),style="";function throttle(r,e,t,i){var s,n=!1,a=0;function o(){s&&clearTimeout(s)}function l(){o(),n=!0}typeof e!="boolean"&&(i=t,t=e,e=void 0);function c(){for(var f=arguments.length,d=new Array(f),u=0;u<f;u++)d[u]=arguments[u];var g=this,p=Date.now()-a;if(n)return;function m(){a=Date.now(),t.apply(g,d)}function S(){s=void 0}i&&!s&&m(),o(),i===void 0&&p>r?m():e!==!0&&(s=setTimeout(i?S:m,i===void 0?r-p:r))}return c.cancel=l,c}function debounce(r,e,t){return t===void 0?throttle(r,e,!1):throttle(r,t,e!==!1)}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var urlToolkit={exports:{}};(function(r,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,f){if(f=f||{},l=l.trim(),c=c.trim(),!c){if(!f.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var u=o.parseURL(c);if(!u)throw new Error("Error trying to parse relative URL.");if(u.scheme)return f.alwaysNormalize?(u.path=o.normalizePath(u.path),o.buildURLFromParts(u)):c;var g=o.parseURL(l);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var p=s.exec(g.path);g.netLoc=p[1],g.path=p[2]}g.netLoc&&!g.path&&(g.path="/");var m={scheme:g.scheme,netLoc:u.netLoc,path:null,params:u.params,query:u.query,fragment:u.fragment};if(!u.netLoc&&(m.netLoc=g.netLoc,u.path[0]!=="/"))if(!u.path)m.path=g.path,u.params||(m.params=g.params,u.query||(m.query=g.query));else{var S=g.path,y=S.substring(0,S.lastIndexOf("/")+1)+u.path;m.path=o.normalizePath(y)}return m.path===null&&(m.path=f.alwaysNormalize?o.normalizePath(u.path):u.path),o.buildURLFromParts(m)},parseURL:function(l){var c=i.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(n,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=o})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function _objectSpread2(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(i){_defineProperty(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function _toPrimitive(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function _toPropertyKey(r){var e=_toPrimitive(r,"string");return typeof e=="symbol"?e:String(e)}function _defineProperty(r,e,t){return e=_toPropertyKey(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _extends(){return _extends=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},isSafeInteger=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r}({}),ErrorTypes=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),ErrorDetails=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.UNKNOWN="unknown",r}({});const noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(r){const e=self.console[r];return e?e.bind(self.console,`[${r}] >`):noop}function exportLoggerFunctions(r,...e){e.forEach(function(t){exportedLogger[t]=r[t]?r[t].bind(r):consolePrintFn(t)})}function enableLogs(r,e){if(typeof console=="object"&&r===!0||typeof r=="object"){exportLoggerFunctions(r,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${e}" in hls.js version 1.5.8`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(e){typeof e=="string"&&(e=AttrList.parseAttrList(e)),_extends(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=DECIMAL_RESOLUTION_REGEX.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const i={},s='"';for(ATTR_LIST_REGEX.lastIndex=0;(t=ATTR_LIST_REGEX.exec(e))!==null;){let n=t[2];n.indexOf(s)===0&&n.lastIndexOf(s)===n.length-1&&(n=n.slice(1,-1));const a=t[1].trim();i[a]=n}return i}}function isDateRangeCueAttribute(r){return r!=="ID"&&r!=="CLASS"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function isSCTE35Attribute(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"}class DateRange{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const i=t.attr;for(const s in i)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==i[s]){logger.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=s;break}e=_extends(new AttrList({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);isFiniteNumber(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const i=e.split("@",2);let s;i.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Fragment extends BaseSegment{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const e=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,n,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:n,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,n)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ElementaryStreamTypes.AUDIO]=null,e[ElementaryStreamTypes.VIDEO]=null,e[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(e,t,i,s,n){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function getKeyIdBytes(r){const e=strToUtf8array(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function changeEndianness(r){const e=function(i,s,n){const a=i[s];i[s]=i[n],i[n]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function convertDataUriToArrayBytes(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const n=s[0]==="base64",a=s[1];n?(i.splice(-1,1),t=base64Decode(a)):t=getKeyIdBytes(a)}}return t}function strToUtf8array(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}const optionalSelf=typeof self!="undefined"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(r){switch(r){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(r){if(r===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(r){switch(r){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(r){const{drmSystems:e,widevineLicenseUrl:t}=r,i=e?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(s=>!!e[s]):[];return!i[KeySystems.WIDEVINE]&&t&&i.push(KeySystems.WIDEVINE),i}const requestMediaKeySystemAccess=function(r){return optionalSelf!=null&&(r=optionalSelf.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(r,e,t,i){let s;switch(r){case KeySystems.FAIRPLAY:s=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:s=["cenc"];break;case KeySystems.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return createMediaKeySystemConfigurations(s,e,t,i)}function createMediaKeySystemConfigurations(r,e,t,i){return[{initDataTypes:r,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs="${n}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs="${n}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function sliceUint8(r,e,t){return Uint8Array.prototype.slice?r.slice(e,t):new Uint8Array(Array.prototype.slice.call(r,e,t))}const isHeader$2=(r,e)=>e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128,isFooter=(r,e)=>e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128,getID3Data=(r,e)=>{const t=e;let i=0;for(;isHeader$2(r,e);)i+=10,i+=readSize(r,e+6),isFooter(r,e+10)&&(i+=10),e+=i;if(i>0)return r.subarray(t,t+i)},readSize=(r,e)=>{let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t},canParse$2=(r,e)=>isHeader$2(r,e)&&readSize(r,e+6)+10<=r.length-e,getTimeStamp=r=>{const e=getID3Frames(r);for(let t=0;t<e.length;t++){const i=e[t];if(isTimeStampFrame(i))return readTimeStamp(i)}},isTimeStampFrame=r=>r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=r=>{const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=readSize(r,4),i=10;return{type:e,size:t,data:r.subarray(i,i+t)}},getID3Frames=r=>{let e=0;const t=[];for(;isHeader$2(r,e);){const i=readSize(r,e+6);e+=10;const s=e+i;for(;e+8<s;){const n=getFrameData(r.subarray(e)),a=decodeFrame(n);a&&t.push(a),e+=n.size+10}isFooter(r,e)&&(e+=10)}return t},decodeFrame=r=>r.type==="PRIV"?decodePrivFrame(r):r.type[0]==="W"?decodeURLFrame(r):decodeTextFrame(r),decodePrivFrame=r=>{if(r.size<2)return;const e=utf8ArrayToStr(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}},decodeTextFrame=r=>{if(r.size<2)return;if(r.type==="TXXX"){let t=1;const i=utf8ArrayToStr(r.data.subarray(t),!0);t+=i.length+1;const s=utf8ArrayToStr(r.data.subarray(t));return{key:r.type,info:i,data:s}}const e=utf8ArrayToStr(r.data.subarray(1));return{key:r.type,data:e}},decodeURLFrame=r=>{if(r.type==="WXXX"){if(r.size<2)return;let t=1;const i=utf8ArrayToStr(r.data.subarray(t),!0);t+=i.length+1;const s=utf8ArrayToStr(r.data.subarray(t));return{key:r.type,info:i,data:s}}const e=utf8ArrayToStr(r.data);return{key:r.type,data:e}},readTimeStamp=r=>{if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}},utf8ArrayToStr=(r,e=!1)=>{const t=getTextDecoder();if(t){const c=t.decode(r);if(e){const f=c.indexOf("\0");return f!==-1?c.substring(0,f):c}return c.replace(/\0/g,"")}const i=r.length;let s,n,a,o="",l=0;for(;l<i;){if(s=r[l++],s===0&&e)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:n=r[l++],o+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=r[l++],a=r[l++],o+=String.fromCharCode((s&15)<<12|(n&63)<<6|(a&63)<<0);break}}return o};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder!="undefined"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(r){let e="";for(let t=0;t<r.length;t++){let i=r[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(r){return String.fromCharCode.apply(null,r)}function readUint16(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function readUint32(r,e){const t=readSint32(r,e);return t<0?4294967296+t:t}function readUint64(r,e){let t=readUint32(r,e);return t*=Math.pow(2,32),t+=readUint32(r,e+4),t}function readSint32(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function writeUint32(r,e,t){r[e]=t>>24,r[e+1]=t>>16&255,r[e+2]=t>>8&255,r[e+3]=t&255}function hasMoofData(r){const e=r.byteLength;for(let t=0;t<e;){const i=readUint32(r,t);if(i>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=i>1?t+i:e}return!1}function findBox(r,e){const t=[];if(!e.length)return t;const i=r.byteLength;for(let s=0;s<i;){const n=readUint32(r,s),a=bin2str(r.subarray(s+4,s+8)),o=n>1?s+n:i;if(a===e[0])if(e.length===1)t.push(r.subarray(s+8,o));else{const l=findBox(r.subarray(s+8,o),e.slice(1));l.length&&push.apply(t,l)}s=o}return t}function parseSegmentIndex(r){const e=[],t=r[0];let i=8;const s=readUint32(r,i);i+=4;let n=0,a=0;t===0?(n=readUint32(r,i),a=readUint32(r,i+4),i+=8):(n=readUint64(r,i),a=readUint64(r,i+8),i+=16),i+=2;let o=r.length+a;const l=readUint16(r,i);i+=2;for(let c=0;c<l;c++){let f=i;const d=readUint32(r,f);f+=4;const u=d&2147483647;if((d&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const p=readUint32(r,f);f+=4,e.push({referenceSize:u,subsegmentDuration:p,info:{duration:p/s,start:o,end:o+u-1}}),o+=u,f+=4,i=f}return{earliestPresentationTime:n,timescale:s,version:t,referencesCount:l,references:e}}function parseInitSegment(r){const e=[],t=findBox(r,["moov","trak"]);for(let s=0;s<t.length;s++){const n=t[s],a=findBox(n,["tkhd"])[0];if(a){let o=a[0];const l=readUint32(a,o===0?12:20),c=findBox(n,["mdia","mdhd"])[0];if(c){o=c[0];const f=readUint32(c,o===0?12:20),d=findBox(n,["mdia","hdlr"])[0];if(d){const u=bin2str(d.subarray(8,12)),g={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[u];if(g){const p=findBox(n,["mdia","minf","stbl","stsd"])[0],m=parseStsd(p);e[l]={timescale:f,type:g},e[g]=_objectSpread2({timescale:f,id:l},m)}}}}}return findBox(r,["moov","mvex","trex"]).forEach(s=>{const n=readUint32(s,4),a=e[n];a&&(a.default={duration:readUint32(s,12),flags:readUint32(s,20)})}),e}function parseStsd(r){const e=r.subarray(8),t=e.subarray(8+78),i=bin2str(e.subarray(4,8));let s=i;const n=i==="enca"||i==="encv";if(n){const o=findBox(e,[i])[0].subarray(i==="enca"?28:78);findBox(o,["sinf"]).forEach(c=>{const f=findBox(c,["schm"])[0];if(f){const d=bin2str(f.subarray(4,8));if(d==="cbcs"||d==="cenc"){const u=findBox(c,["frma"])[0];u&&(s=bin2str(u))}}})}switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const a=findBox(t,["avcC"])[0];s+="."+toHex(a[1])+toHex(a[2])+toHex(a[3]);break}case"mp4a":{const a=findBox(e,[i])[0],o=findBox(a.subarray(28),["esds"])[0];if(o&&o.length>12){let l=4;if(o[l++]!==3)break;l=skipBERInteger(o,l),l+=2;const c=o[l++];if(c&128&&(l+=2),c&64&&(l+=o[l++]),o[l++]!==4)break;l=skipBERInteger(o,l);const f=o[l++];if(f===64)s+="."+toHex(f);else break;if(l+=12,o[l++]!==5)break;l=skipBERInteger(o,l);const d=o[l++];let u=(d&248)>>3;u===31&&(u+=1+((d&7)<<3)+((o[l]&224)>>5)),s+="."+u}break}case"hvc1":case"hev1":{const a=findBox(t,["hvcC"])[0],o=a[1],l=["","A","B","C"][o>>6],c=o&31,f=readUint32(a,2),d=(o&32)>>5?"H":"L",u=a[12],g=a.subarray(6,12);s+="."+l+c,s+="."+f.toString(16).toUpperCase(),s+="."+d+u;let p="";for(let m=g.length;m--;){const S=g[m];if(S||p){const y=S.toString(16).toUpperCase();p="."+y+p}}s+=p;break}case"dvh1":case"dvhe":{const a=findBox(t,["dvcC"])[0],o=a[2]>>1&127,l=a[2]<<5&32|a[3]>>3&31;s+="."+addLeadingZero(o)+"."+addLeadingZero(l);break}case"vp09":{const a=findBox(t,["vpcC"])[0],o=a[4],l=a[5],c=a[6]>>4&15;s+="."+addLeadingZero(o)+"."+addLeadingZero(l)+"."+addLeadingZero(c);break}case"av01":{const a=findBox(t,["av1C"])[0],o=a[1]>>>5,l=a[1]&31,c=a[2]>>>7?"H":"M",f=(a[2]&64)>>6,d=(a[2]&32)>>5,u=o===2&&f?d?12:10:f?10:8,g=(a[2]&16)>>4,p=(a[2]&8)>>3,m=(a[2]&4)>>2,S=a[2]&3,y=1,x=1,E=1,T=0;s+="."+o+"."+addLeadingZero(l)+c+"."+addLeadingZero(u)+"."+g+"."+p+m+S+"."+addLeadingZero(y)+"."+addLeadingZero(x)+"."+addLeadingZero(E)+"."+T;break}}return{codec:s,encrypted:n}}function skipBERInteger(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function toHex(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(r){return(r<10?"0":"")+r}function patchEncyptionData(r,e){if(!r||!e)return r;const t=e.keyId;return t&&e.isCommonEncryption&&findBox(r,["moov","trak"]).forEach(s=>{const a=findBox(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=findBox(a,["enca"]);const l=o.length>0;l||(o=findBox(a,["encv"])),o.forEach(c=>{const f=l?c.subarray(28):c.subarray(78);findBox(f,["sinf"]).forEach(u=>{const g=parseSinf(u);if(g){const p=g.subarray(8,24);p.some(m=>m!==0)||(logger.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(p)} -> ${Hex.hexDump(t)}`),g.set(t,8))}})})}),r}function parseSinf(r){const e=findBox(r,["schm"])[0];if(e){const t=bin2str(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return findBox(r,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(r,e){return findBox(e,["moof","traf"]).reduce((t,i)=>{const s=findBox(i,["tfdt"])[0],n=s[0],a=findBox(i,["tfhd"]).reduce((o,l)=>{const c=readUint32(l,4),f=r[c];if(f){let d=readUint32(s,4);if(n===1){if(d===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;d*=UINT32_MAX$1+1,d+=readUint32(s,8)}const u=f.timescale||9e4,g=d/u;if(isFiniteNumber(g)&&(o===null||g<o))return g}return o},null);return a!==null&&isFiniteNumber(a)&&(t===null||a<t)?a:t},null)}function getDuration(r,e){let t=0,i=0,s=0;const n=findBox(r,["moof","traf"]);for(let a=0;a<n.length;a++){const o=n[a],l=findBox(o,["tfhd"])[0],c=readUint32(l,4),f=e[c];if(!f)continue;const d=f.default,u=readUint32(l,0)|(d==null?void 0:d.flags);let g=d==null?void 0:d.duration;u&8&&(u&2?g=readUint32(l,12):g=readUint32(l,8));const p=f.timescale||9e4,m=findBox(o,["trun"]);for(let S=0;S<m.length;S++){if(t=computeRawDurationFromSamples(m[S]),!t&&g){const y=readUint32(m[S],4);t=g*y}f.type===ElementaryStreamTypes.VIDEO?i+=t/p:f.type===ElementaryStreamTypes.AUDIO&&(s+=t/p)}}if(i===0&&s===0){let a=1/0,o=0,l=0;const c=findBox(r,["sidx"]);for(let f=0;f<c.length;f++){const d=parseSegmentIndex(c[f]);if(d!=null&&d.references){a=Math.min(a,d.earliestPresentationTime/d.timescale);const u=d.references.reduce((g,p)=>g+p.info.duration||0,0);o=Math.max(o,u+d.earliestPresentationTime/d.timescale),l=o-a}}if(l&&isFiniteNumber(l))return l}return i||s}function computeRawDurationFromSamples(r){const e=readUint32(r,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let i=0;const s=readUint32(r,4);for(let n=0;n<s;n++)e&256&&(i+=readUint32(r,t),t+=4),e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4);return i}function offsetStartDTS(r,e,t){findBox(e,["moof","traf"]).forEach(i=>{findBox(i,["tfhd"]).forEach(s=>{const n=readUint32(s,4),a=r[n];if(!a)return;const o=a.timescale||9e4;findBox(i,["tfdt"]).forEach(l=>{const c=l[0],f=t*o;if(f){let d=readUint32(l,4);if(c===0)d-=f,d=Math.max(d,0),writeUint32(l,4,d);else{d*=Math.pow(2,32),d+=readUint32(l,8),d-=f,d=Math.max(d,0);const u=Math.floor(d/(UINT32_MAX$1+1)),g=Math.floor(d%(UINT32_MAX$1+1));writeUint32(l,4,u),writeUint32(l,8,g)}}})})})}function segmentValidRange(r){const e={valid:null,remainder:null},t=findBox(r,["moof"]);if(t.length<2)return e.remainder=r,e;const i=t[t.length-1];return e.valid=sliceUint8(r,0,i.byteOffset-8),e.remainder=sliceUint8(r,i.byteOffset-8),e}function appendUint8Array(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function parseSamples(r,e){const t=[],i=e.samples,s=e.timescale,n=e.id;let a=!1;return findBox(i,["moof"]).map(l=>{const c=l.byteOffset-8;findBox(l,["traf"]).map(d=>{const u=findBox(d,["tfdt"]).map(g=>{const p=g[0];let m=readUint32(g,4);return p===1&&(m*=Math.pow(2,32),m+=readUint32(g,8)),m/s})[0];return u!==void 0&&(r=u),findBox(d,["tfhd"]).map(g=>{const p=readUint32(g,4),m=readUint32(g,0)&16777215,S=(m&1)!==0,y=(m&2)!==0,x=(m&8)!==0;let E=0;const T=(m&16)!==0;let A=0;const _=(m&32)!==0;let P=8;p===n&&(S&&(P+=8),y&&(P+=4),x&&(E=readUint32(g,P),P+=4),T&&(A=readUint32(g,P),P+=4),_&&(P+=4),e.type==="video"&&(a=isHEVC(e.codec)),findBox(d,["trun"]).map(k=>{const F=k[0],M=readUint32(k,0)&16777215,B=(M&1)!==0;let N=0;const G=(M&4)!==0,U=(M&256)!==0;let O=0;const L=(M&512)!==0;let D=0;const b=(M&1024)!==0,C=(M&2048)!==0;let I=0;const R=readUint32(k,4);let V=8;B&&(N=readUint32(k,V),V+=4),G&&(V+=4);let $=N+c;for(let H=0;H<R;H++){if(U?(O=readUint32(k,V),V+=4):O=E,L?(D=readUint32(k,V),V+=4):D=A,b&&(V+=4),C&&(F===0?I=readUint32(k,V):I=readSint32(k,V),V+=4),e.type===ElementaryStreamTypes.VIDEO){let z=0;for(;z<D;){const W=readUint32(i,$);if($+=4,isSEIMessage(a,i[$])){const j=i.subarray($,$+W);parseSEIMessageFromNALu(j,a?2:1,r+I/s,t)}$+=W,z+=W+4}}r+=O/s}}))})})}),t}function isHEVC(r){if(!r)return!1;const e=r.indexOf("."),t=e<0?r:r.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function isSEIMessage(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function parseSEIMessageFromNALu(r,e,t,i){const s=discardEPB(r);let n=0;n+=e;let a=0,o=0,l=0;for(;n<s.length;){a=0;do{if(n>=s.length)break;l=s[n++],a+=l}while(l===255);o=0;do{if(n>=s.length)break;l=s[n++],o+=l}while(l===255);const c=s.length-n;let f=n;if(o<c)n+=o;else if(o>c){logger.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(s[f++]===181){const u=readUint16(s,f);if(f+=2,u===49){const g=readUint32(s,f);if(f+=4,g===1195456820){const p=s[f++];if(p===3){const m=s[f++],S=31&m,y=64&m,x=y?2+S*3:0,E=new Uint8Array(x);if(y){E[0]=m;for(let T=1;T<x;T++)E[T]=s[f++]}i.push({type:p,payloadType:a,pts:t,bytes:E})}}}}}else if(a===5&&o>16){const d=[];for(let p=0;p<16;p++){const m=s[f++].toString(16);d.push(m.length==1?"0"+m:m),(p===3||p===5||p===7||p===9)&&d.push("-")}const u=o-16,g=new Uint8Array(u);for(let p=0;p<u;p++)g[p]=s[f++];i.push({payloadType:a,pts:t,uuid:d.join(""),userData:utf8ArrayToStr(g),userDataBytes:g})}}}function discardEPB(r){const e=r.byteLength,t=[];let i=1;for(;i<e-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return r;const s=e-t.length,n=new Uint8Array(s);let a=0;for(i=0;i<s;a++,i++)a===t[0]&&(a++,t.shift()),n[i]=r[a];return n}function parseEmsg(r){const e=r[0];let t="",i="",s=0,n=0,a=0,o=0,l=0,c=0;if(e===0){for(;bin2str(r.subarray(c,c+1))!=="\0";)t+=bin2str(r.subarray(c,c+1)),c+=1;for(t+=bin2str(r.subarray(c,c+1)),c+=1;bin2str(r.subarray(c,c+1))!=="\0";)i+=bin2str(r.subarray(c,c+1)),c+=1;i+=bin2str(r.subarray(c,c+1)),c+=1,s=readUint32(r,12),n=readUint32(r,16),o=readUint32(r,20),l=readUint32(r,24),c=28}else if(e===1){c+=4,s=readUint32(r,c),c+=4;const d=readUint32(r,c);c+=4;const u=readUint32(r,c);for(c+=4,a=2**32*d+u,isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=readUint32(r,c),c+=4,l=readUint32(r,c),c+=4;bin2str(r.subarray(c,c+1))!=="\0";)t+=bin2str(r.subarray(c,c+1)),c+=1;for(t+=bin2str(r.subarray(c,c+1)),c+=1;bin2str(r.subarray(c,c+1))!=="\0";)i+=bin2str(r.subarray(c,c+1)),c+=1;i+=bin2str(r.subarray(c,c+1)),c+=1}const f=r.subarray(c,r.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:f}}function mp4Box(r,...e){const t=e.length;let i=8,s=t;for(;s--;)i+=e[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(r,4),s=0,i=8;s<t;s++)n.set(e[s],i),i+=e[s].byteLength;return n}function mp4pssh(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let i,s;if(e){i=1,s=new Uint8Array(e.length*16);for(let o=0;o<e.length;o++){const l=e[o];if(l.byteLength!==16)throw new RangeError("Invalid key");s.set(l,o*16)}}else i=0,s=new Uint8Array;let n;i>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([i,0,0,0]),r,n,s,a,t||new Uint8Array)}function parsePssh(r){if(!(r instanceof ArrayBuffer)||r.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(r),i=t.getUint32(0);if(r.byteLength!==i&&i>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Hex.hexDump(new Uint8Array(r,12,16));const n=t.getUint32(28);if(e.version===0){if(i-32<n)return null;e.data=new Uint8Array(r,32,n)}else if(e.version===1){e.kids=[];for(let a=0;a<n;a++)e.kids.push(new Uint8Array(r,32+a*16,16))}return e}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(e,t,i,s=[1],n=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=createInitializationVector(e);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=convertDataUriToArrayBytes(this.uri);if(t)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case KeySystemFormats.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(i,null,t);const s=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(s)),a=n.substring(n.indexOf("<"),n.length),c=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(c){const f=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(f){const d=base64Decode(f).subarray(0,16);changeEndianness(d),this.keyId=d}}break}default:{let i=t.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=keyUriToKeyIdMap[this.uri];if(!i){const s=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),keyUriToKeyIdMap[this.uri]=i}this.keyId=i}return this}}function createInitializationVector(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(r){return VARIABLE_REPLACEMENT_REGEX.test(r)}function substituteVariablesInAttributes(r,e,t){if(r.variableList!==null||r.hasVariableRefs)for(let i=t.length;i--;){const s=t[i],n=e[s];n&&(e[s]=substituteVariables(r,n))}}function substituteVariables(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(VARIABLE_REPLACEMENT_REGEX,i=>{const s=i.substring(2,i.length-1),n=t==null?void 0:t[s];return n===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):n})}return e}function addVariableDefinition(r,e,t){let i=r.variableList;i||(r.variableList=i={});let s,n;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))n=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,n=e.VALUE;s in i?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=n||""}function importVariableDefinition(r,e,t){const i=e.IMPORT;if(t&&i in t){let s=r.variableList;s||(r.variableList=s={}),s[i]=t[i]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function getMediaSource(r=!0){return typeof self=="undefined"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function isManagedMediaSource(r){return typeof self!="undefined"&&r===self.ManagedMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(r,e){const t=sampleEntryCodesISO[e];return!!t&&!!t[r.slice(0,4)]}function areCodecsMediaSourceSupported(r,e,t=!0){return!r.split(",").some(i=>!isCodecMediaSourceSupported(i,e,t))}function isCodecMediaSourceSupported(r,e,t=!0){var i;const s=getMediaSource(t);return(i=s==null?void 0:s.isTypeSupported(mimeTypeForCodec(r,e)))!=null?i:!1}function mimeTypeForCodec(r,e){return`${e}/mp4;codecs="${r}"`}function videoCodecPreferenceValue(r){if(r){const e=r.substring(0,4);return sampleEntryCodesISO.video[e]}return 2}function codecsSetSelectionPreferenceValue(r){return r.split(",").reduce((e,t)=>{const i=sampleEntryCodesISO.video[t];return i?(i*2+e)/(e?3:2):(sampleEntryCodesISO.audio[t]+e)/(e?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(r,e=!0){if(CODEC_COMPATIBLE_NAMES[r])return CODEC_COMPATIBLE_NAMES[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[r];for(let i=0;i<t.length;i++)if(isCodecMediaSourceSupported(t[i],"audio",e))return CODEC_COMPATIBLE_NAMES[r]=t[i],t[i];return r}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(r,e=!0){return r.replace(AUDIO_CODEC_REGEXP,t=>getCodecCompatibleNameLower(t.toLowerCase(),e))}function pickMostCompleteCodecName(r,e){return r&&r!=="mp4a"?r:e&&e.split(",")[0]}function convertAVC1ToAVCOTI(r){const e=r.split(".");if(e.length>2){let t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t}return r}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static resolve(e,t){return urlToolkitExports.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return IS_MEDIA_PLAYLIST.test(e)}static parseMasterPlaylist(e,t){const i=hasVariableReferences(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},n=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let a;for(;(a=MASTER_PLAYLIST_REGEX.exec(e))!=null;)if(a[1]){var o;const c=new AttrList(a[1]);substituteVariablesInAttributes(s,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const f=substituteVariables(s,a[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:M3U8Parser.resolve(f,t)},u=c.decimalResolution("RESOLUTION");u&&(d.width=u.width,d.height=u.height),setCodecs(c.CODECS,d),(o=d.unknownCodecs)!=null&&o.length||n.push(d),s.levels.push(d)}else if(a[3]){const c=a[3],f=a[4];switch(c){case"SESSION-DATA":{const d=new AttrList(f);substituteVariablesInAttributes(s,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const u=d["DATA-ID"];u&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[u]=d);break}case"SESSION-KEY":{const d=parseKey(f,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const d=new AttrList(f);substituteVariablesInAttributes(s,d,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(s,d,t)}break}case"CONTENT-STEERING":{const d=new AttrList(f);substituteVariablesInAttributes(s,d,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:M3U8Parser.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=parseStartTimeOffset(f);break}}}const l=n.length>0&&n.length<s.levels.length;return s.levels=l?n:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s;const n={},a=i.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(s=MASTER_PLAYLIST_MEDIA_REGEX.exec(e))!==null;){const c=new AttrList(s[1]),f=c.TYPE;if(f){const d=o[f],u=n[f]||[];n[f]=u,substituteVariablesInAttributes(i,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const g=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],m=c.CHANNELS,S=c.CHARACTERISTICS,y=c["INSTREAM-ID"],x={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||g||"",type:f,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:g,url:c.URI?M3U8Parser.resolve(c.URI,t):""};if(p&&(x.assocLang=p),m&&(x.channels=m),S&&(x.characteristics=S),y&&(x.instreamId=y),d!=null&&d.length){const E=M3U8Parser.findGroup(d,x.groupId)||d[0];assignCodec(x,E,"audioCodec"),assignCodec(x,E,"textCodec")}u.push(x)}}return n}static parseLevelPlaylist(e,t,i,s,n,a){const o=new LevelDetails(t),l=o.fragments;let c=null,f=0,d=0,u=0,g=0,p=null,m=new Fragment(s,t),S,y,x,E=-1,T=!1,A=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,o.m3u8=e,o.hasVariableRefs=hasVariableReferences(e);(S=LEVEL_PLAYLIST_REGEX_FAST.exec(e))!==null;){T&&(T=!1,m=new Fragment(s,t),m.start=u,m.sn=f,m.cc=g,m.level=i,c&&(m.initSegment=c,m.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null,A&&(m.setByteRange(A),A=null)));const F=S[1];if(F){m.duration=parseFloat(F);const M=(" "+S[2]).slice(1);m.title=M||null,m.tagList.push(M?["INF",F,M]:["INF",F])}else if(S[3]){if(isFiniteNumber(m.duration)){m.start=u,x&&setFragLevelKeys(m,x,o),m.sn=f,m.level=i,m.cc=g,l.push(m);const M=(" "+S[3]).slice(1);m.relurl=substituteVariables(o,M),assignProgramDateTime(m,p),p=m,u+=m.duration,f++,d=0,T=!0}}else if(S[4]){const M=(" "+S[4]).slice(1);p?m.setByteRange(M,p):m.setByteRange(M)}else if(S[5])m.rawProgramDateTime=(" "+S[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),E===-1&&(E=l.length);else{if(S=S[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!S){logger.warn("No matches on slow regex match for level playlist!");continue}for(y=1;y<S.length&&typeof S[y]=="undefined";y++);const M=(" "+S[y]).slice(1),B=(" "+S[y+1]).slice(1),N=S[y+2]?(" "+S[y+2]).slice(1):"";switch(M){case"PLAYLIST-TYPE":o.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":f=o.startSN=parseInt(B);break;case"SKIP":{const G=new AttrList(B);substituteVariablesInAttributes(o,G,["RECENTLY-REMOVED-DATERANGES"]);const U=G.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(U)){o.skippedSegments=U;for(let L=U;L--;)l.unshift(null);f+=U}const O=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");O&&(o.recentlyRemovedDateranges=O.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(B),1);break;case"VERSION":o.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(B||N)&&m.tagList.push(N?[B,N]:[B]);break;case"DISCONTINUITY":g++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([M]);break;case"BITRATE":m.tagList.push([M,B]);break;case"DATERANGE":{const G=new AttrList(B);substituteVariablesInAttributes(o,G,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(o,G,G.clientAttrs);const U=new DateRange(G,o.dateRanges[G.ID]);U.isValid||o.skippedSegments?o.dateRanges[U.id]=U:logger.warn(`Ignoring invalid DATERANGE tag: "${B}"`),m.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const G=new AttrList(B);substituteVariablesInAttributes(o,G,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in G?importVariableDefinition(o,G,a):addVariableDefinition(o,G,t)}break}case"DISCONTINUITY-SEQUENCE":g=parseInt(B);break;case"KEY":{const G=parseKey(B,t,o);if(G.isSupported()){if(G.method==="NONE"){x=void 0;break}x||(x={}),x[G.keyFormat]&&(x=_extends({},x)),x[G.keyFormat]=G}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${B}"`);break}case"START":o.startTimeOffset=parseStartTimeOffset(B);break;case"MAP":{const G=new AttrList(B);if(substituteVariablesInAttributes(o,G,["BYTERANGE","URI"]),m.duration){const U=new Fragment(s,t);setInitSegment(U,G,i,x),c=U,m.initSegment=c,c.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=c.rawProgramDateTime)}else{const U=m.byteRangeEndOffset;if(U){const O=m.byteRangeStartOffset;A=`${U-O}@${O}`}else A=null;setInitSegment(m,G,i,x),c=m,T=!0}break}case"SERVER-CONTROL":{const G=new AttrList(B);o.canBlockReload=G.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=G.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&G.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=G.optionalFloat("PART-HOLD-BACK",0),o.holdBack=G.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const G=new AttrList(B);o.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=o.partList;G||(G=o.partList=[]);const U=d>0?G[G.length-1]:void 0,O=d++,L=new AttrList(B);substituteVariablesInAttributes(o,L,["BYTERANGE","URI"]);const D=new Part(L,m,t,O,U);G.push(D),m.duration+=D.duration;break}case"PRELOAD-HINT":{const G=new AttrList(B);substituteVariablesInAttributes(o,G,["URI"]),o.preloadHint=G;break}case"RENDITION-REPORT":{const G=new AttrList(B);substituteVariablesInAttributes(o,G,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(G);break}default:logger.warn(`line parsed but not handled: ${S}`);break}}}p&&!p.relurl?(l.pop(),u-=p.duration,o.partList&&(o.fragmentHint=p)):o.partList&&(assignProgramDateTime(m,p),m.cc=g,o.fragmentHint=m,x&&setFragLevelKeys(m,x,o));const _=l.length,P=l[0],k=l[_-1];if(u+=o.skippedSegments*o.targetduration,u>0&&_&&k){o.averagetargetduration=u/_;const F=k.sn;o.endSN=F!=="initSegment"?F:0,o.live||(k.endList=!0),P&&(o.startCC=P.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(u+=o.fragmentHint.duration),o.totalduration=u,o.endCC=g,E>0&&backfillProgramDateTimes(l,E),o}}function parseKey(r,e,t){var i,s;const n=new AttrList(r);substituteVariablesInAttributes(t,n,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=(i=n.METHOD)!=null?i:"",o=n.URI,l=n.hexadecimalInteger("IV"),c=n.KEYFORMATVERSIONS,f=(s=n.KEYFORMAT)!=null?s:"identity";o&&n.IV&&!l&&logger.error(`Invalid IV: ${n.IV}`);const d=o?M3U8Parser.resolve(o,e):"",u=(c||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(a,d,f,u,l)}function parseStartTimeOffset(r){const t=new AttrList(r).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(t)?t:null}function setCodecs(r,e){let t=(r||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=t.filter(n=>isCodecType(n,i));s.length&&(e[`${i}Codec`]=s.join(","),t=t.filter(n=>s.indexOf(n)===-1))}),e.unknownCodecs=t}function assignCodec(r,e,t){const i=e[t];i&&(r[t]=i)}function backfillProgramDateTimes(r,e){let t=r[e];for(let i=e;i--;){const s=r[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function assignProgramDateTime(r,e){r.rawProgramDateTime?r.programDateTime=Date.parse(r.rawProgramDateTime):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime),isFiniteNumber(r.programDateTime)||(r.programDateTime=null,r.rawProgramDateTime=null)}function setInitSegment(r,e,t,i){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",i&&(r.levelkeys=i),r.initSegment=null}function setFragLevelKeys(r,e,t){r.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(r)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(r){const{type:e}=r;switch(e){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class PlaylistLoader{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,n=i||s,a=new n(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(e,t){const{id:i,level:s,pathwayId:n,url:a,deliveryDirectives:o}=t;this.load({id:i,level:s,pathwayId:n,responseType:"text",type:PlaylistContextType.LEVEL,url:a,deliveryDirectives:o})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:n,deliveryDirectives:a}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:n,deliveryDirectives:a}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:a})}load(e){var t;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=s.context;if(c&&c.url===e.url&&c.level===e.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let n;if(e.type===PlaylistContextType.MANIFEST?n=i.manifestLoadPolicy.default:n=_extends({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),isFiniteNumber((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===PlaylistContextType.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===PlaylistContextType.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const f=c.partTarget,d=c.targetduration;if(f&&d){const u=Math.max(f*3,d*.8)*1e3;n=_extends({},n,{maxTimeToFirstByteMs:Math.min(u,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(u,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,f,d,u)=>{const g=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=c.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),u||null,f);return}f.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(c,f,d,u||null,g):this.handleMasterPlaylist(c,f,d,u)},onError:(c,f,d,u)=>{this.handleNetworkError(f,d,!1,c,u)},onTimeout:(c,f,d)=>{this.handleNetworkError(f,d,!0,void 0,c)}};s.load(e,o,l)}handleMasterPlaylist(e,t,i,s){const n=this.hls,a=e.data,o=getResponseUrl(e,i),l=M3U8Parser.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,i,l.playlistParsingError,s,t);return}const{contentSteering:c,levels:f,sessionData:d,sessionKeys:u,startTimeOffset:g,variableList:p}=l;this.variableList=p;const{AUDIO:m=[],SUBTITLES:S,"CLOSED-CAPTIONS":y}=M3U8Parser.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(E=>!E.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),n.trigger(Events.MANIFEST_LOADED,{levels:f,audioTracks:m,subtitles:S,captions:y,contentSteering:c,url:o,stats:t,networkDetails:s,sessionData:d,sessionKeys:u,startTimeOffset:g,variableList:p})}handleTrackOrLevelPlaylist(e,t,i,s,n){const a=this.hls,{id:o,level:l,type:c}=i,f=getResponseUrl(e,i),d=0,u=isFiniteNumber(l)?l:isFiniteNumber(o)?o:0,g=mapContextToLevelType(i),p=M3U8Parser.parseLevelPlaylist(e.data,f,u,g,d,this.variableList);if(c===PlaylistContextType.MANIFEST){const m={attrs:new AttrList({}),bitrate:0,details:p,name:"",url:f};a.trigger(Events.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=p,this.handlePlaylistLoaded(p,e,t,i,s,n)}handleManifestParsingError(e,t,i,s,n){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===PlaylistContextType.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:n})}handleNetworkError(e,t,i=!1,s,n){let a=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===PlaylistContextType.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===PlaylistContextType.AUDIO_TRACK||e.type===PlaylistContextType.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);logger.warn(`[playlist-loader]: ${a}`);let l=ErrorDetails.UNKNOWN,c=!1;const f=this.getInternalLoader(e);switch(e.type){case PlaylistContextType.MANIFEST:l=i?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,c=!0;break;case PlaylistContextType.LEVEL:l=i?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,c=!1;break;case PlaylistContextType.AUDIO_TRACK:l=i?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case PlaylistContextType.SUBTITLE_TRACK:l=i?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,c=!1;break}f&&this.resetInternalLoader(e.type);const d={type:ErrorTypes.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:f,context:e,error:o,networkDetails:t,stats:n};if(s){const u=(t==null?void 0:t.url)||e.url;d.response=_objectSpread2({url:u,data:void 0},s)}this.hls.trigger(Events.ERROR,d)}handlePlaylistLoaded(e,t,i,s,n,a){const o=this.hls,{type:l,level:c,id:f,groupId:d,deliveryDirectives:u}=s,g=getResponseUrl(t,s),p=mapContextToLevelType(s),m=typeof s.level=="number"&&p===PlaylistLevelType.MAIN?c:void 0;if(!e.fragments.length){const y=new Error("No Segments found in Playlist");o.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:y,reason:y.message,response:t,context:s,level:m,parent:p,networkDetails:n,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const S=e.playlistParsingError;if(S){o.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:S,reason:S.message,response:t,context:s,level:m,parent:p,networkDetails:n,stats:i});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:o.trigger(Events.LEVEL_LOADED,{details:e,level:m||0,id:f||0,stats:i,networkDetails:n,deliveryDirectives:u});break;case PlaylistContextType.AUDIO_TRACK:o.trigger(Events.AUDIO_TRACK_LOADED,{details:e,id:f||0,groupId:d||"",stats:i,networkDetails:n,deliveryDirectives:u});break;case PlaylistContextType.SUBTITLE_TRACK:o.trigger(Events.SUBTITLE_TRACK_LOADED,{details:e,id:f||0,groupId:d||"",stats:i,networkDetails:n,deliveryDirectives:u});break}}}function sendAddTrackEvent(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function addCueToTrack(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){logger.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function clearCurrentCues(r){const e=r.mode;if(e==="disabled"&&(r.mode="hidden"),r.cues)for(let t=r.cues.length;t--;)r.removeCue(r.cues[t]);e==="disabled"&&(r.mode=e)}function removeCuesInRange(r,e,t,i){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const n=getCuesInRange(r.cues,e,t);for(let a=0;a<n.length;a++)(!i||i(n[a]))&&r.removeCue(n[a])}s==="disabled"&&(r.mode=s)}function getFirstCueIndexAfterTime(r,e){if(e<r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let i=0,s=t;for(;i<=s;){const n=Math.floor((s+i)/2);if(e<r[n].startTime)s=n-1;else if(e>r[n].startTime&&i<t)i=n+1;else return n}return r[i].startTime-e<e-r[s].startTime?i:s}function getCuesInRange(r,e,t){const i=[],s=getFirstCueIndexAfterTime(r,e);if(s>-1)for(let n=s,a=r.length;n<a;n++){const o=r[n];if(o.startTime>=e&&o.endTime<=t)i.push(o);else if(o.startTime>t)return i}return i}function filterSubtitleTracks(r){const e=[];for(let t=0;t<r.length;t++){const i=r[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(r[t])}return e}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(typeof self!="undefined")return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(r,e,t,i,s){let n=new r(e,t,"");try{n.value=i,s&&(n.type=s)}catch{n=new r(e,t,JSON.stringify(s?_objectSpread2({type:s},i):i))}return n}const MAX_CUE_ENDTIME=(()=>{const r=getCueClass();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(r,e){return r.getTime()/1e3-e}function hexToArrayBuffer(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){!this.id3Track||(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(!!this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return sendAddTrackEvent(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=getCueClass();if(!!a)for(let o=0;o<n.length;o++){const l=n[o].type;if(l===MetadataSchema.emsg&&!i||!s)continue;const c=getID3Frames(n[o].data);if(c){const f=n[o].pts;let d=f+n[o].duration;d>MAX_CUE_ENDTIME&&(d=MAX_CUE_ENDTIME),d-f<=0&&(d=f+MIN_CUE_DURATION);for(let g=0;g<c.length;g++){const p=c[g];if(!isTimeStampFrame(p)){this.updateId3CueEnds(f,l);const m=createCueWithDataFields(a,f,d,p,l);m&&this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,t){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let n=s.length;n--;){const a=s[n];a.type===t&&a.startTime<e&&a.endTime===MAX_CUE_ENDTIME&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:n,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(n&&(o||l)){let c;s==="audio"?c=f=>f.type===MetadataSchema.audioId3&&l:s==="video"?c=f=>f.type===MetadataSchema.emsg&&o:c=f=>f.type===MetadataSchema.audioId3&&l||f.type===MetadataSchema.emsg&&o,removeCuesInRange(n,t,i,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:s}=this,{dateRanges:n}=t,a=Object.keys(n);if(s){const f=Object.keys(i).filter(d=>!a.includes(d));for(let d=f.length;d--;){const u=f[d];Object.keys(i[u].cues).forEach(g=>{s.removeCue(i[u].cues[g])}),delete i[u]}}const o=t.fragments[t.fragments.length-1];if(a.length===0||!isFiniteNumber(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=o.programDateTime/1e3-o.start,c=getCueClass();for(let f=0;f<a.length;f++){const d=a[f],u=n[d],g=dateRangeDateToTimelineSeconds(u.startDate,l),p=i[d],m=(p==null?void 0:p.cues)||{};let S=(p==null?void 0:p.durationKnown)||!1,y=MAX_CUE_ENDTIME;const x=u.endDate;if(x)y=dateRangeDateToTimelineSeconds(x,l),S=!0;else if(u.endOnNext&&!S){const T=a.reduce((A,_)=>{if(_!==u.id){const P=n[_];if(P.class===u.class&&P.startDate>u.startDate&&(!A||u.startDate<A.startDate))return P}return A},null);T&&(y=dateRangeDateToTimelineSeconds(T.startDate,l),S=!0)}const E=Object.keys(u.attr);for(let T=0;T<E.length;T++){const A=E[T];if(!isDateRangeCueAttribute(A))continue;const _=m[A];if(_)S&&!p.durationKnown&&(_.endTime=y);else if(c){let P=u.attr[A];isSCTE35Attribute(A)&&(P=hexToArrayBuffer(P));const k=createCueWithDataFields(c,g,y,{key:A,data:P},MetadataSchema.dateRange);k&&(k.id=d,this.id3Track.addCue(k),m[A]=k)}}i[d]={cues:m,dateRange:u,durationKnown:S}}}}class LatencyController{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&i||t;(l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=n!==void 0?n:a*s);const f=s,d=1;return c+Math.min(this.stallCount*d,f)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(e===null||t===null||i===null)return null;const s=i.edge,n=e-t-this.edgeStalled,a=s-i.totalduration,o=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,n),o)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:n}=this.config;if(!s||n===1||!t.live)return;const a=this.targetLatency;if(a===null)return;const o=i-a,l=Math.min(this.maxLatency,a+t.targetduration);if(o<l&&o>.05&&this.forwardBufferLength>1){const f=Math.min(2,Math.max(1,n)),d=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(f,Math.max(1,d))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(r){return HdcpLevels.indexOf(r)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(r){return!!r&&VideoRangeValues.indexOf(r)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(r){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=r,s=i<e/2;return e&&s?t?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Level{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return hasGroup(this._audioGroups,e)}hasSubtitleGroup(e){return hasGroup(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(!!t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function hasGroup(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function updateFromToPTS(r,e){const t=e.startPTS;if(isFiniteNumber(t)){let i=0,s;e.sn>r.sn?(i=t-r.start,s=r):(i=r.start-t,s=e),s.duration!==i&&(s.duration=i)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.start=r.start+(r.minEndPTS-r.start):e.start=r.start+r.duration:e.start=Math.max(r.start-e.duration,0)}function updateFragPTSDTS(r,e,t,i,s,n){i-t<=0&&(logger.warn("Fragment should have a positive duration",e),i=t+e.duration,n=s+e.duration);let o=t,l=i;const c=e.startPTS,f=e.endPTS;if(isFiniteNumber(c)){const S=Math.abs(c-t);isFiniteNumber(e.deltaPTS)?e.deltaPTS=Math.max(S,e.deltaPTS):e.deltaPTS=S,o=Math.max(t,c),t=Math.min(t,c),s=Math.min(s,e.startDTS),l=Math.min(i,f),i=Math.max(i,f),n=Math.max(n,e.endDTS)}const d=t-e.start;e.start!==0&&(e.start=t),e.duration=i-e.start,e.startPTS=t,e.maxStartPTS=o,e.startDTS=s,e.endPTS=i,e.minEndPTS=l,e.endDTS=n;const u=e.sn;if(!r||u<r.startSN||u>r.endSN)return 0;let g;const p=u-r.startSN,m=r.fragments;for(m[p]=e,g=p;g>0;g--)updateFromToPTS(m[g],m[g-1]);for(g=p;g<m.length-1;g++)updateFromToPTS(m[g],m[g+1]);return r.fragmentHint&&updateFromToPTS(m[m.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,d}function mergeDetails(r,e){let t=null;const i=r.fragments;for(let l=i.length-1;l>=0;l--){const c=i[l].initSegment;if(c){t=c;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let s=0,n;if(mapFragmentIntersection(r,e,(l,c)=>{l.relurl&&(s=l.cc-c.cc),isFiniteNumber(l.startPTS)&&isFiniteNumber(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(n=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,l.initSegment&&(c.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var f;c&&(!c.initSegment||c.initSegment.relurl===((f=t)==null?void 0:f.relurl))&&(c.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=mergeDateRanges(r.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const a=e.fragments;if(s){logger.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<a.length;l++)a[l].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),mapPartIntersection(r.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),n?updateFragPTSDTS(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):adjustSliding(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const l=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=l),e.driftEndTime=o,e.driftEnd=l}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime}function mergeDateRanges(r,e,t){const i=_extends({},r);return t&&t.forEach(s=>{delete i[s]}),Object.keys(e).forEach(s=>{const n=new DateRange(e[s].attr,i[s]);n.isValid?i[s]=n:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[s].attr)}"`)}),i}function mapPartIntersection(r,e,t){if(r&&e){let i=0;for(let s=0,n=r.length;s<=n;s++){const a=r[s],o=e[s+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):i--}}}function mapFragmentIntersection(r,e,t){const i=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,n=(r.fragmentHint?1:0)+(i?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let c=s;c<=n;c++){const f=l[a+c];let d=o[c];i&&!d&&c<i&&(d=e.fragments[c]=f),f&&d&&t(f,d)}}function adjustSliding(r,e){const t=e.startSN+e.skippedSegments-r.startSN,i=r.fragments;t<0||t>=i.length||addSliding(e,i[t].start)}function addSliding(r,e){if(e){const t=r.fragments;for(let i=r.skippedSegments;i<t.length;i++)t[i].start+=e;r.fragmentHint&&(r.fragmentHint.start+=e)}}function computeReloadInterval(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const i=r.fragments,s=4;if(i.length&&t*s>e){const n=i[i.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function getFragmentWithSN(r,e,t){if(!(r!=null&&r.details))return null;const i=r.details;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function getPartWith(r,e,t){var i;return r!=null&&r.details?findPart((i=r.details)==null?void 0:i.partList,e,t):null}function findPart(r,e,t){if(r)for(let i=r.length;i--;){const s=r[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function reassignFragmentLevelIndexes(r){r.forEach((e,t)=>{const{details:i}=e;i!=null&&i.fragments&&i.fragments.forEach(s=>{s.level=t})})}function isTimeoutError(r){switch(r.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(r,e){const t=isTimeoutError(e);return r.default[`${t?"timeout":"error"}Retry`]}function getRetryDelay(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function getLoaderConfigWithoutReties(r){return _objectSpread2(_objectSpread2({},r),{errorRetry:null,timeoutRetry:null})}function shouldRetry(r,e,t,i){if(!r)return!1;const s=i==null?void 0:i.code,n=e<r.maxNumRetry&&(retryForHttpStatus(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,i,n):n}function retryForHttpStatus(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}const BinarySearch={search:function(r,e){let t=0,i=r.length-1,s=null,n=null;for(;t<=i;){s=(t+i)/2|0,n=r[s];const a=e(n);if(a>0)t=s+1;else if(a<0)i=s-1;else return n}return null}};function findFragmentByPDT(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!isFiniteNumber(e))return null;const i=r[0].programDateTime;if(e<(i||0))return null;const s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let n=0;n<r.length;++n){const a=r[n];if(pdtWithinToleranceTest(e,t,a))return a}return null}function findFragmentByPTS(r,e,t=0,i=0){let s=null;if(r){s=e[r.sn-e[0].sn+1]||null;const a=r.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&(!r||r.level===s.level)&&fragmentWithinToleranceTest(t,i,s)===0)return s;const n=BinarySearch.search(e,fragmentWithinToleranceTest.bind(null,t,i));return n&&(n!==r||!s)?n:s}function fragmentWithinToleranceTest(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=r?1:t.start-i>r&&t.start?-1:0}function pdtWithinToleranceTest(r,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>r}function findFragWithCC(r,e){return BinarySearch.search(r,t=>t.cc<e?1:t.cc>e?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Events.ERROR,this.onError,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;!e||(e.off(Events.ERROR,this.onError,this),e.off(Events.ERROR,this.onErrorOut,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===PlaylistLevelType.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,s;if(t.fatal)return;const n=this.hls,a=t.context;switch(t.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case ErrorDetails.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var o,l;const c=t.parent===PlaylistLevelType.MAIN?t.level:n.loadLevel;t.details===ErrorDetails.LEVEL_EMPTY_ERROR&&!!((o=t.context)!=null&&(l=o.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const c=n.levels[n.loadLevel];if(c&&(a.type===PlaylistContextType.AUDIO_TRACK&&c.hasAudioGroup(a.groupId)||a.type===PlaylistContextType.SUBTITLE_TRACK&&c.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,t.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=n.levels[n.loadLevel],f=c==null?void 0:c.attrs["HDCP-LEVEL"];f?t.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:f}:this.keySystemError(t)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(s=t.level)!=null?s:n.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:t.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}t.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,s=getRetryConfig(i.config.playlistLoadPolicy,e),n=this.playlistError++;if(shouldRetry(s,n,isTimeoutError(e),e.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:s,retryCount:n};const o=this.getLevelSwitchAction(e,t);return s&&(o.retryConfig=s,o.retryCount=n),o}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,o=getRetryConfig(e.details.startsWith("key")?a:n,e),l=t.levels.reduce((f,d)=>f+d.fragmentError,0);if(s&&(e.details!==ErrorDetails.FRAG_GAP&&s.fragmentError++,shouldRetry(o,l,isTimeoutError(e),e.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,i);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const s=this.hls.levels[t];if(s){var n,a;const c=e.details;s.loadError++,c===ErrorDetails.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1;const{levels:d,loadLevel:u,minAutoLevel:g,maxAutoLevel:p}=i;i.autoLevelEnabled||(i.loadLevel=-1);const m=(n=e.frag)==null?void 0:n.type,y=(m===PlaylistLevelType.AUDIO&&c===ErrorDetails.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===ErrorDetails.BUFFER_ADD_CODEC_ERROR||c===ErrorDetails.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:_})=>s.audioCodec!==_),E=e.sourceBufferName==="video"&&(c===ErrorDetails.BUFFER_ADD_CODEC_ERROR||c===ErrorDetails.BUFFER_APPEND_ERROR)&&d.some(({codecSet:_,audioCodec:P})=>s.codecSet!==_&&s.audioCodec===P),{type:T,groupId:A}=(a=e.context)!=null?a:{};for(let _=d.length;_--;){const P=(_+u)%d.length;if(P!==u&&P>=g&&P<=p&&d[P].loadError===0){var o,l;const k=d[P];if(c===ErrorDetails.FRAG_GAP&&e.frag){const F=d[P].details;if(F){const M=findFragmentByPTS(e.frag,F.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(T===PlaylistContextType.AUDIO_TRACK&&k.hasAudioGroup(A)||T===PlaylistContextType.SUBTITLE_TRACK&&k.hasSubtitleGroup(A))continue;if(m===PlaylistLevelType.AUDIO&&(o=s.audioGroups)!=null&&o.some(F=>k.hasAudioGroup(F))||m===PlaylistLevelType.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(F=>k.hasSubtitleGroup(F))||y&&s.audioCodec===k.audioCodec||!y&&s.audioCodec!==k.audioCodec||E&&s.codecSet===k.codecSet)continue}f=P;break}}if(f>-1&&i.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:f}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==ErrorDetails.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s,hdcpLevel:n,nextAutoLevel:a}=i;switch(s){case ErrorActionFlags.None:this.switchLevel(e,a);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:n&&(t.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(n)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${t}:`),this.warn=logger.warn.bind(logger,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const s=t==null?void 0:t.renditionReports;if(s){let n=-1;for(let a=0;a<s.length;a++){const o=s[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(c){logger.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){n=a;break}else l===e.substring(0,l.length)&&(n=a)}if(n!==-1){const a=s[n],o=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&f>t.partTarget&&(l+=1)}const c=i&&getSkipValue(i);return new HlsUrlParameters(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){const{details:s,stats:n}=t,a=self.performance.now(),o=n.loading.first?Math.max(0,a-n.loading.first):0;if(s.advancedDateTime=Date.now()-o,s.live||i!=null&&i.live){if(s.reloaded(i),i&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),i&&s.fragments.length>0&&mergeDetails(i,s),!this.canLoad||!s.live)return;let l,c,f;if(s.canBlockReload&&s.endSN&&s.advanced){const S=this.hls.config.lowLatencyMode,y=s.lastPartSn,x=s.endSN,E=s.lastPartIndex,T=E!==-1,A=y===x,_=S?0:E;T?(c=A?x+1:y,f=A?_:E+1):c=x+1;const P=s.age,k=P+s.ageHeader;let F=Math.min(k-s.partTarget,s.targetduration*1.5);if(F>0){if(i&&F>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${F} with playlist age: ${s.age}`),F=0;else{const M=Math.floor(F/s.targetduration);c+=M,f!==void 0&&(f+=Math.round(F%s.targetduration/s.partTarget)),this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${F} skip sn ${M} to part ${f}`)}s.tuneInGoal=F}if(l=this.getDeliveryDirectives(s,t.deliveryDirectives,c,f),S||!A){this.loadPlaylist(l);return}}else(s.canBlockReload||s.canSkipUntil)&&(l=this.getDeliveryDirectives(s,t.deliveryDirectives,c,f));const d=this.hls.mainForwardBufferInfo,u=d?d.end-d.len:0,g=(s.edge-u)*1e3,p=computeReloadInterval(s,g);s.updated&&a>this.requestScheduled+p&&(this.requestScheduled=n.loading.start),c!==void 0&&s.canBlockReload?this.requestScheduled=n.loading.first+p-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+p<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=p);let m=this.requestScheduled-a;m=Math.max(0,m),this.log(`reload live playlist ${e} in ${Math.round(m)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),m)}else this.clearTimer()}getDeliveryDirectives(e,t,i,s){let n=getSkipValue(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,n=HlsSkip.No),new HlsUrlParameters(i,s,n)}checkRetry(e){const t=e.details,i=isTimeoutError(e),s=e.errorAction,{action:n,retryCount:a=0,retryConfig:o}=s||{},l=!!s&&!!o&&(n===NetworkErrorAction.RetryRequest||!s.resolved&&n===NetworkErrorAction.SendAlternateToPenaltyBox);if(l){var c;if(this.requestScheduled=-1,a>=o.maxNumRetry)return!1;if(i&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=getRetryDelay(o,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}class EWMA{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class EwmaBandWidthEstimator{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(e),this.fast_=new EWMA(t),this.defaultTTFB_=s,this.ttfb_=new EWMA(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:n}=this;i.halfLife!==e&&(this.slow_=new EWMA(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new EWMA(t,s.getEstimate(),s.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new EWMA(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,s=e/1e3,n=i/s;this.fast_.sample(s,n),this.slow_.sample(s,n)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(r,e,t,i,s,n){const a=r.audioCodec?r.audioGroups:null,o=n==null?void 0:n.audioCodec,l=n==null?void 0:n.channels,c=l?parseInt(l):o?1/0:2;let f=null;if(a!=null&&a.length)try{a.length===1&&a[0]?f=e.groups[a[0]].channels:f=a.reduce((d,u)=>{if(u){const g=e.groups[u];if(!g)throw new Error(`Audio track group ${u} not found`);Object.keys(g.channels).forEach(p=>{d[p]=(d[p]||0)+g.channels[p]})}return d},{2:0})}catch{return!0}return r.videoCodec!==void 0&&(r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(i,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!f&&isFiniteNumber(c)&&Object.keys(f).some(d=>parseInt(d)>c)}function getMediaDecodingInfoPromise(r,e,t){const i=r.videoCodec,s=r.audioCodec;if(!i||!s||!t)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const n={width:r.width,height:r.height,bitrate:Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)),framerate:r.frameRate||30},a=r.videoRange;a!=="SDR"&&(n.transferFunction=a.toLowerCase());const o=i.split(",").map(l=>({type:"media-source",video:_objectSpread2(_objectSpread2({},n),{},{contentType:mimeTypeForCodec(l,"video")})}));return s&&r.audioGroups&&r.audioGroups.forEach(l=>{var c;!l||(c=e.groups[l])==null||c.tracks.forEach(f=>{if(f.groupId===l){const d=f.channels||"",u=parseFloat(d);isFiniteNumber(u)&&u>2&&o.push.apply(o,s.split(",").map(g=>({type:"media-source",audio:{contentType:mimeTypeForCodec(g,"audio"),channels:""+u}})))}})}),Promise.all(o.map(l=>{const c=getMediaDecodingInfoKey(l);return SUPPORTED_INFO_CACHE[c]||(SUPPORTED_INFO_CACHE[c]=t.decodingInfo(l))})).then(l=>({supported:!l.some(c=>!c.supported),configurations:o,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:o,decodingInfoResults:[],error:l}))}function getMediaDecodingInfoKey(r){const{audio:e,video:t}=r,i=t||e;if(i){const s=i.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${s}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${s}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function getVideoSelectionOptions(r,e){let t=!1,i=[];return r&&(t=r!=="SDR",i=[r]),e&&(i=e.allowedVideoRanges||VideoRangeValues.slice(0),t=e.preferHDR!==void 0?e.preferHDR:isHdrSupported(),t?i=i.filter(s=>s!=="SDR"):i=["SDR"]),{preferHDR:t,allowedVideoRanges:i}}function getStartCodecTier(r,e,t,i,s){const n=Object.keys(r),a=i==null?void 0:i.channels,o=i==null?void 0:i.audioCodec,l=a&&parseInt(a)===2;let c=!0,f=!1,d=1/0,u=1/0,g=1/0,p=0,m=[];const{preferHDR:S,allowedVideoRanges:y}=getVideoSelectionOptions(e,s);for(let A=n.length;A--;){const _=r[n[A]];c=_.channels[2]>0,d=Math.min(d,_.minHeight),u=Math.min(u,_.minFramerate),g=Math.min(g,_.minBitrate);const P=y.filter(k=>_.videoRanges[k]>0);P.length>0&&(f=!0,m=P)}d=isFiniteNumber(d)?d:0,u=isFiniteNumber(u)?u:0;const x=Math.max(1080,d),E=Math.max(30,u);return g=isFiniteNumber(g)?g:t,t=Math.max(g,t),f||(e=void 0,m=[]),{codecSet:n.reduce((A,_)=>{const P=r[_];if(_===A)return A;if(P.minBitrate>t)return logStartCodecCandidateIgnored(_,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),A;if(!P.hasDefaultAudio)return logStartCodecCandidateIgnored(_,"no renditions with default or auto-select sound found"),A;if(o&&_.indexOf(o.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(_,`audio codec preference "${o}" not found`),A;if(a&&!l){if(!P.channels[a])return logStartCodecCandidateIgnored(_,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),A}else if((!o||l)&&c&&P.channels[2]===0)return logStartCodecCandidateIgnored(_,"no renditions with stereo sound found"),A;return P.minHeight>x?(logStartCodecCandidateIgnored(_,`min resolution of ${P.minHeight} > maximum of ${x}`),A):P.minFramerate>E?(logStartCodecCandidateIgnored(_,`min framerate of ${P.minFramerate} > maximum of ${E}`),A):m.some(k=>P.videoRanges[k]>0)?P.maxScore<p?(logStartCodecCandidateIgnored(_,`max score of ${P.maxScore} < selected max of ${p}`),A):A&&(codecsSetSelectionPreferenceValue(_)>=codecsSetSelectionPreferenceValue(A)||P.fragmentError>r[A].fragmentError)?A:(p=P.maxScore,_):(logStartCodecCandidateIgnored(_,`no variants with VIDEO-RANGE of ${JSON.stringify(m)} found`),A)},void 0),videoRanges:m,preferHDR:S,minFramerate:u,minBitrate:g}}function logStartCodecCandidateIgnored(r,e){logger.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function getAudioTracksByGroup(r){return r.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const s=t.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(r,e,t,i){return r.slice(t,i+1).reduce((s,n)=>{if(!n.codecSet)return s;const a=n.audioGroups;let o=s[n.codecSet];o||(s[n.codecSet]=o={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),o.minBitrate=Math.min(o.minBitrate,n.bitrate);const l=Math.min(n.height,n.width);return o.minHeight=Math.min(o.minHeight,l),o.minFramerate=Math.min(o.minFramerate,n.frameRate),o.maxScore=Math.max(o.maxScore,n.score),o.fragmentError+=n.fragmentError,o.videoRanges[n.videoRange]=(o.videoRanges[n.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const f=e.groups[c];!f||(o.hasDefaultAudio=o.hasDefaultAudio||e.hasDefaultAudio?f.hasDefault:f.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(f.channels).forEach(d=>{o.channels[d]=(o.channels[d]||0)+f.channels[d]}))}),s},{})}function findMatchingOption(r,e,t){if("attrs"in r){const i=e.indexOf(r);if(i!==-1)return i}for(let i=0;i<e.length;i++){const s=e[i];if(matchesOption(r,s,t))return i}return-1}function matchesOption(r,e,t){const{groupId:i,name:s,lang:n,assocLang:a,characteristics:o,default:l}=r,c=r.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(n===void 0||e.lang===n)&&(n===void 0||e.assocLang===a)&&(l===void 0||e.default===l)&&(c===void 0||e.forced===c)&&(o===void 0||characteristicsMatch(o,e.characteristics))&&(t===void 0||t(r,e))}function characteristicsMatch(r,e=""){const t=r.split(","),i=e.split(",");return t.length===i.length&&!t.some(s=>i.indexOf(s)===-1)}function audioMatchPredicate(r,e){const{audioCodec:t,channels:i}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function findClosestLevelWithAudioGroup(r,e,t,i,s){const n=e[i],o=e.reduce((u,g,p)=>{const m=g.uri;return(u[m]||(u[m]=[])).push(p),u},{})[n.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=n.videoRange,c=n.frameRate,f=n.codecSet.substring(0,4),d=searchDownAndUpList(e,i,u=>{if(u.videoRange!==l||u.frameRate!==c||u.codecSet.substring(0,4)!==f)return!1;const g=u.audioGroups,p=t.filter(m=>!g||g.indexOf(m.groupId)!==-1);return findMatchingOption(r,p,s)>-1});return d>-1?d:searchDownAndUpList(e,i,u=>{const g=u.audioGroups,p=t.filter(m=>!g||g.indexOf(m.groupId)!==-1);return findMatchingOption(r,p,s)>-1})}function searchDownAndUpList(r,e,t){for(let i=e;i;i--)if(t(r[i]))return i;for(let i=e+1;i<r.length;i++)if(t(r[i]))return i;return-1}class AbrController{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:i,hls:s}=this,{autoLevelEnabled:n,media:a}=s;if(!t||!a)return;const o=performance.now(),l=i?i.stats:t.stats,c=i?i.duration:t.duration,f=o-l.loading.start,d=s.minAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||t.level<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!n||a.paused||!a.playbackRate||!a.readyState)return;const u=s.mainForwardBufferInfo;if(u===null)return;const g=this.bwEstimator.getEstimateTTFB(),p=Math.abs(a.playbackRate);if(f<=Math.max(g,1e3*(c/(p*2))))return;const m=u.len/p,S=l.loading.first?l.loading.first-l.loading.start:-1,y=l.loaded&&S>-1,x=this.getBwEstimate(),E=s.levels,T=E[t.level],A=l.total||Math.max(l.loaded,Math.round(c*T.averageBitrate/8));let _=y?f-S:f;_<1&&y&&(_=Math.min(f,l.loaded*8/x));const P=y?l.loaded*1e3/_:0,k=P?(A-l.loaded)/P:A*8/x+g/1e3;if(k<=m)return;const F=P?P*8:x;let M=Number.POSITIVE_INFINITY,B;for(B=t.level-1;B>d;B--){const G=E[B].maxBitrate;if(M=this.getTimeToLoadFrag(g/1e3,F,c*G,!E[B].details),M<m)break}if(M>=k||M>c*10)return;s.nextLoadLevel=s.nextAutoLevel=B,y?this.bwEstimator.sample(f-Math.min(g,S),l.loaded):this.bwEstimator.sampleTTFB(f);const N=E[B].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>N&&this.resetEstimator(N),this.clearTimer(),logger.warn(`[abr] Fragment ${t.sn}${i?" part "+i.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${m.toFixed(3)} s
      Estimated load time for current fragment: ${k.toFixed(3)} s
      Estimated load time for down switch fragment: ${M.toFixed(3)} s
      TTFB estimate: ${S|0} ms
      Current BW estimate: ${isFiniteNumber(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${B} @ ${N|0} bps`),s.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(logger.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new EwmaBandWidthEstimator(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.FRAG_LOADING,this.onFragLoading,this),e.on(Events.FRAG_LOADED,this.onFragLoaded,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;!e||(e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.FRAG_LOADING,this.onFragLoading,this),e.off(Events.FRAG_LOADED,this.onFragLoaded,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:s,partCurrent:n}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const a=performance.now(),o=n?n.stats:i.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,s){const n=e+i/t,a=s?this.lastLevelLoadSec:0;return n+a}onLevelLoaded(e,t){const i=this.hls.config,{loading:s}=t.stats,n=s.end-s.start;isFiniteNumber(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const n=i?i.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+s.loaded,l=(a.loaded?a.loaded.duration:0)+n;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const n={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(Events.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:s}=t,n=s!=null&&s.stats.loaded?s.stats:i.stats;if(n.aborted||this.ignoreFragment(i))return;const a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==PlaylistLevelType.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,n=this.findBestLevel(i,t,e,0,s,1,1);if(n>-1)return n;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const n=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,n)&&a[e].loadError<=a[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:s,config:n,minAutoLevel:a}=i,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let f=n.abrBandWidthFactor,d=n.abrBandWidthUpFactor;if(c){const S=this.findBestLevel(l,a,s,c,0,f,d);if(S>=0)return S}let u=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay;if(!c){const S=this.bitrateTestDelay;S&&(u=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-S,logger.info(`[abr] bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*u)} ms`),f=d=1)}const g=this.findBestLevel(l,a,s,c,u,f,d);if(logger.info(`[abr] ${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${g}`),g>-1)return g;const p=i.levels[a],m=i.levels[i.loadLevel];return(p==null?void 0:p.bitrate)<(m==null?void 0:m.bitrate)?a:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,s,n,a,o){var l;const c=s+n,f=this.lastLoadedFragLevel,d=f===-1?this.hls.firstLevel:f,{fragCurrent:u,partCurrent:g}=this,{levels:p,allAudioTracks:m,loadLevel:S,config:y}=this.hls;if(p.length===1)return 0;const x=p[d],E=!!(x!=null&&(l=x.details)!=null&&l.live),T=S===-1||f===-1;let A,_="SDR",P=(x==null?void 0:x.frameRate)||0;const{audioPreference:k,videoPreference:F}=y,M=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(m));if(T){if(this.firstSelection!==-1)return this.firstSelection;const O=this.codecTiers||(this.codecTiers=getCodecTiers(p,M,t,i)),L=getStartCodecTier(O,_,e,k,F),{codecSet:D,videoRanges:b,minFramerate:C,minBitrate:I,preferHDR:R}=L;A=D,_=R?b[b.length-1]:b[0],P=C,e=Math.max(e,I),logger.log(`[abr] picked start tier ${JSON.stringify(L)}`)}else A=x==null?void 0:x.codecSet,_=x==null?void 0:x.videoRange;const B=g?g.duration:u?u.duration:0,N=this.bwEstimator.getEstimateTTFB()/1e3,G=[];for(let O=i;O>=t;O--){var U;const L=p[O],D=O>d;if(!L)continue;if(y.useMediaCapabilities&&!L.supportedResult&&!L.supportedPromise){const H=navigator.mediaCapabilities;typeof(H==null?void 0:H.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(L,M,_,P,e,k)?(L.supportedPromise=getMediaDecodingInfoPromise(L,M,H),L.supportedPromise.then(z=>{if(!this.hls)return;L.supportedResult=z;const W=this.hls.levels,j=W.indexOf(L);z.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${z.error}" for level ${j} ${JSON.stringify(z)}`):z.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${j} ${JSON.stringify(z)}`),j>-1&&W.length>1&&(logger.log(`[abr] Removing unsupported level ${j}`),this.hls.removeLevel(j)))})):L.supportedResult=SUPPORTED_INFO_DEFAULT}if(A&&L.codecSet!==A||_&&L.videoRange!==_||D&&P>L.frameRate||!D&&P>0&&P<L.frameRate||L.supportedResult&&!((U=L.supportedResult.decodingInfoResults)!=null&&U[0].smooth)){G.push(O);continue}const b=L.details,C=(g?b==null?void 0:b.partTarget:b==null?void 0:b.averagetargetduration)||B;let I;D?I=o*e:I=a*e;const R=B&&s>=B*2&&n===0?p[O].averageBitrate:p[O].maxBitrate,V=this.getTimeToLoadFrag(N,I,R*C,b===void 0);if(I>=R&&(O===f||L.loadError===0&&L.fragmentError===0)&&(V<=N||!isFiniteNumber(V)||E&&!this.bitrateTestDelay||V<c)){const H=this.forcedAutoLevel;return O!==S&&(H===-1||H!==S)&&(G.length&&logger.trace(`[abr] Skipped level(s) ${G.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${p[G[0]].codecs}" ${p[G[0]].videoRange}; not compatible with "${x.codecs}" ${_}`),logger.info(`[abr] switch candidate:${d}->${O} adjustedbw(${Math.round(I)})-bitrate=${Math.round(I-R)} ttfb:${N.toFixed(1)} avgDuration:${C.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${V.toFixed(1)} firstSelection:${T} codecSet:${A} videoRange:${_} hls.loadLevel:${S}`)),T&&(this.firstSelection=O),O}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls,s=Math.min(Math.max(e,i),t);this._nextAutoLevel!==s&&(this.nextAutoLevelKey="",this._nextAutoLevel=s)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const n=i[s];if(!n)break;const a=n.end;if(n.start<=e&&a!==null&&e<=a)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:i}=this,s=Object.keys(i);for(let n=s.length;n--;){const a=i[s[n]];if((a==null?void 0:a.body.type)===t&&a.buffered){const o=a.body;if(o.start<=e&&e<=o.end)return o}}return null}detectEvictedFragments(e,t,i,s){this.timeRanges&&(this.timeRanges[e]=t);const n=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o||n>=o.body.sn)return;if(!o.buffered&&!o.loaded){o.body.type===i&&this.removeFragment(o.body);return}const l=o.range[e];!l||l.time.some(c=>{const f=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return f&&this.removeFragment(o.body),f})})}detectPartialFragments(e){const t=this.timeRanges,{frag:i,part:s}=e;if(!t||i.sn==="initSegment")return;const n=getFragmentKey(i),a=this.fragments[n];if(!a||a.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(l=>{const c=i.elementaryStreams[l];if(!c)return;const f=t[l],d=o||c.partial===!0;a.range[l]=this.getBufferedTimes(i,s,d,f)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=i.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),isPartial(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}removeParts(e,t){const i=this.activePartLists[t];!i||(this.activePartLists[t]=i.filter(s=>s.fragment.sn>=e))}fragBuffered(e,t){const i=getFragmentKey(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,i,s){const n={time:[],partial:i},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let f=0;f<s.length;f++){const d=s.start(f)-this.bufferPadding,u=s.end(f)+this.bufferPadding;if(c>=d&&l<=u){n.time.push({startPTS:Math.max(a,s.start(f)),endPTS:Math.min(o,s.end(f))});break}else if(a<u&&o>d){const g=Math.max(a,s.start(f)),p=Math.min(o,s.end(f));p>g&&(n.partial=!0,n.time.push({startPTS:g,endPTS:p}))}else if(o<=d)break}return n}getPartialFragment(e){let t=null,i,s,n,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const f=l[c];!f||isPartial(f)&&(s=f.body.start-o,n=f.body.end+o,e>=s&&e<=n&&(i=Math.min(e-s,n-e),a<=i&&(t=f.body,a=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||isPartial(t))}getState(e){const t=getFragmentKey(e),i=this.fragments[t];return i?i.buffered?isPartial(i)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(e,t,i){let s,n;for(let a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,n=i.end(a)+this.bufferPadding,e>=s&&t<=n)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:i,part:s}=t;if(i.sn==="initSegment"||i.bitrateTest)return;const n=s?null:t,a=getFragmentKey(i);this.fragments[a]={body:i,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:n}=t;if(i.sn==="initSegment")return;const a=i.type;if(s){let o=this.activePartLists[a];o||(this.activePartLists[a]=o=[]),o.push(s)}this.timeRanges=n,Object.keys(n).forEach(o=>{const l=n[o];this.detectEvictedFragments(o,l,a,s)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=getFragmentKey(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,n){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==i||s&&!l.gap||l.start<t&&l.end>e&&(o.buffered||n)&&this.removeFragment(l)})}removeFragment(e){const t=getFragmentKey(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=i.filter(n=>n.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(r){var e,t,i;return r.buffered&&(r.body.gap||((e=r.range.video)==null?void 0:e.partial)||((t=r.range.audio)==null?void 0:t.partial)||((i=r.range.audiovideo)==null?void 0:i.partial))}function getFragmentKey(r){return`${r.type}_${r.level}_${r.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(e,t){try{if(e){const i=BufferHelper.getBuffered(e);for(let s=0;s<i.length;s++)if(t>=i.start(s)&&t<=i.end(s))return!0}}catch{}return!1}static bufferInfo(e,t,i){try{if(e){const s=BufferHelper.getBuffered(e),n=[];let a;for(a=0;a<s.length;a++)n.push({start:s.start(a),end:s.end(a)});return this.bufferedInfo(n,t,i)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.sort(function(c,f){const d=c.start-f.start;return d||f.end-c.end});let s=[];if(i)for(let c=0;c<e.length;c++){const f=s.length;if(f){const d=s[f-1].end;e[c].start-d<i?e[c].end>d&&(s[f-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let n=0,a,o=t,l=t;for(let c=0;c<s.length;c++){const f=s[c].start,d=s[c].end;if(t+i>=f&&t<d)o=f,l=d,n=l-t;else if(t+i<f){a=f;break}}return{len:n,start:o||0,end:l||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(t){return logger.log("failed to get media.buffered",t),noopBuffered}}}class ChunkMetadata{constructor(e,t,i,s=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=n,this.partial=a}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(r,e){for(let i=0,s=r.length;i<s;i++){var t;if(((t=r[i])==null?void 0:t.cc)===e)return r[i]}return null}function shouldAlignOnDiscontinuities(r,e,t){return!!(e&&(t.endCC>t.startCC||r&&r.cc<t.startCC))}function findDiscontinuousReferenceFrag(r,e){const t=r.fragments,i=e.fragments;if(!i.length||!t.length){logger.log("No fragments to align");return}const s=findFirstFragWithCC(t,i[0].cc);if(!s||s&&!s.startPTS){logger.log("No frag in previous level to align on");return}return s}function adjustFragmentStart(r,e){if(r){const t=r.start+e;r.start=r.startPTS=t,r.endPTS=t+r.duration}}function adjustSlidingStart(r,e){const t=e.fragments;for(let i=0,s=t.length;i<s;i++)adjustFragmentStart(t[i],r);e.fragmentHint&&adjustFragmentStart(e.fragmentHint,r),e.alignedSliding=!0}function alignStream(r,e,t){!e||(alignDiscontinuities(r,t,e),!t.alignedSliding&&e&&alignMediaPlaylistByPDT(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&adjustSliding(e,t))}function alignDiscontinuities(r,e,t){if(shouldAlignOnDiscontinuities(r,t,e)){const i=findDiscontinuousReferenceFrag(t,e);i&&isFiniteNumber(i.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),adjustSlidingStart(i.start,e))}}function alignMediaPlaylistByPDT(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,i=e.fragments;if(!t.length||!i.length)return;let s,n;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(s=findFirstFragWithCC(i,a),n=findFirstFragWithCC(t,a)),(!s||!n)&&(s=i[Math.floor(i.length/2)],n=findFirstFragWithCC(t,s.cc)||t[Math.floor(t.length/2)]);const o=s.programDateTime,l=n.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(n.start-s.start);adjustSlidingStart(c,r)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,n=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(createGapLoadError(e));return}else e.gap=!1;const c=this.loader=e.loader=n?new n(s):new a(s),f=createLoaderContext(e),d=getLoaderConfigWithoutReties(s.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};e.stats=c.stats,c.load(f,u,{onSuccess:(g,p,m,S)=>{this.resetLoader(e,c);let y=g.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),o({frag:e,part:null,payload:y,networkDetails:S})},onError:(g,p,m,S)=>{this.resetLoader(e,c),l(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:_objectSpread2({url:i,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:m,stats:S}))},onAbort:(g,p,m)=>{this.resetLoader(e,c),l(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:g}))},onTimeout:(g,p,m)=>{this.resetLoader(e,c),l(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${u.timeout}ms`),networkDetails:m,stats:g}))},onProgress:(g,p,m,S)=>{t&&t({frag:e,part:null,payload:m,networkDetails:S})}})})}loadPart(e,t,i){this.abort();const s=this.config,n=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(createGapLoadError(e,t));return}const c=this.loader=e.loader=n?new n(s):new a(s),f=createLoaderContext(e,t),d=getLoaderConfigWithoutReties(s.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};t.stats=c.stats,c.load(f,u,{onSuccess:(g,p,m,S)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:g.data,networkDetails:S};i(y),o(y)},onError:(g,p,m,S)=>{this.resetLoader(e,c),l(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:_objectSpread2({url:f.url,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:m,stats:S}))},onAbort:(g,p,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:g}))},onTimeout:(g,p,m)=>{this.resetLoader(e,c),l(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${u.timeout}ms`),networkDetails:m,stats:g}))}})})}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,n=s.total;if(i.loaded+=s.loaded,n){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(i.loaded/n),l),d=(l-c)*Math.round(i.loaded/c);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);const a=i.loading,o=s.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function createLoaderContext(r,e=null){const t=e||r,i={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(isFiniteNumber(s)&&isFiniteNumber(n)){var a;let o=s,l=n;if(r.sn==="initSegment"&&((a=r.decryptdata)==null?void 0:a.method)==="AES-128"){const c=n-s;c%16&&(l=n+(16-c%16)),s!==0&&(i.resetIV=!0,o=s-16)}i.rangeStart=o,i.rangeEnd=l}return i}function createGapLoadError(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),i={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(i.part=e),(e||r).stats.aborted=!0,new LoadError(i)}class LoadError extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class AESCrypto{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class FastAESKey{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?sliceUint8(r,0,e-t):r}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],n=i[1],a=i[2],o=i[3],l=this.invSubMix,c=l[0],f=l[1],d=l[2],u=l[3],g=new Uint32Array(256);let p=0,m=0,S=0;for(S=0;S<256;S++)S<128?g[S]=S<<1:g[S]=S<<1^283;for(S=0;S<256;S++){let y=m^m<<1^m<<2^m<<3^m<<4;y=y>>>8^y&255^99,e[p]=y,t[y]=p;const x=g[p],E=g[x],T=g[E];let A=g[y]*257^y*16843008;s[p]=A<<24|A>>>8,n[p]=A<<16|A>>>16,a[p]=A<<8|A>>>24,o[p]=A,A=T*16843009^E*65537^x*257^p*16843008,c[y]=A<<24|A>>>8,f[y]=A<<16|A>>>16,d[y]=A<<8|A>>>24,u[y]=A,p?(p=x^g[g[g[T^x]]],m^=g[g[m]]):p=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);const a=this.ksRows=(n+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),f=this.invKeySchedule=new Uint32Array(a),d=this.sBox,u=this.rcon,g=this.invSubMix,p=g[0],m=g[1],S=g[2],y=g[3];let x,E;for(o=0;o<a;o++){if(o<n){x=c[o]=t[o];continue}E=x,o%n===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=u[o/n|0]<<24):n>6&&o%n===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),c[o]=x=(c[o-n]^E)>>>0}for(l=0;l<a;l++)o=a-l,l&3?E=c[o]:E=c[o-4],l<4||o<=4?f[l]=E:f[l]=p[d[E>>>24]]^m[d[E>>>16&255]]^S[d[E>>>8&255]]^y[d[E&255]],f[l]=f[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],f=o[2],d=o[3],u=this.uint8ArrayToUint32Array_(i);let g=u[0],p=u[1],m=u[2],S=u[3];const y=new Int32Array(e),x=new Int32Array(y.length);let E,T,A,_,P,k,F,M,B,N,G,U,O,L;const D=this.networkToHostOrderSwap;for(;t<y.length;){for(B=D(y[t]),N=D(y[t+1]),G=D(y[t+2]),U=D(y[t+3]),P=B^n[0],k=U^n[1],F=G^n[2],M=N^n[3],O=4,L=1;L<s;L++)E=l[P>>>24]^c[k>>16&255]^f[F>>8&255]^d[M&255]^n[O],T=l[k>>>24]^c[F>>16&255]^f[M>>8&255]^d[P&255]^n[O+1],A=l[F>>>24]^c[M>>16&255]^f[P>>8&255]^d[k&255]^n[O+2],_=l[M>>>24]^c[P>>16&255]^f[k>>8&255]^d[F&255]^n[O+3],P=E,k=T,F=A,M=_,O=O+4;E=a[P>>>24]<<24^a[k>>16&255]<<16^a[F>>8&255]<<8^a[M&255]^n[O],T=a[k>>>24]<<24^a[F>>16&255]<<16^a[M>>8&255]<<8^a[P&255]^n[O+1],A=a[F>>>24]<<24^a[M>>16&255]<<16^a[P>>8&255]<<8^a[k&255]^n[O+2],_=a[M>>>24]<<24^a[P>>16&255]<<16^a[k>>8&255]<<8^a[F&255]^n[O+3],x[t]=D(E^g),x[t+1]=D(_^p),x[t+2]=D(A^m),x[t+3]=D(T^S),g=B,p=N,m=G,S=U,t=t+4}return x.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?removePadding(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise((s,n)=>{this.softwareDecrypt(new Uint8Array(e),t,i);const a=this.flush();a?s(a.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){const{currentIV:s,currentResult:n,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=appendUint8Array(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;s&&(i=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new AESDecryptor),l.expandKey(t);const c=n;return this.currentResult=l.decrypt(o.buffer,0,i),this.currentIV=sliceUint8(o,-16).buffer,c||null}webCryptoDecrypt(e,t,i){const s=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new FastAESKey(s,t)),this.fastAesKey.expandKey().then(n=>s?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(s,new Uint8Array(i)).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,i)))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%CHUNK_SIZE;return i!==e.length&&(t=sliceUint8(e,0,i),this.remainderData=sliceUint8(e,i)),t}logOnce(e){!this.logEnabled||(logger.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const TimeRanges={toString:function(r){let e="";const t=r.length;for(let i=0;i<t;i++)e+=`[${r.start(i).toFixed(3)}-${r.end(i).toFixed(3)}]`;return e}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(e,t,i,s,n){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=n,this.logPrefix=s,this.log=logger.log.bind(logger,`${s}:`),this.warn=logger.warn.bind(logger,`${s}:`),this.hls=e,this.fragmentLoader=new FragmentLoader(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Decrypter(e.config),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const i=t.partList;if(i!=null&&i.length){const n=i[i.length-1];return BufferHelper.isBuffered(this.media,n.start+n.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:i,mediaBuffer:s,state:n}=this,a=i?i.currentTime:0,o=BufferHelper.bufferInfo(s||i,a,e.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(a)?a.toFixed(3):a}, state: ${n}`),this.state===State.ENDED)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,c=t.start-l,f=t.start+t.duration+l;if(!o.len||f<o.start||c>o.end){const d=a>f;(a<c||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const s=n=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${n.part?" p: "+n.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,i,s).then(n=>{if(!n)return;const a=this.state;if(this.fragContextChanged(e)){(a===State.FRAG_LOADING||!this.fragCurrent&&a===State.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=State.IDLE);return}"payload"in n&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(Events.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===FragmentState.APPENDING){const n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===FragmentState.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(Events.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{if(!i||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{payload:n}=i,a=e.decryptdata;if(n&&n.byteLength>0&&a!=null&&a.key&&a.iv&&a.method==="AES-128"){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),a.key.buffer,a.iv.buffer).catch(l=>{throw s.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return s.trigger(Events.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:o,tdecrypt:c}}),i.payload=l,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state=State.IDLE,e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var i,s,n,a;const o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${e.level} (frag:[${((i=e.startPTS)!=null?i:NaN).toFixed(3)}-${((s=e.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${o?TimeRanges.toString(BufferHelper.getBuffered(o)):"(detached)"})`),e.sn!=="initSegment"){var l;if(e.type!==PlaylistLevelType.SUBTITLE){const f=e.elementaryStreams;if(!Object.keys(f).some(d=>!!f[d])){this.state=State.IDLE;return}}const c=(l=this.levels)==null?void 0:l[e.level];c!=null&&c.fragmentError&&(this.log(`Resetting level fragment error count of ${c.fragmentError} on frag buffered`),c.fragmentError=0)}this.state=State.IDLE,o&&(!this.loadedmetadata&&e.type==PlaylistLevelType.MAIN&&o.buffered.length&&((n=this.fragCurrent)==null?void 0:n.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:n}=e,a=!n||n.length===0||n.some(l=>!l),o=new ChunkMetadata(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var n;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=State.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(Events.KEY_LOADED,f),this.state===State.KEY_LOADING&&(this.state=State.IDLE),f}),this.hls.trigger(Events.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const f=a.partList;if(f&&s){i>e.end&&a.fragmentHint&&(e=a.fragmentHint);const d=this.getNextPart(f,e,i);if(d>-1){const u=f[d];this.log(`Loading part sn: ${e.sn} p: ${u.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${d}-${f.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=u.start+u.duration,this.state=State.FRAG_LOADING;let g;return o?g=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,u,t,s)).catch(p=>this.handleFragLoadError(p)):g=this.doFragPartsLoad(e,u,t,s).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(Events.FRAG_LOADING,{frag:e,part:u,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(f,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),isFiniteNumber(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=State.FRAG_LOADING;const l=this.config.progressive;let c;return l&&o?c=o.then(f=>!f||this.fragContextChanged(f==null?void 0:f.frag)?null:this.fragmentLoader.load(e,s)).catch(f=>this.handleFragLoadError(f)):c=Promise.all([this.fragmentLoader.load(e,l?s:void 0),o]).then(([f])=>(!l&&f&&s&&s(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(Events.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,i,s){return new Promise((n,a)=>{var o;const l=[],c=(o=i.details)==null?void 0:o.partList,f=d=>{this.fragmentLoader.loadPart(e,d,s).then(u=>{l[d.index]=u;const g=u.part;this.hls.trigger(Events.FRAG_LOADED,u);const p=getPartWith(i,e.sn,d.index+1)||findPart(c,e.sn,d.index+1);if(p)f(p);else return n({frag:e,part:g,partsLoaded:l})}).catch(a)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(Events.ERROR,t)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:i,part:s,level:n}=t,a=self.performance.now();i.stats.parsing.end=a,s&&(s.stats.parsing.end=a),this.updateLevelTiming(i,s,n,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:n,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${n} of level ${s}. The current chunk will not be buffered.`),null;const o=t[s],l=a>-1?getPartWith(o,n,a):null,c=l?l.fragment:getFragmentWithSN(o,n,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,t,i,s,n){var a;if(!e||this.state!==State.PARSING)return;const{data1:o,data2:l}=e;let c=o;if(o&&l&&(c=appendUint8Array(o,l)),!((a=c)!=null&&a.length))return;const f={type:e.type,frag:t,part:i,chunkMeta:s,parent:t.type,data:c};if(this.hls.trigger(Events.BUFFER_APPENDING,f),e.dropped&&e.independent&&!i){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!BufferHelper.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,s=BufferHelper.bufferInfo(t,i,0),n=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),o=Math.max(Math.min(e.start-a,s.end-a),i+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){const i=this.getLoadPosition();return isFiniteNumber(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){const{config:{maxBufferHole:s}}=this,n=BufferHelper.bufferInfo(e,t,s);if(n.len===0&&n.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&n.nextStart<a.end)return BufferHelper.bufferInfo(e,t,Math.max(n.nextStart,s))}return n}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(e,t=PlaylistLevelType.MAIN){const i=this.fragmentTracker.getAppendedFrag(e,PlaylistLevelType.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:n}=this,a=i[0].start;let o;if(t.live){const l=n.initialLiveManifestSize;if(s<l)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${l})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a)&&(o=this.getInitialLiveFragment(t,i),this.startPosition=this.nextLoadPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=a&&(o=i[0]);if(!o){const l=n.lowLatencyMode?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===FragmentState.OK||i===FragmentState.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,n){const a=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(o===null)return o;if(e=o,a&&e&&!e.gap&&i.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(l!==null&&i.len+l.len>=n)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,n=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,s>-1&&i<c.start)break;const f=c.loaded;f?s=-1:(n||c.independent||a)&&c.fragment===t&&(s=o),n=f}return s}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=findFragmentByPDT(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const n=i.sn+1;if(n>=e.startSN&&n<=e.endSN){const a=t[n-e.startSN];i.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=findFragWithCC(t,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const n=this.hls.liveSyncPosition;n!==null&&(s=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:n}=this,{fragments:a,endSN:o}=i;const{fragmentHint:l}=i,c=s.maxFragLookUpTolerance,f=i.partList,d=!!(s.lowLatencyMode&&f!=null&&f.length&&l);d&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn);let u;if(e<t){const g=e>t-c?0:c;u=findFragmentByPTS(n,a,e,g)}else u=a[a.length-1];if(u){const g=u.sn-i.startSN,p=this.fragmentTracker.getState(u);if((p===FragmentState.OK||p===FragmentState.PARTIAL&&u.gap)&&(n=u),n&&u.sn===n.sn&&(!d||f[0].fragment.sn>u.sn)&&n&&u.level===n.level){const S=a[g+1];u.sn<o&&this.fragmentTracker.getState(S)!==FragmentState.OK?u=S:u=null}}return u}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,n=i.currentTime,a=e.fragments[0].start,o=e.edge,l=n>=a-t.maxFragLookUpTolerance&&n<=o;if(s!==null&&i.duration>s&&(n<s||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&i.readyState<4||n<o-c)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}alignPlaylists(e,t,i){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const n=e.fragments[0].start,a=!t,o=e.alignedSliding&&isFiniteNumber(n);if(a||!o&&!n){const{fragPrevious:l}=this;alignStream(l,i,e);const c=e.fragments[0].start;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${l?l.sn:"na"} fragments: ${s}`),c}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),i===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,n=s?this.startTimeOffset:e.startTimeOffset;n!==null&&isFiniteNumber(n)?(i=t+n,n<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${n} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const f=this.getCurrentContext(t.chunkMeta);f&&(t.frag=f.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const n=t.details===ErrorDetails.FRAG_GAP;n&&this.fragmentTracker.fragBuffered(i,!0);const a=t.errorAction,{action:o,retryCount:l=0,retryConfig:c}=a||{};if(a&&o===NetworkErrorAction.RetryRequest&&c){this.resetStartWhenNotLoaded(this.levelLastLoaded);const f=getRetryDelay(c,l);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${f}ms`),a.resolved=!0,this.retryDate=self.performance.now()+f,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(c&&a)if(this.resetFragmentErrors(e),l<c.maxNumRetry)!n&&o!==NetworkErrorAction.RemoveAlternatePermanently&&(a.resolved=!0);else{logger.warn(`${t.details} reached or exceeded max retry (${l})`);return}else(a==null?void 0:a.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===State.PARSING||this.state===State.PARSED){const t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);const n=!s;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const s=BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){var n;const a=i.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const f=e.elementaryStreams[c];if(f){const d=f.endPTS-f.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const u=s?0:updateFragPTSDTS(a,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:a,level:i,drift:u,type:c,frag:e,start:f.startPTS,end:f.endPTS}),!0}return l},!1)&&((n=this.transmuxer)==null?void 0:n.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(i.fragmentError===0&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=concatUint8Arrays(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(r,e){const t=new Uint8Array(e);let i=0;for(let s=0;s<r.length;s++){const n=r[s];t.set(n,i),i+=n.length}return t}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const r=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(r);return{worker:new self.Worker(e),objectURL:e}}function loadWorker(r){const e=new self.URL(r,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function dummyTrack(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=appendUint8Array(this.cachedData,e),this.cachedData=null);let i=getID3Data(e,0),s=i?i.length:0,n;const a=this._audioTrack,o=this._id3Track,l=i?getTimeStamp(i):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(l))&&(this.basePTS=initPTSFn(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const f=this.appendFrame(a,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,n=s):s=c}else canParse$2(e,s)?(i=getID3Data(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,n=s):s++;if(s===c&&n!==c){const f=sliceUint8(e,n);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,f):this.cachedData=f}}return{audioTrack:a,videoTrack:dummyTrack(),id3Track:o,textTrack:dummyTrack()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(r,e,t)=>{if(isFiniteNumber(r))return r*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};function getAudioConfig(r,e,t,i){let s,n,a,o;const l=navigator.userAgent.toLowerCase(),c=i,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((e[t+2]&192)>>>6)+1;const d=(e[t+2]&60)>>>2;if(d>f.length-1){const u=new Error(`invalid ADTS sampling index:${d}`);r.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:u,reason:u.message});return}return a=(e[t+2]&1)<<2,a|=(e[t+3]&192)>>>6,logger.log(`manifest codec:${i}, ADTS type:${s}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(s=5,o=new Array(4),n=d-3):(s=2,o=new Array(2),n=d):l.indexOf("android")!==-1?(s=2,o=new Array(2),n=d):(s=5,o=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&d>=6?n=d-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(d>=6&&a===1||/vivaldi/i.test(l))||!i&&a===1)&&(s=2,o=new Array(2)),n=d)),o[0]=s<<3,o[0]|=(d&14)>>1,o[1]|=(d&1)<<7,o[1]|=a<<3,s===5&&(o[1]|=(n&14)>>1,o[2]=(n&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplerate:f[d],channelCount:a,codec:"mp4a.40."+s,manifestCodec:c}}function isHeaderPattern$1(r,e){return r[e]===255&&(r[e+1]&246)===240}function getHeaderLength(r,e){return r[e+1]&1?7:9}function getFullFrameLength(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function canGetFrameLength(r,e){return e+5<r.length}function isHeader$1(r,e){return e+1<r.length&&isHeaderPattern$1(r,e)}function canParse$1(r,e){return canGetFrameLength(r,e)&&isHeaderPattern$1(r,e)&&getFullFrameLength(r,e)<=r.length-e}function probe$1(r,e){if(isHeader$1(r,e)){const t=getHeaderLength(r,e);if(e+t>=r.length)return!1;const i=getFullFrameLength(r,e);if(i<=t)return!1;const s=e+i;return s===r.length||isHeader$1(r,s)}return!1}function initTrackConfig(r,e,t,i,s){if(!r.samplerate){const n=getAudioConfig(e,t,i,s);if(!n)return;r.config=n.config,r.samplerate=n.samplerate,r.channelCount=n.channelCount,r.codec=n.codec,r.manifestCodec=n.manifestCodec,logger.log(`parsed codec:${r.codec}, rate:${n.samplerate}, channels:${n.channelCount}`)}}function getFrameDuration(r){return 1024*9e4/r}function parseFrameHeader(r,e){const t=getHeaderLength(r,e);if(e+t<=r.length){const i=getFullFrameLength(r,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function appendFrame$2(r,e,t,i,s){const n=getFrameDuration(r.samplerate),a=i+s*n,o=parseFrameHeader(e,t);let l;if(o){const{frameLength:d,headerLength:u}=o,g=u+d,p=Math.max(0,t+g-e.length);p?(l=new Uint8Array(g-u),l.set(e.subarray(t+u,e.length),0)):l=e.subarray(t+u,t+g);const m={unit:l,pts:a};return p||r.samples.push(m),{sample:m,length:g,missing:p}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(r,e,t,i,s){if(t+24>e.length)return;const n=parseHeader(e,t);if(n&&t+n.frameLength<=e.length){const a=n.samplesPerFrame*9e4/n.sampleRate,o=i+s*a,l={unit:e.subarray(t,t+n.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=n.channelCount,r.samplerate=n.sampleRate,r.samples.push(l),{sample:l,length:n.frameLength,missing:0}}}function parseHeader(r,e){const t=r[e+1]>>3&3,i=r[e+1]>>1&3,s=r[e+2]>>4&15,n=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&n!==3){const a=r[e+2]>>1&1,o=r[e+3]>>6,l=t===3?3-i:i===3?3:4,c=BitratesMap[l*14+s-1]*1e3,d=SamplingRateMap[(t===3?0:t===2?1:2)*3+n],u=o===3?1:2,g=SamplesCoefficients[t][i],p=BytesInSlot[i],m=g*8*p,S=Math.floor(g*c/d+a)*p;if(chromeVersion$1===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=E?parseInt(E[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&i===2&&c>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:u,frameLength:S,samplesPerFrame:m}}}function isHeaderPattern(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function isHeader(r,e){return e+1<r.length&&isHeaderPattern(r,e)}function canParse(r,e){return isHeaderPattern(r,e)&&4<=r.length-e}function probe(r,e){if(e+1<r.length&&isHeaderPattern(r,e)){const i=parseHeader(r,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const n=e+s;return n===r.length||isHeader(r,n)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=getID3Data(e,0);let i=(t==null?void 0:t.length)||0;if(probe(e,i))return!1;for(let s=e.length;i<s;i++)if(probe$1(e,i))return logger.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return canParse$1(e,t)}appendFrame(e,t,i){initTrackConfig(e,this.observer,t,i,e.manifestCodec);const s=appendFrame$2(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const n=this.videoTrack=dummyTrack("video",1),a=this.audioTrack=dummyTrack("audio",1),o=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=parseInitSegment(e);if(l.video){const{id:c,timescale:f,codec:d}=l.video;n.id=c,n.timescale=o.timescale=f,n.codec=d}if(l.audio){const{id:c,timescale:f,codec:d}=l.audio;a.id=c,a.timescale=f,a.codec=d}o.id=RemuxerTrackIdConfig.text,n.sampleDuration=0,n.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return hasMoofData(e)}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=appendUint8Array(this.remainderData,e));const o=segmentValidRange(i);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=i;const a=this.extractID3Track(s,t);return n.samples=parseSamples(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=parseSamples(e,t),{videoTrack:t,audioTrack:dummyTrack(),id3Track:s,textTrack:dummyTrack()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=findBox(e.samples,["emsg"]);s&&s.forEach(n=>{const a=parseEmsg(n);if(emsgSchemePattern.test(a.schemeIdUri)){const o=isFiniteNumber(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale;let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;i.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:MetadataSchema.emsg,duration:l})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(r,e)=>{let t=0,i=5;e+=i;const s=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=r[e];const o=Math.min(i,8),l=8-o;n[0]=4278190080>>>24+l<<l,s[0]=(a[0]&n[0])>>l,t=t?t<<o|s[0]:s[0],e+=1,i-=o}return t};class AC3Demuxer extends BaseAudioDemuxer{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const s=appendFrame(e,t,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=getID3Data(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&getTimeStamp(t)!==void 0&&getAudioBSID(e,i)<16}}function appendFrame(r,e,t,i,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const n=e[t+4]>>6;if(n>=3)return-1;const o=[48e3,44100,32e3][n],l=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+n]*2;if(t+f>e.length)return-1;const d=e[t+6]>>5;let u=0;d===2?u+=2:(d&1&&d!==1&&(u+=2),d&4&&(u+=2));const g=(e[t+6]<<8|e[t+7])>>12-u&1,m=[2,1,2,3,3,4,4,5][d]+g,S=e[t+5]>>3,y=e[t+5]&7,x=new Uint8Array([n<<6|S<<1|y>>2,(y&3)<<6|d<<3|g<<2|l>>4,l<<4&224]),E=1536/o*9e4,T=i+s*E,A=e.subarray(t,t+f);return r.config=x,r.channelCount=m,r.samplerate=o,r.samples.push({unit:A,pts:T}),f}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(e,t,i,s){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:s,length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const n=i.units;s=n[n.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,s=i.length;if(s){const n=i[s-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&logger.log(e.pts+"/"+e.dts+":"+e.debug)}}class ExpGolomb{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");s.set(e.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,i=8,s;for(let n=0;n<e;n++)i!==0&&(s=this.readEG(),i=(t+s+256)%256),t=i===0?t:i}readSPS(){let e=0,t=0,i=0,s=0,n,a,o;const l=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),d=this.readBoolean.bind(this),u=this.skipBits.bind(this),g=this.skipEG.bind(this),p=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);l();const S=l();if(c(5),u(3),l(),p(),S===100||S===110||S===122||S===244||S===44||S===83||S===86||S===118||S===128){const _=f();if(_===3&&u(1),p(),p(),u(1),d())for(a=_!==3?8:12,o=0;o<a;o++)d()&&(o<6?m(16):m(64))}p();const y=f();if(y===0)f();else if(y===1)for(u(1),g(),g(),n=f(),o=0;o<n;o++)g();p(),u(1);const x=f(),E=f(),T=c(1);T===0&&u(1),u(1),d()&&(e=f(),t=f(),i=f(),s=f());let A=[1,1];if(d()&&d())switch(l()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((x+1)*16-e*2-t*2),height:(2-T)*(E+1)*16-(T?2:4)*(i+s),pixelRatio:A}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(e,t,i,s,n){const a=this.parseAVCNALu(e,i.data);let o=this.VideoSample,l,c=!1;i.data=null,o&&a.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"")),a.forEach(f=>{var d;switch(f.type){case 1:{let m=!1;l=!0;const S=f.data;if(c&&S.length>4){const y=new ExpGolomb(S).readSliceType();(y===2||y===4||y===7||y===9)&&(m=!0)}if(m){var u;(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts,"")),o.frame=!0,o.key=m;break}case 5:l=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts,"")),o.key=!0,o.frame=!0;break;case 6:{l=!0,parseSEIMessageFromNALu(f.data,1,i.pts,t.samples);break}case 7:{var g,p;l=!0,c=!0;const m=f.data,y=new ExpGolomb(m).readSPS();if(!e.sps||e.width!==y.width||e.height!==y.height||((g=e.pixelRatio)==null?void 0:g[0])!==y.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[m],e.duration=n;const x=m.subarray(1,4);let E="avc1.";for(let T=0;T<3;T++){let A=x[T].toString(16);A.length<2&&(A="0"+A),E+=A}e.codec=E}break}case 8:l=!0,e.pps=[f.data];break;case 9:l=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"");break;case 12:l=!0;break;default:l=!1,o&&(o.debug+="unknown NAL "+f.type+" ");break}o&&l&&o.units.push(f)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}parseAVCNALu(e,t){const i=t.byteLength;let s=e.naluState||0;const n=s,a=[];let o=0,l,c,f,d=-1,u=0;for(s===-1&&(d=0,u=t[0]&31,s=0,o=1);o<i;){if(l=t[o++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(c=o-s-1,d>=0){const g={data:t.subarray(d,c),type:u};a.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(n&&o<=4-n&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-n)),c>0&&(g.data=appendUint8Array(g.data,t.subarray(0,c)),g.state=0))}o<i?(f=t[o]&31,d=o,u=f,s=0):s=-1}else s=0}if(d>=0&&s>=0){const g={data:t.subarray(d,i),type:u,state:s};a.push(g)}if(a.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=appendUint8Array(g.data,t))}return e.naluState=s,a}}class SampleAesDecrypter{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Decrypter(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const n=s.subarray(16,s.length-s.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let s=0;for(let n=32;n<e.length-16;n+=160,s+=16)i.set(e.subarray(n,n+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let n=32;n<e.length-16;n+=160,s+=16)e.set(i.subarray(s,s+16),n);return e}decryptAvcSample(e,t,i,s,n){const a=discardEPB(n.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{n.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)})}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}const n=e[t].units;for(;!(i>=n.length);i++){const a=n[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,s,a),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.videoParser=new AvcVideoParser}static probe(e){const t=TSDemuxer.syncOffset(e);return t>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let i=Math.min(PACKET_LENGTH*5,t-PACKET_LENGTH)+1,s=0;for(;s<i;){let n=!1,a=-1,o=0;for(let l=s;l<t;l+=PACKET_LENGTH)if(e[l]===71&&(t-l===PACKET_LENGTH||e[l+PACKET_LENGTH]===71)){if(o++,a===-1&&(a=l,a!==0&&(i=Math.min(a+PACKET_LENGTH*99,e.length-PACKET_LENGTH)+1)),n||(n=parsePID(e,l)===0),n&&o>1&&(a===0&&o>2||l+PACKET_LENGTH>i))return a}else{if(o)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",s),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let n;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let f=a.pid,d=a.pesData,u=o.pid,g=l.pid,p=o.pesData,m=l.pesData,S=null,y=this.pmtParsed,x=this._pmtId,E=e.length;if(this.remainderData&&(e=appendUint8Array(this.remainderData,e),E=e.length,this.remainderData=null),E<PACKET_LENGTH&&!s)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const T=Math.max(0,TSDemuxer.syncOffset(e));E-=(E-T)%PACKET_LENGTH,E<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let A=0;for(let P=T;P<E;P+=PACKET_LENGTH)if(e[P]===71){const k=!!(e[P+1]&64),F=parsePID(e,P),M=(e[P+3]&48)>>4;let B;if(M>1){if(B=P+5+e[P+4],B===P+PACKET_LENGTH)continue}else B=P+4;switch(F){case f:k&&(d&&(n=parsePES(d))&&this.videoParser.parseAVCPES(a,c,n,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(e.subarray(B,P+PACKET_LENGTH)),d.size+=P+PACKET_LENGTH-B);break;case u:if(k){if(p&&(n=parsePES(p)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n);break;case"ac3":this.parseAC3PES(o,n);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(B,P+PACKET_LENGTH)),p.size+=P+PACKET_LENGTH-B);break;case g:k&&(m&&(n=parsePES(m))&&this.parseID3PES(l,n),m={data:[],size:0}),m&&(m.data.push(e.subarray(B,P+PACKET_LENGTH)),m.size+=P+PACKET_LENGTH-B);break;case 0:k&&(B+=e[B]+1),x=this._pmtId=parsePAT(e,B);break;case x:{k&&(B+=e[B]+1);const N=parsePMT(e,B,this.typeSupported,i);f=N.videoPid,f>0&&(a.pid=f,a.segmentCodec=N.segmentVideoCodec),u=N.audioPid,u>0&&(o.pid=u,o.segmentCodec=N.segmentAudioCodec),g=N.id3Pid,g>0&&(l.pid=g),S!==null&&!y&&(logger.warn(`MPEG-TS PMT found at ${P} after unknown PID '${S}'. Backtracking to sync byte @${T} to parse all TS packets.`),S=null,P=T-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=F;break}}else A++;if(A>0){const P=new Error(`Found ${A} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message})}a.pesData=d,o.pesData=p,l.pesData=m;const _={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:n}=e,a=i.pesData,o=t.pesData,l=s.pesData;let c;if(a&&(c=parsePES(a))?(this.videoParser.parseAVCPES(i,n,c,!0,this._duration),i.pesData=null):i.pesData=a,o&&(c=parsePES(o))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=parsePES(l))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),n=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,t);return this.decrypt(s,n)}decrypt(e,t){return new Promise(i=>{const{audioTrack:s,videoTrack:n}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{i(e)}):i(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{i(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let n=t.data;if(s){this.aacOverFlow=null;const d=s.missing,u=s.sample.unit.byteLength;if(d===-1)n=appendUint8Array(s.sample.unit,n);else{const g=u-d;s.sample.unit.set(n.subarray(0,d),g),e.samples.push(s.sample),i=s.missing}}let a,o;for(a=i,o=n.length;a<o-1&&!isHeader$1(n,a);a++);if(a!==i){let d;const u=a<o-1;u?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES";const g=new Error(d);if(logger.warn(`parsing error: ${d}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:u,error:g,reason:d}),!u)return}initTrackConfig(e,this.observer,n,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=getFrameDuration(e.samplerate);l=s.sample.pts+d}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,f;for(;a<o;)if(f=appendFrame$2(e,n,a,l,c),a+=f.length,f.missing){this.aacOverFlow=f;break}else for(c++;a<o-1&&!isHeader$1(n,a);a++);}parseMPEGPES(e,t){const i=t.data,s=i.length;let n=0,a=0;const o=t.pts;if(o===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(isHeader(i,a)){const l=appendFrame$1(e,i,a,o,n);if(l)a+=l.length,n++;else break}else a++}parseAC3PES(e,t){{const i=t.data,s=t.pts;if(s===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const n=i.length;let a=0,o=0,l;for(;o<n&&(l=appendFrame(e,i,o,s,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=_extends({},t,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function parsePID(r,e){return((r[e+1]&31)<<8)+r[e+2]}function parsePAT(r,e){return(r[e+10]&31)<<8|r[e+11]}function parsePMT(r,e,t,i){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},n=(r[e+1]&15)<<8|r[e+2],a=e+3+n-4,o=(r[e+10]&15)<<8|r[e+11];for(e+=12+o;e<a;){const l=parsePID(r,e),c=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!i){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:s.audioPid===-1&&(s.audioPid=l);break;case 21:s.id3Pid===-1&&(s.id3Pid=l);break;case 219:if(!i){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:s.videoPid===-1&&(s.videoPid=l,s.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?logger.log("MPEG audio found, not supported in this browser"):s.audioPid===-1&&(s.audioPid=l,s.segmentAudioCodec="mp3");break;case 193:if(!i){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:t.ac3?s.audioPid===-1&&(s.audioPid=l,s.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(s.audioPid===-1&&c>0){let f=e+5,d=c;for(;d>2;){switch(r[f]){case 106:t.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=l,s.segmentAudioCodec="ac3");break}const g=r[f+1]+2;f+=g,d-=g}}break;case 194:case 135:logger.warn("Unsupported EC-3 in M2TS found");break;case 36:logger.warn("Unsupported HEVC in M2TS found");break}e+=c+5}return s}function logEncryptedSamplesFoundInUnencryptedStream(r){logger.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(r){let e=0,t,i,s,n,a;const o=r.data;if(!r||r.size===0)return null;for(;o[0].length<19&&o.length>1;)o[0]=appendUint8Array(o[0],o[1]),o.splice(1,1);if(t=o[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(i=(t[4]<<8)+t[5],i&&i>r.size-6)return null;const c=t[7];c&192&&(n=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,c&64?(a=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,n-a>60*9e4&&(logger.warn(`${Math.round((n-a)/9e4)}s delta between PTS and DTS, align them`),n=a)):a=n),s=t[8];let f=s+9;if(r.size<=f)return null;r.size-=f;const d=new Uint8Array(r.size);for(let u=0,g=o.length;u<g;u++){t=o[u];let p=t.byteLength;if(f)if(f>p){f-=p;continue}else t=t.subarray(f),p-=f,f=0;d.set(t,e),e+=p}return i&&(i-=s+3),{data:d,pts:n,dts:a,len:i}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=getID3Data(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&getTimeStamp(t)!==void 0&&getAudioBSID(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(probe(e,i))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return canParse(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return appendFrame$1(e,t,i,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in MP4.types)MP4.types.hasOwnProperty(e)&&(MP4.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=n,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,a,l,a,o),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,s))}static box(e,...t){let i=8,s=t.length;const n=s;for(;s--;)i+=t[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),s=0,i=8;s<n;s++)a.set(t[s],i),i+=t[s].byteLength;return a}static hdlr(e){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[e])}static mdat(e){return MP4.box(MP4.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(UINT32_MAX+1)),s=Math.floor(t%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return MP4.box(MP4.types.mdia,MP4.mdhd(e.timescale,e.duration),MP4.hdlr(e.type),MP4.minf(e))}static mfhd(e){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(e)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(e))}static moof(e,t,i){return MP4.box(MP4.types.moof,MP4.mfhd(e),MP4.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=MP4.trak(e[t]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(MP4.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=MP4.trex(e[t]);return MP4.box.apply(null,[MP4.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(UINT32_MAX+1)),s=Math.floor(t%(UINT32_MAX+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,n)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,n;for(s=0;s<t.length;s++)n=t[s].flags,i[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return MP4.box(MP4.types.sdtp,i)}static stbl(e){return MP4.box(MP4.types.stbl,MP4.stsd(e),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(e){let t=[],i=[],s,n,a;for(s=0;s<e.sps.length;s++)n=e.sps[s],a=n.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(n));for(s=0;s<e.pps.length;s++)n=e.pps[s],a=n.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(n));const o=MP4.box(MP4.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),l=e.width,c=e.height,f=e.pixelRatio[0],d=e.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return MP4.box(MP4.types.mp4a,MP4.audioStsd(e),MP4.box(MP4.types.esds,MP4.esds(e)))}static mp3(e){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(e))}static ac3(e){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(e),MP4.box(MP4.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(e)):e.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(e)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(e)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(e))}static tkhd(e){const t=e.id,i=e.duration*e.timescale,s=e.width,n=e.height,a=Math.floor(i/(UINT32_MAX+1)),o=Math.floor(i%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,n>>8&255,n&255,0,0]))}static traf(e,t){const i=MP4.sdtp(e),s=e.id,n=Math.floor(t/(UINT32_MAX+1)),a=Math.floor(t%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255])),MP4.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(e),MP4.mdia(e))}static trex(e){const t=e.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,n=12+16*s,a=new Uint8Array(n);let o,l,c,f,d,u;for(t+=8+n,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<s;o++)l=i[o],c=l.duration,f=l.size,d=l.flags,u=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&240<<8,d.degradPrio&15,u>>>24&255,u>>>16&255,u>>>8&255,u&255],12+16*o);return MP4.box(MP4.types.trun,a)}static initSegment(e){MP4.types||MP4.init();const t=MP4.moov(e);return appendUint8Array(MP4.FTYP,t)}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(r,e,t=1,i=!1){const s=r*e*t;return i?Math.round(s):s}function toTimescaleFromScale(r,e,t=1,i=!1){return toTimescaleFromBase(r,e,1/t,i)}function toMsFromMpegTsClock(r,e=!1){return toTimescaleFromBase(r,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,e)}function toMpegTsClockFromTimescale(r,e=1){return toTimescaleFromBase(r,MPEG_TS_CLOCK_FREQ_HZ,1/e)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(e,t,i,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,chromeVersion===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=a?parseInt(a[1]):0}if(safariWebkitVersion===null){const n=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e.reduce((s,n)=>{const a=n.pts-s;return a<-4294967296?(t=!0,normalizePts(s,n.pts)):a>0?s:n.pts},e[0].pts);return t&&logger.debug("PTS rollover detected"),i}remux(e,t,i,s,n,a,o,l){let c,f,d,u,g,p,m=n,S=n;const y=e.pid>-1,x=t.pid>-1,E=t.samples.length,T=e.samples.length>0,A=o&&E>0||E>1;if((!y||T)&&(!x||A)||this.ISGenerated||o){if(this.ISGenerated){var P,k,F,M;const U=this.videoTrackConfig;U&&(t.width!==U.width||t.height!==U.height||((P=t.pixelRatio)==null?void 0:P[0])!==((k=U.pixelRatio)==null?void 0:k[0])||((F=t.pixelRatio)==null?void 0:F[1])!==((M=U.pixelRatio)==null?void 0:M[1]))&&this.resetInitSegment()}else d=this.generateIS(e,t,n,a);const B=this.isVideoContiguous;let N=-1,G;if(A&&(N=findKeyframeIndex(t.samples),!B&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,N>0){logger.warn(`[mp4-remuxer]: Dropped ${N} out of ${E} video samples due to a missing keyframe`);const U=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(N),t.dropped+=N,S+=(t.samples[0].pts-U)/t.inputTimeScale,G=S}else N===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),p=!1);if(this.ISGenerated){if(T&&A){const U=this.getVideoStartPts(t.samples),L=(normalizePts(e.samples[0].pts,U)-U)/t.inputTimeScale;m+=Math.max(0,L),S+=Math.max(0,-L)}if(T){if(e.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,n,a)),f=this.remuxAudio(e,m,this.isAudioContiguous,a,x||A||l===PlaylistLevelType.AUDIO?S:void 0),A){const U=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,n,a)),c=this.remuxVideo(t,S,B,U)}}else A&&(c=this.remuxVideo(t,S,B,0));c&&(c.firstKeyFrame=N,c.independent=N!==-1,c.firstKeyFramePTS=G)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(g=flushTextTrackMetadataCueSamples(i,n,this._initPTS,this._initDTS)),s.samples.length&&(u=flushTextTrackUserdataCueSamples(s,n,this._initPTS))),{audio:f,video:c,initSegment:d,independent:p,text:u,id3:g}}generateIS(e,t,i,s){const n=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS;let f=!c||s,d="audio/mp4",u,g,p;if(f&&(u=g=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):MP4.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(p=e.inputTimeScale,!c||p!==c.timescale?u=g=n[0].pts-Math.round(p*i):f=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:MP4.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(p=t.inputTimeScale,!c||p!==c.timescale){const m=this.getVideoStartPts(a),S=Math.round(p*i);g=Math.min(g,normalizePts(a[0].dts,m)-S),u=Math.min(u,m-S)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,f?(this._initPTS={baseTime:u,timescale:p},this._initDTS={baseTime:g,timescale:p}):u=p=void 0,{tracks:l,initPTS:u,timescale:p}}remuxVideo(e,t,i,s){const n=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS;let f=this.nextAvcDts,d=8,u=this.videoSampleDuration,g,p,m=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,y=!1;if(!i||f===null){const C=t*n,I=a[0].pts-normalizePts(a[0].dts,a[0].pts);chromeVersion&&f!==null&&Math.abs(C-I-f)<15e3?i=!0:f=C-I}const x=c.baseTime*n/c.timescale;for(let C=0;C<l;C++){const I=a[C];I.pts=normalizePts(I.pts-x,f),I.dts=normalizePts(I.dts-x,f),I.dts<a[C>0?C-1:C].dts&&(y=!0)}y&&a.sort(function(C,I){const R=C.dts-I.dts,V=C.pts-I.pts;return R||V}),g=a[0].dts,p=a[a.length-1].dts;const E=p-g,T=E?Math.round(E/(l-1)):u||e.inputTimeScale/30;if(i){const C=g-f,I=C>T,R=C<-1;if((I||R)&&(I?logger.warn(`AVC: ${toMsFromMpegTsClock(C,!0)} ms (${C}dts) hole between fragments detected at ${t.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-C,!0)} ms (${C}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!R||f>=a[0].pts||chromeVersion)){g=f;const V=a[0].pts-C;if(I)a[0].dts=g,a[0].pts=V;else for(let $=0;$<a.length&&!(a[$].dts>V);$++)a[$].dts-=C,a[$].pts-=C;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(V,!0)}/${toMsFromMpegTsClock(g,!0)}, delta: ${toMsFromMpegTsClock(C,!0)} ms`)}}g=Math.max(0,g);let A=0,_=0,P=g;for(let C=0;C<l;C++){const I=a[C],R=I.units,V=R.length;let $=0;for(let H=0;H<V;H++)$+=R[H].data.length;_+=$,A+=V,I.length=$,I.dts<P?(I.dts=P,P+=T/4|0||1):P=I.dts,m=Math.min(I.pts,m),S=Math.max(I.pts,S)}p=a[l-1].dts;const k=_+4*A+8;let F;try{F=new Uint8Array(k)}catch(C){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:k,reason:`fail allocating video mdat ${k}`});return}const M=new DataView(F.buffer);M.setUint32(0,k),F.set(MP4.types.mdat,4);let B=!1,N=Number.POSITIVE_INFINITY,G=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY;for(let C=0;C<l;C++){const I=a[C],R=I.units;let V=0;for(let z=0,W=R.length;z<W;z++){const j=R[z],Y=j.data,Q=j.data.byteLength;M.setUint32(d,Q),d+=4,F.set(Y,d),d+=Q,V+=4+Q}let $;if(C<l-1)u=a[C+1].dts-I.dts,$=a[C+1].pts-I.pts;else{const z=this.config,W=C>0?I.dts-a[C-1].dts:T;if($=C>0?I.pts-a[C-1].pts:T,z.stretchShortVideoTrack&&this.nextAudioPts!==null){const j=Math.floor(z.maxBufferHole*n),Y=(s?m+s*n:this.nextAudioPts)-I.pts;Y>j?(u=Y-W,u<0?u=W:B=!0,logger.log(`[mp4-remuxer]: It is approximately ${Y/90} ms to the next segment; using duration ${u/90} ms for the last video frame.`)):u=W}else u=W}const H=Math.round(I.pts-I.dts);N=Math.min(N,u),U=Math.max(U,u),G=Math.min(G,$),O=Math.max(O,$),o.push(new Mp4Sample(I.key,u,V,H))}if(o.length){if(chromeVersion){if(chromeVersion<70){const C=o[0].flags;C.dependsOn=2,C.isNonSync=0}}else if(safariWebkitVersion&&O-G<U-N&&T/U<.025&&o[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let C=g;for(let I=0,R=o.length;I<R;I++){const V=C+o[I].duration,$=C+o[I].cts;if(I<R-1){const H=V+o[I+1].cts;o[I].duration=H-$}else o[I].duration=I?o[I-1].duration:T;o[I].cts=0,C=V}}}u=B||!u?T:u,this.nextAvcDts=f=p+u,this.videoSampleDuration=u,this.isVideoContiguous=!0;const L=MP4.moof(e.sequenceNumber++,g,_extends({},e,{samples:o})),D="video",b={data1:L,data2:F,startPTS:m/n,endPTS:(S+u)/n,startDTS:g/n,endDTS:f/n,type:D,hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,b}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(e,t,i,s,n){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),f=c*l,d=this._initPTS,u=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],p=n!==void 0;let m=e.samples,S=u?0:8,y=this.nextAudioPts||-1;const x=t*a,E=d.baseTime*a/d.timescale;if(this.isAudioContiguous=i=i||m.length&&y>0&&(s&&Math.abs(x-y)<9e3||Math.abs(normalizePts(m[0].pts-E,x)-y)<20*f),m.forEach(function(L){L.pts=normalizePts(L.pts-E,x)}),!i||y<0){if(m=m.filter(L=>L.pts>=0),!m.length)return;n===0?y=0:s&&!p?y=Math.max(0,x):y=m[0].pts}if(e.segmentCodec==="aac"){const L=this.config.maxAudioFramesDrift;for(let D=0,b=y;D<m.length;D++){const C=m[D],I=C.pts,R=I-b,V=Math.abs(1e3*R/a);if(R<=-L*f&&p)D===0&&(logger.warn(`Audio frame @ ${(I/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*R/a)} ms.`),this.nextAudioPts=y=b=I);else if(R>=L*f&&V<MAX_SILENT_FRAME_DURATION&&p){let $=Math.round(R/f);b=I-$*f,b<0&&($--,b+=f),D===0&&(this.nextAudioPts=y=b),logger.warn(`[mp4-remuxer]: Injecting ${$} audio frame @ ${(b/a).toFixed(3)}s due to ${Math.round(1e3*R/a)} ms gap.`);for(let H=0;H<$;H++){const z=Math.max(b,0);let W=AAC.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);W||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),W=C.unit.subarray()),m.splice(D,0,{unit:W,pts:z}),b+=f,D++}}C.pts=b,b+=f}}let T=null,A=null,_,P=0,k=m.length;for(;k--;)P+=m[k].unit.byteLength;for(let L=0,D=m.length;L<D;L++){const b=m[L],C=b.unit;let I=b.pts;if(A!==null){const V=g[L-1];V.duration=Math.round((I-A)/l)}else if(i&&e.segmentCodec==="aac"&&(I=y),T=I,P>0){P+=S;try{_=new Uint8Array(P)}catch(V){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:P,reason:`fail allocating audio mdat ${P}`});return}u||(new DataView(_.buffer).setUint32(0,P),_.set(MP4.types.mdat,4))}else return;_.set(C,S);const R=C.byteLength;S+=R,g.push(new Mp4Sample(!0,c,R,0)),A=I}const F=g.length;if(!F)return;const M=g[g.length-1];this.nextAudioPts=y=A+l*M.duration;const B=u?new Uint8Array(0):MP4.moof(e.sequenceNumber++,T/l,_extends({},e,{samples:g}));e.samples=[];const N=T/a,G=y/a,O={data1:B,data2:_,startPTS:N,endPTS:G,startDTS:N,endDTS:G,type:"audio",hasAudio:!0,hasVideo:!1,nb:F};return this.isAudioContiguous=!0,O}remuxEmptyAudio(e,t,i,s){const n=e.inputTimeScale,a=e.samplerate?e.samplerate:n,o=n/a,l=this.nextAudioPts,c=this._initDTS,f=c.baseTime*9e4/c.timescale,d=(l!==null?l:s.startDTS*n)+f,u=s.endDTS*n+f,g=o*AAC_SAMPLES_PER_FRAME,p=Math.ceil((u-d)/g),m=AAC.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!m){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const S=[];for(let y=0;y<p;y++){const x=d+y*g;S.push({unit:m,pts:x,dts:x})}return e.samples=S,this.remuxAudio(e,t,i,!1)}}function normalizePts(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function findKeyframeIndex(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function flushTextTrackMetadataCueSamples(r,e,t,i){const s=r.samples.length;if(!s)return;const n=r.inputTimeScale;for(let o=0;o<s;o++){const l=r.samples[o];l.pts=normalizePts(l.pts-t.baseTime*n/t.timescale,e*n)/n,l.dts=normalizePts(l.dts-i.baseTime*n/i.timescale,e*n)/n}const a=r.samples;return r.samples=[],{samples:a}}function flushTextTrackUserdataCueSamples(r,e,t){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let a=0;a<i;a++){const o=r.samples[a];o.pts=normalizePts(o.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((a,o)=>a.pts-o.pts);const n=r.samples;return r.samples=[],{samples:n}}class Mp4Sample{constructor(e,t,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=s,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(patchEncyptionData(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=parseInitSegment(e);s.audio&&(t=getParsedTrackCodec(s.audio,ElementaryStreamTypes.AUDIO)),s.video&&(i=getParsedTrackCodec(s.video,ElementaryStreamTypes.VIDEO));const n={};s.audio&&s.video?n.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:s.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?n.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n}remux(e,t,i,s,n,a){var o,l;let{initPTS:c,lastEndTime:f}=this;const d={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};isFiniteNumber(f)||(f=this.lastEndTime=n||0);const u=t.samples;if(!(u!=null&&u.length))return d;const g={initPTS:void 0,timescale:1};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(u),p=this.initData),!((l=p)!=null&&l.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);const m=getDuration(u,p),S=getStartDTS(p,u),y=S===null?n:S;(isInvalidInitPts(c,y,n,m)||g.timescale!==c.timescale&&a)&&(g.initPTS=y-n,c&&c.timescale===1&&logger.warn(`Adjusting initPTS by ${g.initPTS-c.baseTime}`),this.initPTS=c={baseTime:g.initPTS,timescale:1});const x=e?y-c.baseTime/c.timescale:f,E=x+m;offsetStartDTS(p,u,c.baseTime/c.timescale),m>0?this.lastEndTime=E:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const T=!!p.audio,A=!!p.video;let _="";T&&(_+="audio"),A&&(_+="video");const P={data1:u,startPTS:x,startDTS:x,endPTS:E,endDTS:E,type:_,hasAudio:T,hasVideo:A,nb:1,dropped:0};return d.audio=P.type==="audio"?P:void 0,d.video=P.type!=="audio"?P:void 0,d.initSegment=g,d.id3=flushTextTrackMetadataCueSamples(i,n,c,c),s.samples.length&&(d.text=flushTextTrackUserdataCueSamples(s,n,c)),d}}function isInvalidInitPts(r,e,t,i){if(r===null)return!0;const s=Math.max(i,1),n=e-r.baseTime/r.timescale;return Math.abs(n-t)>s}function getParsedTrackCodec(r,e){const t=r==null?void 0:r.codec;if(t&&t.length>4)return t;if(e===ElementaryStreamTypes.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return getCodecCompatibleName(t,!1);const i="mp4a.40.5";return logger.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${i}"`),i}return logger.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch{logger.debug("Unable to use Performance API on this environment"),now=optionalSelf==null?void 0:optionalSelf.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(e,t,i,s,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=s,this.id=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const n=i.transmuxing;n.executeStart=now();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:f,trackSwitch:d,accurateTimeOffset:u,timeOffset:g,initSegmentChange:p}=s||o,{audioCodec:m,videoCodec:S,defaultInitPts:y,duration:x,initSegmentData:E}=l,T=getEncryptionType(a,t);if(T&&T.method==="AES-128"){const k=this.getDecrypter();if(k.isSync()){let F=k.softwareDecrypt(a,T.key.buffer,T.iv.buffer);if(i.part>-1&&(F=k.flush()),!F)return n.executeEnd=now(),emptyResult(i);a=new Uint8Array(F)}else return this.decryptionPromise=k.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer).then(F=>{const M=this.push(F,null,i);return this.decryptionPromise=null,M}),this.decryptionPromise}const A=this.needsProbing(f,d);if(A){const k=this.configureTransmuxer(a);if(k)return logger.warn(`[transmuxer] ${k.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message}),n.executeEnd=now(),emptyResult(i)}(f||d||p||A)&&this.resetInitSegment(E,m,S,x,t),(f||p||A)&&this.resetInitialTimestamp(y),c||this.resetContiguity();const _=this.transmux(a,T,g,u,i),P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,n.executeEnd=now(),_}flush(e){const t=e.transmuxing;t.executeStart=now();const{decrypter:i,currentTransmuxState:s,decryptionPromise:n}=this;if(n)return n.then(()=>this.flush(e));const a=[],{timeOffset:o}=s;if(i){const d=i.flush();d&&a.push(this.push(d,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return t.executeEnd=now(),[emptyResult(e)];const f=l.flush(o);return isPromise(f)?f.then(d=>(this.flushRemux(a,d,e),a)):(this.flushRemux(a,f,e),a)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:n,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const f=this.remuxer.remux(s,n,a,o,c,l,!0,this.id);e.push({remuxResult:f,chunkMeta:i}),i.transmuxing.executeEnd=now()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,n){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,i,s),o.resetInitSegment(e,t,i,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,n){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,s,n):a=this.transmuxUnencrypted(e,i,s,n),a}transmuxUnencrypted(e,t,i,s){const{audioTrack:n,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,o,l,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,n){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,s,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s,vendor:n}=this;let a;for(let u=0,g=muxConfig.length;u<g;u++){var o;if((o=muxConfig[u].demux)!=null&&o.probe(e)){a=muxConfig[u];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,c=this.remuxer,f=a.remux,d=a.demux;(!c||!(c instanceof f))&&(this.remuxer=new f(i,t,s,n)),(!l||!(l instanceof d))&&(this.demuxer=new d(i,t,s),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Decrypter(this.config)),e}}function getEncryptionType(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const emptyResult=r=>({remuxResult:{},chunkMeta:r});function isPromise(r){return"then"in r&&r.then instanceof Function}class TransmuxConfig{constructor(e,t,i,s,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=n||null}}class TransmuxState{constructor(e,t,i,s,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=n,this.initSegmentChange=a}}var eventemitter3={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(l,c,f){this.fn=l,this.context=c,this.once=f||!1}function n(l,c,f,d,u){if(typeof f!="function")throw new TypeError("The listener must be a function");var g=new s(f,d||l,u),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],g]:l._events[p].push(g):(l._events[p]=g,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],f,d;if(this._eventsCount===0)return c;for(d in f=this._events)e.call(f,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(f)):c},o.prototype.listeners=function(c){var f=t?t+c:c,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,g=d.length,p=new Array(g);u<g;u++)p[u]=d[u].fn;return p},o.prototype.listenerCount=function(c){var f=t?t+c:c,d=this._events[f];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,f,d,u,g,p){var m=t?t+c:c;if(!this._events[m])return!1;var S=this._events[m],y=arguments.length,x,E;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),y){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,f),!0;case 3:return S.fn.call(S.context,f,d),!0;case 4:return S.fn.call(S.context,f,d,u),!0;case 5:return S.fn.call(S.context,f,d,u,g),!0;case 6:return S.fn.call(S.context,f,d,u,g,p),!0}for(E=1,x=new Array(y-1);E<y;E++)x[E-1]=arguments[E];S.fn.apply(S.context,x)}else{var T=S.length,A;for(E=0;E<T;E++)switch(S[E].once&&this.removeListener(c,S[E].fn,void 0,!0),y){case 1:S[E].fn.call(S[E].context);break;case 2:S[E].fn.call(S[E].context,f);break;case 3:S[E].fn.call(S[E].context,f,d);break;case 4:S[E].fn.call(S[E].context,f,d,u);break;default:if(!x)for(A=1,x=new Array(y-1);A<y;A++)x[A-1]=arguments[A];S[E].fn.apply(S[E].context,x)}}return!0},o.prototype.on=function(c,f,d){return n(this,c,f,d,!1)},o.prototype.once=function(c,f,d){return n(this,c,f,d,!0)},o.prototype.removeListener=function(c,f,d,u){var g=t?t+c:c;if(!this._events[g])return this;if(!f)return a(this,g),this;var p=this._events[g];if(p.fn)p.fn===f&&(!u||p.once)&&(!d||p.context===d)&&a(this,g);else{for(var m=0,S=[],y=p.length;m<y;m++)(p[m].fn!==f||u&&!p[m].once||d&&p[m].context!==d)&&S.push(p[m]);S.length?this._events[g]=S.length===1?S[0]:S:a(this,g)}return this},o.prototype.removeAllListeners=function(c){var f;return c?(f=t?t+c:c,this._events[f]&&a(this,f)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const a=(f,d)=>{d=d||{},d.frag=this.frag,d.id=this.id,f===Events.ERROR&&(this.error=d.error),this.hls.trigger(f,d)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,a),this.observer.on(Events.ERROR,a);const o=getMediaSource(n.preferManagedMediaSource)||{isTypeSupported:()=>!1},l={mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')},c=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"&&(n.workerPath||hasUMDWorker())){try{n.workerPath?(logger.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=loadWorker(n.workerPath)):(logger.log(`injecting Web Worker for "${t}"`),this.workerContext=injectWorker()),this.onwmsg=u=>this.onWorkerMessage(u);const{worker:d}=this.workerContext;d.addEventListener("message",this.onwmsg),d.onerror=u=>{const g=new Error(`${u.message}  (${u.filename}:${u.lineno})`);n.enableWorker=!1,logger.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:g})},d.postMessage({cmd:"init",typeSupported:l,vendor:c,id:t,config:JSON.stringify(n)})}catch(d){logger.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,l,n,c,t)}return}this.transmuxer=new Transmuxer(this.observer,l,n,c,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,s,n,a,o,l,c,f){var d,u;c.transmuxing.start=self.performance.now();const{transmuxer:g}=this,p=a?a.start:n.start,m=n.decryptdata,S=this.frag,y=!(S&&n.cc===S.cc),x=!(S&&c.level===S.level),E=S?c.sn-S.sn:-1,T=this.part?c.part-this.part.index:-1,A=E===0&&c.id>1&&c.id===(S==null?void 0:S.stats.chunkCount),_=!x&&(E===1||E===0&&(T===1||A&&T<=0)),P=self.performance.now();(x||E||n.stats.parsing.start===0)&&(n.stats.parsing.start=P),a&&(T||!_)&&(a.stats.parsing.start=P);const k=!(S&&((d=n.initSegment)==null?void 0:d.url)===((u=S.initSegment)==null?void 0:u.url)),F=new TransmuxState(y,_,l,x,p,k);if(!_||y||k){logger.log(`[transmuxer-interface, ${n.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${y}
        trackSwitch: ${x}
        contiguous: ${_}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${k}`);const M=new TransmuxConfig(i,s,t,o,f);this.configureTransmuxer(M)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:F},e instanceof ArrayBuffer?[e]:[]);else if(g){const M=g.push(e,m,c,F);isPromise(M)?(g.async=!0,M.then(B=>{this.handleTransmuxComplete(B)}).catch(B=>{this.transmuxerError(B,c,"transmuxer-interface push error")})):(g.async=!1,this.handleTransmuxComplete(M))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);isPromise(i)||t.async?(isPromise(i)||(i=Promise.resolve(i)),i.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){!this.hls||(this.error=e,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,i=this.hls;switch(t.event){case"init":{var s;const n=(s=this.workerContext)==null?void 0:s.objectURL;n&&self.URL.revokeObjectURL(n);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":logger[t.data.logType]&&logger[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function subtitleOptionsIdentical(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!mediaAttributesIdentical(r[t].attrs,e[t].attrs))return!1;return!0}function mediaAttributesIdentical(r,e,t){const i=r["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function subtitleTrackMatchesTextTrack(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Events.ERROR,this.onError,this),e.on(Events.BUFFER_RESET,this.onBufferReset,this),e.on(Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Events.ERROR,this.onError,this),e.off(Events.BUFFER_RESET,this.onBufferReset,this),e.off(Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n}){if(i==="main"){const a=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:n},this.log(`InitPTS for cc: ${a} found from main: ${s}`),this.videoTrackCC=a,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=State.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var e;const{levels:i,trackId:s}=this,n=i==null||(e=i[s])==null?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var t;const i=performance.now(),s=this.retryDate;if(!s||i>=s||(t=this.media)!=null&&t.seeking){const{levels:n,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((n==null?void 0:n[a])||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:s,part:n,cache:a,complete:o}=i;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const l=a.flush(),c={frag:s,part:n,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=BufferHelper.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);fragmentWithinToleranceTest(c.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;!(e!=null&&e.readyState)||(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:i,trackId:s}=this,n=e.config;if(!i&&(this.startFragRequested||!n.startFragPrefetch)||!(t!=null&&t[s]))return;const a=t[s],o=a.details;if(!o||o.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(o)){this.state=State.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const c=this.getFwdBufferInfo(l,PlaylistLevelType.AUDIO);if(c===null)return;const{bufferedTrack:f,switchingTrack:d}=this;if(!d&&this._streamEnded(c,o)){e.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const u=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),g=c.len,p=this.getMaxBufferLength(u==null?void 0:u.len),m=o.fragments,S=m[0].start;let y=this.flushing?this.getLoadPosition():c.end;if(d&&i){const A=this.getLoadPosition();f&&!mediaAttributesIdentical(d.attrs,f.attrs)&&(y=A),o.PTSKnown&&A<S&&(c.end>S||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=S+.05)}if(g>=p&&!d&&y<m[m.length-1].start)return;let x=this.getNextFragment(y,o),E=!1;if(x&&this.isLoopLoading(x,y)&&(E=!!x.gap,x=this.getNextFragmentLoopLoading(x,o,c,PlaylistLevelType.MAIN,p)),!x){this.bufferFlushed=!0;return}const T=u&&x.start>u.end+o.targetduration;if(T||!(u!=null&&u.len)&&c.len){const A=this.getAppendedFrag(x.start,PlaylistLevelType.MAIN);if(A===null||(E||(E=!!A.gap||!!T&&u.len===0),T&&!E||E&&c.nextStart&&c.nextStart<A.end))return}this.loadFragment(x,a,y)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Level(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=State.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:s}=this,{details:n,id:a}=t;if(!s){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Audio track ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const o=s[a];let l=0;if(n.live||(i=o.details)!=null&&i.live){this.checkLiveUpdate(n);const f=this.mainDetails;if(n.deltaUpdateFailed||!f)return;if(!o.details&&n.hasProgramDateTime&&f.hasProgramDateTime)alignMediaPlaylistByPDT(n,f),l=n.fragments[0].start;else{var c;l=this.alignPlaylists(n,o.details,(c=this.levelLastLoaded)==null?void 0:c.details)}}o.details=n,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!n.live)&&this.setStartPosition(this.mainDetails||n,l),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:s,payload:n}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const f=c.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const d=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let u=this.transmuxer;u||(u=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const g=this.initPTS[i.cc],p=(t=i.initSegment)==null?void 0:t.data;if(g!==void 0){const S=s?s.index:-1,y=S!==-1,x=new ChunkMetadata(i.level,i.sn,i.stats.chunkCount,n.byteLength,S,y);u.push(n,p,d,"",i,s,f.totalduration,!1,x,g)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${f.startSN} ,${f.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new ChunkCache,complete:!1};m.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&i.type===PlaylistLevelType.MAIN){const n=this.videoBuffer||this.media;n&&BufferHelper.getBuffered(n).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},n)))}this.fragBufferedComplete(i,s)}onError(e,t){var i;if(t.fatal){this.state=State.ERROR;return}switch(t.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,t);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===State.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:n,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:f}=o,{details:d}=f,{audio:u,text:g,id3:p,initSegment:m}=n;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=State.PARSING,this.switchingTrack&&u&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const S=l.initSegment||l;this._bufferInitSegment(f,m.tracks,S,a),s.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:m.tracks})}if(u){const{startPTS:S,endPTS:y,startDTS:x,endDTS:E}=u;c&&(c.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:S,endPTS:y,startDTS:x,endDTS:E}),l.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,S,y,x,E),this.bufferFragmentData(u,l,c,a)}if(p!=null&&(t=p.samples)!=null&&t.length){const S=_extends({id:i,frag:l,details:d},p);s.trigger(Events.FRAG_PARSING_METADATA,S)}if(g){const S=_extends({id:i,frag:l,details:d},g);s.trigger(Events.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,i,s){if(this.state!==State.PARSING)return;t.video&&delete t.video;const n=t.audio;if(!n)return;n.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&a.split(",").length===1&&(n.levelCodec=a),this.hls.trigger(Events.BUFFER_CODECS,t);const o=n.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:o};this.hls.trigger(Events.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||s===FragmentState.NOT_LOADED||s===FragmentState.PARTIAL){var n;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragments[0].start!==t.details.fragments[0].start&&alignMediaPlaylistByPDT(t.details,a)}else this.startFragRequested=!0,super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:i}=this,s=i==null?void 0:i.attrs,n=e.attrs;t&&s&&(s.CHANNELS!==n.CHANNELS||i.name!==e.name||i.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},e))}}class AudioTrackController extends BasePlaylistController{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:n}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,s=this.groupIds;let n=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!i||i.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,g)=>{u.id=g});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!n&&l){const u=findMatchingOption(l,o,audioMatchPredicate);if(u>-1)n=o[u];else{const g=findMatchingOption(l,this.tracks);n=this.tracks[g]}}let c=this.findTrackId(n);c===-1&&n&&(c=this.findTrackId(null));const f={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,f);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(o.length&&d===-1){var a;const u=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(u.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:u})}}else this.shouldReloadPlaylist(n)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&matchesOption(e,s,audioMatchPredicate))return s;const n=findMatchingOption(e,this.tracksInGroup,audioMatchPredicate);if(n>-1){const a=this.tracksInGroup[n];return this.setAudioTrack(n),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=findClosestLevelWithAudioGroup(e,t.levels,i,a,audioMatchPredicate);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=findMatchingOption(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e],n=s.details&&!s.details.live;if(e===this.trackId&&s===i&&n||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},s)),n))return;const a=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||matchesOption(e,s,audioMatchPredicate)))return i}if(e){const{name:i,lang:s,assocLang:n,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<t.length;c++){const f=t[c];if(matchesOption({name:i,lang:s,assocLang:n,characteristics:a,audioCodec:o,channels:l},f,audioMatchPredicate))return c}for(let c=0;c<t.length;c++){const f=t[c];if(mediaAttributesIdentical(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const f=t[c];if(mediaAttributesIdentical(e.attrs,f.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const i=t.id,s=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${i} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:e||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.ERROR,this.onError,this),e.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.ERROR,this.onError,this),e.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(this.fragPrevious=i,this.state=State.IDLE,!s)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let a;const o=i.start;for(let c=0;c<n.length;c++)if(o>=n[c].start&&o<=n[c].end){a=n[c];break}const l=i.start+i.duration;a?a.end=l:(a={start:o,end:l},n.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null)}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){const n=s-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=n){a.shift();continue}else if(a[o].start<n)a[o].start=n;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(i,n,PlaylistLevelType.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===PlaylistLevelType.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&subtitleOptionsIdentical(this.levels,t)){this.levels=t.map(i=>new Level(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const s=new Level(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:s,levels:n}=this,{details:a,id:o}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=n[s];if(o>=n.length||o!==s||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(i=l.details)!=null&&i.live){const d=this.mainDetails;if(a.deltaUpdateFailed||!d)return;const u=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(alignMediaPlaylistByPDT(a,d),c=a.fragments[0].start):u&&(c=u.start,addSliding(a,c));else{var f;c=this.alignPlaylists(a,l.details,(f=this.levelLastLoaded)==null?void 0:f.details),c===0&&u&&(c=u.start,addSliding(a,c))}}l.details=a,this.levelLastLoaded=l,!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(this.mainDetails||a,c),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&s.method==="AES-128"){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).catch(o=>{throw n.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();n.trigger(Events.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details)return;const{config:s}=this,n=this.getLoadPosition(),a=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,s.maxBufferHole),{end:o,len:l}=a,c=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),f=i.details,d=this.getMaxBufferLength(c==null?void 0:c.len)+f.levelTargetDuration;if(l>d)return;const u=f.fragments,g=u.length,p=f.edge;let m=null;const S=this.fragPrevious;if(o<p){const y=s.maxFragLookUpTolerance,x=o>p-y?0:y;m=findFragmentByPTS(S,u,Math.max(u[0].start,o),x),!m&&S&&S.start<u[0].start&&(m=u[0])}else m=u[g-1];if(!m)return;if(m=this.mapToInitFragWhenRequired(m),m.sn!=="initSegment"){const y=m.sn-f.startSN,x=u[y-1];x&&x.cc===m.cc&&this.fragmentTracker.getState(x)===FragmentState.NOT_LOADED&&(m=x)}this.fragmentTracker.getState(m)===FragmentState.NOT_LOADED&&this.loadFragment(m,i,o)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(e){this.buffered=void 0;const t=(i,s,n)=>{if(s=s>>>0,s>n-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${n})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=filterSubtitleTracks(this.media.textTracks);for(let n=0;n<i.length;n++)if(i[n].mode==="hidden")t=i[n];else if(i[n].mode==="showing"){t=i[n];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Events.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(t=>{clearCurrentCues(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:s,details:n}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,s=this.groupIds;let n=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,d)=>{f.id=d});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!n&&o){this.selectDefaultTrack=!1;const f=findMatchingOption(o,a);if(f>-1)n=a[f];else{const d=findMatchingOption(o,this.tracks);n=this.tracks[d]}}let l=this.findTrackId(n);l===-1&&n&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}else this.shouldReloadPlaylist(n)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const n=t[s];if(!(i&&!n.default||!i&&!e)&&(!e||matchesOption(n,e)))return s}if(e){for(let s=0;s<t.length;s++){const n=t[s];if(mediaAttributesIdentical(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const n=t[s];if(mediaAttributesIdentical(e.attrs,n.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(subtitleTrackMatchesTextTrack(s,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===PlaylistContextType.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&matchesOption(e,i))return i;const s=findMatchingOption(e,this.tracksInGroup);if(s>-1){const n=this.tracksInGroup[s];return this.setSubtitleTrack(s),n}else{if(i)return null;{const n=findMatchingOption(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const i=t.id,s=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=filterSubtitleTracks(e.textTracks),i=this.currentTrack;let s;if(i&&(s=t.filter(n=>subtitleTrackMatchesTextTrack(i,n))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==s&&(n.mode="disabled")}),s){const n=this.subtitleDisplay?"showing":"hidden";s.mode!==n&&(s.mode=n)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!isFiniteNumber(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:e});return}const n=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&n)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:f}=s;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:f});const d=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(d)}}class BufferOperationQueue{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,i){const s=this.queues[t];s.push(e),s.length===1&&!i&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const i=new Promise(n=>{t=n}),s={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,e),i}executeNext(e){const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){logger.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${s}`),i.onError(s);const n=this.buffers[e];n!=null&&n.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=i=>{!this.hls||this.hls.pauseBuffering()},this._onStartStreaming=i=>{!this.hls||this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:i,mediaSource:s}=this;this.log("Media source opened"),i&&(i.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:i,mediaSource:s})),s&&s.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&logger.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=isManagedMediaSource(getMediaSource(e.config.preferManagedMediaSource)),this.log=logger.log.bind(logger,t),this.warn=logger.warn.bind(logger,t),this.error=logger.error.bind(logger,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.BUFFER_RESET,this.onBufferReset,this),e.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Events.BUFFER_EOS,this.onBufferEos,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Events.FRAG_PARSED,this.onFragParsed,this),e.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.BUFFER_RESET,this.onBufferReset,this),e.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Events.BUFFER_EOS,this.onBufferEos,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Events.FRAG_PARSED,this.onFragParsed,this),e.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const i=this.media=t.media,s=getMediaSource(this.appendSource);if(i&&s){var n;const a=this.mediaSource=new s;this.log(`created media source: ${(n=a.constructor)==null?void 0:n.name}`),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&a instanceof l,removeSourceChildren(i),addSource(i,o),i.load()}catch{i.src=o}else i.src=o;i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(s){this.warn(`onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(e.removeAttribute("src"),this.appendSource&&removeSourceChildren(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var i;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(s){this.warn(`onBufferReset ${e}`,s)}}onBufferCodecs(e,t){const i=this.getSourceBufferTypes().length,s=Object.keys(t);if(s.forEach(a=>{if(i){const l=this.tracks[a];if(l&&typeof l.buffer.changeType=="function"){var o;const{id:c,codec:f,levelCodec:d,container:u,metadata:g}=t[a],p=pickMostCompleteCodecName(l.codec,l.levelCodec),m=p==null?void 0:p.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let S=pickMostCompleteCodecName(f,d);const y=(o=S)==null?void 0:o.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(S&&m!==y){a.slice(0,5)==="audio"&&(S=getCodecCompatibleName(S,this.appendSource));const x=`${u};codecs=${S}`;this.appendChangeType(a,x),this.log(`switching codec ${p} to ${S}`),this.tracks[a]={buffer:l.buffer,codec:f,container:u,levelCodec:d,metadata:g,id:c}}}}else this.pendingTracks[a]=t[a]}),i)return;const n=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==n&&(this.log(`${n} bufferCodec event(s) expected ${s.join(",")}`),this.bufferCodecEventsExpected=n),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:i}=this,s={execute:()=>{const n=this.sourceBuffer[e];n&&(this.log(`changing ${e} sourceBuffer type to ${t}`),n.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:n=>{this.warn(`Failed to change ${e} SourceBuffer type`,n)}};i.append(s,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:i,operationQueue:s,tracks:n}=this,{data:a,type:o,frag:l,part:c,chunkMeta:f}=t,d=f.buffering[o],u=self.performance.now();d.start=u;const g=l.stats.buffering,p=c?c.stats.buffering:null;g.start===0&&(g.start=u),p&&p.start===0&&(p.start=u);const m=n.audio;let S=!1;o==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(S=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const y=l.start,x={execute:()=>{if(d.executeStart=self.performance.now(),S){const E=this.sourceBuffer[o];if(E){const T=y-E.timestampOffset;Math.abs(T)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${y} (delta: ${T}) sn: ${l.sn})`),E.timestampOffset=y)}}this.appendExecutor(a,o)},onStart:()=>{},onComplete:()=>{const E=self.performance.now();d.executeEnd=d.end=E,g.first===0&&(g.first=E),p&&p.first===0&&(p.first=E);const{sourceBuffer:T}=this,A={};for(const _ in T)A[_]=BufferHelper.getBuffered(T[_]);this.appendErrors[o]=0,o==="audio"||o==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:o,frag:l,part:c,chunkMeta:f,parent:l.type,timeRanges:A})},onError:E=>{const T={type:ErrorTypes.MEDIA_ERROR,parent:l.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:l,part:c,chunkMeta:f,error:E,err:E,fatal:!1};if(E.code===DOMException.QUOTA_EXCEEDED_ERR)T.details=ErrorDetails.BUFFER_FULL_ERROR;else{const A=++this.appendErrors[o];T.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${A}/${i.config.appendErrorMaxRetry} times to append segment in "${o}" sourceBuffer`),A>=i.config.appendErrorMaxRetry&&(T.fatal=!0)}i.trigger(Events.ERROR,T)}};s.append(x,o,!!this.pendingTracks[o])}onBufferFlushing(e,t){const{operationQueue:i}=this,s=n=>({execute:this.removeExecutor.bind(this,n,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:n})},onError:a=>{this.warn(`Failed to remove from ${n} SourceBuffer`,a)}});t.type?i.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(n=>{i.append(s(n),n)})}onFragParsed(e,t){const{frag:i,part:s}=t,n=[],a=s?s.elementaryStreams:i.elementaryStreams;a[ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(a[ElementaryStreamTypes.AUDIO]&&n.push("audio"),a[ElementaryStreamTypes.VIDEO]&&n.push("video"));const o=()=>{const l=self.performance.now();i.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const c=s?s.stats:i.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:i,part:s,stats:c,id:i.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,n)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((s,n)=>{const a=this.sourceBuffer[n];return a&&(!t.type||t.type===n)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${n} sourceBuffer now EOS`))),s&&!!(!a||a.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(n=>{const a=this.sourceBuffer[n];a&&(a.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(e,{details:t}){!t.fragments.length||(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.getSourceBufferTypes().length)return;const n=e.config,a=i.currentTime,o=t.levelTargetDuration,l=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(isFiniteNumber(l)&&l>0){const c=Math.max(l,o),f=Math.floor(a/o)*o-c;this.flushBackBuffer(a,o,f)}if(isFiniteNumber(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){const c=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),f=Math.max(c,o),d=Math.floor(a/o)*o+f;this.flushFrontBuffer(a,o,d)}}flushBackBuffer(e,t,i){const{details:s,sourceBuffer:n}=this;this.getSourceBufferTypes().forEach(o=>{const l=n[o];if(l){const c=BufferHelper.getBuffered(l);if(c.length>0&&i>c.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:i}),s!=null&&s.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l.ended&&c.end(c.length-1)-e<t*2){this.log(`Cannot flush ${o} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:o})}}})}flushFrontBuffer(e,t,i){const{sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(a=>{const o=s[a];if(o){const l=BufferHelper.getBuffered(o),c=l.length;if(c<2)return;const f=l.start(c-1),d=l.end(c-1);if(i>f||e>=f&&e<=d)return;if(o.ended&&e-d<2*t){this.log(`Cannot flush ${a} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:a})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:i,mediaSource:s}=this,n=e.fragments[0].start+e.totalduration,a=i.duration,o=isFiniteNumber(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(s.duration=1/0,this.updateSeekableRange(e)):(n>o&&n>a||!isFiniteNumber(a))&&(this.log(`Updating Media Source duration to ${n.toFixed(3)}`),s.duration=n)}updateSeekableRange(e){const t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){const n=Math.max(0,i[0].start),a=Math.max(n,n+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${n}-${a}.`),t.setLiveSeekableRange(n,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,s=Object.keys(i).length;if(s&&(!e||s===2||"audiovideo"in i)){this.createSourceBuffers(i),this.pendingTracks={};const n=this.getSourceBufferTypes();if(n.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),n.forEach(a=>{t.executeNext(a)});else{const a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const n in e)if(!t[n]){var s;const a=e[n];if(!a)throw Error(`source buffer exists for track ${n}, however track does not`);let o=((s=a.levelCodec)==null?void 0:s.indexOf(","))===-1?a.levelCodec:a.codec;o&&n.slice(0,5)==="audio"&&(o=getCodecCompatibleName(o,this.appendSource));const l=`${a.container};codecs=${o}`;this.log(`creating sourceBuffer(${l})`);try{const c=t[n]=i.addSourceBuffer(l),f=n;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(f,"bufferedchange",(d,u)=>{const g=u.removedRanges;g!=null&&g.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:n})}),this.tracks[n]={buffer:c,codec:o,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(c){this.error(`error while trying to add sourceBuffer: ${c.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:n,mimeType:l})}}}get mediaSrc(){var e;const t=((e=this.media)==null?void 0:e.firstChild)||this.media;return t==null?void 0:t.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:i}=this;i.current(e).onComplete(),i.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var i;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,t),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const n=this.operationQueue.current(e);n&&n.onError(s)}removeExecutor(e,t,i){const{media:s,mediaSource:n,operationQueue:a,sourceBuffer:o}=this,l=o[e];if(!s||!n||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}const c=isFiniteNumber(s.duration)?s.duration:1/0,f=isFiniteNumber(n.duration)?n.duration:1/0,d=Math.max(0,t),u=Math.min(i,c,f);u>d&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${d},${u}] from the ${e} SourceBuffer`),l.remove(d,u)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.sourceBuffer[t];if(!i){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}i.ended=!1,i.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:i}=this,s=t.map(n=>i.appendBlocker(n));Promise.all(s).then(()=>{e(),t.forEach(n=>{const a=this.sourceBuffer[n];a!=null&&a.updating||i.shiftAndExecuteNext(n)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){const s=this.sourceBuffer[e];if(!s)return;const n=i.bind(this,e);this.listeners[e].push({event:t,listener:n}),s.addEventListener(t,n)}removeBufferListeners(e){const t=this.sourceBuffer[e];!t||this.listeners[e].forEach(i=>{t.removeEventListener(i.event,i.listener)})}}function removeSourceChildren(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function addSource(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(e){let t=e;return specialCea608CharsCodes.hasOwnProperty(e)&&(t=specialCea608CharsCodes[e]),String.fromCharCode(t)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;logger.log(`${this.time} [${e}] ${i}`)}}}const numArrayToHexArray=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(e){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<NR_COLS;t++)this.chars.push(new StyledUnicodeChar);this.logger=e}equals(e){for(let t=0;t<NR_COLS;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<NR_COLS;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<NR_COLS;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=getCharForByte(e);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<NR_COLS;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<NR_COLS;i++){const s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(e){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<NR_ROWS;t++)this.rows.push(new Row(e));this.logger=e}reset(){for(let e=0;e<NR_ROWS;e++)this.rows[e].clear();this.currRow=NR_ROWS-1}equals(e){let t=!0;for(let i=0;i<NR_ROWS;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<NR_ROWS;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<NR_ROWS;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<NR_ROWS;o++)this.rows[o].clear();const n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[n].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[n+c])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const n=e.indent,a=Math.max(n-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let n=0;n<NR_ROWS;n++){const a=this.rows[n].getTextString();a&&(s=n+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(i),this.nonDisplayedMemory=new CaptionScreen(i),this.lastOutputScreen=new CaptionScreen(i),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Cea608Parser{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const s=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(e,t,s),new Cea608Channel(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,s,n,a=!1;this.logger.time=e;for(let o=0;o<t.length;o+=2)if(s=t[o]&127,n=t[o+1]&127,!(s===0&&n===0)){if(this.logger.log(3,"["+numArrayToHexArray([t[o],t[o+1]])+"] -> ("+numArrayToHexArray([s,n])+")"),i=this.parseCmd(s,n),i||(i=this.parseMidrow(s,n)),i||(i=this.parsePAC(s,n)),i||(i=this.parseBackgroundAttributes(s,n)),!i&&(a=this.parseChars(s,n),a)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!i&&!a&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([s,n])+" orig: "+numArrayToHexArray([t[o],t[o+1]]))}}parseCmd(e,t){const{cmdHistory:i}=this,s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;if(hasCmdRepeated(e,t,i))return setLastCmd(null,null,i),this.logger.log(3,"Repeated command ("+numArrayToHexArray([e,t])+") is dropped"),!0;const a=e===20||e===21||e===23?1:2,o=this.channels[a];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),setLastCmd(e,t,i),this.currentChannel=a,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,"MIDROW ("+numArrayToHexArray([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const s=this.cmdHistory,n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(n||a))return!1;if(hasCmdRepeated(e,t,s))return setLastCmd(null,null,s),!0;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?rowsLowCh1[e]:rowsLowCh2[e]:i=o===1?rowsHighCh1[e]:rowsHighCh2[e];const l=this.channels[o];return l?(l.setPAC(this.interpretPAC(i,t)),setLastCmd(e,t,s),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,n=null;if(e>=25?(i=2,n=e-8):(i=1,n=e),n>=17&&n<=19){let a;n===17?a=t+80:n===18?a=t+112:a=t+144,this.logger.log(2,"Special char '"+getCharForByte(a)+"' in channel "+i),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);if(s){const a=numArrayToHexArray(s);this.logger.log(3,"Char codes =  "+a.join(",")),setLastCmd(e,t,this.cmdHistory)}return s}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let n;const a={};e===16||e===24?(n=Math.floor((t-32)/2),a.background=backgroundColors[n],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),setLastCmd(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function setLastCmd(r,e,t){t.a=r,t.b=e}function hasCmdRepeated(r,e,t){return t.a===r&&t.b===e}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function i(o){return t(r,o)}function s(o){return t(e,o)}function n(o,...l){let c=1;for(;c<arguments.length;c++){const f=arguments[c];for(const d in f)o[d]=f[d]}return o}function a(o,l,c){const f=this,d={enumerable:!0};f.hasBeenReset=!1;let u="",g=!1,p=o,m=l,S=c,y=null,x="",E=!0,T="auto",A="start",_=50,P="middle",k=50,F="middle";Object.defineProperty(f,"id",n({},d,{get:function(){return u},set:function(M){u=""+M}})),Object.defineProperty(f,"pauseOnExit",n({},d,{get:function(){return g},set:function(M){g=!!M}})),Object.defineProperty(f,"startTime",n({},d,{get:function(){return p},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");p=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",n({},d,{get:function(){return m},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");m=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",n({},d,{get:function(){return S},set:function(M){S=""+M,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",n({},d,{get:function(){return y},set:function(M){y=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",n({},d,{get:function(){return x},set:function(M){const B=i(M);if(B===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=B,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",n({},d,{get:function(){return E},set:function(M){E=!!M,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",n({},d,{get:function(){return T},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",n({},d,{get:function(){return A},set:function(M){const B=s(M);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");A=B,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",n({},d,{get:function(){return _},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");_=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",n({},d,{get:function(){return P},set:function(M){const B=s(M);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");P=B,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",n({},d,{get:function(){return k},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");k=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",n({},d,{get:function(){return F},set:function(M){const B=s(M);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");F=B,this.hasBeenReset=!0}})),f.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class StringDecoder{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function parseTimeStamp(r){function e(i,s,n,a){return(i|0)*3600+(s|0)*60+(n|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function parseOptions(r,e,t,i){const s=i?r.split(i):[r];for(const n in s){if(typeof s[n]!="string")continue;const a=s[n].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue(r,e,t){const i=r;function s(){const o=parseTimeStamp(r);if(o===null)throw new Error("Malformed timestamp: "+i);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function n(o,l){const c=new Settings;parseOptions(o,function(u,g){let p;switch(u){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===g){c.set(u,t[m].region);break}break;case"vertical":c.alt(u,g,["rl","lr"]);break;case"line":p=g.split(","),c.integer(u,p[0]),c.percent(u,p[0])&&c.set("snapToLines",!1),c.alt(u,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",center,"end"]);break;case"position":p=g.split(","),c.percent(u,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":c.percent(u,g);break;case"align":c.alt(u,g,["start",center,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let f=c.get("line","auto");f==="auto"&&defaults.line===-1&&(f=-1),l.line=f,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",center);let d=c.get("position","auto");d==="auto"&&defaults.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);r=r.slice(3),a(),e.endTime=s(),a(),n(r,e)}function fixLineBreaks(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let n=t.buffer,a=0;for(n=fixLineBreaks(n);a<n.length&&n[a]!=="\r"&&n[a]!==`
`;)++a;const o=n.slice(0,a);return n[a]==="\r"&&++a,n[a]===`
`&&++a,t.buffer=n.slice(a),o}function s(n){parseOptions(n,function(a,o){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=i();const o=n.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=i(),t.state){case"HEADER":/:/.test(n)?s(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new VTTCue(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{parseCue(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=n.indexOf("-->")!==-1;if(!n||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(e,t,i=0){return e.slice(i,i+t.length)===t},cueString2millis=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!isFiniteNumber(t)||!isFiniteNumber(i)||!isFiniteNumber(s)||!isFiniteNumber(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=60*60*1e3*n,t},hash=function(e){let t=5381,i=e.length;for(;i;)t=t*33^e.charCodeAt(--i);return(t>>>0).toString()};function generateCueId(r,e,t){return hash(r.toString())+hash(e.toString())+hash(t)}const calculateOffset=function(e,t,i){let s=e[t],n=e[s.prevCC];if(!n||!n.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=n)!=null&&a.new;){var a;e.ccOffset+=s.start-n.start,s.new=!1,s=n,n=e[s.prevCC]}e.presentationOffset=i};function parseWebVTT(r,e,t,i,s,n,a){const o=new VTTParser,l=utf8ArrayToStr(new Uint8Array(r)).trim().replace(LINEBREAKS,`
`).split(`
`),c=[],f=e?toMpegTsClockFromTimescale(e.baseTime,e.timescale):0;let d="00:00.000",u=0,g=0,p,m=!0;o.oncue=function(S){const y=t[i];let x=t.ccOffset;const E=(u-f)/9e4;if(y!=null&&y.new&&(g!==void 0?x=t.ccOffset=y.start:calculateOffset(t,i,E)),E){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}x=E-t.presentationOffset}const T=S.endTime-S.startTime,A=normalizePts((S.startTime+x-g)*9e4,s*9e4)/9e4;S.startTime=Math.max(A,0),S.endTime=Math.max(A+T,0);const _=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(_)),S.id||(S.id=generateCueId(S.startTime,S.endTime,_)),S.endTime>0&&c.push(S)},o.onparsingerror=function(S){p=S},o.onflush=function(){if(p){a(p);return}n(c)},l.forEach(S=>{if(m)if(startsWith(S,"X-TIMESTAMP-MAP=")){m=!1,S.slice(16).split(",").forEach(y=>{startsWith(y,"LOCAL:")?d=y.slice(6):startsWith(y,"MPEGTS:")&&(u=parseInt(y.slice(7)))});try{g=cueString2millis(d)/1e3}catch(y){p=y}return}else S===""&&(m=!1);o.parse(S+`
`)}),o.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(r,e,t,i){const s=findBox(new Uint8Array(r),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const n=s.map(o=>utf8ArrayToStr(o)),a=toTimescaleFromScale(e.baseTime,1,e.timescale);try{n.forEach(o=>t(parseTTML(o,a)))}catch(o){i(o)}}function parseTTML(r,e){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((d,u)=>(d[u]=s.getAttribute(`ttp:${u}`)||n[u],d),{}),o=s.getAttribute("xml:space")!=="preserve",l=collectionToDictionary(getElementCollection(s,"styling","style")),c=collectionToDictionary(getElementCollection(s,"layout","region")),f=getElementCollection(s,"body","[begin]");return[].map.call(f,d=>{const u=getTextContent(d,o);if(!u||!d.hasAttribute("begin"))return null;const g=parseTtmlTime(d.getAttribute("begin"),a),p=parseTtmlTime(d.getAttribute("dur"),a);let m=parseTtmlTime(d.getAttribute("end"),a);if(g===null)throw timestampParsingError(d);if(m===null){if(p===null)throw timestampParsingError(d);m=g+p}const S=new VTTCue(g-e,m-e,u);S.id=generateCueId(S.startTime,S.endTime,S.text);const y=c[d.getAttribute("region")],x=l[d.getAttribute("style")],E=getTtmlStyles(y,x,l),{textAlign:T}=E;if(T){const A=textAlignToLineAlign[T];A&&(S.lineAlign=A),S.align=T}return _extends(S,E),S}).filter(d=>d!==null)}function getElementCollection(r,e,t){const i=r.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function collectionToDictionary(r){return r.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function getTextContent(r,e){return[].slice.call(r.childNodes).reduce((t,i,s)=>{var n;return i.nodeName==="br"&&s?t+`
`:(n=i.childNodes)!=null&&n.length?getTextContent(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function getTtmlStyles(r,e,t){const i="http://www.w3.org/ns/ttml#styling";let s=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),n.reduce((o,l)=>{const c=getAttributeNS(e,i,l)||getAttributeNS(r,i,l)||getAttributeNS(s,i,l);return c&&(o[l]=c),o},{})}function getAttributeNS(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function timestampParsingError(r){return new Error(`Could not parse ttml timestamp ${r}`)}function parseTtmlTime(r,e){if(!r)return null;let t=parseTimeStamp(r);return t===null&&(HMSF_REGEX.test(r)?t=parseHoursMinutesSecondsFrames(r,e):TIME_UNIT_REGEX.test(r)&&(t=parseTimeUnits(r,e))),t}function parseHoursMinutesSecondsFrames(r,e){const t=HMSF_REGEX.exec(r),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function parseTimeUnits(r,e){const t=TIME_UNIT_REGEX.exec(r),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class TimelineController{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Events.FRAG_LOADING,this.onFragLoading,this),e.on(Events.FRAG_LOADED,this.onFragLoaded,this),e.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Events.FRAG_LOADING,this.onFragLoading,this),e.off(Events.FRAG_LOADED,this.onFragLoaded,this),e.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new OutputFilter(this,"textTrack1"),t=new OutputFilter(this,"textTrack2"),i=new OutputFilter(this,"textTrack3"),s=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,e,t),this.cea608Parser2=new Cea608Parser(3,i,s)}}addCues(e,t,i,s,n){let a=!1;for(let o=n.length;o--;){const l=n[o],c=intersection(l[0],l[1],t,i);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),a=!0,c/(i-t)>.5))return}if(a||n.push([t,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,i,s)}else{const o=this.Cues.newCue(null,t,i,s);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n}){const{unparsedVttFrags:a}=this;i==="main"&&(this.initPTS[t.cc]={baseTime:s,timescale:n}),a.length&&(this.unparsedVttFrags=[],a.forEach(o=>{this.onFragLoaded(Events.FRAG_LOADED,o)}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const n=i.textTracks[s];if(canReuseVttTextTrack(n,{name:e,lang:t,attrs:{}}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:n,languageCode:a}=t[e],o=this.getExistingTrack(n,a);if(o)i[e]=o,clearCurrentCues(i[e]),sendAddTrackEvent(i[e],s);else{const l=this.createTextTrack("captions",n,a);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){const s=this.media;if(!!s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{clearCurrentCues(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)clearCurrentCues(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some(n=>n.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,o=a?filterSubtitleTracks(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let f;if(o){let d=null;for(let u=0;u<o.length;u++)if(o[u]&&canReuseVttTextTrack(o[u],l)){d=o[u],o[u]=null;break}d&&(f=d)}if(f)clearCurrentCues(f);else{const d=captionsOrSubtitlesFromCharacteristics(l);f=this.createTextTrack(d,l.name,l.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const n=`textTrack${s[1]}`,a=this.captionsProperties[n];!a||(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){this.initCea608Parsers();const{cea608Parser1:i,cea608Parser2:s,lastCc:n,lastSn:a,lastPartIndex:o}=this;if(!(!this.enabled||!i||!s)&&t.frag.type===PlaylistLevelType.MAIN){var l,c;const{cc:f,sn:d}=t.frag,u=(l=t==null||(c=t.part)==null?void 0:c.index)!=null?l:-1;d===a+1||d===a&&u===o+1||f===n||(i.reset(),s.reset()),this.lastCc=f,this.lastSn=d,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===PlaylistLevelType.SUBTITLE)if(s.byteLength){const n=i.decryptdata,a="stats"in t;if(n==null||!n.encrypted||a){const o=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===IMSC1_CODEC?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;parseIMSC1(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:n,unparsedVttFrags:a}=this,o=n.length-1;if(!n[i.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(t=i.initSegment)!=null&&t.data?appendUint8Array(i.initSegment.data,new Uint8Array(s)):s;parseWebVTT(c,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,f=>{this._appendCues(f,i.level),l.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},f=>{const d=f.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(i,s),logger.log(`Failed to parse VTT cue: ${f}`),!(d&&o>i.cc)&&l.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:f})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||parseIMSC1(t,this.initPTS[e.cc],()=>{i.textCodec=IMSC1_CODEC,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(n=>addCueToTrack(s,n))}else{const s=this.tracks[t];if(!s)return;const n=s.default?"default":"subtitles"+t;i.trigger(Events.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:i,cea608Parser2:s}=this;if(!this.enabled||!i||!s)return;const{frag:n,samples:a}=t;if(!(n.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let o=0;o<a.length;o++){const l=a[o].bytes;if(l){const c=this.extractCea608Data(l);i.addData(a[o].pts,c[0]),s.addData(a[o].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:n}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!n||n==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>removeCuesInRange(o[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>removeCuesInRange(o[l],t,s))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let s=2;for(let n=0;n<i;n++){const a=e[s++],o=127&e[s++],l=127&e[s++];if(o===0&&l===0)continue;if((4&a)!==0){const f=3&a;(f===0||f===1)&&(t[f].push(o),t[f].push(l))}}return t}}function captionsOrSubtitlesFromCharacteristics(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(r,e){return!!r&&r.kind===captionsOrSubtitlesFromCharacteristics(e)&&subtitleTrackMatchesTextTrack(e,r)}function intersection(r,e,t,i){return Math.min(e,i)-Math.max(r,t)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((s,n)=>this.isLevelAllowed(s)&&n<=e);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const s=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let n=e.length-1;const a=Math.max(t,i);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&s(l,e[o+1])){n=o;break}}return n}}class FPSController{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const n=s-this.lastTime,a=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/n,c=this.hls;if(c.trigger(Events.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:i}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let f=c.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=f)&&(f=f-1,c.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:c.currentLevel}),c.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===KeySystems.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(a,o,l)=>!!a&&l.indexOf(a)===o,s=t.map(a=>a.audioCodec).filter(i),n=t.map(a=>a.videoCodec).filter(i);return s.length+n.length===0&&n.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const f=c.shift();this.getMediaKeysPromise(f,s,n).then(d=>a({keySystem:f,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof EMEKeyError?o(d):o(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,t)}getMediaKeysPromise(e,t,i){const s=getSupportedMediaKeySystemConfigurations(e,t,i,this.config.drmSystemOptions),n=this.keySystemAccessPromises[e];let a=n==null?void 0:n.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(s)}`),a=this.requestMediaKeySystemAccess(e,s);const o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),c.then(d=>d?this.setMediaKeysServerCertificate(f,e,d):f))),o.mediaKeys.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),o.mediaKeys})}return a.then(()=>n.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Hex.hexDump(e.keyId||[])}`);const s=i.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),n="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,n,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Hex.hexDump(e.keyId)}updateKeySession(e,t){var i;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Hex.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{const s=getKeySystemsForConfig(this.config),n=e.map(keySystemFormatToKeySystemDomain).filter(a=>!!a&&s.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(n).then(({keySystem:a})=>{const o=keySystemDomainToKeySystemFormat(a);o?t(o):i(new Error(`Unable to find format for key-system "${a}"`))}).catch(i)})}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),s=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let n=this.keyIdToKeySessionPromise[i];return n||(n=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(a,o).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:a,mediaKeys:o,decryptdata:t}),c="cenc";return this.generateRequestWithPreferredKeySession(l,c,t.pssh,"playlist-key")}))),n.catch(a=>this.handleError(a))),n}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){!this.hls||(this.error(e.message),e instanceof EMEKeyError?this.hls.trigger(Events.ERROR,e.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const s=keySystemFormatToKeySystemDomain(e.keyFormat),n=s?[s]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(n)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=getKeySystemsForConfig(this.config)),e.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:i}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),i===null)return;let s,n;if(t==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const f=bin2str(new Uint8Array(i));try{const d=base64Decode(JSON.parse(f).sinf),u=parseSinf(new Uint8Array(d));if(!u)return;s=u.subarray(8,24),n=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const f=parsePssh(i);if(f===null)return;f.version===0&&f.systemId===KeySystemIds.WIDEVINE&&f.data&&(s=f.data.subarray(8,24)),n=keySystemIdToKeySystemDomain(f.systemId)}if(!n||!s)return;const a=Hex.hexDump(s),{keyIdToKeySessionPromise:o,mediaKeySessions:l}=this;let c=o[a];for(let f=0;f<l.length;f++){const d=l[f],u=d.decryptdata;if(u.pssh||!u.keyId)continue;const g=Hex.hexDump(u.keyId);if(a===g||u.uri.replace(/-/g,"").indexOf(a)!==-1){c=o[g],delete o[g],u.pssh=new Uint8Array(i),u.keyId=s,c=o[a]=c.then(()=>this.generateRequestWithPreferredKeySession(d,t,i,"encrypted-event-key-match"));break}}c||(c=o[a]=this.getKeySystemSelectionPromise([n]).then(({keySystem:f,mediaKeys:d})=>{var u;this.throwIfDestroyed();const g=new LevelKey("ISO-23001-7",a,(u=keySystemDomainToKeySystemFormat(f))!=null?u:"");return g.pssh=new Uint8Array(i),g.keyId=s,this.attemptSetMediaKeys(f,d).then(()=>{this.throwIfDestroyed();const p=this.createMediaKeySessionContext({decryptdata:g,keySystem:f,mediaKeys:d});return this.generateRequestWithPreferredKeySession(p,t,i,"encrypted-event-no-match")})})),c.catch(f=>this.handleError(f))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(n=>i.indexOf(n)===-1)})}generateRequestWithPreferredKeySession(e,t,i,s){var n,a;const o=(n=this.config.drmSystems)==null||(a=n[e.keySystem])==null?void 0:a.generateRequest;if(o)try{const p=o.call(this.hls,t,i,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,i=e.decryptdata.pssh=p.initData?new Uint8Array(p.initData):null}catch(p){var l;if(this.warn(p.message),(l=this.hls)!=null&&l.config.debug)throw p}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${c} (init data type: ${t} length: ${i?i.byteLength:null})`);const f=new EventEmitter,d=e._onmessage=p=>{const m=e.mediaKeysSession;if(!m){f.emit("error",new Error("invalid state"));return}const{messageType:S,message:y}=p;this.log(`"${S}" message event for session "${m.sessionId}" message size: ${y.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,y).catch(x=>{this.handleError(x),f.emit("error",x)}):S==="license-release"?e.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(e,strToUtf8array("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${S}"`)},u=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){f.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const S=e.keyStatus;f.emit("keyStatus",S),S==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",u);const g=new Promise((p,m)=>{f.on("error",m),f.on("keyStatus",S=>{S.startsWith("usable")?p():S==="output-restricted"?m(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):S==="internal-error"?m(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${S}"`)):S==="expired"?m(new Error("key expired while generating request")):this.warn(`unhandled key status change "${S}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var p;this.log(`Request generated for key-session "${(p=e.mediaKeysSession)==null?void 0:p.sessionId}" keyId: ${c}`)}).catch(p=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:p,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>g).catch(p=>{throw f.removeAllListeners(),this.removeSession(e),p}).then(()=>(f.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Hex.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Hex.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,s=new i(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:n},c=t.certLoadPolicy.default,f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(u,g,p,m)=>{a(u.data)},onError:(u,g,p,m)=>{o(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:_objectSpread2({url:l.url,data:void 0},u)},`"${e}" certificate request failed (${n}). Status: ${u.code} (${u.text})`))},onTimeout:(u,g,p)=>{o(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(u,g,p)=>{o(new Error("aborted"))}};s.load(l,f,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((s,n)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),s(e)}).catch(a=>{n(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(i,"application/xml"),n=s.querySelectorAll("HttpHeader");if(n.length>0){let f;for(let d=0,u=n.length;d<u;d++){var a,o;f=n[d];const g=(a=f.querySelector("name"))==null?void 0:a.textContent,p=(o=f.querySelector("value"))==null?void 0:o.textContent;g&&p&&e.setRequestHeader(g,p)}}const l=s.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(c))}setupLicenseXHR(e,t,i,s){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,i,s)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",t,!0),n.call(this.hls,e,t,i,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((s,n)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(f){this.error(f)}s(l)}else{const l=i.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)n(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const f=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(s,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==KeySystems.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const i=t.length;EMEController.CDMCleanupPromise=Promise.all(t.map(s=>this.removeSession(s)).concat(e==null?void 0:e.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((s,n)=>(s.indexOf(n.keyFormat)===-1&&s.push(n.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),t.remove().catch(n=>{this.log(`Could not remove session: ${n}`)}).then(()=>t.close()).catch(n=>{this.log(`Could not close session: ${n}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var CmObjectType;(function(r){r.MANIFEST="m",r.AUDIO="a",r.VIDEO="v",r.MUXED="av",r.INIT="i",r.CAPTION="c",r.TIMED_TEXT="tt",r.KEY="k",r.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(r){r.DASH="d",r.HLS="h",r.SMOOTH="s",r.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(r){r.OBJECT="CMCD-Object",r.REQUEST="CMCD-Request",r.SESSION="CMCD-Session",r.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(i=>i instanceof SfItem?i:new SfItem(i))),this.value=e,this.params=t}}class SfToken{constructor(e){this.description=void 0,this.description=e}}const DICT="Dict";function format(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function throwError(r,e,t,i){return new Error(`failed to ${r} "${format(e)}" as ${t}`,{cause:i})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(r){return r<-999999999999999||999999999999999<r}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(r,e,t){return throwError("serialize",r,e,t)}function serializeBoolean(r){if(typeof r!="boolean")throw serializeError(r,BOOLEAN);return r?"?1":"?0"}function base64encode(r){return btoa(String.fromCharCode(...r))}function serializeByteSequence(r){if(ArrayBuffer.isView(r)===!1)throw serializeError(r,BYTES);return`:${base64encode(r)}:`}function serializeInteger(r){if(isInvalidInt(r))throw serializeError(r,INTEGER);return r.toString()}function serializeDate(r){return`@${serializeInteger(r.getTime()/1e3)}`}function roundToEven(r,e){if(r<0)return-roundToEven(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}function serializeDecimal(r){const e=roundToEven(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw serializeError(r,DECIMAL);const t=e.toString();return t.includes(".")?t:`${t}.0`}const STRING="String";function serializeString(r){if(STRING_REGEX.test(r))throw serializeError(r,STRING);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(r){return r.description||r.toString().slice(7,-1)}function serializeToken(r){const e=symbolToStr(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw serializeError(e,TOKEN);return e}function serializeBareItem(r){switch(typeof r){case"number":if(!isFiniteNumber(r))throw serializeError(r,BARE_ITEM);return Number.isInteger(r)?serializeInteger(r):serializeDecimal(r);case"string":return serializeString(r);case"symbol":return serializeToken(r);case"boolean":return serializeBoolean(r);case"object":if(r instanceof Date)return serializeDate(r);if(r instanceof Uint8Array)return serializeByteSequence(r);if(r instanceof SfToken)return serializeToken(r);default:throw serializeError(r,BARE_ITEM)}}function serializeKey(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw serializeError(r,KEY);return r}function serializeParams(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${serializeKey(e)}`:`;${serializeKey(e)}=${serializeBareItem(t)}`).join("")}function serializeItem(r){return r instanceof SfItem?`${serializeBareItem(r.value)}${serializeParams(r.params)}`:serializeBareItem(r)}function serializeInnerList(r){return`(${r.value.map(serializeItem).join(" ")})${serializeParams(r.params)}`}function serializeDict(r,e={whitespace:!0}){if(typeof r!="object")throw serializeError(r,DICT);const t=r instanceof Map?r.entries():Object.entries(r),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,n])=>{n instanceof SfItem||(n=new SfItem(n));let a=serializeKey(s);return n.value===!0?a+=serializeParams(n.params):(a+="=",Array.isArray(n.value)?a+=serializeInnerList(n):a+=serializeItem(n)),a}).join(`,${i}`)}function encodeSfDict(r,e){return serializeDict(r,e)}const isTokenField=r=>r==="ot"||r==="sf"||r==="st",isValid=r=>typeof r=="number"?isFiniteNumber(r):r!=null&&r!==""&&r!==!1;function urlToRelativePath(r,e){const t=new URL(r),i=new URL(e);if(t.origin!==i.origin)return r;const s=t.pathname.split("/").slice(1),n=i.pathname.split("/").slice(1,-1);for(;s[0]===n[0];)s.shift(),n.shift();for(;n.length;)n.shift(),s.unshift("..");return s.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?n:n&3|8).toString(16)})}}}const toRounded=r=>Math.round(r),toUrlSafe=(r,e)=>(e!=null&&e.baseUrl&&(r=urlToRelativePath(r,e.baseUrl)),encodeURIComponent(r)),toHundred=r=>toRounded(r/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(r,e){const t={};if(r==null||typeof r!="object")return t;const i=Object.keys(r).sort(),s=_extends({},CmcdFormatters,e==null?void 0:e.formatters),n=e==null?void 0:e.filter;return i.forEach(a=>{if(n!=null&&n(a))return;let o=r[a];const l=s[a];l&&(o=l(o,e)),!(a==="v"&&o===1)&&(a=="pr"&&o===1||!isValid(o)||(isTokenField(a)&&typeof o=="string"&&(o=new SfToken(o)),t[a]=o))}),t}function encodeCmcd(r,e={}){return r?encodeSfDict(processCmcd(r,e),_extends({whitespace:!1},e)):""}function toCmcdHeaders(r,e={}){if(!r)return{};const t=Object.entries(r),i=Object.entries(CmcdHeaderMap).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=t.reduce((n,a)=>{var o,l;const[c,f]=a,d=((o=i.find(u=>u[1].includes(c)))==null?void 0:o[0])||CmcdHeaderField.REQUEST;return(l=n[d])!=null||(n[d]={}),n[d][c]=f,n},{});return Object.entries(s).reduce((n,[a,o])=>(n[a]=encodeCmcd(o,e),n),{})}function appendCmcdHeaders(r,e,t){return _extends(r,toCmcdHeaders(e,t))}const CMCD_PARAM="CMCD";function toCmcdQuery(r,e={}){if(!r)return"";const t=encodeCmcd(r,e);return`${CMCD_PARAM}=${encodeURIComponent(t)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(r,e,t){const i=toCmcdQuery(e,t);if(!i)return r;if(REGEX.test(r))return r.replace(REGEX,i);const s=r.includes("?")?"&":"?";return`${r}${s}${i}`}class CMCDController{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(n){logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=s=>{try{const n=s.frag,a=this.hls.levels[n.level],o=this.getObjectType(n),l={d:n.duration*1e3,ot:o};(o===CmObjectType.VIDEO||o===CmObjectType.AUDIO||o==CmObjectType.MUXED)&&(l.br=a.bitrate/1e3,l.tb=this.getTopBandwidth(o)/1e3,l.bl=this.getBufferLength(o)),this.apply(s,l)}catch(n){logger.warn("Could not generate segment CMCD data.",n)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){_extends(t,this.createData());const i=t.ot===CmObjectType.INIT||t.ot===CmObjectType.VIDEO||t.ot===CmObjectType.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((n,a)=>(s.includes(a)&&(n[a]=t[a]),n),{})),this.useHeaders?(e.headers||(e.headers={}),appendCmcdHeaders(e.headers,t)):e.url=appendCmcdQuery(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return CmObjectType.TIMED_TEXT;if(e.sn==="initSegment")return CmObjectType.INIT;if(t==="audio")return CmObjectType.AUDIO;if(t==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(e){let t=0,i;const s=this.hls;if(e===CmObjectType.AUDIO)i=s.audioTracks;else{const n=s.maxAutoLevel,a=n>-1?n+1:s.levels.length;i=s.levels.slice(0,a)}for(const n of i)n.bitrate>t&&(t=n.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,i=e===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:BufferHelper.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;!e||(e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&i.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const s=this.levels;let n=this.pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:c}=t.context;o&&s?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!n&&s&&(n=s.reduce((o,l)=>(o.indexOf(l.pathwayId)===-1&&o.push(l.pathwayId),o),[])),n&&n.length>1&&(this.updatePathwayPriority(n),i.resolved=this.pathwayId!==a),i.resolved||logger.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${JSON.stringify(n)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(n=>{s-i[n]>PATHWAY_PENALTY_DURATION_MS&&delete i[n]});for(let n=0;n<e.length;n++){const a=e[n];if(a in i)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,reassignFragmentLevelIndexes(t),this.hls.trigger(Events.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let n=0;n<s.length;n++)if(t===PlaylistContextType.AUDIO_TRACK&&s[n].hasAudioGroup(e)||t===PlaylistContextType.SUBTITLE_TRACK&&s[n].hasSubtitleGroup(e))return s[n].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach(n=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=n;if(t.some(f=>f.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(f=>{const d=new AttrList(f.attrs);d["PATHWAY-ID"]=a;const u=d.AUDIO&&`${d.AUDIO}_clone_${a}`,g=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;u&&(i[d.AUDIO]=u,d.AUDIO=u),g&&(s[d.SUBTITLES]=g,d.SUBTITLES=g);const p=performUriReplacement(f.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new Level({attrs:d,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:p,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let S=1;S<f.audioGroups.length;S++)m.addGroupId("audio",`${f.audioGroups[S]}_clone_${a}`);if(f.subtitleGroups)for(let S=1;S<f.subtitleGroups.length;S++)m.addGroupId("text",`${f.subtitleGroups[S]}_clone_${a}`);return m});t.push(...c),cloneRenditionGroups(this.audioTracks,i,l,a),cloneRenditionGroups(this.subtitleTracks,s,l,a)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}const n={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(f,d,u,g)=>{this.log(`Loaded steering manifest: "${s}"`);const p=f.data;if(p.VERSION!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":y}=p;if(m)try{this.uri=new self.URL(m,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||u.url),S&&this.clonePathways(S);const x={steeringManifest:p,url:s.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,x),y&&this.updatePathwayPriority(y)},onError:(f,d,u,g)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${d.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(f.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const S=m.getResponseHeader("Retry-After");S&&(p=parseFloat(S)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(f,d,u)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(n,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function cloneRenditionGroups(r,e,t,i){!r||Object.keys(e).forEach(s=>{const n=r.filter(a=>a.groupId===s).map(a=>{const o=_extends({},a);return o.details=void 0,o.attrs=new AttrList(o.attrs),o.url=o.attrs.URI=performUriReplacement(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[s],o.attrs["PATHWAY-ID"]=i,o});r.push(...n)})}function performUriReplacement(r,e,t,i){const{HOST:s,PARAMS:n,[t]:a}=i;let o;e&&(o=a==null?void 0:a[e],o&&(r=o));const l=new self.URL(r);return s&&!o&&(l.host=s),n&&Object.keys(n).sort().forEach(c=>{c&&l.searchParams.set(c,n[c])}),l.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!this.stats.aborted)return n(i,t.url)}).catch(a=>(i.open("GET",t.url,!0),n(i,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{this.callbacks.onError({code:i.status,text:a.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=i.loadPolicy;if(s)for(const o in s)e.setRequestHeader(o,s[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=n&&isFiniteNumber(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,n=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const a=t.status,o=t.responseType!=="text";if(a>=200&&a<300&&(o&&t.response||t.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=o?t.response:t.responseText,c=t.responseType==="arraybuffer"?l.byteLength:l.length;if(i.loaded=i.total=c,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const f=this.callbacks.onProgress;if(f&&f(i,e,l,t),!this.callbacks)return;const d={url:t.responseURL,data:l,code:a};this.callbacks.onSuccess(d,i,e,t)}else{const l=n.loadPolicy.errorRetry,c=i.retry,f={url:e.url,data:void 0,code:a};shouldRetry(l,c,!1,f)?this.retry(l):(logger.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:t.statusText},e,t,i))}}}loadtimeout(){var e;const t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,i=this.stats.retry;if(shouldRetry(t,i,!0))this.retry(t);else{var s;logger.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=getRetryDelay(e,i.retry),i.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const n=getRequestParameters(e,this.controller.signal),a=i.onProgress,o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=c&&isFiniteNumber(c)?c:f,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const u=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(s,e,this.response)},f-(u-s.loading.start)),!d.ok){const{status:g,statusText:p}=d;throw new FetchError(p||"fetch, bad network response",g,d)}return s.loading.first=u,s.total=getContentLength(d.headers)||s.total,a&&isFiniteNumber(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,a):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{const u=this.response;if(!u)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const g=d[l];g&&(s.loaded=s.total=g);const p={url:u.url,data:d,code:u.status};a&&!isFiniteNumber(t.highWaterMark)&&a(s,e,d,u),i.onSuccess(p,s,e,u)}).catch(d=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const u=d&&d.code||0,g=d?d.message:null;i.onError({code:u,text:g},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,n){const a=new ChunkCache,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&n(t,i,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const f=c.value,d=f.length;return t.loaded+=d,d<s||a.dataLength?(a.push(f),a.dataLength>=s&&n(t,i,a.flush(),e)):n(t,i,f,e),l()}).catch(()=>Promise.reject());return l()}}function getRequestParameters(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(_extends({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function getByteRangeLength(r){const e=BYTERANGE.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function getContentLength(r){const e=r.get("Content-Range");if(e){const i=getByteRangeLength(e);if(isFiniteNumber(i))return i}const t=r.get("Content-Length");if(t)return parseInt(t)}function getRequest(r,e){return new self.Request(r.url,e)}class FetchError extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const WHITESPACE_CHAR=/\s/,Cues={newCue(r,e,t,i){const s=[];let n,a,o,l,c;const f=self.VTTCue||self.TextTrackCue;for(let u=0;u<i.rows.length;u++)if(n=i.rows[u],o=!0,l=0,c="",!n.isEmpty()){var d;for(let m=0;m<n.chars.length;m++)WHITESPACE_CHAR.test(n.chars[m].uchar)&&o?l++:(c+=n.chars[m].uchar,o=!1);n.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const g=fixLineBreaks(c.trim()),p=generateCueId(e,t,g);r!=null&&(d=r.cues)!=null&&d.getCueById(p)||(a=new f(e,t,g),a.id=p,a.line=u+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(a))}return r&&s.length&&(s.sort((u,g)=>u.line==="auto"||g.line==="auto"?0:u.line>8&&g.line>8?g.line-u.line:u.line-g.line),s.forEach(u=>addCueToTrack(r,u))),s}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(r,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=deepCpy(r),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(n=>{const a=`${n==="level"?"playlist":n}LoadPolicy`,o=e[a]===void 0,l=[];s.forEach(c=>{const f=`${n}Loading${c}`,d=e[f];if(d!==void 0&&o){l.push(f);const u=t[a].default;switch(e[a]={default:u},c){case"TimeOut":u.maxLoadTimeMs=d,u.maxTimeToFirstByteMs=d;break;case"MaxRetry":u.errorRetry.maxNumRetry=d,u.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":u.errorRetry.retryDelayMs=d,u.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=d,u.timeoutRetry.maxRetryDelayMs=d;break}}}),l.length&&logger.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),_objectSpread2(_objectSpread2({},t),e)}function deepCpy(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(deepCpy):Object.keys(r).reduce((e,t)=>(e[t]=deepCpy(r[t]),e),{}):r}function enableStreamingMode(r){const e=r.loader;e!==FetchLoader&&e!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):fetchSupported()&&(r.loader=FetchLoader,r.progressive=!0,r.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,s=[],n={},a={};let o=!1,l=!1,c=!1;t.levels.forEach(f=>{var d,u;const g=f.attrs;let{audioCodec:p,videoCodec:m}=f;((d=p)==null?void 0:d.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(f.audioCodec=p=void 0)),p&&(f.audioCodec=p=getCodecCompatibleName(p,i)),((u=m)==null?void 0:u.indexOf("avc1"))===0&&(m=f.videoCodec=convertAVC1ToAVCOTI(m));const{width:S,height:y,unknownCodecs:x}=f;if(o||(o=!!(S&&y)),l||(l=!!m),c||(c=!!p),x!=null&&x.length||p&&!areCodecsMediaSourceSupported(p,"audio",i)||m&&!areCodecsMediaSourceSupported(m,"video",i))return;const{CODECS:E,"FRAME-RATE":T,"HDCP-LEVEL":A,"PATHWAY-ID":_,RESOLUTION:P,"VIDEO-RANGE":k}=g,M=`${`${_||"."}-`}${f.bitrate}-${P}-${T}-${E}-${k}-${A}`;if(n[M])if(n[M].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const B=a[M]+=1;f.attrs["PATHWAY-ID"]=new Array(B+1).join(".");const N=new Level(f);n[M]=N,s.push(N)}else n[M].addGroupId("audio",g.AUDIO),n[M].addGroupId("text",g.SUBTITLES);else{const B=new Level(f);n[M]=B,a[M]=1,s.push(B)}}),this.filterAndSortMediaOptions(s,t,o,l,c)}filterAndSortMediaOptions(e,t,i,s,n){let a=[],o=[],l=e;if((i||s)&&n&&(l=l.filter(({videoCodec:p,videoRange:m,width:S,height:y})=>(!!p||!!(S&&y))&&isVideoRange(m))),l.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const p=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:p,reason:p.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:p}=this.hls.config;a=t.audioTracks.filter(m=>!m.audioCodec||areCodecsMediaSourceSupported(m.audioCodec,"audio",p)),assignTrackIdsByGroup(a)}t.subtitles&&(o=t.subtitles,assignTrackIdsByGroup(o));const c=l.slice(0);l.sort((p,m)=>{if(p.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&p.height!==m.height)return p.height-m.height;if(p.frameRate!==m.frameRate)return p.frameRate-m.frameRate;if(p.videoRange!==m.videoRange)return VideoRangeValues.indexOf(p.videoRange)-VideoRangeValues.indexOf(m.videoRange);if(p.videoCodec!==m.videoCodec){const S=videoCodecPreferenceValue(p.videoCodec),y=videoCodecPreferenceValue(m.videoCodec);if(S!==y)return y-S}if(p.uri===m.uri&&p.codecSet!==m.codecSet){const S=codecsSetSelectionPreferenceValue(p.codecSet),y=codecsSetSelectionPreferenceValue(m.codecSet);if(S!==y)return y-S}return p.averageBitrate!==m.averageBitrate?p.averageBitrate-m.averageBitrate:0});let f=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let p=0;p<c.length;p++)if(c[p].pathwayId===l[0].pathwayId){f=c[p];break}}this._levels=l;for(let p=0;p<l.length;p++)if(l[p]===f){var d;this._firstLevel=p;const m=f.bitrate,S=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${m}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const y=Math.min(m,this.hls.config.abrEwmaDefaultEstimateMax);y>S&&S===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=y)}break}const u=n&&!s,g={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:s,altAudio:!u&&a.some(p=>!!p.url)};this.hls.trigger(Events.MANIFEST_PARSED,g),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:f,reason:f.message}),d)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,n=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&a.details&&s&&n===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${i}${n?" with Pathway "+n:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const f=this.switchParams(a.uri,s==null?void 0:s.details,c);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===PlaylistContextType.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===PlaylistLevelType.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(n=>!!i[n]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:n}=t,a=this._levels[s];if(!a){var o;this.warn(`Invalid level index ${s}`),(o=t.deliveryDirectives)!=null&&o.skip&&(n.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(s,t,a.details)):(i=t.deliveryDirectives)!=null&&i.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){let s=i.uri;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const n=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${n?" Pathway "+n:""} ${s}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:s,level:t,pathwayId:i.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const i=this._levels.filter((s,n)=>n!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));reassignFragmentLevelIndexes(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function assignTrackIdsByGroup(r){const e={};r.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}class KeyLoader{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[i].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=ErrorDetails.KEY_LOAD_ERROR,i,s,n){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:i,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=e;for(let n=0;n<t.length;n++){const a=t[n];if(s<=a.cc&&(i==="initSegment"||a.sn==="initSegment"||i<a.sn)){this.emeController.selectKeySystemFormat(a).then(o=>{a.setKeyFormat(o)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,c))}const a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((i=o)!=null&&i.decryptdata.key)return n.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((s=o)!=null&&s.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>(n.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(e.keyLoadPromise=s.then(n=>(e.mediaKeySessionContext=n,i))).catch(n=>{throw e.keyLoadPromise=null,n})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=i.loader,n=new s(i);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=i.keyLoadPolicy.default,f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(u,g,p,m)=>{const{frag:S,keyInfo:y,url:x}=p;if(!S.decryptdata||y!==this.keyUriToKeyInfo[x])return o(this.createKeyLoadError(S,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));y.decryptdata.key=S.decryptdata.key=new Uint8Array(u.data),S.keyLoader=null,y.loader=null,a({frag:S,keyInfo:y})},onError:(u,g,p,m)=>{this.resetLoader(g),o(this.createKeyLoadError(t,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${u.code} loading key ${u.text}`),p,_objectSpread2({url:l.url,data:void 0},u)))},onTimeout:(u,g,p)=>{this.resetLoader(g),o(this.createKeyLoadError(t,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(u,g,p)=>{this.resetLoader(g),o(this.createKeyLoadError(t,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};n.load(l,f,d)})}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,n=i.loader;t.keyLoader===n&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],n&&n.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const e=getSourceBuffer();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const r=getMediaSource();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(mimeTypeForCodec(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(mimeTypeForCodec(e,"audio"))))}function changeTypeSupported(){var r;const e=getSourceBuffer();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(e,t,i,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:i,media:s,stalled:n}=this;if(s===null)return;const{currentTime:a,seeking:o}=s,l=this.seeking&&!o,c=!this.seeking&&o;if(this.seeking=o,a!==e){if(this.moved=!0,o||(this.nudgeRetry=0),n!==null){if(this.stallReported){const S=self.performance.now()-n;logger.warn(`playback not stuck anymore @${a}, after ${Math.round(S)}ms`),this.stallReported=!1}this.stalled=null}return}if(c||l){this.stalled=null;return}if(s.paused&&!o||s.ended||s.playbackRate===0||!BufferHelper.getBuffered(s).length){this.nudgeRetry=0;return}const f=BufferHelper.bufferInfo(s,a,0),d=f.nextStart||0;if(o){const S=f.len>MAX_START_GAP_JUMP,y=!d||t&&t.start<=a||d-a>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(a);if(S||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var u;if(!(f.len>0)&&!d)return;const y=Math.max(d,f.start||0)-a,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=(x==null||(u=x.details)==null?void 0:u.live)?x.details.targetduration*2:MAX_START_GAP_JUMP,A=this.fragmentTracker.getPartialFragment(a);if(y>0&&(y<=T||A)){s.paused||this._trySkipBufferHole(A);return}}const g=self.performance.now();if(n===null){this.stalled=g;return}const p=g-n;if(!o&&p>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(f),!this.media))return;const m=BufferHelper.bufferInfo(s,a,i.maxBufferHole);this._tryFixBufferStall(m,p)}_tryFixBufferStall(e,t){const{config:i,fragmentTracker:s,media:n}=this;if(n===null)return;const a=n.currentTime,o=s.getPartialFragment(a);o&&(this._trySkipBufferHole(o)||!this.media)||(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-a<i.maxBufferHole)&&t>i.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:i,stallReported:s}=this;if(!s&&i){this.stallReported=!0;const n=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);logger.warn(n.message),t.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:i,media:s}=this;if(s===null)return 0;const n=s.currentTime,a=BufferHelper.bufferInfo(s,n,0),o=n<a.start?a.start:a.nextStart;if(o){const l=a.len<=t.maxBufferHole,c=a.len>0&&a.len<1&&s.readyState<3,f=o-n;if(f>0&&(l||c)){if(f>t.maxBufferHole){const{fragmentTracker:u}=this;let g=!1;if(n===0){const p=u.getAppendedFrag(0,PlaylistLevelType.MAIN);p&&o<p.end&&(g=!0)}if(!g){const p=e||u.getAppendedFrag(n,PlaylistLevelType.MAIN);if(p){let m=!1,S=p.end;for(;S<o;){const y=u.getPartialFragment(S);if(y)S+=y.duration;else{m=!0;break}}if(m)return 0}}}const d=Math.max(o+SKIP_BUFFER_RANGE_START,n+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${n} to ${d}`),this.moved=!0,this.stalled=null,s.currentTime=d,e&&!e.gap){const u=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${d}`);i.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:u,reason:u.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:i,nudgeRetry:s}=this;if(i===null)return;const n=i.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const a=n+(s+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${n} to ${a}`);logger.warn(o.message),i.currentTime=a,t.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const a=new Error(`Playhead still not moving while enough data buffered @${n} after ${e.nudgeMaxRetry} nudges`);logger.error(a.message),t.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(e,t,i){super(e,t,i,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Events.ERROR,this.onError,this),e.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Events.ERROR,this.onError,this),e.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:t,level:i}=this,s=t==null?void 0:t[i],n=s==null?void 0:s.details;if(n&&(!n.live||this.levelLastLoaded===s)){if(this.waitForCdnTuneIn(n))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:s,level:n}=this,a=s==null?void 0:s[n];this.resetStartWhenNotLoaded(a||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this;if(t===null||!s&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const n=e.nextLoadLevel;if(!(i!=null&&i[n]))return;const a=i[n],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const m={};this.altAudio&&(m.type="video"),this.hls.trigger(Events.BUFFER_EOS,m),this.state=State.ENDED;return}e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const c=a.details;if(!c||this.state===State.WAITING_LEVEL||c.live&&this.levelLastLoaded!==a){this.level=n,this.state=State.WAITING_LEVEL;return}const f=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(f>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const u=this.backtrackFragment?this.backtrackFragment.start:o.end;let g=this.getNextFragment(u,c);if(this.couldBacktrack&&!this.fragPrevious&&g&&g.sn!=="initSegment"&&this.fragmentTracker.getState(g)!==FragmentState.OK){var p;const S=((p=this.backtrackFragment)!=null?p:g).sn-c.startSN,y=c.fragments[S-1];y&&g.cc===y.cc&&(g=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,u)){if(!g.gap){const S=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,y=(S===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,S,PlaylistLevelType.MAIN)}g=this.getNextFragmentLoopLoading(g,c,o,PlaylistLevelType.MAIN,d)}!g||(g.initSegment&&!g.initSegment.data&&!this.bitrateTest&&(g=g.initSegment),this.loadFragment(g,a,u))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===FragmentState.NOT_LOADED||s===FragmentState.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,PlaylistLevelType.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const n=this.getLevelDetails();if(n!=null&&n.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<n.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:i=0}else i=0;const a=this.getBufferedFrag(t.currentTime+i);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,f=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;isFiniteNumber(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let i=!1,s=!1;t.levels.forEach(n=>{const a=n.audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&s&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==State.IDLE)return;const s=i[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(s.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:s}=this,n=t.level,a=t.details,o=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${n}`);return}this.log(`Level ${n} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=s[n],c=this.fragCurrent;c&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let f=0;if(a.live||(i=l.details)!=null&&i.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;f=this.alignPlaylists(a,l.details,(d=this.levelLastLoaded)==null?void 0:d.details)}if(l.details=a,this.levelLastLoaded=l,this.hls.trigger(Events.LEVEL_UPDATED,{details:a,level:n}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=State.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,f),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:s,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=a[i.level],l=o.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const c=o.videoCodec,f=l.PTSKnown||!l.live,d=(t=i.initSegment)==null?void 0:t.data,u=this._getAudioCodec(o),g=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=s?s.index:-1,m=p!==-1,S=new ChunkMetadata(i.level,i.sn,i.stats.chunkCount,n.byteLength,p,m),y=this.initPTS[i.cc];g.push(n,d,u,c,i,s,l.totalduration,f,S,y)}onAudioTrackSwitching(e,t){const i=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const n=this.hls;i&&(n.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),n.trigger(Events.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=t.id,s=!!this.hls.audioTracks[i].url;if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,n,a=!1;for(const o in i){const l=i[o];if(l.id==="main"){if(n=o,s=l,o==="video"){const c=i[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i&&i.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const n=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}onError(e,t){var i;if(t.fatal){this.state=State.ERROR;return}switch(t.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,t);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===State.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(e).length){const i=this.state!==State.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const i=(t===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,t,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const s=BufferHelper.getBuffered(e),a=(s.length?s.start(0):0)-i;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),i+=a,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:s}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const n=e.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),s.trigger(Events.FRAG_LOADED,i),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i="main",{hls:s}=this,{remuxResult:n,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:f}=o,{video:d,text:u,id3:g,initSegment:p}=n,{details:m}=f,S=this.altAudio?void 0:n.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=State.PARSING,p){if(p!=null&&p.tracks){const E=l.initSegment||l;this._bufferInitSegment(f,p.tracks,E,a),s.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:p.tracks})}const y=p.initPTS,x=p.timescale;isFiniteNumber(y)&&(this.initPTS[l.cc]={baseTime:y,timescale:x},s.trigger(Events.INIT_PTS_FOUND,{frag:l,id:i,initPTS:y,timescale:x}))}if(d&&m&&l.sn!=="initSegment"){const y=m.fragments[l.sn-1-m.startSN],x=l.sn===m.startSN,E=!y||l.cc>y.cc;if(n.independent!==!1){const{startPTS:T,endPTS:A,startDTS:_,endDTS:P}=d;if(c)c.elementaryStreams[d.type]={startPTS:T,endPTS:A,startDTS:_,endDTS:P};else if(d.firstKeyFrame&&d.independent&&a.id===1&&!E&&(this.couldBacktrack=!0),d.dropped&&d.independent){const k=this.getMainFwdBufferInfo(),F=(k?k.end:this.getLoadPosition())+this.config.maxBufferHole,M=d.firstKeyFramePTS?d.firstKeyFramePTS:T;if(!x&&F<M-this.config.maxBufferHole&&!E){this.backtrack(l);return}else E&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,A,l.start,P,!0)}else x&&T>MAX_START_GAP_JUMP&&(l.gap=!0);l.setElementaryStreamInfo(d.type,T,A,_,P),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,c,a,x||E)}else if(x||E)l.gap=!0;else{this.backtrack(l);return}}if(S){const{startPTS:y,endPTS:x,startDTS:E,endDTS:T}=S;c&&(c.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:y,endPTS:x,startDTS:E,endDTS:T}),l.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,y,x,E,T),this.bufferFragmentData(S,l,c,a)}if(m&&g!=null&&(t=g.samples)!=null&&t.length){const y={id:i,frag:l,details:m,samples:g.samples};s.trigger(Events.FRAG_PARSING_METADATA,y)}if(m&&u){const y={id:i,frag:l,details:m,samples:u.samples};s.trigger(Events.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,i,s){if(this.state!==State.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:n,video:a,audiovideo:o}=t;if(n){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),n.metadata.channelCount!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")),l&&l.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),n.levelCodec=l,n.id="main",this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${n.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const f=t[l].initSegment;f!=null&&f.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:l,data:f,frag:i,part:null,chunkMeta:s,parent:i.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=State.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(BufferHelper.isBuffered(e,i)?t=this.getAppendedFrag(i):BufferHelper.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,n=t.level;(!s||t.sn!==s.sn||s.level!==n)&&(this.fragPlaying=t,this.hls.trigger(Events.FRAG_CHANGED,{frag:t}),(!s||s.level!==n)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,i=this.currentFrag;if(i&&isFiniteNumber(t)&&isFiniteNumber(i.programDateTime)){const s=i.programDateTime+(t-i.start)*1e3;return new Date(s)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.8"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(e){Hls.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(e.debug||!1,"Hls instance");const t=this.config=mergeConfig(Hls.DefaultConfig,e);this.userConfig=e,t.progressive&&enableStreamingMode(t);const{abrController:i,bufferController:s,capLevelController:n,errorController:a,fpsController:o}=t,l=new a(this),c=this.abrController=new i(this),f=this.bufferController=new s(this),d=this.capLevelController=new n(this),u=new o(this),g=new PlaylistLoader(this),p=new ID3TrackController(this),m=t.contentSteeringController,S=m?new m(this):null,y=this.levelController=new LevelController(this,S),x=new FragmentTracker(this),E=new KeyLoader(this.config),T=this.streamController=new StreamController(this,x,E);d.setStreamController(T),u.setStreamController(T);const A=[g,y,T];S&&A.splice(1,0,S),this.networkControllers=A;const _=[c,f,d,u,p,x];this.audioTrackController=this.createController(t.audioTrackController,A);const P=t.audioStreamController;P&&A.push(new P(this,x,E)),this.subtitleTrackController=this.createController(t.subtitleTrackController,A);const k=t.subtitleStreamController;k&&A.push(new k(this,x,E)),this.createController(t.timelineController,_),E.emeController=this.emeController=this.createController(t.emeController,_),this.cmcdController=this.createController(t.cmcdController,_),this.latencyController=this.createController(LatencyController,_),this.coreComponents=_,A.push(l);const F=l.onErrorOut;typeof F=="function"&&this.on(Events.ERROR,F,l)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=e===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:s,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){logger.log("attachMedia"),this._media=e,this.trigger(Events.MEDIA_ATTACHING,{media:e})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,i=this.url,s=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Events.MANIFEST_LOADING,{url:e})}startLoad(e=-1){logger.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){isHdcpLevel(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,i)for(let n=s;n--;){const a=e[n].attrs["HDCP-LEVEL"];if(a&&a<=i)return n}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;var dIcon_vue_vue_type_style_index_0_scoped_true_lang="";const __default__$2={name:"d-icon"},_sfc_main$d=Object.assign(__default__$2,{props:{icon:String,size:[Number,String]},setup(r){const e=r,t=computed(()=>({fontSize:/^\d+$/.test(e.size)?e.size+"px":e.size}));return(i,s)=>(openBlock(),createElementBlock("i",{class:normalizeClass(["d-icon iconfont",r.icon]),style:normalizeStyle(t.value)},null,6))}});var DIcon=_export_sfc$1(_sfc_main$d,[["__scopeId","data-v-0fc84128"]]),dPlayerTop_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$a={class:"d-player-top"},_hoisted_2$9={class:"top-title"},_hoisted_3$6={class:"top-title"},_sfc_main$c={__name:"d-player-top",props:{title:{default:""}},setup(r){Date.prototype.format=function(i){let s={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var n in s)new RegExp("("+n+")").test(i)&&(i=i.replace(RegExp.$1,RegExp.$1.length==1?s[n]:("00"+s[n]).substr((""+s[n]).length)));return i};let e=ref("00:00:00");e.value=new Date().format("hh:mm:ss");let t=null;return t=setInterval(()=>{e.value=new Date().format("hh:mm:ss")},1e3),onUnmounted(()=>{clearInterval(t)}),(i,s)=>(openBlock(),createElementBlock("div",_hoisted_1$a,[createBaseVNode("p",_hoisted_2$9,toDisplayString(r.title||""),1),createBaseVNode("p",_hoisted_3$6,toDisplayString(unref(e)),1)]))}};var DPlayerTop=_export_sfc$1(_sfc_main$c,[["__scopeId","data-v-5c0933d7"]]),dStatus_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$9={class:"d-status"},_hoisted_2$8={class:"d-flex-center"},_hoisted_3$5={class:"d-flex-center"},_sfc_main$b=defineComponent({__name:"d-status",props:["state"],setup(r){return(e,t)=>withDirectives((openBlock(),createElementBlock("div",_hoisted_1$9,[withDirectives(createBaseVNode("li",_hoisted_2$8,[createVNode(DIcon,{size:"18",class:"d-status-icon",icon:`icon-volume-${r.state.volume==0?"mute":r.state.volume>.5?"up":"down"}`},null,8,["icon"]),createTextVNode(" "+toDisplayString(~~(r.state.volume*100))+"% ",1)],512),[[vShow,r.state.handleType=="volume"]]),withDirectives(createBaseVNode("li",_hoisted_3$5,[createVNode(DIcon,{size:"12",icon:"icon-play"}),createVNode(DIcon,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),createTextVNode("5\u500D\u901F\u64AD\u653E\u4E2D ")],512),[[vShow,r.state.handleType=="playbackRate"||r.state.isMultiplesPlay]])],512)),[[vShow,r.state.handleType||r.state.isMultiplesPlay]])}});var DStatus=_export_sfc$1(_sfc_main$b,[["__scopeId","data-v-1d047331"]]),dSwitch_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$3=r=>(pushScopeId("data-v-05d20674"),r=r(),popScopeId(),r),_hoisted_1$8=["checked","true-value","false-value"],_hoisted_2$7=_withScopeId$3(()=>createBaseVNode("span",{class:"d-switch_action"},null,-1)),_sfc_main$a=defineComponent({__name:"d-switch",props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(r,{emit:e}){useCssVars(o=>({"0602b74c":r.width,"8b1928de":r.activeColor}));const t=r,i=e,s=ref(null),n=computed(()=>t.modelValue===t.trueValue),a=()=>{nextTick(()=>{const o=s.value.checked;i("update:modelValue",o),i("change",o)})};return(o,l)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["d-switch",{"is-checked":n.value}])},[createBaseVNode("input",{class:"d-switch__input",ref_key:"input",ref:s,type:"checkbox",checked:n.value,onChange:a,"true-value":r.trueValue,"false-value":r.falseValue},null,40,_hoisted_1$8),_hoisted_2$7],2))}});var DSwitch=_export_sfc$1(_sfc_main$a,[["__scopeId","data-v-05d20674"]]),dLoading_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$2=r=>(pushScopeId("data-v-16a029a4"),r=r(),popScopeId(),r),_hoisted_1$7={key:0},_hoisted_2$6=_withScopeId$2(()=>createBaseVNode("i",{class:"rotating iconfont icon-loading f50"},null,-1)),_hoisted_3$4=_withScopeId$2(()=>createBaseVNode("i",{class:"rotating iconfont icon-loading f50"},null,-1)),_hoisted_4$3=_withScopeId$2(()=>createBaseVNode("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)),_hoisted_5$3=[_hoisted_3$4,_hoisted_4$3],_hoisted_6$2=_withScopeId$2(()=>createBaseVNode("i",{class:"iconfont icon-replay f24 mr5"},null,-1)),_hoisted_7$2=_withScopeId$2(()=>createBaseVNode("i",{class:"iconfont icon-replay f24 mr5"},null,-1)),_sfc_main$9=defineComponent({__name:"d-loading",props:{loadType:String,text:{type:String,default:""}},setup(r){const{proxy:e}=getCurrentInstance(),t=["loadstart","waiting","ended","error","stalled"],i=r,s=()=>{e.$parent.play()},n=computed(()=>{let a="background: rgba(0, 0, 0, .1);z-index:1";return i.loadType=="loadstart"&&(a="background: rgba(0, 0, 0, 1);;z-index:3"),a});return(a,o)=>withDirectives((openBlock(),createElementBlock("div",{class:"d-loading",style:normalizeStyle(n.value)},[createBaseVNode("div",null,[r.loadType=="loadstart"?(openBlock(),createElementBlock("span",_hoisted_1$7,[_hoisted_2$6,createBaseVNode("p",null,toDisplayString(r.text),1)])):createCommentVNode("",!0),withDirectives(createBaseVNode("span",null,_hoisted_5$3,512),[[vShow,r.loadType=="waiting"]]),withDirectives(createBaseVNode("span",null,[createBaseVNode("p",{onClick:s,class:"d-flex-x d-pointer"},[_hoisted_6$2,createTextVNode("\u91CD\u65B0\u64AD\u653E ")])],512),[[vShow,r.loadType=="ended"]]),withDirectives(createBaseVNode("span",null,[createBaseVNode("p",{onClick:s,class:"d-flex-x d-pointer"},[_hoisted_7$2,createTextVNode("\u8BF7\u6C42\u9519\u8BEF ")])],512),[[vShow,r.loadType=="error"||r.loadType=="stalled"]])])],4)),[[vShow,t.includes(r.loadType)]])}});var DLoading=_export_sfc$1(_sfc_main$9,[["__scopeId","data-v-16a029a4"]]);const on=function(r,e,t,i=!1){r&&e&&t&&r.addEventListener(e,t,i)},off=function(r,e,t,i=!1){r&&e&&t&&r.removeEventListener(e,t,i)};var dSlider_vue_vue_type_style_index_0_scoped_true_lang="";const __default__$1={name:"DSlider"},_sfc_main$8=defineComponent({...__default__$1,props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup(r,{emit:e}){useCssVars(y=>({"0d6c4c08":r.size}));const t=ref(null),i=ref(null),s=r,n=e,a=reactive({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),o=computed(()=>{let y=s.modelValue<0?0:s.modelValue>1?1:s.modelValue;return s.vertical?`height:${y*100}%`:`width:${y*100}%`}),l=computed(()=>{let y=s.preload<0?0:s.preload>1?1:s.preload;return s.vertical?`height:${y*100}%`:`width:${y*100}%`}),c=computed(()=>{let y=a.hoverPosition<0?0:a.hoverPosition>1?1:a.hoverPosition;return s.vertical?`bottom:${y*100}%`:`left:${y*100}%`}),f=y=>{y.preventDefault()},d=y=>{s.disabled||(y.preventDefault(),a.dragging=!0,g(y),on(window,"mousemove",m),on(window,"touchmove",m),on(window,"mouseup",S),on(window,"touchend",S))},u=y=>{if(!s.hover)return;let x=p(y);if(n("onMousemove",y,x),a.hoverPosition=x,s.vertical)return;let E=t.value,T=i.value.clientWidth/2,A=y.clientX-E.getBoundingClientRect().left;A<T?a.hoverTipsLeft=T-A+"px":E.clientWidth-A<T?a.hoverTipsLeft=E.clientWidth-A-T+"px":a.hoverTipsLeft="50%"},g=y=>{let x=p(y);n("update:modelValue",x),n("change",y,x)},p=y=>{let x=t.value,E=0;if(s.vertical){let T=x.clientHeight;E=(x.getBoundingClientRect().bottom-y.clientY)/T}else E=(y.clientX-x.getBoundingClientRect().left)/x.clientWidth;return E<0?0:E>1?1:E},m=y=>{g(y)},S=y=>{a.dragging&&(off(window,"mousemove",m),off(window,"touchmove",m),off(window,"mouseup",S),off(window,"touchend",S),off(window,"contextmenu",S),setTimeout(()=>{a.dragging=!1},0))};return(y,x)=>(openBlock(),createElementBlock("div",{ref_key:"refSlider",ref:t,class:normalizeClass(["d-slider",{"is-vertical":s.vertical}]),onMousedown:withModifiers(d,["stop"]),onContextmenu:f},[createBaseVNode("div",{class:"d-slider__runway",onMousemove:u},[withDirectives(createBaseVNode("div",{class:"d-slider__cursor",style:normalizeStyle(c.value)},[withDirectives(createBaseVNode("div",{class:"d-slider__tips",ref_key:"refTips",ref:i,style:normalizeStyle({left:a.hoverTipsLeft})},toDisplayString(s.hoverText),5),[[vShow,s.hoverText]])],4),[[vShow,s.hover]]),createBaseVNode("div",{class:"d-slider__preload",style:normalizeStyle(l.value)},null,4),createBaseVNode("div",{class:"d-slider__bar",style:normalizeStyle(o.value)},null,4)],32)],34))}});var DSlider=_export_sfc$1(_sfc_main$8,[["__scopeId","data-v-37328a38"]]);const version="1.3.2";var dContextmenu_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId$1=r=>(pushScopeId("data-v-e7a7558c"),r=r(),popScopeId(),r),_hoisted_1$6={key:0,class:"d-player-dialog"},_hoisted_2$5={class:"d-player-dialog-body"},_hoisted_3$3={class:"d-player-dialog-title"},_hoisted_4$2={class:"d-player-hotkey-panel"},_hoisted_5$2={class:"d-player-filter-panel"},_hoisted_6$1={class:"d-player-filter-panel-item"},_hoisted_7$1=_withScopeId$1(()=>createBaseVNode("span",null,"\u9971\u548C\u5EA6",-1)),_hoisted_8$1={class:"d-player-filter-panel-item"},_hoisted_9$1=_withScopeId$1(()=>createBaseVNode("span",null,"\u4EAE\u5EA6",-1)),_hoisted_10$1={class:"d-player-filter-panel-item"},_hoisted_11$1=_withScopeId$1(()=>createBaseVNode("span",null,"\u5BF9\u6BD4\u5EA6",-1)),_hoisted_12$1={key:0,class:"d-player-contextmenu"},_hoisted_13$1=["dplayerKeyCode"],_hoisted_14$1=_withScopeId$1(()=>createBaseVNode("input",{class:"d-player-copyText"},null,-1)),_sfc_main$7={__name:"d-contextmenu",setup(r){const e=reactive({show:!1,dialogType:"",dialogTitle:"",version,mouseX:0,mouseY:0}),t=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A"+version,key:"version"}],i=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],s=reactive({saturate:.392,brightness:.392,contrast:.392}),n=computed(()=>({left:e.mouseX+"px",top:e.mouseY+"px"}));watch(s,f=>{let d=document.querySelector("#dPlayerVideo"),u=(f.saturate*2.55).toFixed(2),g=(f.brightness*2.55).toFixed(2),p=(f.contrast*2.55).toFixed(2);d.style.filter=`saturate(${u}) brightness(${g}) contrast(${p})`});const a=()=>{s.saturate=.392,s.brightness=.392,s.contrast=.392},o=f=>{f.key=="Escape"&&c(0)},l=f=>{f.preventDefault(),on(window,"keydown",o),on(window,"click",c);let d=document.querySelector("#refPlayerWrap"),u=d.clientWidth;d.clientHeight,e.mouseX=f.clientX-d.getBoundingClientRect().left,u-e.mouseX<130&&(e.mouseX=e.mouseX+(u-e.mouseX-130)),e.mouseY=f.clientY-d.getBoundingClientRect().top,e.show=!0},c=f=>{let d=f.target.nodeName=="LI",u=f.target.attributes.dplayerKeyCode&&f.target.attributes.dplayerKeyCode.value,g=t.map(p=>p.key);if(d&&g.includes(u))if(e.dialogTitle=f.target.innerText,e.dialogType=u,u=="copy"){let p=document.querySelector(".d-player-copyText");p.value=window.location.href,p.select(),document.execCommand("copy"),e.dialogType=""}else u=="version"&&(e.dialogType="");e.show=!1,off(window,"keydown",o),off(window,"click",c)};return onMounted(()=>{let f=document.querySelector("#refPlayerWrap");off(window,"keydown",o),off(window,"click",c),off(f,"contextmenu",l),on(f,"contextmenu",l)}),onUnmounted(()=>{let f=document.querySelector("#refPlayerWrap");off(window,"keydown",o),off(window,"click",c),off(f,"contextmenu",l)}),(f,d)=>(openBlock(),createElementBlock("div",null,[createVNode(Transition,{name:"d-fade-in"},{default:withCtx(()=>[e.dialogType?(openBlock(),createElementBlock("div",_hoisted_1$6,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("h5",_hoisted_3$3,[createTextVNode(toDisplayString(e.dialogTitle)+" ",1),createBaseVNode("i",{onClick:d[0]||(d[0]=u=>e.dialogType=!1),class:"icon icon-close"},"X")]),withDirectives(createBaseVNode("ul",_hoisted_4$2,[(openBlock(),createElementBlock(Fragment$1,null,renderList(i,u=>createBaseVNode("li",{class:"d-player-hotkey-panel-item",key:u.key},[createBaseVNode("span",null,toDisplayString(u.key),1),createBaseVNode("span",null,toDisplayString(u.label),1)])),64))],512),[[vShow,e.dialogType=="hotkey"]]),withDirectives(createBaseVNode("ul",_hoisted_5$2,[createBaseVNode("li",_hoisted_6$1,[_hoisted_7$1,createVNode(DSlider,{class:"filter-panel-slider",size:"5px",modelValue:s.saturate,"onUpdate:modelValue":d[1]||(d[1]=u=>s.saturate=u)},null,8,["modelValue"]),createBaseVNode("span",null,toDisplayString(Math.round(s.saturate*255)),1)]),createBaseVNode("li",_hoisted_8$1,[_hoisted_9$1,createVNode(DSlider,{class:"filter-panel-slider",size:"5px",modelValue:s.brightness,"onUpdate:modelValue":d[2]||(d[2]=u=>s.brightness=u)},null,8,["modelValue"]),createBaseVNode("span",null,toDisplayString(Math.round(s.brightness*255)),1)]),createBaseVNode("li",_hoisted_10$1,[_hoisted_11$1,createVNode(DSlider,{class:"filter-panel-slider",size:"5px",modelValue:s.contrast,"onUpdate:modelValue":d[3]||(d[3]=u=>s.contrast=u)},null,8,["modelValue"]),createBaseVNode("span",null,toDisplayString(Math.round(s.contrast*255)),1)]),createBaseVNode("span",{onClick:a,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[vShow,e.dialogType=="filter"]])])])):createCommentVNode("",!0)]),_:1}),e.show?(openBlock(),createElementBlock("div",_hoisted_12$1,[createBaseVNode("ul",{class:"d-player-contextmenu-body",style:normalizeStyle(n.value)},[(openBlock(),createElementBlock(Fragment$1,null,renderList(t,u=>createBaseVNode("li",{dplayerKeyCode:u.key,key:u.key},toDisplayString(u.label),9,_hoisted_13$1)),64))],4),_hoisted_14$1])):createCommentVNode("",!0)]))}};var DContextmenu=_export_sfc$1(_sfc_main$7,[["__scopeId","data-v-e7a7558c"]]);const hexToRgba=r=>`${parseInt("0x"+r.slice(1,3))},${parseInt("0x"+r.slice(3,5))},${parseInt("0x"+r.slice(5,7))}`,firstUpperCase=r=>r.charAt(0).toUpperCase()+r.slice(1),timeFormat=r=>{let e=~~(r/3600),t=~~(r%3600/60),i=~~(r%60);return e=e<10?"0"+e:e,t=t<10?"0"+t:t,i=i<10?"0"+i:i,`${e}:${t}:${i}`},isMobile="ontouchstart"in window,toggleFullScreen=r=>{let e=document,t=e.webkitIsFullScreen||e.fullscreen;return t?(document.exitFullscreen||e.webkitExitFullScreen).call(e):(r.requestFullscreen||r.webkitRequestFullScreen).call(r),!t},requestPictureInPicture=r=>{document.pictureInPictureElement?document.exitPictureInPicture().catch(e=>{console.log(e,"Video failed to leave Picture-in-Picture mode.")}):r.requestPictureInPicture().catch(e=>{console.log(e,"Video failed to enter Picture-in-Picture mode.")})},videoEmits=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],defineProps={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};var main_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId=r=>(pushScopeId("data-v-7a96e874"),r=r(),popScopeId(),r),_hoisted_1$5={class:"d-player-video",id:"dPlayerVideo"},_hoisted_2$4=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],_hoisted_3$2={class:"d-player-lightoff"},_hoisted_4$1={key:1,class:"d-player-state"},_hoisted_5$1={class:"d-play-btn"},_hoisted_6={class:"d-control-progress"},_hoisted_7={class:"d-tool-bar"},_hoisted_8={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},_hoisted_9=_withScopeId(()=>createBaseVNode("span",{style:{margin:"0 3px"}},"/",-1)),_hoisted_10={class:"total-time"},_hoisted_11={class:"d-tool-bar"},_hoisted_12={key:0,class:"d-tool-item quality-btn"},_hoisted_13={class:"d-tool-item-main"},_hoisted_14={class:"speed-main",style:{"text-align":"center"}},_hoisted_15=["onClick"],_hoisted_16={key:1,class:"d-tool-item speedRate-btn"},_hoisted_17={class:"d-tool-item-main"},_hoisted_18={class:"speed-main"},_hoisted_19=["onClick"],_hoisted_20={key:2,class:"d-tool-item volume-btn"},_hoisted_21={class:"d-tool-item-main volume-box",style:{width:"52px"}},_hoisted_22={class:"volume-text-size"},_hoisted_23={key:3,class:"d-tool-item setting-btn"},_hoisted_24={class:"d-tool-item-main"},_hoisted_25={class:"speed-main"},_hoisted_26=_withScopeId(()=>createBaseVNode("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1)),_hoisted_27=_withScopeId(()=>createBaseVNode("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1)),_hoisted_28=_withScopeId(()=>createBaseVNode("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1)),__default__={name:"vue3VideoPlay",inheritAttrs:!1},_sfc_main$6=defineComponent({...__default__,props:defineProps,emits:[...videoEmits,"mirrorChange","loopChange","lightOffChange"],setup(r,{expose:e,emit:t}){useCssVars(I=>({"11535e26":unref(p),"25c55139":I.width,"7915dc14":I.height}));const i=new Hls({fragLoadingTimeOut:2e3}),s=r,n=t,a=ref(null),o=ref(null),l=ref(null),c=ref(null),f=reactive({dVideo:null,...s,muted:s.muted,playBtnState:s.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0}),d=(...I)=>R=>I.reverse().reduce((V,$)=>$(V),R),u=videoEmits.reduce((I,R)=>{let V=`on${firstUpperCase(R)}`;return I[V]=$=>{f.loadStateType=R,n(R,$)},I},{});u.onCanplay=d(u.onCanplay,()=>{f.playBtnState!="play"&&f.dVideo.play(),f.autoPlay&&(f.dVideo.play(),f.playBtnState="pause")}),u.onEnded=d(u.onEnded,()=>{f.playBtnState="replay"}),u.onDurationchange=I=>{n("durationchange",I),s.currentTime!=0&&(f.dVideo.currentTime=s.currentTime),u.onTimeupdate(I)},u.onProgress=I=>{console.log("\u7F13\u51B2\u4E2D..."),n("progress",I);let R=I.target.duration,V=I.target.buffered,$=I.target.buffered.length&&I.target.buffered.end(V-1);f.preloadBar=$/R},u.onTimeupdate=I=>{n("timeupdate",I);let R=I.duration||I.target.duration||0,V=I.currentTime||I.target.currentTime;f.playProgress=V/R,f.currentTime=timeFormat(V),f.totalTime=timeFormat(R)},u.onError=d(u.onError,()=>{f.playBtnState="replay"});let g=useAttrs();for(let I in g)u[I]=g[I];const p=hexToRgba(f.color),m=debounce(500,()=>{f.handleType=""}),S=I=>{I.preventDefault(),I.code=="ArrowUp"?f.volume=f.volume+.1>1?1:f.volume+.1:f.volume=f.volume-.1<0?0:f.volume-.1,f.muted=!1,f.handleType="volume",m()},y=I=>{!s.speed||(f.dVideo.currentTime=f.dVideo.currentTime<10?.1:f.dVideo.currentTime-10,u.onTimeupdate(f.dVideo),T())},x=I=>{I.preventDefault();let R=I.type;if(I.key=="ArrowRight"){if(T(),R=="keyup"){if(clearTimeout(f.longPressTimeout),!s.speed&&!f.longPressTimeout)return;f.isMultiplesPlay?(f.dVideo.playbackRate=f.speedActive,f.isMultiplesPlay=!1):(f.dVideo.currentTime=f.dVideo.currentTime+10,u.onTimeupdate(f.dVideo))}else if(R=="keydown"){if(!s.speed)return;f.isMultiplesPlay&&clearTimeout(f.longPressTimeout),f.longPressTimeout=setTimeout(()=>{f.isMultiplesPlay=!0,f.dVideo.playbackRate=5,f.handleType="playbackRate",m()},500)}}},E=()=>{isMobile||c.value.focus()},T=()=>{f.loadStateType="play",f.dVideo.play().catch(()=>{f.dVideo.load(),setTimeout(()=>{f.dVideo.play().catch(()=>{f.playBtnState="replay",f.loadStateType="error"})},200)}),f.playBtnState="pause"},A=()=>{f.dVideo.pause(),f.playBtnState="play"},_=I=>{I&&I.preventDefault(),f.playBtnState=="play"||f.playBtnState=="replay"?T():f.playBtnState=="pause"&&A()},P=()=>{f.muted=!f.muted,f.volume==0&&(f.volume=.05)},k=(I,R)=>{let V=f.dVideo.duration||f.dVideo.target.duration;f.dVideo.currentTime=V*R,f.playBtnState=="play"&&(f.dVideo.play(),f.playBtnState="pause")},F=(I,R)=>{f.progressCursorTime=timeFormat(f.dVideo.duration*R)},M=debounce(2500,()=>{f.isVideoHovering=!1}),B=I=>{f.isVideoHovering=!0,M()},N=(I,R)=>{i.currentLevel=R,f.currentLevel=R},G=I=>{f.speedActive=I,f.dVideo.playbackRate=I},U=I=>{n("mirrorChange",I,f.dVideo)},O=I=>{n("loopChange",I,f.dVideo)},L=I=>{n("lightOffChange",I,f.dVideo)},D=()=>{requestPictureInPicture(f.dVideo)},b=()=>{f.fullScreen=toggleFullScreen(a.value)},C=()=>{f.dVideo.canPlayType(s.type)||console.error("vue3-video-play: Format not supported,Check the [type] parameter"),f.dVideo.canPlayType(s.type)||f.dVideo.canPlayType("application/vnd.apple.mpegurl")?f.muted=s.autoPlay:Hls.isSupported()&&(i.detachMedia(),i.attachMedia(f.dVideo),i.on(Hls.Events.MEDIA_ATTACHED,()=>{i.loadSource(s.src),i.on("hlsManifestParsed",(I,R)=>{console.log(R),f.currentLevel=R.level,f.qualityLevels=R.levels||[]})}),i.on("hlsLevelSwitching",(I,R)=>{console.log(R),console.log("LEVEL_SWITCHING")}),i.on("hlsLevelSwitched",(I,R)=>{f.currentLevel=R.level,console.log("LEVEL_SWITCHED")}))};return watch(()=>s.src,()=>{nextTick(()=>{C()})},{immediate:!0}),onMounted(()=>{f.dVideo=o,E()}),e({play:T,pause:A,togglePlay:_}),(I,R)=>(openBlock(),createElementBlock("div",{ref_key:"refPlayerWrap",ref:a,id:"refPlayerWrap",class:normalizeClass(["d-player-wrap",{"web-full-screen":f.webFullScreen,"is-lightoff":f.lightOff,"d-player-wrap-hover":f.playBtnState=="play"||f.isVideoHovering}]),onMousemove:B},[createBaseVNode("div",_hoisted_1$5,[createBaseVNode("video",mergeProps({ref_key:"refdVideo",ref:o,class:["d-player-video-main",{"video-mirror":f.mirror}],id:"dPlayerVideoMain",controls:!!(unref(isMobile)&&f.speed),"webkit-playsinline":s.playsinline,playsinline:s.playsinline},unref(u),{volume:f.volume,muted:f.muted,loop:f.loop,preload:I.preload,width:"100%",height:"100%",src:s.src,poster:s.poster})," \u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002 ",16,_hoisted_2$4)]),createVNode(Transition,{name:"d-fade-in"},{default:withCtx(()=>[withDirectives(createBaseVNode("div",_hoisted_3$2,null,512),[[vShow,f.lightOff]])]),_:1}),f.fullScreen?(openBlock(),createBlock(DPlayerTop,{key:0,title:s.title},null,8,["title"])):createCommentVNode("",!0),unref(isMobile)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_4$1,[createVNode(Transition,{name:"d-scale-out"},{default:withCtx(()=>[withDirectives(createBaseVNode("div",_hoisted_5$1,[createVNode(DIcon,{icon:"icon-play",size:40})],512),[[vShow,f.playBtnState=="play"]])]),_:1}),createVNode(DStatus,{state:f},null,8,["state"])])),unref(isMobile)?createCommentVNode("",!0):(openBlock(),createElementBlock("input",{key:2,type:"input",readonly:"readonly",ref_key:"refInput",ref:c,onDblclick:b,onKeyup:[withKeys(b,["f"]),R[0]||(R[0]=withKeys(V=>f.webFullScreen=!1,["esc"])),x],onClick:_,onKeydown:[withKeys(_,["space"]),withKeys(y,["arrow-left"]),withKeys(S,["arrow-up","arrow-down"]),x],class:"d-player-input",maxlength:"0"},null,544)),createVNode(DLoading,{loadType:f.loadStateType},null,8,["loadType"]),createVNode(DContextmenu),!unref(isMobile)&&f.control?(openBlock(),createElementBlock("div",{key:3,class:"d-player-control",ref_key:"refPlayerControl",ref:l},[createBaseVNode("div",_hoisted_6,[createVNode(DSlider,{class:"d-progress-bar",onOnMousemove:F,onChange:k,disabled:!f.speed,hoverText:f.progressCursorTime,modelValue:f.playProgress,"onUpdate:modelValue":R[1]||(R[1]=V=>f.playProgress=V),preload:f.preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),createBaseVNode("div",{class:"d-control-tool",onClick:E},[createBaseVNode("div",_hoisted_7,[createBaseVNode("div",{class:"d-tool-item",onClick:_},[createVNode(DIcon,{size:"24",icon:`icon-${f.playBtnState}`},null,8,["icon"])]),s.controlBtns.includes("audioTrack")?(openBlock(),createElementBlock("div",_hoisted_8,[createBaseVNode("span",null,toDisplayString(f.currentTime),1),_hoisted_9,createBaseVNode("span",_hoisted_10,toDisplayString(f.totalTime),1)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_11,[f.qualityLevels.length&&s.controlBtns.includes("quality")?(openBlock(),createElementBlock("div",_hoisted_12,[createTextVNode(toDisplayString(f.qualityLevels.length&&(f.qualityLevels[f.currentLevel]||{}).height)+"P ",1),createBaseVNode("div",_hoisted_13,[createBaseVNode("ul",_hoisted_14,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(f.qualityLevels,(V,$)=>(openBlock(),createElementBlock("li",{class:normalizeClass({"speed-active":f.currentLevel==$}),onClick:H=>N(V,$),key:V},toDisplayString(V.height)+"P ",11,_hoisted_15))),128))])])])):createCommentVNode("",!0),s.controlBtns.includes("speedRate")?(openBlock(),createElementBlock("div",_hoisted_16,[createTextVNode(toDisplayString(f.speedActive=="1.0"?"\u500D\u901F":f.speedActive+"x")+" ",1),createBaseVNode("div",_hoisted_17,[createBaseVNode("ul",_hoisted_18,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(f.speedRate,V=>(openBlock(),createElementBlock("li",{class:normalizeClass({"speed-active":f.speedActive==V}),onClick:$=>G(V),key:V},toDisplayString(V)+"x ",11,_hoisted_19))),128))])])])):createCommentVNode("",!0),s.controlBtns.includes("volume")?(openBlock(),createElementBlock("div",_hoisted_20,[createBaseVNode("div",_hoisted_21,[createBaseVNode("div",{class:normalizeClass(["volume-main",{"is-muted":f.muted}])},[createBaseVNode("span",_hoisted_22,toDisplayString(f.muted?0:~~(f.volume*100))+"%",1),createVNode(DSlider,{onChange:R[2]||(R[2]=V=>f.muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:f.volume,"onUpdate:modelValue":R[3]||(R[3]=V=>f.volume=V)},null,8,["modelValue"])],2)]),createBaseVNode("span",{onClick:P,style:{display:"flex"}},[createVNode(DIcon,{size:"20",icon:`icon-volume-${f.volume==0||f.muted?"mute":f.volume>.5?"up":"down"}`},null,8,["icon"])])])):createCommentVNode("",!0),s.controlBtns.includes("setting")?(openBlock(),createElementBlock("div",_hoisted_23,[createVNode(DIcon,{size:"20",class:"rotateHover",icon:"icon-settings"}),createBaseVNode("div",_hoisted_24,[createBaseVNode("ul",_hoisted_25,[createBaseVNode("li",null,[createTextVNode(" \u955C\u50CF\u753B\u9762 "),createVNode(DSwitch,{onChange:U,modelValue:f.mirror,"onUpdate:modelValue":R[4]||(R[4]=V=>f.mirror=V)},null,8,["modelValue"])]),createBaseVNode("li",null,[createTextVNode(" \u5FAA\u73AF\u64AD\u653E "),createVNode(DSwitch,{onChange:O,modelValue:f.loop,"onUpdate:modelValue":R[5]||(R[5]=V=>f.loop=V)},null,8,["modelValue"])]),createBaseVNode("li",null,[createTextVNode(" \u5173\u706F\u6A21\u5F0F "),createVNode(DSwitch,{onChange:L,modelValue:f.lightOff,"onUpdate:modelValue":R[6]||(R[6]=V=>f.lightOff=V)},null,8,["modelValue"])])])])])):createCommentVNode("",!0),s.controlBtns.includes("pip")?(openBlock(),createElementBlock("div",{key:4,class:"d-tool-item pip-btn",onClick:D},[createVNode(DIcon,{size:"20",icon:"icon-pip"}),_hoisted_26])):createCommentVNode("",!0),s.controlBtns.includes("pageFullScreen")?(openBlock(),createElementBlock("div",{key:5,class:"d-tool-item pip-btn",onClick:R[7]||(R[7]=V=>f.webFullScreen=!f.webFullScreen)},[createVNode(DIcon,{size:"20",icon:"icon-web-screen"}),_hoisted_27])):createCommentVNode("",!0),s.controlBtns.includes("fullScreen")?(openBlock(),createElementBlock("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:b},[_hoisted_28,createVNode(DIcon,{size:"20",icon:"icon-screen"})])):createCommentVNode("",!0)])])],512)):createCommentVNode("",!0)],34))}});var Vue3VideoPlay=_export_sfc$1(_sfc_main$6,[["__scopeId","data-v-7a96e874"]]);const _hoisted_1$4=createBaseVNode("div",{class:"absolute-center",style:{"z-index":"0"}}," \u52A0\u8F7D\u4E2D...",-1),_hoisted_2$3={key:0},_hoisted_3$1={key:1,style:{width:"800px",height:"auto"},controls:"","x-webkit-airplay":"allow",playsinline:"","webkit-playsinline":"webkit-playsinline",airplay:"true"},_hoisted_4=["src"],_hoisted_5=["src"],_sfc_main$5={__name:"VideoPreview",setup(r,{expose:e}){useQuasar();const t=ref(!1),i=ref(null),s=reactive({width:"800px",height:"450px",color:"#409eff",title:"",src:null,muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,controlBtns:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]}),n=()=>{const o=window.navigator.userAgent.toLowerCase();return/^((?!chrome|android).)*safari/i.test(o)};return e({showVideoPreview:(o,l,c)=>{t.value=!0,s.src=l.url,s.type="m3u8",s.title=o.vod_name+" - "+l.title,c&&(i.value=c+l.url)}}),(o,l)=>(openBlock(),createBlock(QDialog,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=c=>t.value=c),persistent:""},{default:withCtx(()=>[createVNode(QCard,{style:{"min-width":"800px"}},{default:withCtx(()=>[createVNode(QToolbar,null,{default:withCtx(()=>[createVNode(QToolbarTitle,null,{default:withCtx(()=>[createTextVNode(toDisplayString(s.title),1)]),_:1}),withDirectives(createVNode(QBtn,{flat:"",round:"",dense:"",icon:"ion-ios-close"},null,512),[[ClosePopup]])]),_:1}),_hoisted_1$4,i.value?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_2$3,[n()?(openBlock(),createElementBlock("video",_hoisted_3$1,[createBaseVNode("source",{src:s.src},null,8,_hoisted_4),createTextVNode(" \u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u89C6\u9891\u6807\u7B7E\u3002 ")])):(openBlock(),createBlock(Vue3VideoPlay,mergeProps({key:0},s,{style:{width:"px !important",height:"auto"}}),null,16))])),i.value?(openBlock(),createElementBlock("iframe",{key:1,src:i.value,width:"800",height:"400",style:{"z-index":"999",position:"relative"},allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",frameborder:"0",allowfullscreen:""},null,8,_hoisted_5)):createCommentVNode("",!0)]),_:1})]),_:1},8,["modelValue"]))}};var SearchDetail_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$3={class:"flex justify-between align-items-center",style:{border:"#aad2f1 1px solid",padding:"1px",margin:"5px","border-radius":"5px"}},_hoisted_2$2={class:"q-gutter-xs q-pa-sm"},_sfc_main$4={__name:"SearchDetail",props:{confirm:{type:Boolean,default:!1},vod:{type:Object,default:()=>({})},play_url:{type:String,default:()=>""}},emits:["update:confirm"],setup(r,{emit:e}){const t=useQuasar(),i=r,s=lookup("/search"),n=ref(!1),a=ref(null),o=e;watch(n,()=>{o("update:confirm",n.value)});const l=(d,u,g)=>{a.value.showVideoPreview(d,u,g)},c=(d,u)=>{u.loading=!0,!u.downloaded&&s.emit("download",{downloads:[{vod:d,detail:{...u,checked:!0}}]},g=>{u.loading=!1,g.code==="200"?(u.downloaded=!0,showInfo(g.msg)):showError(g.msg)})},f=()=>{let d=i.sources.findIndex(u=>u.name===tab.value);console.log(i.sources[d].details),s.emit("download",{source:i.sources[d]},u=>{t.loading.hide(),u.code==="200"?showInfo(u.msg):showError(u.msg)})};return(d,u)=>(openBlock(),createBlock(QDialog,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=g=>n.value=g),position:"right",maximized:"","full-height":"",class:"dialog"},{default:withCtx(()=>[createVNode(QCard,{style:{width:"40vw","min-width":"400px"},class:"content"},{default:withCtx(()=>[createVNode(QToolbar,null,{default:withCtx(()=>[createVNode(QIcon,{size:"sm",name:"ion-ios-download"}),createVNode(QToolbarTitle,null,{default:withCtx(()=>[createTextVNode(toDisplayString(r.vod.vod_name),1)]),_:1}),withDirectives(createVNode(QBtn,{flat:"",round:"",dense:"",icon:"ion-ios-close"},null,512),[[ClosePopup]])]),_:1}),createVNode(QCardSection,{style:{height:"calc(100vh - 100px)",overflow:"auto"}},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(r.vod.url_details,g=>(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",null,[createVNode(QCheckbox,{modelValue:g.checked,"onUpdate:modelValue":p=>g.checked=p},null,8,["modelValue","onUpdate:modelValue"]),createTextVNode(" "+toDisplayString(g.title),1)]),createBaseVNode("div",_hoisted_2$2,[createVNode(QBtn,{flat:"",round:"",icon:"ion-ios-play",color:"primary",size:"sm",onClick:p=>l(r.vod,g,r.play_url)},null,8,["onClick"]),createVNode(QBtn,{loading:g.loading,flat:"",round:"",icon:g.downloaded?"ion-ios-checkmark-circle":"ion-ios-download",color:g.downloaded?"green":"primary",size:"sm",onClick:p=>c(r.vod,g)},null,8,["loading","icon","color","onClick"])])]))),256))]),_:1}),createVNode(QCardActions,{class:"absolute-bottom"},{default:withCtx(()=>[createVNode(QBtn,{flat:"",label:"\u5168\u9009",color:"primary"}),createVNode(QSpace),createVNode(QBtn,{label:"\u4E0B\u8F7D\u9009\u62E9\u7684\u89C6\u9891",color:"primary",onClick:f})]),_:1})]),_:1}),createVNode(_sfc_main$5,{ref_key:"videoPreview",ref:a},null,512)]),_:1},8,["modelValue"]))}};var SearchDetail=_export_sfc$1(_sfc_main$4,[["__scopeId","data-v-03271465"]]);const _hoisted_1$2={class:"text-weight-medium"},_hoisted_2$1={class:"text-grey-8"},_sfc_main$3=Object.assign({name:"SearchResultCards"},{__name:"SearchResultCards",props:{searchs:{type:Array,required:!0}},setup(r){useQuasar();const e=ref(!1),t=ref({}),i=ref("");lookup("/search"),ref("ALL"),ref([]);const s=(n,a)=>{e.value=!0,t.value=a,i.value=n.play_url};return(n,a)=>(openBlock(),createElementBlock(Fragment$1,null,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(r.searchs,o=>(openBlock(),createBlock(QCard,{bordered:"",class:"q-mt-md no-box-shadow content"},{default:withCtx(()=>[createVNode(QList,{separator:"",style:{"border-radius":"10px"}},{default:withCtx(()=>[createVNode(QItemLabel,{header:""},{default:withCtx(()=>[createTextVNode(toDisplayString(o.api_name),1)]),_:2},1024),withDirectives(createVNode(QItemLabel,{header:""},{default:withCtx(()=>[createTextVNode("\u6CA1\u6709\u641C\u7D22\u5230\u5185\u5BB9")]),_:2},1536),[[vShow,o.vms.length===0]]),(openBlock(!0),createElementBlock(Fragment$1,null,renderList(o.vms,l=>(openBlock(),createBlock(QItem,{clickable:""},{default:withCtx(()=>[createVNode(QItemSection,{avatar:"",top:""},{default:withCtx(()=>[createVNode(QImg,{src:l.vod_pic,ratio:16/9,width:"100px"},null,8,["src"])]),_:2},1024),createVNode(QItemSection,{top:"",onClick:c=>s(o,l)},{default:withCtx(()=>[createVNode(QItemLabel,{lines:"1"},{default:withCtx(()=>[createBaseVNode("span",_hoisted_1$2,toDisplayString(l.vod_name),1),createBaseVNode("span",_hoisted_2$1," - "+toDisplayString(l.vod_remarks),1)]),_:2},1024),createVNode(QItemLabel,{caption:"",innerHTML:l.vod_content},null,8,["innerHTML"]),createVNode(QItemLabel,{caption:""},{default:withCtx(()=>[createTextVNode(" \u6F14\u5458:"),createBaseVNode("span",null,toDisplayString(l.vod_actor),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),256))]),_:2},1024)]),_:2},1024))),256)),createVNode(SearchDetail,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=o=>e.value=o),vod:t.value,play_url:i.value},null,8,["modelValue","vod","play_url"])],64))}});var lottie={exports:{}};(function(module,exports){typeof navigator!="undefined"&&function(r,e){module.exports=e()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(e){_useWebWorker=!!e},getWebWorker=function(){return _useWebWorker},setLocationHref=function(e){locationHref=e},getLocationHref=function(){return locationHref};function createTag(r){return document.createElement(r)}function extendPrototype(r,e){var t,i=r.length,s;for(t=0;t<i;t+=1){s=r[t].prototype;for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e.prototype[n]=s[n])}}function getDescriptor(r,e){return Object.getOwnPropertyDescriptor(r,e)}function createProxyFunction(r){function e(){}return e.prototype=r,e}var audioControllerFactory=function(){function r(e){this.audios=[],this.audioFactory=e,this._volume=1,this._isMuted=!1}return r.prototype={addAudio:function(t){this.audios.push(t)},pause:function(){var t,i=this.audios.length;for(t=0;t<i;t+=1)this.audios[t].pause()},resume:function(){var t,i=this.audios.length;for(t=0;t<i;t+=1)this.audios[t].resume()},setRate:function(t){var i,s=this.audios.length;for(i=0;i<s;i+=1)this.audios[i].setRate(t)},createAudio:function(t){return this.audioFactory?this.audioFactory(t):window.Howl?new window.Howl({src:[t]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(t){this.audioFactory=t},setVolume:function(t){this._volume=t,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var t,i=this.audios.length;for(t=0;t<i;t+=1)this.audios[t].volume(this._volume*(this._isMuted?0:1))}},function(){return new r}}(),createTypedArray=function(){function r(t,i){var s=0,n=[],a;switch(t){case"int16":case"uint8c":a=1;break;default:a=1.1;break}for(s=0;s<i;s+=1)n.push(a);return n}function e(t,i){return t==="float32"?new Float32Array(i):t==="int16"?new Int16Array(i):t==="uint8c"?new Uint8ClampedArray(i):r(t,i)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?e:r}();function createSizedArray(r){return Array.apply(null,{length:r})}function _typeof$6(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$6=function(t){return typeof t}:_typeof$6=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$6(r)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var r=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],e,t=r.length;for(e=0;e<t;e+=1)BMMath[r[e]]=Math[r[e]]})(),BMMath.random=Math.random,BMMath.abs=function(r){var e=_typeof$6(r);if(e==="object"&&r.length){var t=createSizedArray(r.length),i,s=r.length;for(i=0;i<s;i+=1)t[i]=Math.abs(r[i]);return t}return Math.abs(r)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(r){r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.display="block",r.style.transformOrigin="0 0",r.style.webkitTransformOrigin="0 0",r.style.backfaceVisibility="visible",r.style.webkitBackfaceVisibility="visible",r.style.transformStyle="preserve-3d",r.style.webkitTransformStyle="preserve-3d",r.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(r,e,t,i){this.type=r,this.currentTime=e,this.totalTime=t,this.direction=i<0?-1:1}function BMCompleteEvent(r,e){this.type=r,this.direction=e<0?-1:1}function BMCompleteLoopEvent(r,e,t,i){this.type=r,this.currentLoop=t,this.totalLoops=e,this.direction=i<0?-1:1}function BMSegmentStartEvent(r,e,t){this.type=r,this.firstFrame=e,this.totalFrames=t}function BMDestroyEvent(r,e){this.type=r,this.target=e}function BMRenderFrameErrorEvent(r,e){this.type="renderFrameError",this.nativeError=r,this.currentTime=e}function BMConfigErrorEvent(r){this.type="configError",this.nativeError=r}var createElementID=function(){var r=0;return function(){return r+=1,idPrefix$1+"__lottie_element_"+r}}();function HSVtoRGB(r,e,t){var i,s,n,a,o,l,c,f;switch(a=Math.floor(r*6),o=r*6-a,l=t*(1-e),c=t*(1-o*e),f=t*(1-(1-o)*e),a%6){case 0:i=t,s=f,n=l;break;case 1:i=c,s=t,n=l;break;case 2:i=l,s=t,n=f;break;case 3:i=l,s=c,n=t;break;case 4:i=f,s=l,n=t;break;case 5:i=t,s=l,n=c;break}return[i,s,n]}function RGBtoHSV(r,e,t){var i=Math.max(r,e,t),s=Math.min(r,e,t),n=i-s,a,o=i===0?0:n/i,l=i/255;switch(i){case s:a=0;break;case r:a=e-t+n*(e<t?6:0),a/=6*n;break;case e:a=t-r+n*2,a/=6*n;break;case t:a=r-e+n*4,a/=6*n;break}return[a,o,l]}function addSaturationToRGB(r,e){var t=RGBtoHSV(r[0]*255,r[1]*255,r[2]*255);return t[1]+=e,t[1]>1?t[1]=1:t[1]<=0&&(t[1]=0),HSVtoRGB(t[0],t[1],t[2])}function addBrightnessToRGB(r,e){var t=RGBtoHSV(r[0]*255,r[1]*255,r[2]*255);return t[2]+=e,t[2]>1?t[2]=1:t[2]<0&&(t[2]=0),HSVtoRGB(t[0],t[1],t[2])}function addHueToRGB(r,e){var t=RGBtoHSV(r[0]*255,r[1]*255,r[2]*255);return t[0]+=e/360,t[0]>1?t[0]-=1:t[0]<0&&(t[0]+=1),HSVtoRGB(t[0],t[1],t[2])}var rgbToHex=function(){var r=[],e,t;for(e=0;e<256;e+=1)t=e.toString(16),r[e]=t.length===1?"0"+t:t;return function(i,s,n){return i<0&&(i=0),s<0&&(s=0),n<0&&(n=0),"#"+r[i]+r[s]+r[n]}}(),setSubframeEnabled=function(e){subframeEnabled=!!e},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(e){expressionsPlugin=e},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(e){expressionsInterfaces=e},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(e){defaultCurveSegments=e},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(e){idPrefix$1=e};function createNS(r){return document.createElementNS(svgNS,r)}function _typeof$5(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$5=function(t){return typeof t}:_typeof$5=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$5(r)}var dataManager=function(){var r=1,e=[],t,i,s={onmessage:function(){},postMessage:function(g){t({data:g})}},n={postMessage:function(g){s.onmessage({data:g})}};function a(u){if(window.Worker&&window.Blob&&getWebWorker()){var g=new Blob(["var _workerSelf = self; self.onmessage = ",u.toString()],{type:"text/javascript"}),p=URL.createObjectURL(g);return new Worker(p)}return t=u,s}function o(){i||(i=a(function(g){function p(){function S(O,L){var D,b,C=O.length,I,R,V,$;for(b=0;b<C;b+=1)if(D=O[b],"ks"in D&&!D.completed){if(D.completed=!0,D.hasMask){var H=D.masksProperties;for(R=H.length,I=0;I<R;I+=1)if(H[I].pt.k.i)A(H[I].pt.k);else for($=H[I].pt.k.length,V=0;V<$;V+=1)H[I].pt.k[V].s&&A(H[I].pt.k[V].s[0]),H[I].pt.k[V].e&&A(H[I].pt.k[V].e[0])}D.ty===0?(D.layers=E(D.refId,L),S(D.layers,L)):D.ty===4?T(D.shapes):D.ty===5&&G(D)}}function y(O,L){if(O){var D=0,b=O.length;for(D=0;D<b;D+=1)O[D].t===1&&(O[D].data.layers=E(O[D].data.refId,L),S(O[D].data.layers,L))}}function x(O,L){for(var D=0,b=L.length;D<b;){if(L[D].id===O)return L[D];D+=1}return null}function E(O,L){var D=x(O,L);return D?D.layers.__used?JSON.parse(JSON.stringify(D.layers)):(D.layers.__used=!0,D.layers):null}function T(O){var L,D=O.length,b,C;for(L=D-1;L>=0;L-=1)if(O[L].ty==="sh")if(O[L].ks.k.i)A(O[L].ks.k);else for(C=O[L].ks.k.length,b=0;b<C;b+=1)O[L].ks.k[b].s&&A(O[L].ks.k[b].s[0]),O[L].ks.k[b].e&&A(O[L].ks.k[b].e[0]);else O[L].ty==="gr"&&T(O[L].it)}function A(O){var L,D=O.i.length;for(L=0;L<D;L+=1)O.i[L][0]+=O.v[L][0],O.i[L][1]+=O.v[L][1],O.o[L][0]+=O.v[L][0],O.o[L][1]+=O.v[L][1]}function _(O,L){var D=L?L.split("."):[100,100,100];return O[0]>D[0]?!0:D[0]>O[0]?!1:O[1]>D[1]?!0:D[1]>O[1]?!1:O[2]>D[2]?!0:D[2]>O[2]?!1:null}var P=function(){var O=[4,4,14];function L(b){var C=b.t.d;b.t.d={k:[{s:C,t:0}]}}function D(b){var C,I=b.length;for(C=0;C<I;C+=1)b[C].ty===5&&L(b[C])}return function(b){if(_(O,b.v)&&(D(b.layers),b.assets)){var C,I=b.assets.length;for(C=0;C<I;C+=1)b.assets[C].layers&&D(b.assets[C].layers)}}}(),k=function(){var O=[4,7,99];return function(L){if(L.chars&&!_(O,L.v)){var D,b=L.chars.length;for(D=0;D<b;D+=1){var C=L.chars[D];C.data&&C.data.shapes&&(T(C.data.shapes),C.data.ip=0,C.data.op=99999,C.data.st=0,C.data.sr=1,C.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},L.chars[D].t||(C.data.shapes.push({ty:"no"}),C.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),F=function(){var O=[5,7,15];function L(b){var C=b.t.p;typeof C.a=="number"&&(C.a={a:0,k:C.a}),typeof C.p=="number"&&(C.p={a:0,k:C.p}),typeof C.r=="number"&&(C.r={a:0,k:C.r})}function D(b){var C,I=b.length;for(C=0;C<I;C+=1)b[C].ty===5&&L(b[C])}return function(b){if(_(O,b.v)&&(D(b.layers),b.assets)){var C,I=b.assets.length;for(C=0;C<I;C+=1)b.assets[C].layers&&D(b.assets[C].layers)}}}(),M=function(){var O=[4,1,9];function L(b){var C,I=b.length,R,V;for(C=0;C<I;C+=1)if(b[C].ty==="gr")L(b[C].it);else if(b[C].ty==="fl"||b[C].ty==="st")if(b[C].c.k&&b[C].c.k[0].i)for(V=b[C].c.k.length,R=0;R<V;R+=1)b[C].c.k[R].s&&(b[C].c.k[R].s[0]/=255,b[C].c.k[R].s[1]/=255,b[C].c.k[R].s[2]/=255,b[C].c.k[R].s[3]/=255),b[C].c.k[R].e&&(b[C].c.k[R].e[0]/=255,b[C].c.k[R].e[1]/=255,b[C].c.k[R].e[2]/=255,b[C].c.k[R].e[3]/=255);else b[C].c.k[0]/=255,b[C].c.k[1]/=255,b[C].c.k[2]/=255,b[C].c.k[3]/=255}function D(b){var C,I=b.length;for(C=0;C<I;C+=1)b[C].ty===4&&L(b[C].shapes)}return function(b){if(_(O,b.v)&&(D(b.layers),b.assets)){var C,I=b.assets.length;for(C=0;C<I;C+=1)b.assets[C].layers&&D(b.assets[C].layers)}}}(),B=function(){var O=[4,4,18];function L(b){var C,I=b.length,R,V;for(C=I-1;C>=0;C-=1)if(b[C].ty==="sh")if(b[C].ks.k.i)b[C].ks.k.c=b[C].closed;else for(V=b[C].ks.k.length,R=0;R<V;R+=1)b[C].ks.k[R].s&&(b[C].ks.k[R].s[0].c=b[C].closed),b[C].ks.k[R].e&&(b[C].ks.k[R].e[0].c=b[C].closed);else b[C].ty==="gr"&&L(b[C].it)}function D(b){var C,I,R=b.length,V,$,H,z;for(I=0;I<R;I+=1){if(C=b[I],C.hasMask){var W=C.masksProperties;for($=W.length,V=0;V<$;V+=1)if(W[V].pt.k.i)W[V].pt.k.c=W[V].cl;else for(z=W[V].pt.k.length,H=0;H<z;H+=1)W[V].pt.k[H].s&&(W[V].pt.k[H].s[0].c=W[V].cl),W[V].pt.k[H].e&&(W[V].pt.k[H].e[0].c=W[V].cl)}C.ty===4&&L(C.shapes)}}return function(b){if(_(O,b.v)&&(D(b.layers),b.assets)){var C,I=b.assets.length;for(C=0;C<I;C+=1)b.assets[C].layers&&D(b.assets[C].layers)}}}();function N(O){O.__complete||(M(O),P(O),k(O),F(O),B(O),S(O.layers,O.assets),y(O.chars,O.assets),O.__complete=!0)}function G(O){O.t.a.length===0&&"m"in O.t.p}var U={};return U.completeData=N,U.checkColors=M,U.checkChars=k,U.checkPathProperties=F,U.checkShapes=B,U.completeLayers=S,U}if(n.dataManager||(n.dataManager=p()),n.assetLoader||(n.assetLoader=function(){function S(x){var E=x.getResponseHeader("content-type");return E&&x.responseType==="json"&&E.indexOf("json")!==-1||x.response&&_typeof$5(x.response)==="object"?x.response:x.response&&typeof x.response=="string"?JSON.parse(x.response):x.responseText?JSON.parse(x.responseText):null}function y(x,E,T,A){var _,P=new XMLHttpRequest;try{P.responseType="json"}catch{}P.onreadystatechange=function(){if(P.readyState===4)if(P.status===200)_=S(P),T(_);else try{_=S(P),T(_)}catch(k){A&&A(k)}};try{P.open(["G","E","T"].join(""),x,!0)}catch{P.open(["G","E","T"].join(""),E+"/"+x,!0)}P.send()}return{load:y}}()),g.data.type==="loadAnimation")n.assetLoader.load(g.data.path,g.data.fullPath,function(S){n.dataManager.completeData(S),n.postMessage({id:g.data.id,payload:S,status:"success"})},function(){n.postMessage({id:g.data.id,status:"error"})});else if(g.data.type==="complete"){var m=g.data.animation;n.dataManager.completeData(m),n.postMessage({id:g.data.id,payload:m,status:"success"})}else g.data.type==="loadData"&&n.assetLoader.load(g.data.path,g.data.fullPath,function(S){n.postMessage({id:g.data.id,payload:S,status:"success"})},function(){n.postMessage({id:g.data.id,status:"error"})})}),i.onmessage=function(u){var g=u.data,p=g.id,m=e[p];e[p]=null,g.status==="success"?m.onComplete(g.payload):m.onError&&m.onError()})}function l(u,g){r+=1;var p="processId_"+r;return e[p]={onComplete:u,onError:g},p}function c(u,g,p){o();var m=l(g,p);i.postMessage({type:"loadAnimation",path:u,fullPath:window.location.origin+window.location.pathname,id:m})}function f(u,g,p){o();var m=l(g,p);i.postMessage({type:"loadData",path:u,fullPath:window.location.origin+window.location.pathname,id:m})}function d(u,g,p){o();var m=l(g,p);i.postMessage({type:"complete",animation:u,id:m})}return{loadAnimation:c,loadData:f,completeAnimation:d}}(),ImagePreloader=function(){var r=function(){var y=createTag("canvas");y.width=1,y.height=1;var x=y.getContext("2d");return x.fillStyle="rgba(0,0,0,0)",x.fillRect(0,0,1,1),y}();function e(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function t(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function i(y,x,E){var T="";if(y.e)T=y.p;else if(x){var A=y.p;A.indexOf("images/")!==-1&&(A=A.split("/")[1]),T=x+A}else T=E,T+=y.u?y.u:"",T+=y.p;return T}function s(y){var x=0,E=setInterval(function(){var T=y.getBBox();(T.width||x>500)&&(this._imageLoaded(),clearInterval(E)),x+=1}.bind(this),50)}function n(y){var x=i(y,this.assetsPath,this.path),E=createNS("image");isSafari?this.testImageLoaded(E):E.addEventListener("load",this._imageLoaded,!1),E.addEventListener("error",function(){T.img=r,this._imageLoaded()}.bind(this),!1),E.setAttributeNS("http://www.w3.org/1999/xlink","href",x),this._elementHelper.append?this._elementHelper.append(E):this._elementHelper.appendChild(E);var T={img:E,assetData:y};return T}function a(y){var x=i(y,this.assetsPath,this.path),E=createTag("img");E.crossOrigin="anonymous",E.addEventListener("load",this._imageLoaded,!1),E.addEventListener("error",function(){T.img=r,this._imageLoaded()}.bind(this),!1),E.src=x;var T={img:E,assetData:y};return T}function o(y){var x={assetData:y},E=i(y,this.assetsPath,this.path);return dataManager.loadData(E,function(T){x.img=T,this._footageLoaded()}.bind(this),function(){x.img={},this._footageLoaded()}.bind(this)),x}function l(y,x){this.imagesLoadedCb=x;var E,T=y.length;for(E=0;E<T;E+=1)y[E].layers||(!y[E].t||y[E].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(y[E]))):y[E].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(y[E]))))}function c(y){this.path=y||""}function f(y){this.assetsPath=y||""}function d(y){for(var x=0,E=this.images.length;x<E;){if(this.images[x].assetData===y)return this.images[x].img;x+=1}return null}function u(){this.imagesLoadedCb=null,this.images.length=0}function g(){return this.totalImages===this.loadedAssets}function p(){return this.totalFootages===this.loadedFootagesCount}function m(y,x){y==="svg"?(this._elementHelper=x,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function S(){this._imageLoaded=e.bind(this),this._footageLoaded=t.bind(this),this.testImageLoaded=s.bind(this),this.createFootageData=o.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return S.prototype={loadAssets:l,setAssetsPath:f,setPath:c,loadedImages:g,loadedFootages:p,destroy:u,getAsset:d,createImgData:a,createImageData:n,imageLoaded:e,footageLoaded:t,setCacheType:m},S}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(e,t){if(this._cbs[e])for(var i=this._cbs[e],s=0;s<i.length;s+=1)i[s](t)},addEventListener:function(e,t){return this._cbs[e]||(this._cbs[e]=[]),this._cbs[e].push(t),function(){this.removeEventListener(e,t)}.bind(this)},removeEventListener:function(e,t){if(!t)this._cbs[e]=null;else if(this._cbs[e]){for(var i=0,s=this._cbs[e].length;i<s;)this._cbs[e][i]===t&&(this._cbs[e].splice(i,1),i-=1,s-=1),i+=1;this._cbs[e].length||(this._cbs[e]=null)}}};var markerParser=function(){function r(e){for(var t=e.split(`\r
`),i={},s,n=0,a=0;a<t.length;a+=1)s=t[a].split(":"),s.length===2&&(i[s[0]]=s[1].trim(),n+=1);if(n===0)throw new Error;return i}return function(e){for(var t=[],i=0;i<e.length;i+=1){var s=e[i],n={time:s.tm,duration:s.dr};try{n.payload=JSON.parse(e[i].cm)}catch{try{n.payload=r(e[i].cm)}catch{n.payload={name:e[i].cm}}}t.push(n)}return t}}(),ProjectInterface=function(){function r(e){this.compositions.push(e)}return function(){function e(t){for(var i=0,s=this.compositions.length;i<s;){if(this.compositions[i].data&&this.compositions[i].data.nm===t)return this.compositions[i].prepareFrame&&this.compositions[i].data.xt&&this.compositions[i].prepareFrame(this.currentFrame),this.compositions[i].compInterface;i+=1}return null}return e.compositions=[],e.currentFrame=0,e.registerComposition=r,e}}(),renderers={},registerRenderer=function(e,t){renderers[e]=t};function getRenderer(r){return renderers[r]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var r in renderers)if(renderers[r])return r;return""}function _typeof$4(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$4=function(t){return typeof t}:_typeof$4=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$4(r)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(r){(r.wrapper||r.container)&&(this.wrapper=r.wrapper||r.container);var e="svg";r.animType?e=r.animType:r.renderer&&(e=r.renderer);var t=getRenderer(e);this.renderer=new t(this,r.rendererSettings),this.imagePreloader.setCacheType(e,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=e,r.loop===""||r.loop===null||r.loop===void 0||r.loop===!0?this.loop=!0:r.loop===!1?this.loop=!1:this.loop=parseInt(r.loop,10),this.autoplay="autoplay"in r?r.autoplay:!0,this.name=r.name?r.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(r,"autoloadSegments")?r.autoloadSegments:!0,this.assetsPath=r.assetsPath,this.initialSegment=r.initialSegment,r.audioFactory&&this.audioController.setAudioFactory(r.audioFactory),r.animationData?this.setupAnimation(r.animationData):r.path&&(r.path.lastIndexOf("\\")!==-1?this.path=r.path.substr(0,r.path.lastIndexOf("\\")+1):this.path=r.path.substr(0,r.path.lastIndexOf("/")+1),this.fileName=r.path.substr(r.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(r.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(r){dataManager.completeAnimation(r,this.configAnimation)},AnimationItem.prototype.setData=function(r,e){e&&_typeof$4(e)!=="object"&&(e=JSON.parse(e));var t={wrapper:r,animationData:e},i=r.attributes;t.path=i.getNamedItem("data-animation-path")?i.getNamedItem("data-animation-path").value:i.getNamedItem("data-bm-path")?i.getNamedItem("data-bm-path").value:i.getNamedItem("bm-path")?i.getNamedItem("bm-path").value:"",t.animType=i.getNamedItem("data-anim-type")?i.getNamedItem("data-anim-type").value:i.getNamedItem("data-bm-type")?i.getNamedItem("data-bm-type").value:i.getNamedItem("bm-type")?i.getNamedItem("bm-type").value:i.getNamedItem("data-bm-renderer")?i.getNamedItem("data-bm-renderer").value:i.getNamedItem("bm-renderer")?i.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var s=i.getNamedItem("data-anim-loop")?i.getNamedItem("data-anim-loop").value:i.getNamedItem("data-bm-loop")?i.getNamedItem("data-bm-loop").value:i.getNamedItem("bm-loop")?i.getNamedItem("bm-loop").value:"";s==="false"?t.loop=!1:s==="true"?t.loop=!0:s!==""&&(t.loop=parseInt(s,10));var n=i.getNamedItem("data-anim-autoplay")?i.getNamedItem("data-anim-autoplay").value:i.getNamedItem("data-bm-autoplay")?i.getNamedItem("data-bm-autoplay").value:i.getNamedItem("bm-autoplay")?i.getNamedItem("bm-autoplay").value:!0;t.autoplay=n!=="false",t.name=i.getNamedItem("data-name")?i.getNamedItem("data-name").value:i.getNamedItem("data-bm-name")?i.getNamedItem("data-bm-name").value:i.getNamedItem("bm-name")?i.getNamedItem("bm-name").value:"";var a=i.getNamedItem("data-anim-prerender")?i.getNamedItem("data-anim-prerender").value:i.getNamedItem("data-bm-prerender")?i.getNamedItem("data-bm-prerender").value:i.getNamedItem("bm-prerender")?i.getNamedItem("bm-prerender").value:"";a==="false"&&(t.prerender=!1),t.path?this.setParams(t):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(r){r.op>this.animationData.op&&(this.animationData.op=r.op,this.totalFrames=Math.floor(r.op-this.animationData.ip));var e=this.animationData.layers,t,i=e.length,s=r.layers,n,a=s.length;for(n=0;n<a;n+=1)for(t=0;t<i;){if(e[t].id===s[n].id){e[t]=s[n];break}t+=1}if((r.chars||r.fonts)&&(this.renderer.globalData.fontManager.addChars(r.chars),this.renderer.globalData.fontManager.addFonts(r.fonts,this.renderer.globalData.defs)),r.assets)for(i=r.assets.length,t=0;t<i;t+=1)this.animationData.assets.push(r.assets[t]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(r){this.animationData=r;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var r=this.animationData.segments;if(!r||r.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var e=r.shift();this.timeCompleted=e.time*this.frameRate;var t=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(t,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){var r=this.animationData.segments;r||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(r){if(!!this.renderer)try{this.animationData=r,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(r),r.assets||(r.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(r.assets),this.markers=markerParser(r.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(e){this.triggerConfigError(e)}},AnimationItem.prototype.waitForFontsLoaded=function(){!this.renderer||(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var r=getExpressionsPlugin();r&&r.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(r,e){var t=typeof r=="number"?r:void 0,i=typeof e=="number"?e:void 0;this.renderer.updateContainerSize(t,i)},AnimationItem.prototype.setSubframe=function(r){this.isSubframeEnabled=!!r},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(r){this.triggerRenderFrameError(r)}},AnimationItem.prototype.play=function(r){r&&this.name!==r||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(r){r&&this.name!==r||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(r){r&&this.name!==r||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(r){r&&this.name!==r||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(r){for(var e,t=0;t<this.markers.length;t+=1)if(e=this.markers[t],e.payload&&e.payload.name===r)return e;return null},AnimationItem.prototype.goToAndStop=function(r,e,t){if(!(t&&this.name!==t)){var i=Number(r);if(isNaN(i)){var s=this.getMarkerData(r);s&&this.goToAndStop(s.time,!0)}else e?this.setCurrentRawFrameValue(r):this.setCurrentRawFrameValue(r*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(r,e,t){if(!(t&&this.name!==t)){var i=Number(r);if(isNaN(i)){var s=this.getMarkerData(r);s&&(s.duration?this.playSegments([s.time,s.time+s.duration],!0):this.goToAndStop(s.time,!0))}else this.goToAndStop(i,e,t);this.play()}},AnimationItem.prototype.advanceTime=function(r){if(!(this.isPaused===!0||this.isLoaded===!1)){var e=this.currentRawFrame+r*this.frameModifier,t=!1;e>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(e>this.totalFrames?e%this.totalFrames:0)||(t=!0,e=this.totalFrames-1):e>=this.totalFrames?(this.playCount+=1,this.checkSegments(e%this.totalFrames)||(this.setCurrentRawFrameValue(e%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(e):e<0?this.checkSegments(e%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+e%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(t=!0,e=0)):this.setCurrentRawFrameValue(e),t&&(this.setCurrentRawFrameValue(e),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(r,e){this.playCount=0,r[1]<r[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=r[0]-r[1],this.timeCompleted=this.totalFrames,this.firstFrame=r[1],this.setCurrentRawFrameValue(this.totalFrames-.001-e)):r[1]>r[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=r[1]-r[0],this.timeCompleted=this.totalFrames,this.firstFrame=r[0],this.setCurrentRawFrameValue(.001+e)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(r,e){var t=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<r?t=r:this.currentRawFrame+this.firstFrame>e&&(t=e-r)),this.firstFrame=r,this.totalFrames=e-r,this.timeCompleted=this.totalFrames,t!==-1&&this.goToAndStop(t,!0)},AnimationItem.prototype.playSegments=function(r,e){if(e&&(this.segments.length=0),_typeof$4(r[0])==="object"){var t,i=r.length;for(t=0;t<i;t+=1)this.segments.push(r[t])}else this.segments.push(r);this.segments.length&&e&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(r){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),r&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(r){return this.segments.length?(this.adjustSegment(this.segments.shift(),r),!0):!1},AnimationItem.prototype.destroy=function(r){r&&this.name!==r||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(r){this.currentRawFrame=r,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(r){this.playSpeed=r,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(r){this.playDirection=r<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(r){this.loop=r},AnimationItem.prototype.setVolume=function(r,e){e&&this.name!==e||this.audioController.setVolume(r)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(r){r&&this.name!==r||this.audioController.mute()},AnimationItem.prototype.unmute=function(r){r&&this.name!==r||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(r){var e="";if(r.e)e=r.p;else if(this.assetsPath){var t=r.p;t.indexOf("images/")!==-1&&(t=t.split("/")[1]),e=this.assetsPath+t}else e=this.path,e+=r.u?r.u:"",e+=r.p;return e},AnimationItem.prototype.getAssetData=function(r){for(var e=0,t=this.assets.length;e<t;){if(r===this.assets[e].id)return this.assets[e];e+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(r){return r?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(r,e,t){try{var i=this.renderer.getElementByPath(r);i.updateDocumentData(e,t)}catch{}},AnimationItem.prototype.trigger=function(r){if(this._cbs&&this._cbs[r])switch(r){case"enterFrame":this.triggerEvent(r,new BMEnterFrameEvent(r,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(r,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(r,new BMCompleteLoopEvent(r,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(r,new BMCompleteEvent(r,this.frameMult));break;case"segmentStart":this.triggerEvent(r,new BMSegmentStartEvent(r,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(r,new BMDestroyEvent(r,this));break;default:this.triggerEvent(r)}r==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(r,this.currentFrame,this.totalFrames,this.frameMult)),r==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(r,this.loop,this.playCount,this.frameMult)),r==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(r,this.frameMult)),r==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(r,this.firstFrame,this.totalFrames)),r==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(r,this))},AnimationItem.prototype.triggerRenderFrameError=function(r){var e=new BMRenderFrameErrorEvent(r,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)},AnimationItem.prototype.triggerConfigError=function(r){var e=new BMConfigErrorEvent(r,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)};var animationManager=function(){var r={},e=[],t=0,i=0,s=0,n=!0,a=!1;function o(L){for(var D=0,b=L.target;D<i;)e[D].animation===b&&(e.splice(D,1),D-=1,i-=1,b.isPaused||d()),D+=1}function l(L,D){if(!L)return null;for(var b=0;b<i;){if(e[b].elem===L&&e[b].elem!==null)return e[b].animation;b+=1}var C=new AnimationItem;return u(C,L),C.setData(L,D),C}function c(){var L,D=e.length,b=[];for(L=0;L<D;L+=1)b.push(e[L].animation);return b}function f(){s+=1,M()}function d(){s-=1}function u(L,D){L.addEventListener("destroy",o),L.addEventListener("_active",f),L.addEventListener("_idle",d),e.push({elem:D,animation:L}),i+=1}function g(L){var D=new AnimationItem;return u(D,null),D.setParams(L),D}function p(L,D){var b;for(b=0;b<i;b+=1)e[b].animation.setSpeed(L,D)}function m(L,D){var b;for(b=0;b<i;b+=1)e[b].animation.setDirection(L,D)}function S(L){var D;for(D=0;D<i;D+=1)e[D].animation.play(L)}function y(L){var D=L-t,b;for(b=0;b<i;b+=1)e[b].animation.advanceTime(D);t=L,s&&!a?window.requestAnimationFrame(y):n=!0}function x(L){t=L,window.requestAnimationFrame(y)}function E(L){var D;for(D=0;D<i;D+=1)e[D].animation.pause(L)}function T(L,D,b){var C;for(C=0;C<i;C+=1)e[C].animation.goToAndStop(L,D,b)}function A(L){var D;for(D=0;D<i;D+=1)e[D].animation.stop(L)}function _(L){var D;for(D=0;D<i;D+=1)e[D].animation.togglePause(L)}function P(L){var D;for(D=i-1;D>=0;D-=1)e[D].animation.destroy(L)}function k(L,D,b){var C=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),I,R=C.length;for(I=0;I<R;I+=1)b&&C[I].setAttribute("data-bm-type",b),l(C[I],L);if(D&&R===0){b||(b="svg");var V=document.getElementsByTagName("body")[0];V.innerText="";var $=createTag("div");$.style.width="100%",$.style.height="100%",$.setAttribute("data-bm-type",b),V.appendChild($),l($,L)}}function F(){var L;for(L=0;L<i;L+=1)e[L].animation.resize()}function M(){!a&&s&&n&&(window.requestAnimationFrame(x),n=!1)}function B(){a=!0}function N(){a=!1,M()}function G(L,D){var b;for(b=0;b<i;b+=1)e[b].animation.setVolume(L,D)}function U(L){var D;for(D=0;D<i;D+=1)e[D].animation.mute(L)}function O(L){var D;for(D=0;D<i;D+=1)e[D].animation.unmute(L)}return r.registerAnimation=l,r.loadAnimation=g,r.setSpeed=p,r.setDirection=m,r.play=S,r.pause=E,r.stop=A,r.togglePause=_,r.searchAnimations=k,r.resize=F,r.goToAndStop=T,r.destroy=P,r.freeze=B,r.unfreeze=N,r.setVolume=G,r.mute=U,r.unmute=O,r.getRegisteredAnimations=c,r}(),BezierFactory=function(){var r={};r.getBezierEasing=t;var e={};function t(x,E,T,A,_){var P=_||("bez_"+x+"_"+E+"_"+T+"_"+A).replace(/\./g,"p");if(e[P])return e[P];var k=new y([x,E,T,A]);return e[P]=k,k}var i=4,s=.001,n=1e-7,a=10,o=11,l=1/(o-1),c=typeof Float32Array=="function";function f(x,E){return 1-3*E+3*x}function d(x,E){return 3*E-6*x}function u(x){return 3*x}function g(x,E,T){return((f(E,T)*x+d(E,T))*x+u(E))*x}function p(x,E,T){return 3*f(E,T)*x*x+2*d(E,T)*x+u(E)}function m(x,E,T,A,_){var P,k,F=0;do k=E+(T-E)/2,P=g(k,A,_)-x,P>0?T=k:E=k;while(Math.abs(P)>n&&++F<a);return k}function S(x,E,T,A){for(var _=0;_<i;++_){var P=p(E,T,A);if(P===0)return E;var k=g(E,T,A)-x;E-=k/P}return E}function y(x){this._p=x,this._mSampleValues=c?new Float32Array(o):new Array(o),this._precomputed=!1,this.get=this.get.bind(this)}return y.prototype={get:function(E){var T=this._p[0],A=this._p[1],_=this._p[2],P=this._p[3];return this._precomputed||this._precompute(),T===A&&_===P?E:E===0?0:E===1?1:g(this._getTForX(E),A,P)},_precompute:function(){var E=this._p[0],T=this._p[1],A=this._p[2],_=this._p[3];this._precomputed=!0,(E!==T||A!==_)&&this._calcSampleValues()},_calcSampleValues:function(){for(var E=this._p[0],T=this._p[2],A=0;A<o;++A)this._mSampleValues[A]=g(A*l,E,T)},_getTForX:function(E){for(var T=this._p[0],A=this._p[2],_=this._mSampleValues,P=0,k=1,F=o-1;k!==F&&_[k]<=E;++k)P+=l;--k;var M=(E-_[k])/(_[k+1]-_[k]),B=P+M*l,N=p(B,T,A);return N>=s?S(E,B,T,A):N===0?B:m(E,P,P+l,T,A)}},r}(),pooling=function(){function r(e){return e.concat(createSizedArray(e.length))}return{double:r}}(),poolFactory=function(){return function(r,e,t){var i=0,s=r,n=createSizedArray(s),a={newElement:o,release:l};function o(){var c;return i?(i-=1,c=n[i]):c=e(),c}function l(c){i===s&&(n=pooling.double(n),s*=2),t&&t(c),n[i]=c,i+=1}return a}}(),bezierLengthPool=function(){function r(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,r)}(),segmentsLengthPool=function(){function r(){return{lengths:[],totalLength:0}}function e(t){var i,s=t.lengths.length;for(i=0;i<s;i+=1)bezierLengthPool.release(t.lengths[i]);t.lengths.length=0}return poolFactory(8,r,e)}();function bezFunction(){var r=Math;function e(u,g,p,m,S,y){var x=u*m+g*S+p*y-S*m-y*u-p*g;return x>-.001&&x<.001}function t(u,g,p,m,S,y,x,E,T){if(p===0&&y===0&&T===0)return e(u,g,m,S,x,E);var A=r.sqrt(r.pow(m-u,2)+r.pow(S-g,2)+r.pow(y-p,2)),_=r.sqrt(r.pow(x-u,2)+r.pow(E-g,2)+r.pow(T-p,2)),P=r.sqrt(r.pow(x-m,2)+r.pow(E-S,2)+r.pow(T-y,2)),k;return A>_?A>P?k=A-_-P:k=P-_-A:P>_?k=P-_-A:k=_-A-P,k>-1e-4&&k<1e-4}var i=function(){return function(u,g,p,m){var S=getDefaultCurveSegments(),y,x,E,T,A,_=0,P,k=[],F=[],M=bezierLengthPool.newElement();for(E=p.length,y=0;y<S;y+=1){for(A=y/(S-1),P=0,x=0;x<E;x+=1)T=bmPow(1-A,3)*u[x]+3*bmPow(1-A,2)*A*p[x]+3*(1-A)*bmPow(A,2)*m[x]+bmPow(A,3)*g[x],k[x]=T,F[x]!==null&&(P+=bmPow(k[x]-F[x],2)),F[x]=k[x];P&&(P=bmSqrt(P),_+=P),M.percents[y]=A,M.lengths[y]=_}return M.addedLength=_,M}}();function s(u){var g=segmentsLengthPool.newElement(),p=u.c,m=u.v,S=u.o,y=u.i,x,E=u._length,T=g.lengths,A=0;for(x=0;x<E-1;x+=1)T[x]=i(m[x],m[x+1],S[x],y[x+1]),A+=T[x].addedLength;return p&&E&&(T[x]=i(m[x],m[0],S[x],y[0]),A+=T[x].addedLength),g.totalLength=A,g}function n(u){this.segmentLength=0,this.points=new Array(u)}function a(u,g){this.partialLength=u,this.point=g}var o=function(){var u={};return function(g,p,m,S){var y=(g[0]+"_"+g[1]+"_"+p[0]+"_"+p[1]+"_"+m[0]+"_"+m[1]+"_"+S[0]+"_"+S[1]).replace(/\./g,"p");if(!u[y]){var x=getDefaultCurveSegments(),E,T,A,_,P,k=0,F,M,B=null;g.length===2&&(g[0]!==p[0]||g[1]!==p[1])&&e(g[0],g[1],p[0],p[1],g[0]+m[0],g[1]+m[1])&&e(g[0],g[1],p[0],p[1],p[0]+S[0],p[1]+S[1])&&(x=2);var N=new n(x);for(A=m.length,E=0;E<x;E+=1){for(M=createSizedArray(A),P=E/(x-1),F=0,T=0;T<A;T+=1)_=bmPow(1-P,3)*g[T]+3*bmPow(1-P,2)*P*(g[T]+m[T])+3*(1-P)*bmPow(P,2)*(p[T]+S[T])+bmPow(P,3)*p[T],M[T]=_,B!==null&&(F+=bmPow(M[T]-B[T],2));F=bmSqrt(F),k+=F,N.points[E]=new a(F,M),B=M}N.segmentLength=k,u[y]=N}return u[y]}}();function l(u,g){var p=g.percents,m=g.lengths,S=p.length,y=bmFloor((S-1)*u),x=u*g.addedLength,E=0;if(y===S-1||y===0||x===m[y])return p[y];for(var T=m[y]>x?-1:1,A=!0;A;)if(m[y]<=x&&m[y+1]>x?(E=(x-m[y])/(m[y+1]-m[y]),A=!1):y+=T,y<0||y>=S-1){if(y===S-1)return p[y];A=!1}return p[y]+(p[y+1]-p[y])*E}function c(u,g,p,m,S,y){var x=l(S,y),E=1-x,T=r.round((E*E*E*u[0]+(x*E*E+E*x*E+E*E*x)*p[0]+(x*x*E+E*x*x+x*E*x)*m[0]+x*x*x*g[0])*1e3)/1e3,A=r.round((E*E*E*u[1]+(x*E*E+E*x*E+E*E*x)*p[1]+(x*x*E+E*x*x+x*E*x)*m[1]+x*x*x*g[1])*1e3)/1e3;return[T,A]}var f=createTypedArray("float32",8);function d(u,g,p,m,S,y,x){S<0?S=0:S>1&&(S=1);var E=l(S,x);y=y>1?1:y;var T=l(y,x),A,_=u.length,P=1-E,k=1-T,F=P*P*P,M=E*P*P*3,B=E*E*P*3,N=E*E*E,G=P*P*k,U=E*P*k+P*E*k+P*P*T,O=E*E*k+P*E*T+E*P*T,L=E*E*T,D=P*k*k,b=E*k*k+P*T*k+P*k*T,C=E*T*k+P*T*T+E*k*T,I=E*T*T,R=k*k*k,V=T*k*k+k*T*k+k*k*T,$=T*T*k+k*T*T+T*k*T,H=T*T*T;for(A=0;A<_;A+=1)f[A*4]=r.round((F*u[A]+M*p[A]+B*m[A]+N*g[A])*1e3)/1e3,f[A*4+1]=r.round((G*u[A]+U*p[A]+O*m[A]+L*g[A])*1e3)/1e3,f[A*4+2]=r.round((D*u[A]+b*p[A]+C*m[A]+I*g[A])*1e3)/1e3,f[A*4+3]=r.round((R*u[A]+V*p[A]+$*m[A]+H*g[A])*1e3)/1e3;return f}return{getSegmentsLength:s,getNewSegment:d,getPointInSegment:c,buildBezierData:o,pointOnLine2D:e,pointOnLine3D:t}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(r,e){var t=this.offsetTime,i;this.propType==="multidimensional"&&(i=createTypedArray("float32",this.pv.length));for(var s=e.lastIndex,n=s,a=this.keyframes.length-1,o=!0,l,c,f;o;){if(l=this.keyframes[n],c=this.keyframes[n+1],n===a-1&&r>=c.t-t){l.h&&(l=c),s=0;break}if(c.t-t>r){s=n;break}n<a-1?n+=1:(s=0,o=!1)}f=this.keyframesMetadata[n]||{};var d,u,g,p,m,S,y=c.t-t,x=l.t-t,E;if(l.to){f.bezierData||(f.bezierData=bez.buildBezierData(l.s,c.s||l.e,l.to,l.ti));var T=f.bezierData;if(r>=y||r<x){var A=r>=y?T.points.length-1:0;for(u=T.points[A].point.length,d=0;d<u;d+=1)i[d]=T.points[A].point[d]}else{f.__fnct?S=f.__fnct:(S=BezierFactory.getBezierEasing(l.o.x,l.o.y,l.i.x,l.i.y,l.n).get,f.__fnct=S),g=S((r-x)/(y-x));var _=T.segmentLength*g,P,k=e.lastFrame<r&&e._lastKeyframeIndex===n?e._lastAddedLength:0;for(m=e.lastFrame<r&&e._lastKeyframeIndex===n?e._lastPoint:0,o=!0,p=T.points.length;o;){if(k+=T.points[m].partialLength,_===0||g===0||m===T.points.length-1){for(u=T.points[m].point.length,d=0;d<u;d+=1)i[d]=T.points[m].point[d];break}else if(_>=k&&_<k+T.points[m+1].partialLength){for(P=(_-k)/T.points[m+1].partialLength,u=T.points[m].point.length,d=0;d<u;d+=1)i[d]=T.points[m].point[d]+(T.points[m+1].point[d]-T.points[m].point[d])*P;break}m<p-1?m+=1:o=!1}e._lastPoint=m,e._lastAddedLength=k-T.points[m].partialLength,e._lastKeyframeIndex=n}}else{var F,M,B,N,G;if(a=l.s.length,E=c.s||l.e,this.sh&&l.h!==1)if(r>=y)i[0]=E[0],i[1]=E[1],i[2]=E[2];else if(r<=x)i[0]=l.s[0],i[1]=l.s[1],i[2]=l.s[2];else{var U=createQuaternion(l.s),O=createQuaternion(E),L=(r-x)/(y-x);quaternionToEuler(i,slerp(U,O,L))}else for(n=0;n<a;n+=1)l.h!==1&&(r>=y?g=1:r<x?g=0:(l.o.x.constructor===Array?(f.__fnct||(f.__fnct=[]),f.__fnct[n]?S=f.__fnct[n]:(F=l.o.x[n]===void 0?l.o.x[0]:l.o.x[n],M=l.o.y[n]===void 0?l.o.y[0]:l.o.y[n],B=l.i.x[n]===void 0?l.i.x[0]:l.i.x[n],N=l.i.y[n]===void 0?l.i.y[0]:l.i.y[n],S=BezierFactory.getBezierEasing(F,M,B,N).get,f.__fnct[n]=S)):f.__fnct?S=f.__fnct:(F=l.o.x,M=l.o.y,B=l.i.x,N=l.i.y,S=BezierFactory.getBezierEasing(F,M,B,N).get,l.keyframeMetadata=S),g=S((r-x)/(y-x)))),E=c.s||l.e,G=l.h===1?l.s[n]:l.s[n]+(E[n]-l.s[n])*g,this.propType==="multidimensional"?i[n]=G:i=G}return e.lastIndex=s,i}function slerp(r,e,t){var i=[],s=r[0],n=r[1],a=r[2],o=r[3],l=e[0],c=e[1],f=e[2],d=e[3],u,g,p,m,S;return g=s*l+n*c+a*f+o*d,g<0&&(g=-g,l=-l,c=-c,f=-f,d=-d),1-g>1e-6?(u=Math.acos(g),p=Math.sin(u),m=Math.sin((1-t)*u)/p,S=Math.sin(t*u)/p):(m=1-t,S=t),i[0]=m*s+S*l,i[1]=m*n+S*c,i[2]=m*a+S*f,i[3]=m*o+S*d,i}function quaternionToEuler(r,e){var t=e[0],i=e[1],s=e[2],n=e[3],a=Math.atan2(2*i*n-2*t*s,1-2*i*i-2*s*s),o=Math.asin(2*t*i+2*s*n),l=Math.atan2(2*t*n-2*i*s,1-2*t*t-2*s*s);r[0]=a/degToRads,r[1]=o/degToRads,r[2]=l/degToRads}function createQuaternion(r){var e=r[0]*degToRads,t=r[1]*degToRads,i=r[2]*degToRads,s=Math.cos(e/2),n=Math.cos(t/2),a=Math.cos(i/2),o=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(i/2),f=s*n*a-o*l*c,d=o*l*a+s*n*c,u=o*n*a+s*l*c,g=s*l*a-o*n*c;return[d,u,g,f]}function getValueAtCurrentTime(){var r=this.comp.renderedFrame-this.offsetTime,e=this.keyframes[0].t-this.offsetTime,t=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(r===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=t&&r>=t||this._caching.lastFrame<e&&r<e))){this._caching.lastFrame>=r&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var i=this.interpolateValue(r,this._caching);this.pv=i}return this._caching.lastFrame=r,this.pv}function setVValue(r){var e;if(this.propType==="unidimensional")e=r*this.mult,mathAbs(this.v-e)>1e-5&&(this.v=e,this._mdf=!0);else for(var t=0,i=this.v.length;t<i;)e=r[t]*this.mult,mathAbs(this.v[t]-e)>1e-5&&(this.v[t]=e,this._mdf=!0),t+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var r,e=this.effectsSequence.length,t=this.kf?this.pv:this.data.k;for(r=0;r<e;r+=1)t=this.effectsSequence[r](t);this.setVValue(t),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(r){this.effectsSequence.push(r),this.container.addDynamicProperty(this)}function ValueProperty(r,e,t,i){this.propType="unidimensional",this.mult=t||1,this.data=e,this.v=t?e.k*t:e.k,this.pv=e.k,this._mdf=!1,this.elem=r,this.container=i,this.comp=r.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(r,e,t,i){this.propType="multidimensional",this.mult=t||1,this.data=e,this._mdf=!1,this.elem=r,this.container=i,this.comp=r.comp,this.k=!1,this.kf=!1,this.frameId=-1;var s,n=e.k.length;for(this.v=createTypedArray("float32",n),this.pv=createTypedArray("float32",n),this.vel=createTypedArray("float32",n),s=0;s<n;s+=1)this.v[s]=e.k[s]*this.mult,this.pv[s]=e.k[s];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(r,e,t,i){this.propType="unidimensional",this.keyframes=e.k,this.keyframesMetadata=[],this.offsetTime=r.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=e,this.mult=t||1,this.elem=r,this.container=i,this.comp=r.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(r,e,t,i){this.propType="multidimensional";var s,n=e.k.length,a,o,l,c;for(s=0;s<n-1;s+=1)e.k[s].to&&e.k[s].s&&e.k[s+1]&&e.k[s+1].s&&(a=e.k[s].s,o=e.k[s+1].s,l=e.k[s].to,c=e.k[s].ti,(a.length===2&&!(a[0]===o[0]&&a[1]===o[1])&&bez.pointOnLine2D(a[0],a[1],o[0],o[1],a[0]+l[0],a[1]+l[1])&&bez.pointOnLine2D(a[0],a[1],o[0],o[1],o[0]+c[0],o[1]+c[1])||a.length===3&&!(a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2])&&bez.pointOnLine3D(a[0],a[1],a[2],o[0],o[1],o[2],a[0]+l[0],a[1]+l[1],a[2]+l[2])&&bez.pointOnLine3D(a[0],a[1],a[2],o[0],o[1],o[2],o[0]+c[0],o[1]+c[1],o[2]+c[2]))&&(e.k[s].to=null,e.k[s].ti=null),a[0]===o[0]&&a[1]===o[1]&&l[0]===0&&l[1]===0&&c[0]===0&&c[1]===0&&(a.length===2||a[2]===o[2]&&l[2]===0&&c[2]===0)&&(e.k[s].to=null,e.k[s].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=e,this.keyframes=e.k,this.keyframesMetadata=[],this.offsetTime=r.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=t||1,this.elem=r,this.container=i,this.comp=r.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var f=e.k[0].s.length;for(this.v=createTypedArray("float32",f),this.pv=createTypedArray("float32",f),s=0;s<f;s+=1)this.v[s]=initFrame,this.pv[s]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",f)},this.addEffect=addEffect}var PropertyFactory=function(){function r(t,i,s,n,a){i.sid&&(i=t.globalData.slotManager.getProp(i));var o;if(!i.k.length)o=new ValueProperty(t,i,n,a);else if(typeof i.k[0]=="number")o=new MultiDimensionalProperty(t,i,n,a);else switch(s){case 0:o=new KeyframedValueProperty(t,i,n,a);break;case 1:o=new KeyframedMultidimensionalProperty(t,i,n,a);break}return o.effectsSequence.length&&a.addDynamicProperty(o),o}var e={getProp:r};return e}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(e){this.dynamicProperties.indexOf(e)===-1&&(this.dynamicProperties.push(e),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var e,t=this.dynamicProperties.length;for(e=0;e<t;e+=1)this.dynamicProperties[e].getValue(),this.dynamicProperties[e]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(e){this.container=e,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function r(){return createTypedArray("float32",2)}return poolFactory(8,r)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(r,e){this.c=r,this.setLength(e);for(var t=0;t<e;)this.v[t]=pointPool.newElement(),this.o[t]=pointPool.newElement(),this.i[t]=pointPool.newElement(),t+=1},ShapePath.prototype.setLength=function(r){for(;this._maxLength<r;)this.doubleArrayLength();this._length=r},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(r,e,t,i,s){var n;switch(this._length=Math.max(this._length,i+1),this._length>=this._maxLength&&this.doubleArrayLength(),t){case"v":n=this.v;break;case"i":n=this.i;break;case"o":n=this.o;break;default:n=[];break}(!n[i]||n[i]&&!s)&&(n[i]=pointPool.newElement()),n[i][0]=r,n[i][1]=e},ShapePath.prototype.setTripleAt=function(r,e,t,i,s,n,a,o){this.setXYAt(r,e,"v",a,o),this.setXYAt(t,i,"o",a,o),this.setXYAt(s,n,"i",a,o)},ShapePath.prototype.reverse=function(){var r=new ShapePath;r.setPathData(this.c,this._length);var e=this.v,t=this.o,i=this.i,s=0;this.c&&(r.setTripleAt(e[0][0],e[0][1],i[0][0],i[0][1],t[0][0],t[0][1],0,!1),s=1);var n=this._length-1,a=this._length,o;for(o=s;o<a;o+=1)r.setTripleAt(e[n][0],e[n][1],i[n][0],i[n][1],t[n][0],t[n][1],o,!1),n-=1;return r},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function r(){return new ShapePath}function e(s){var n=s._length,a;for(a=0;a<n;a+=1)pointPool.release(s.v[a]),pointPool.release(s.i[a]),pointPool.release(s.o[a]),s.v[a]=null,s.i[a]=null,s.o[a]=null;s._length=0,s.c=!1}function t(s){var n=i.newElement(),a,o=s._length===void 0?s.v.length:s._length;for(n.setLength(o),n.c=s.c,a=0;a<o;a+=1)n.setTripleAt(s.v[a][0],s.v[a][1],s.o[a][0],s.o[a][1],s.i[a][0],s.i[a][1],a);return n}var i=poolFactory(4,r,e);return i.clone=t,i}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(r){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=r,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var r;for(r=0;r<this._length;r+=1)shapePool.release(this.shapes[r]);this._length=0};var shapeCollectionPool=function(){var r={newShapeCollection:s,release:n},e=0,t=4,i=createSizedArray(t);function s(){var a;return e?(e-=1,a=i[e]):a=new ShapeCollection,a}function n(a){var o,l=a._length;for(o=0;o<l;o+=1)shapePool.release(a.shapes[o]);a._length=0,e===t&&(i=pooling.double(i),t*=2),i[e]=a,e+=1}return r}(),ShapePropertyFactory=function(){var r=-999999;function e(y,x,E){var T=E.lastIndex,A,_,P,k,F,M,B,N,G,U=this.keyframes;if(y<U[0].t-this.offsetTime)A=U[0].s[0],P=!0,T=0;else if(y>=U[U.length-1].t-this.offsetTime)A=U[U.length-1].s?U[U.length-1].s[0]:U[U.length-2].e[0],P=!0;else{for(var O=T,L=U.length-1,D=!0,b,C,I;D&&(b=U[O],C=U[O+1],!(C.t-this.offsetTime>y));)O<L-1?O+=1:D=!1;if(I=this.keyframesMetadata[O]||{},P=b.h===1,T=O,!P){if(y>=C.t-this.offsetTime)N=1;else if(y<b.t-this.offsetTime)N=0;else{var R;I.__fnct?R=I.__fnct:(R=BezierFactory.getBezierEasing(b.o.x,b.o.y,b.i.x,b.i.y).get,I.__fnct=R),N=R((y-(b.t-this.offsetTime))/(C.t-this.offsetTime-(b.t-this.offsetTime)))}_=C.s?C.s[0]:b.e[0]}A=b.s[0]}for(M=x._length,B=A.i[0].length,E.lastIndex=T,k=0;k<M;k+=1)for(F=0;F<B;F+=1)G=P?A.i[k][F]:A.i[k][F]+(_.i[k][F]-A.i[k][F])*N,x.i[k][F]=G,G=P?A.o[k][F]:A.o[k][F]+(_.o[k][F]-A.o[k][F])*N,x.o[k][F]=G,G=P?A.v[k][F]:A.v[k][F]+(_.v[k][F]-A.v[k][F])*N,x.v[k][F]=G}function t(){var y=this.comp.renderedFrame-this.offsetTime,x=this.keyframes[0].t-this.offsetTime,E=this.keyframes[this.keyframes.length-1].t-this.offsetTime,T=this._caching.lastFrame;return T!==r&&(T<x&&y<x||T>E&&y>E)||(this._caching.lastIndex=T<y?this._caching.lastIndex:0,this.interpolateShape(y,this.pv,this._caching)),this._caching.lastFrame=y,this.pv}function i(){this.paths=this.localShapeCollection}function s(y,x){if(y._length!==x._length||y.c!==x.c)return!1;var E,T=y._length;for(E=0;E<T;E+=1)if(y.v[E][0]!==x.v[E][0]||y.v[E][1]!==x.v[E][1]||y.o[E][0]!==x.o[E][0]||y.o[E][1]!==x.o[E][1]||y.i[E][0]!==x.i[E][0]||y.i[E][1]!==x.i[E][1])return!1;return!0}function n(y){s(this.v,y)||(this.v=shapePool.clone(y),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function a(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var y;this.kf?y=this.pv:this.data.ks?y=this.data.ks.k:y=this.data.pt.k;var x,E=this.effectsSequence.length;for(x=0;x<E;x+=1)y=this.effectsSequence[x](y);this.setVValue(y),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function o(y,x,E){this.propType="shape",this.comp=y.comp,this.container=y,this.elem=y,this.data=x,this.k=!1,this.kf=!1,this._mdf=!1;var T=E===3?x.pt.k:x.ks.k;this.v=shapePool.clone(T),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=i,this.effectsSequence=[]}function l(y){this.effectsSequence.push(y),this.container.addDynamicProperty(this)}o.prototype.interpolateShape=e,o.prototype.getValue=a,o.prototype.setVValue=n,o.prototype.addEffect=l;function c(y,x,E){this.propType="shape",this.comp=y.comp,this.elem=y,this.container=y,this.offsetTime=y.data.st,this.keyframes=E===3?x.pt.k:x.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var T=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,T),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=r,this.reset=i,this._caching={lastFrame:r,lastIndex:0},this.effectsSequence=[t.bind(this)]}c.prototype.getValue=a,c.prototype.interpolateShape=e,c.prototype.setVValue=n,c.prototype.addEffect=l;var f=function(){var y=roundCorner;function x(E,T){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=T.d,this.elem=E,this.comp=E.comp,this.frameId=-1,this.initDynamicPropertyContainer(E),this.p=PropertyFactory.getProp(E,T.p,1,0,this),this.s=PropertyFactory.getProp(E,T.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return x.prototype={reset:i,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var T=this.p.v[0],A=this.p.v[1],_=this.s.v[0]/2,P=this.s.v[1]/2,k=this.d!==3,F=this.v;F.v[0][0]=T,F.v[0][1]=A-P,F.v[1][0]=k?T+_:T-_,F.v[1][1]=A,F.v[2][0]=T,F.v[2][1]=A+P,F.v[3][0]=k?T-_:T+_,F.v[3][1]=A,F.i[0][0]=k?T-_*y:T+_*y,F.i[0][1]=A-P,F.i[1][0]=k?T+_:T-_,F.i[1][1]=A-P*y,F.i[2][0]=k?T+_*y:T-_*y,F.i[2][1]=A+P,F.i[3][0]=k?T-_:T+_,F.i[3][1]=A+P*y,F.o[0][0]=k?T+_*y:T-_*y,F.o[0][1]=A-P,F.o[1][0]=k?T+_:T-_,F.o[1][1]=A+P*y,F.o[2][0]=k?T-_*y:T+_*y,F.o[2][1]=A+P,F.o[3][0]=k?T-_:T+_,F.o[3][1]=A-P*y}},extendPrototype([DynamicPropertyContainer],x),x}(),d=function(){function y(x,E){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=x,this.comp=x.comp,this.data=E,this.frameId=-1,this.d=E.d,this.initDynamicPropertyContainer(x),E.sy===1?(this.ir=PropertyFactory.getProp(x,E.ir,0,0,this),this.is=PropertyFactory.getProp(x,E.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(x,E.pt,0,0,this),this.p=PropertyFactory.getProp(x,E.p,1,0,this),this.r=PropertyFactory.getProp(x,E.r,0,degToRads,this),this.or=PropertyFactory.getProp(x,E.or,0,0,this),this.os=PropertyFactory.getProp(x,E.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return y.prototype={reset:i,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var E=Math.floor(this.pt.v)*2,T=Math.PI*2/E,A=!0,_=this.or.v,P=this.ir.v,k=this.os.v,F=this.is.v,M=2*Math.PI*_/(E*2),B=2*Math.PI*P/(E*2),N,G,U,O,L=-Math.PI/2;L+=this.r.v;var D=this.data.d===3?-1:1;for(this.v._length=0,N=0;N<E;N+=1){G=A?_:P,U=A?k:F,O=A?M:B;var b=G*Math.cos(L),C=G*Math.sin(L),I=b===0&&C===0?0:C/Math.sqrt(b*b+C*C),R=b===0&&C===0?0:-b/Math.sqrt(b*b+C*C);b+=+this.p.v[0],C+=+this.p.v[1],this.v.setTripleAt(b,C,b-I*O*U*D,C-R*O*U*D,b+I*O*U*D,C+R*O*U*D,N,!0),A=!A,L+=T*D}},convertPolygonToPath:function(){var E=Math.floor(this.pt.v),T=Math.PI*2/E,A=this.or.v,_=this.os.v,P=2*Math.PI*A/(E*4),k,F=-Math.PI*.5,M=this.data.d===3?-1:1;for(F+=this.r.v,this.v._length=0,k=0;k<E;k+=1){var B=A*Math.cos(F),N=A*Math.sin(F),G=B===0&&N===0?0:N/Math.sqrt(B*B+N*N),U=B===0&&N===0?0:-B/Math.sqrt(B*B+N*N);B+=+this.p.v[0],N+=+this.p.v[1],this.v.setTripleAt(B,N,B-G*P*_*M,N-U*P*_*M,B+G*P*_*M,N+U*P*_*M,k,!0),F+=T*M}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],y),y}(),u=function(){function y(x,E){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=x,this.comp=x.comp,this.frameId=-1,this.d=E.d,this.initDynamicPropertyContainer(x),this.p=PropertyFactory.getProp(x,E.p,1,0,this),this.s=PropertyFactory.getProp(x,E.s,1,0,this),this.r=PropertyFactory.getProp(x,E.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return y.prototype={convertRectToPath:function(){var E=this.p.v[0],T=this.p.v[1],A=this.s.v[0]/2,_=this.s.v[1]/2,P=bmMin(A,_,this.r.v),k=P*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(E+A,T-_+P,E+A,T-_+P,E+A,T-_+k,0,!0),this.v.setTripleAt(E+A,T+_-P,E+A,T+_-k,E+A,T+_-P,1,!0),P!==0?(this.v.setTripleAt(E+A-P,T+_,E+A-P,T+_,E+A-k,T+_,2,!0),this.v.setTripleAt(E-A+P,T+_,E-A+k,T+_,E-A+P,T+_,3,!0),this.v.setTripleAt(E-A,T+_-P,E-A,T+_-P,E-A,T+_-k,4,!0),this.v.setTripleAt(E-A,T-_+P,E-A,T-_+k,E-A,T-_+P,5,!0),this.v.setTripleAt(E-A+P,T-_,E-A+P,T-_,E-A+k,T-_,6,!0),this.v.setTripleAt(E+A-P,T-_,E+A-k,T-_,E+A-P,T-_,7,!0)):(this.v.setTripleAt(E-A,T+_,E-A+k,T+_,E-A,T+_,2),this.v.setTripleAt(E-A,T-_,E-A,T-_+k,E-A,T-_,3))):(this.v.setTripleAt(E+A,T-_+P,E+A,T-_+k,E+A,T-_+P,0,!0),P!==0?(this.v.setTripleAt(E+A-P,T-_,E+A-P,T-_,E+A-k,T-_,1,!0),this.v.setTripleAt(E-A+P,T-_,E-A+k,T-_,E-A+P,T-_,2,!0),this.v.setTripleAt(E-A,T-_+P,E-A,T-_+P,E-A,T-_+k,3,!0),this.v.setTripleAt(E-A,T+_-P,E-A,T+_-k,E-A,T+_-P,4,!0),this.v.setTripleAt(E-A+P,T+_,E-A+P,T+_,E-A+k,T+_,5,!0),this.v.setTripleAt(E+A-P,T+_,E+A-k,T+_,E+A-P,T+_,6,!0),this.v.setTripleAt(E+A,T+_-P,E+A,T+_-P,E+A,T+_-k,7,!0)):(this.v.setTripleAt(E-A,T-_,E-A+k,T-_,E-A,T-_,1,!0),this.v.setTripleAt(E-A,T+_,E-A,T+_-k,E-A,T+_,2,!0),this.v.setTripleAt(E+A,T+_,E+A-k,T+_,E+A,T+_,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:i},extendPrototype([DynamicPropertyContainer],y),y}();function g(y,x,E){var T;if(E===3||E===4){var A=E===3?x.pt:x.ks,_=A.k;_.length?T=new c(y,x,E):T=new o(y,x,E)}else E===5?T=new u(y,x):E===6?T=new f(y,x):E===7&&(T=new d(y,x));return T.k&&y.addDynamicProperty(T),T}function p(){return o}function m(){return c}var S={};return S.getShapeProp=g,S.getConstructorFunction=p,S.getKeyframedConstructorFunction=m,S}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var r=Math.cos,e=Math.sin,t=Math.tan,i=Math.round;function s(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function n(b){if(b===0)return this;var C=r(b),I=e(b);return this._t(C,-I,0,0,I,C,0,0,0,0,1,0,0,0,0,1)}function a(b){if(b===0)return this;var C=r(b),I=e(b);return this._t(1,0,0,0,0,C,-I,0,0,I,C,0,0,0,0,1)}function o(b){if(b===0)return this;var C=r(b),I=e(b);return this._t(C,0,I,0,0,1,0,0,-I,0,C,0,0,0,0,1)}function l(b){if(b===0)return this;var C=r(b),I=e(b);return this._t(C,-I,0,0,I,C,0,0,0,0,1,0,0,0,0,1)}function c(b,C){return this._t(1,C,b,1,0,0)}function f(b,C){return this.shear(t(b),t(C))}function d(b,C){var I=r(C),R=e(C);return this._t(I,R,0,0,-R,I,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,t(b),1,0,0,0,0,1,0,0,0,0,1)._t(I,-R,0,0,R,I,0,0,0,0,1,0,0,0,0,1)}function u(b,C,I){return!I&&I!==0&&(I=1),b===1&&C===1&&I===1?this:this._t(b,0,0,0,0,C,0,0,0,0,I,0,0,0,0,1)}function g(b,C,I,R,V,$,H,z,W,j,Y,Q,Z,X,ee,q){return this.props[0]=b,this.props[1]=C,this.props[2]=I,this.props[3]=R,this.props[4]=V,this.props[5]=$,this.props[6]=H,this.props[7]=z,this.props[8]=W,this.props[9]=j,this.props[10]=Y,this.props[11]=Q,this.props[12]=Z,this.props[13]=X,this.props[14]=ee,this.props[15]=q,this}function p(b,C,I){return I=I||0,b!==0||C!==0||I!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,b,C,I,1):this}function m(b,C,I,R,V,$,H,z,W,j,Y,Q,Z,X,ee,q){var K=this.props;if(b===1&&C===0&&I===0&&R===0&&V===0&&$===1&&H===0&&z===0&&W===0&&j===0&&Y===1&&Q===0)return K[12]=K[12]*b+K[15]*Z,K[13]=K[13]*$+K[15]*X,K[14]=K[14]*Y+K[15]*ee,K[15]*=q,this._identityCalculated=!1,this;var se=K[0],le=K[1],ne=K[2],ie=K[3],ae=K[4],oe=K[5],J=K[6],he=K[7],ce=K[8],te=K[9],fe=K[10],re=K[11],ue=K[12],de=K[13],pe=K[14],me=K[15];return K[0]=se*b+le*V+ne*W+ie*Z,K[1]=se*C+le*$+ne*j+ie*X,K[2]=se*I+le*H+ne*Y+ie*ee,K[3]=se*R+le*z+ne*Q+ie*q,K[4]=ae*b+oe*V+J*W+he*Z,K[5]=ae*C+oe*$+J*j+he*X,K[6]=ae*I+oe*H+J*Y+he*ee,K[7]=ae*R+oe*z+J*Q+he*q,K[8]=ce*b+te*V+fe*W+re*Z,K[9]=ce*C+te*$+fe*j+re*X,K[10]=ce*I+te*H+fe*Y+re*ee,K[11]=ce*R+te*z+fe*Q+re*q,K[12]=ue*b+de*V+pe*W+me*Z,K[13]=ue*C+de*$+pe*j+me*X,K[14]=ue*I+de*H+pe*Y+me*ee,K[15]=ue*R+de*z+pe*Q+me*q,this._identityCalculated=!1,this}function S(b){var C=b.props;return this.transform(C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15])}function y(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function x(b){for(var C=0;C<16;){if(b.props[C]!==this.props[C])return!1;C+=1}return!0}function E(b){var C;for(C=0;C<16;C+=1)b.props[C]=this.props[C];return b}function T(b){var C;for(C=0;C<16;C+=1)this.props[C]=b[C]}function A(b,C,I){return{x:b*this.props[0]+C*this.props[4]+I*this.props[8]+this.props[12],y:b*this.props[1]+C*this.props[5]+I*this.props[9]+this.props[13],z:b*this.props[2]+C*this.props[6]+I*this.props[10]+this.props[14]}}function _(b,C,I){return b*this.props[0]+C*this.props[4]+I*this.props[8]+this.props[12]}function P(b,C,I){return b*this.props[1]+C*this.props[5]+I*this.props[9]+this.props[13]}function k(b,C,I){return b*this.props[2]+C*this.props[6]+I*this.props[10]+this.props[14]}function F(){var b=this.props[0]*this.props[5]-this.props[1]*this.props[4],C=this.props[5]/b,I=-this.props[1]/b,R=-this.props[4]/b,V=this.props[0]/b,$=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/b,H=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/b,z=new Matrix;return z.props[0]=C,z.props[1]=I,z.props[4]=R,z.props[5]=V,z.props[12]=$,z.props[13]=H,z}function M(b){var C=this.getInverseMatrix();return C.applyToPointArray(b[0],b[1],b[2]||0)}function B(b){var C,I=b.length,R=[];for(C=0;C<I;C+=1)R[C]=M(b[C]);return R}function N(b,C,I){var R=createTypedArray("float32",6);if(this.isIdentity())R[0]=b[0],R[1]=b[1],R[2]=C[0],R[3]=C[1],R[4]=I[0],R[5]=I[1];else{var V=this.props[0],$=this.props[1],H=this.props[4],z=this.props[5],W=this.props[12],j=this.props[13];R[0]=b[0]*V+b[1]*H+W,R[1]=b[0]*$+b[1]*z+j,R[2]=C[0]*V+C[1]*H+W,R[3]=C[0]*$+C[1]*z+j,R[4]=I[0]*V+I[1]*H+W,R[5]=I[0]*$+I[1]*z+j}return R}function G(b,C,I){var R;return this.isIdentity()?R=[b,C,I]:R=[b*this.props[0]+C*this.props[4]+I*this.props[8]+this.props[12],b*this.props[1]+C*this.props[5]+I*this.props[9]+this.props[13],b*this.props[2]+C*this.props[6]+I*this.props[10]+this.props[14]],R}function U(b,C){if(this.isIdentity())return b+","+C;var I=this.props;return Math.round((b*I[0]+C*I[4]+I[12])*100)/100+","+Math.round((b*I[1]+C*I[5]+I[13])*100)/100}function O(){for(var b=0,C=this.props,I="matrix3d(",R=1e4;b<16;)I+=i(C[b]*R)/R,I+=b===15?")":",",b+=1;return I}function L(b){var C=1e4;return b<1e-6&&b>0||b>-1e-6&&b<0?i(b*C)/C:b}function D(){var b=this.props,C=L(b[0]),I=L(b[1]),R=L(b[4]),V=L(b[5]),$=L(b[12]),H=L(b[13]);return"matrix("+C+","+I+","+R+","+V+","+$+","+H+")"}return function(){this.reset=s,this.rotate=n,this.rotateX=a,this.rotateY=o,this.rotateZ=l,this.skew=f,this.skewFromAxis=d,this.shear=c,this.scale=u,this.setTransform=g,this.translate=p,this.transform=m,this.multiply=S,this.applyToPoint=A,this.applyToX=_,this.applyToY=P,this.applyToZ=k,this.applyToPointArray=G,this.applyToTriplePoints=N,this.applyToPointStringified=U,this.toCSS=O,this.to2dCSS=D,this.clone=E,this.cloneFromProps=T,this.equals=x,this.inversePoints=B,this.inversePoint=M,this.getInverseMatrix=F,this._t=this.transform,this.isIdentity=y,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$3=function(t){return typeof t}:_typeof$3=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$3(r)}var lottie={};function setLocation(r){setLocationHref(r)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(r){setSubframeEnabled(r)}function setPrefix(r){setIdPrefix(r)}function loadAnimation(r){return animationManager.loadAnimation(r)}function setQuality(r){if(typeof r=="string")switch(r){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(r)&&r>1&&setDefaultCurveSegments(r)}function inBrowser(){return typeof navigator!="undefined"}function installPlugin(r,e){r==="expressions"&&setExpressionsPlugin(e)}function getFactory(r){switch(r){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(r){for(var e=queryString.split("&"),t=0;t<e.length;t+=1){var i=e[t].split("=");if(decodeURIComponent(i[0])==r)return decodeURIComponent(i[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(r){}var ShapeModifiers=function(){var r={},e={};r.registerModifier=t,r.getModifier=i;function t(s,n){e[s]||(e[s]=n)}function i(s,n,a){return new e[s](n,a)}return r}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(r){if(!this.closed){r.sh.container.addDynamicProperty(r.sh);var e={shape:r.sh,data:r,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(e),this.addShapeToModifier(e),this._isAnimated&&r.setAsAnimated()}},ShapeModifier.prototype.init=function(r,e){this.shapes=[],this.elem=r,this.initDynamicPropertyContainer(r),this.initModifierProperties(r,e),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(r,e){this.s=PropertyFactory.getProp(r,e.s,0,.01,this),this.e=PropertyFactory.getProp(r,e.e,0,.01,this),this.o=PropertyFactory.getProp(r,e.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=e.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(r){r.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(r,e,t,i,s){var n=[];e<=1?n.push({s:r,e}):r>=1?n.push({s:r-1,e:e-1}):(n.push({s:r,e:1}),n.push({s:0,e:e-1}));var a=[],o,l=n.length,c;for(o=0;o<l;o+=1)if(c=n[o],!(c.e*s<i||c.s*s>i+t)){var f,d;c.s*s<=i?f=0:f=(c.s*s-i)/t,c.e*s>=i+t?d=1:d=(c.e*s-i)/t,a.push([f,d])}return a.length||a.push([0,0]),a},TrimModifier.prototype.releasePathsData=function(r){var e,t=r.length;for(e=0;e<t;e+=1)segmentsLengthPool.release(r[e]);return r.length=0,r},TrimModifier.prototype.processShapes=function(r){var e,t;if(this._mdf||r){var i=this.o.v%360/360;if(i<0&&(i+=1),this.s.v>1?e=1+i:this.s.v<0?e=0+i:e=this.s.v+i,this.e.v>1?t=1+i:this.e.v<0?t=0+i:t=this.e.v+i,e>t){var s=e;e=t,t=s}e=Math.round(e*1e4)*1e-4,t=Math.round(t*1e4)*1e-4,this.sValue=e,this.eValue=t}else e=this.sValue,t=this.eValue;var n,a,o=this.shapes.length,l,c,f,d,u,g=0;if(t===e)for(a=0;a<o;a+=1)this.shapes[a].localShapeCollection.releaseShapes(),this.shapes[a].shape._mdf=!0,this.shapes[a].shape.paths=this.shapes[a].localShapeCollection,this._mdf&&(this.shapes[a].pathsData.length=0);else if(t===1&&e===0||t===0&&e===1){if(this._mdf)for(a=0;a<o;a+=1)this.shapes[a].pathsData.length=0,this.shapes[a].shape._mdf=!0}else{var p=[],m,S;for(a=0;a<o;a+=1)if(m=this.shapes[a],!m.shape._mdf&&!this._mdf&&!r&&this.m!==2)m.shape.paths=m.localShapeCollection;else{if(n=m.shape.paths,c=n._length,u=0,!m.shape._mdf&&m.pathsData.length)u=m.totalShapeLength;else{for(f=this.releasePathsData(m.pathsData),l=0;l<c;l+=1)d=bez.getSegmentsLength(n.shapes[l]),f.push(d),u+=d.totalLength;m.totalShapeLength=u,m.pathsData=f}g+=u,m.shape._mdf=!0}var y=e,x=t,E=0,T;for(a=o-1;a>=0;a-=1)if(m=this.shapes[a],m.shape._mdf){for(S=m.localShapeCollection,S.releaseShapes(),this.m===2&&o>1?(T=this.calculateShapeEdges(e,t,m.totalShapeLength,E,g),E+=m.totalShapeLength):T=[[y,x]],c=T.length,l=0;l<c;l+=1){y=T[l][0],x=T[l][1],p.length=0,x<=1?p.push({s:m.totalShapeLength*y,e:m.totalShapeLength*x}):y>=1?p.push({s:m.totalShapeLength*(y-1),e:m.totalShapeLength*(x-1)}):(p.push({s:m.totalShapeLength*y,e:m.totalShapeLength}),p.push({s:0,e:m.totalShapeLength*(x-1)}));var A=this.addShapes(m,p[0]);if(p[0].s!==p[0].e){if(p.length>1){var _=m.shape.paths.shapes[m.shape.paths._length-1];if(_.c){var P=A.pop();this.addPaths(A,S),A=this.addShapes(m,p[1],P)}else this.addPaths(A,S),A=this.addShapes(m,p[1])}this.addPaths(A,S)}}m.shape.paths=S}}},TrimModifier.prototype.addPaths=function(r,e){var t,i=r.length;for(t=0;t<i;t+=1)e.addShape(r[t])},TrimModifier.prototype.addSegment=function(r,e,t,i,s,n,a){s.setXYAt(e[0],e[1],"o",n),s.setXYAt(t[0],t[1],"i",n+1),a&&s.setXYAt(r[0],r[1],"v",n),s.setXYAt(i[0],i[1],"v",n+1)},TrimModifier.prototype.addSegmentFromArray=function(r,e,t,i){e.setXYAt(r[1],r[5],"o",t),e.setXYAt(r[2],r[6],"i",t+1),i&&e.setXYAt(r[0],r[4],"v",t),e.setXYAt(r[3],r[7],"v",t+1)},TrimModifier.prototype.addShapes=function(r,e,t){var i=r.pathsData,s=r.shape.paths.shapes,n,a=r.shape.paths._length,o,l,c=0,f,d,u,g,p=[],m,S=!0;for(t?(d=t._length,m=t._length):(t=shapePool.newElement(),d=0,m=0),p.push(t),n=0;n<a;n+=1){for(u=i[n].lengths,t.c=s[n].c,l=s[n].c?u.length:u.length+1,o=1;o<l;o+=1)if(f=u[o-1],c+f.addedLength<e.s)c+=f.addedLength,t.c=!1;else if(c>e.e){t.c=!1;break}else e.s<=c&&e.e>=c+f.addedLength?(this.addSegment(s[n].v[o-1],s[n].o[o-1],s[n].i[o],s[n].v[o],t,d,S),S=!1):(g=bez.getNewSegment(s[n].v[o-1],s[n].v[o],s[n].o[o-1],s[n].i[o],(e.s-c)/f.addedLength,(e.e-c)/f.addedLength,u[o-1]),this.addSegmentFromArray(g,t,d,S),S=!1,t.c=!1),c+=f.addedLength,d+=1;if(s[n].c&&u.length){if(f=u[o-1],c<=e.e){var y=u[o-1].addedLength;e.s<=c&&e.e>=c+y?(this.addSegment(s[n].v[o-1],s[n].o[o-1],s[n].i[0],s[n].v[0],t,d,S),S=!1):(g=bez.getNewSegment(s[n].v[o-1],s[n].v[0],s[n].o[o-1],s[n].i[0],(e.s-c)/y,(e.e-c)/y,u[o-1]),this.addSegmentFromArray(g,t,d,S),S=!1,t.c=!1)}else t.c=!1;c+=f.addedLength,d+=1}if(t._length&&(t.setXYAt(t.v[m][0],t.v[m][1],"i",m),t.setXYAt(t.v[t._length-1][0],t.v[t._length-1][1],"o",t._length-1)),c>e.e)break;n<a-1&&(t=shapePool.newElement(),S=!0,p.push(t),d=0)}return p};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(r,e){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(r,e.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(r,e){var t=e/100,i=[0,0],s=r._length,n=0;for(n=0;n<s;n+=1)i[0]+=r.v[n][0],i[1]+=r.v[n][1];i[0]/=s,i[1]/=s;var a=shapePool.newElement();a.c=r.c;var o,l,c,f,d,u;for(n=0;n<s;n+=1)o=r.v[n][0]+(i[0]-r.v[n][0])*t,l=r.v[n][1]+(i[1]-r.v[n][1])*t,c=r.o[n][0]+(i[0]-r.o[n][0])*-t,f=r.o[n][1]+(i[1]-r.o[n][1])*-t,d=r.i[n][0]+(i[0]-r.i[n][0])*-t,u=r.i[n][1]+(i[1]-r.i[n][1])*-t,a.setTripleAt(o,l,c,f,d,u,n);return a},PuckerAndBloatModifier.prototype.processShapes=function(r){var e,t,i=this.shapes.length,s,n,a=this.amount.v;if(a!==0){var o,l;for(t=0;t<i;t+=1){if(o=this.shapes[t],l=o.localShapeCollection,!(!o.shape._mdf&&!this._mdf&&!r))for(l.releaseShapes(),o.shape._mdf=!0,e=o.shape.paths.shapes,n=o.shape.paths._length,s=0;s<n;s+=1)l.addShape(this.processPath(e[s],a));o.shape.paths=o.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var r=[0,0];function e(l){var c=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||c,this.a&&l.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&l.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&l.skewFromAxis(-this.sk.v,this.sa.v),this.r?l.rotate(-this.r.v):l.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?l.translate(this.px.v,this.py.v,-this.pz.v):l.translate(this.px.v,this.py.v,0):l.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function t(l){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||l){var c;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var f,d;if(c=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(f=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/c,0),d=this.p.getValueAtTime(this.p.keyframes[0].t/c,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(f=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/c,0),d=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/c,0)):(f=this.p.pv,d=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/c,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){f=[],d=[];var u=this.px,g=this.py;u._caching.lastFrame+u.offsetTime<=u.keyframes[0].t?(f[0]=u.getValueAtTime((u.keyframes[0].t+.01)/c,0),f[1]=g.getValueAtTime((g.keyframes[0].t+.01)/c,0),d[0]=u.getValueAtTime(u.keyframes[0].t/c,0),d[1]=g.getValueAtTime(g.keyframes[0].t/c,0)):u._caching.lastFrame+u.offsetTime>=u.keyframes[u.keyframes.length-1].t?(f[0]=u.getValueAtTime(u.keyframes[u.keyframes.length-1].t/c,0),f[1]=g.getValueAtTime(g.keyframes[g.keyframes.length-1].t/c,0),d[0]=u.getValueAtTime((u.keyframes[u.keyframes.length-1].t-.01)/c,0),d[1]=g.getValueAtTime((g.keyframes[g.keyframes.length-1].t-.01)/c,0)):(f=[u.pv,g.pv],d[0]=u.getValueAtTime((u._caching.lastFrame+u.offsetTime-.01)/c,u.offsetTime),d[1]=g.getValueAtTime((g._caching.lastFrame+g.offsetTime-.01)/c,g.offsetTime))}else d=r,f=d;this.v.rotate(-Math.atan2(f[1]-d[1],f[0]-d[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function i(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function s(){}function n(l){this._addDynamicProperty(l),this.elem.addDynamicProperty(l),this._isDirty=!0}function a(l,c,f){if(this.elem=l,this.frameId=-1,this.propType="transform",this.data=c,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(f||l),c.p&&c.p.s?(this.px=PropertyFactory.getProp(l,c.p.x,0,0,this),this.py=PropertyFactory.getProp(l,c.p.y,0,0,this),c.p.z&&(this.pz=PropertyFactory.getProp(l,c.p.z,0,0,this))):this.p=PropertyFactory.getProp(l,c.p||{k:[0,0,0]},1,0,this),c.rx){if(this.rx=PropertyFactory.getProp(l,c.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(l,c.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(l,c.rz,0,degToRads,this),c.or.k[0].ti){var d,u=c.or.k.length;for(d=0;d<u;d+=1)c.or.k[d].to=null,c.or.k[d].ti=null}this.or=PropertyFactory.getProp(l,c.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(l,c.r||{k:0},0,degToRads,this);c.sk&&(this.sk=PropertyFactory.getProp(l,c.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(l,c.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(l,c.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(l,c.s||{k:[100,100,100]},1,.01,this),c.o?this.o=PropertyFactory.getProp(l,c.o,0,.01,l):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}a.prototype={applyToMatrix:e,getValue:t,precalculateMatrix:i,autoOrient:s},extendPrototype([DynamicPropertyContainer],a),a.prototype.addDynamicProperty=n,a.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function o(l,c,f){return new a(l,c,f)}return{getTransformProperty:o}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(r,e){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(r,e.c,0,null,this),this.o=PropertyFactory.getProp(r,e.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(r,e.tr,this),this.so=PropertyFactory.getProp(r,e.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(r,e.tr.eo,0,.01,this),this.data=e,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(r,e,t,i,s,n){var a=n?-1:1,o=i.s.v[0]+(1-i.s.v[0])*(1-s),l=i.s.v[1]+(1-i.s.v[1])*(1-s);r.translate(i.p.v[0]*a*s,i.p.v[1]*a*s,i.p.v[2]),e.translate(-i.a.v[0],-i.a.v[1],i.a.v[2]),e.rotate(-i.r.v*a*s),e.translate(i.a.v[0],i.a.v[1],i.a.v[2]),t.translate(-i.a.v[0],-i.a.v[1],i.a.v[2]),t.scale(n?1/o:o,n?1/l:l),t.translate(i.a.v[0],i.a.v[1],i.a.v[2])},RepeaterModifier.prototype.init=function(r,e,t,i){for(this.elem=r,this.arr=e,this.pos=t,this.elemsData=i,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(r),this.initModifierProperties(r,e[t]);t>0;)t-=1,this._elements.unshift(e[t]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(r){var e,t=r.length;for(e=0;e<t;e+=1)r[e]._processed=!1,r[e].ty==="gr"&&this.resetElements(r[e].it)},RepeaterModifier.prototype.cloneElements=function(r){var e=JSON.parse(JSON.stringify(r));return this.resetElements(e),e},RepeaterModifier.prototype.changeGroupRender=function(r,e){var t,i=r.length;for(t=0;t<i;t+=1)r[t]._render=e,r[t].ty==="gr"&&this.changeGroupRender(r[t].it,e)},RepeaterModifier.prototype.processShapes=function(r){var e,t,i,s,n,a=!1;if(this._mdf||r){var o=Math.ceil(this.c.v);if(this._groups.length<o){for(;this._groups.length<o;){var l={it:this.cloneElements(this._elements),ty:"gr"};l.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,l),this._groups.splice(0,0,l),this._currentCopies+=1}this.elem.reloadShapes(),a=!0}n=0;var c;for(i=0;i<=this._groups.length-1;i+=1){if(c=n<o,this._groups[i]._render=c,this.changeGroupRender(this._groups[i].it,c),!c){var f=this.elemsData[i].it,d=f[f.length-1];d.transform.op.v!==0?(d.transform.op._mdf=!0,d.transform.op.v=0):d.transform.op._mdf=!1}n+=1}this._currentCopies=o;var u=this.o.v,g=u%1,p=u>0?Math.floor(u):Math.ceil(u),m=this.pMatrix.props,S=this.rMatrix.props,y=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var x=0;if(u>0){for(;x<p;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),x+=1;g&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,g,!1),x+=g)}else if(u<0){for(;x>p;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),x-=1;g&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-g,!0),x-=g)}i=this.data.m===1?0:this._currentCopies-1,s=this.data.m===1?1:-1,n=this._currentCopies;for(var E,T;n;){if(e=this.elemsData[i].it,t=e[e.length-1].transform.mProps.v.props,T=t.length,e[e.length-1].transform.mProps._mdf=!0,e[e.length-1].transform.op._mdf=!0,e[e.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(i/(this._currentCopies-1)),x!==0){for((i!==0&&s===1||i!==this._currentCopies-1&&s===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15]),this.matrix.transform(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15]),this.matrix.transform(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]),E=0;E<T;E+=1)t[E]=this.matrix.props[E];this.matrix.reset()}else for(this.matrix.reset(),E=0;E<T;E+=1)t[E]=this.matrix.props[E];x+=1,n-=1,i+=s}}else for(n=this._currentCopies,i=0,s=1;n;)e=this.elemsData[i].it,t=e[e.length-1].transform.mProps.v.props,e[e.length-1].transform.mProps._mdf=!1,e[e.length-1].transform.op._mdf=!1,n-=1,i+=s;return a},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(r,e){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(r,e.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(r,e){var t=shapePool.newElement();t.c=r.c;var i,s=r._length,n,a,o,l,c,f,d=0,u,g,p,m,S,y;for(i=0;i<s;i+=1)n=r.v[i],o=r.o[i],a=r.i[i],n[0]===o[0]&&n[1]===o[1]&&n[0]===a[0]&&n[1]===a[1]?(i===0||i===s-1)&&!r.c?(t.setTripleAt(n[0],n[1],o[0],o[1],a[0],a[1],d),d+=1):(i===0?l=r.v[s-1]:l=r.v[i-1],c=Math.sqrt(Math.pow(n[0]-l[0],2)+Math.pow(n[1]-l[1],2)),f=c?Math.min(c/2,e)/c:0,S=n[0]+(l[0]-n[0])*f,u=S,y=n[1]-(n[1]-l[1])*f,g=y,p=u-(u-n[0])*roundCorner,m=g-(g-n[1])*roundCorner,t.setTripleAt(u,g,p,m,S,y,d),d+=1,i===s-1?l=r.v[0]:l=r.v[i+1],c=Math.sqrt(Math.pow(n[0]-l[0],2)+Math.pow(n[1]-l[1],2)),f=c?Math.min(c/2,e)/c:0,p=n[0]+(l[0]-n[0])*f,u=p,m=n[1]+(l[1]-n[1])*f,g=m,S=u-(u-n[0])*roundCorner,y=g-(g-n[1])*roundCorner,t.setTripleAt(u,g,p,m,S,y,d),d+=1):(t.setTripleAt(r.v[i][0],r.v[i][1],r.o[i][0],r.o[i][1],r.i[i][0],r.i[i][1],d),d+=1);return t},RoundCornersModifier.prototype.processShapes=function(r){var e,t,i=this.shapes.length,s,n,a=this.rd.v;if(a!==0){var o,l;for(t=0;t<i;t+=1){if(o=this.shapes[t],l=o.localShapeCollection,!(!o.shape._mdf&&!this._mdf&&!r))for(l.releaseShapes(),o.shape._mdf=!0,e=o.shape.paths.shapes,n=o.shape.paths._length,s=0;s<n;s+=1)l.addShape(this.processPath(e[s],a));o.shape.paths=o.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(r,e){return Math.abs(r-e)*1e5<=Math.min(Math.abs(r),Math.abs(e))}function floatZero(r){return Math.abs(r)<=1e-5}function lerp(r,e,t){return r*(1-t)+e*t}function lerpPoint(r,e,t){return[lerp(r[0],e[0],t),lerp(r[1],e[1],t)]}function quadRoots(r,e,t){if(r===0)return[];var i=e*e-4*r*t;if(i<0)return[];var s=-e/(2*r);if(i===0)return[s];var n=Math.sqrt(i)/(2*r);return[s-n,s+n]}function polynomialCoefficients(r,e,t,i){return[-r+3*e-3*t+i,3*r-6*e+3*t,-3*r+3*e,r]}function singlePoint(r){return new PolynomialBezier(r,r,r,r,!1)}function PolynomialBezier(r,e,t,i,s){s&&pointEqual(r,e)&&(e=lerpPoint(r,i,1/3)),s&&pointEqual(t,i)&&(t=lerpPoint(r,i,2/3));var n=polynomialCoefficients(r[0],e[0],t[0],i[0]),a=polynomialCoefficients(r[1],e[1],t[1],i[1]);this.a=[n[0],a[0]],this.b=[n[1],a[1]],this.c=[n[2],a[2]],this.d=[n[3],a[3]],this.points=[r,e,t,i]}PolynomialBezier.prototype.point=function(r){return[((this.a[0]*r+this.b[0])*r+this.c[0])*r+this.d[0],((this.a[1]*r+this.b[1])*r+this.c[1])*r+this.d[1]]},PolynomialBezier.prototype.derivative=function(r){return[(3*r*this.a[0]+2*this.b[0])*r+this.c[0],(3*r*this.a[1]+2*this.b[1])*r+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(r){var e=this.derivative(r);return Math.atan2(e[1],e[0])},PolynomialBezier.prototype.normalAngle=function(r){var e=this.derivative(r);return Math.atan2(e[0],e[1])},PolynomialBezier.prototype.inflectionPoints=function(){var r=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(r))return[];var e=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/r,t=e*e-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/r;if(t<0)return[];var i=Math.sqrt(t);return floatZero(i)?i>0&&i<1?[e]:[]:[e-i,e+i].filter(function(s){return s>0&&s<1})},PolynomialBezier.prototype.split=function(r){if(r<=0)return[singlePoint(this.points[0]),this];if(r>=1)return[this,singlePoint(this.points[this.points.length-1])];var e=lerpPoint(this.points[0],this.points[1],r),t=lerpPoint(this.points[1],this.points[2],r),i=lerpPoint(this.points[2],this.points[3],r),s=lerpPoint(e,t,r),n=lerpPoint(t,i,r),a=lerpPoint(s,n,r);return[new PolynomialBezier(this.points[0],e,s,a,!0),new PolynomialBezier(a,n,i,this.points[3],!0)]};function extrema(r,e){var t=r.points[0][e],i=r.points[r.points.length-1][e];if(t>i){var s=i;i=t,t=s}for(var n=quadRoots(3*r.a[e],2*r.b[e],r.c[e]),a=0;a<n.length;a+=1)if(n[a]>0&&n[a]<1){var o=r.point(n[a])[e];o<t?t=o:o>i&&(i=o)}return{min:t,max:i}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var r=this.bounds();return{left:r.x.min,right:r.x.max,top:r.y.min,bottom:r.y.max,width:r.x.max-r.x.min,height:r.y.max-r.y.min,cx:(r.x.max+r.x.min)/2,cy:(r.y.max+r.y.min)/2}};function intersectData(r,e,t){var i=r.boundingBox();return{cx:i.cx,cy:i.cy,width:i.width,height:i.height,bez:r,t:(e+t)/2,t1:e,t2:t}}function splitData(r){var e=r.bez.split(.5);return[intersectData(e[0],r.t1,r.t),intersectData(e[1],r.t,r.t2)]}function boxIntersect(r,e){return Math.abs(r.cx-e.cx)*2<r.width+e.width&&Math.abs(r.cy-e.cy)*2<r.height+e.height}function intersectsImpl(r,e,t,i,s,n){if(!!boxIntersect(r,e)){if(t>=n||r.width<=i&&r.height<=i&&e.width<=i&&e.height<=i){s.push([r.t,e.t]);return}var a=splitData(r),o=splitData(e);intersectsImpl(a[0],o[0],t+1,i,s,n),intersectsImpl(a[0],o[1],t+1,i,s,n),intersectsImpl(a[1],o[0],t+1,i,s,n),intersectsImpl(a[1],o[1],t+1,i,s,n)}}PolynomialBezier.prototype.intersections=function(r,e,t){e===void 0&&(e=2),t===void 0&&(t=7);var i=[];return intersectsImpl(intersectData(this,0,1),intersectData(r,0,1),0,e,i,t),i},PolynomialBezier.shapeSegment=function(r,e){var t=(e+1)%r.length();return new PolynomialBezier(r.v[e],r.o[e],r.i[t],r.v[t],!0)},PolynomialBezier.shapeSegmentInverted=function(r,e){var t=(e+1)%r.length();return new PolynomialBezier(r.v[t],r.i[t],r.o[e],r.v[e],!0)};function crossProduct(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function lineIntersection(r,e,t,i){var s=[r[0],r[1],1],n=[e[0],e[1],1],a=[t[0],t[1],1],o=[i[0],i[1],1],l=crossProduct(crossProduct(s,n),crossProduct(a,o));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(r,e,t){return[r[0]+Math.cos(e)*t,r[1]-Math.sin(e)*t]}function pointDistance(r,e){return Math.hypot(r[0]-e[0],r[1]-e[1])}function pointEqual(r,e){return floatEqual(r[0],e[0])&&floatEqual(r[1],e[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(r,e){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(r,e.s,0,null,this),this.frequency=PropertyFactory.getProp(r,e.r,0,null,this),this.pointsType=PropertyFactory.getProp(r,e.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(r,e,t,i,s,n,a){var o=t-Math.PI/2,l=t+Math.PI/2,c=e[0]+Math.cos(t)*i*s,f=e[1]-Math.sin(t)*i*s;r.setTripleAt(c,f,c+Math.cos(o)*n,f-Math.sin(o)*n,c+Math.cos(l)*a,f-Math.sin(l)*a,r.length())}function getPerpendicularVector(r,e){var t=[e[0]-r[0],e[1]-r[1]],i=-Math.PI*.5,s=[Math.cos(i)*t[0]-Math.sin(i)*t[1],Math.sin(i)*t[0]+Math.cos(i)*t[1]];return s}function getProjectingAngle(r,e){var t=e===0?r.length()-1:e-1,i=(e+1)%r.length(),s=r.v[t],n=r.v[i],a=getPerpendicularVector(s,n);return Math.atan2(0,1)-Math.atan2(a[1],a[0])}function zigZagCorner(r,e,t,i,s,n,a){var o=getProjectingAngle(e,t),l=e.v[t%e._length],c=e.v[t===0?e._length-1:t-1],f=e.v[(t+1)%e._length],d=n===2?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0,u=n===2?Math.sqrt(Math.pow(l[0]-f[0],2)+Math.pow(l[1]-f[1],2)):0;setPoint(r,e.v[t%e._length],o,a,i,u/((s+1)*2),d/((s+1)*2))}function zigZagSegment(r,e,t,i,s,n){for(var a=0;a<i;a+=1){var o=(a+1)/(i+1),l=s===2?Math.sqrt(Math.pow(e.points[3][0]-e.points[0][0],2)+Math.pow(e.points[3][1]-e.points[0][1],2)):0,c=e.normalAngle(o),f=e.point(o);setPoint(r,f,c,n,t,l/((i+1)*2),l/((i+1)*2)),n=-n}return n}ZigZagModifier.prototype.processPath=function(r,e,t,i){var s=r._length,n=shapePool.newElement();if(n.c=r.c,r.c||(s-=1),s===0)return n;var a=-1,o=PolynomialBezier.shapeSegment(r,0);zigZagCorner(n,r,0,e,t,i,a);for(var l=0;l<s;l+=1)a=zigZagSegment(n,o,e,t,i,-a),l===s-1&&!r.c?o=null:o=PolynomialBezier.shapeSegment(r,(l+1)%s),zigZagCorner(n,r,l+1,e,t,i,a);return n},ZigZagModifier.prototype.processShapes=function(r){var e,t,i=this.shapes.length,s,n,a=this.amplitude.v,o=Math.max(0,Math.round(this.frequency.v)),l=this.pointsType.v;if(a!==0){var c,f;for(t=0;t<i;t+=1){if(c=this.shapes[t],f=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!r))for(f.releaseShapes(),c.shape._mdf=!0,e=c.shape.paths.shapes,n=c.shape.paths._length,s=0;s<n;s+=1)f.addShape(this.processPath(e[s],a,o,l));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(r,e,t){var i=Math.atan2(e[0]-r[0],e[1]-r[1]);return[polarOffset(r,i,t),polarOffset(e,i,t)]}function offsetSegment(r,e){var t,i,s,n,a,o,l;l=linearOffset(r.points[0],r.points[1],e),t=l[0],i=l[1],l=linearOffset(r.points[1],r.points[2],e),s=l[0],n=l[1],l=linearOffset(r.points[2],r.points[3],e),a=l[0],o=l[1];var c=lineIntersection(t,i,s,n);c===null&&(c=i);var f=lineIntersection(a,o,s,n);return f===null&&(f=a),new PolynomialBezier(t,c,f,o)}function joinLines(r,e,t,i,s){var n=e.points[3],a=t.points[0];if(i===3||pointEqual(n,a))return n;if(i===2){var o=-e.tangentAngle(1),l=-t.tangentAngle(0)+Math.PI,c=lineIntersection(n,polarOffset(n,o+Math.PI/2,100),a,polarOffset(a,o+Math.PI/2,100)),f=c?pointDistance(c,n):pointDistance(n,a)/2,d=polarOffset(n,o,2*f*roundCorner);return r.setXYAt(d[0],d[1],"o",r.length()-1),d=polarOffset(a,l,2*f*roundCorner),r.setTripleAt(a[0],a[1],a[0],a[1],d[0],d[1],r.length()),a}var u=pointEqual(n,e.points[2])?e.points[0]:e.points[2],g=pointEqual(a,t.points[1])?t.points[3]:t.points[1],p=lineIntersection(u,n,a,g);return p&&pointDistance(p,n)<s?(r.setTripleAt(p[0],p[1],p[0],p[1],p[0],p[1],r.length()),p):n}function getIntersection(r,e){var t=r.intersections(e);return t.length&&floatEqual(t[0][0],1)&&t.shift(),t.length?t[0]:null}function pruneSegmentIntersection(r,e){var t=r.slice(),i=e.slice(),s=getIntersection(r[r.length-1],e[0]);return s&&(t[r.length-1]=r[r.length-1].split(s[0])[0],i[0]=e[0].split(s[1])[1]),r.length>1&&e.length>1&&(s=getIntersection(r[0],e[e.length-1]),s)?[[r[0].split(s[0])[0]],[e[e.length-1].split(s[1])[1]]]:[t,i]}function pruneIntersections(r){for(var e,t=1;t<r.length;t+=1)e=pruneSegmentIntersection(r[t-1],r[t]),r[t-1]=e[0],r[t]=e[1];return r.length>1&&(e=pruneSegmentIntersection(r[r.length-1],r[0]),r[r.length-1]=e[0],r[0]=e[1]),r}function offsetSegmentSplit(r,e){var t=r.inflectionPoints(),i,s,n,a;if(t.length===0)return[offsetSegment(r,e)];if(t.length===1||floatEqual(t[1],1))return n=r.split(t[0]),i=n[0],s=n[1],[offsetSegment(i,e),offsetSegment(s,e)];n=r.split(t[0]),i=n[0];var o=(t[1]-t[0])/(1-t[0]);return n=n[1].split(o),a=n[0],s=n[1],[offsetSegment(i,e),offsetSegment(a,e),offsetSegment(s,e)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(r,e){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(r,e.a,0,null,this),this.miterLimit=PropertyFactory.getProp(r,e.ml,0,null,this),this.lineJoin=e.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(r,e,t,i){var s=shapePool.newElement();s.c=r.c;var n=r.length();r.c||(n-=1);var a,o,l,c=[];for(a=0;a<n;a+=1)l=PolynomialBezier.shapeSegment(r,a),c.push(offsetSegmentSplit(l,e));if(!r.c)for(a=n-1;a>=0;a-=1)l=PolynomialBezier.shapeSegmentInverted(r,a),c.push(offsetSegmentSplit(l,e));c=pruneIntersections(c);var f=null,d=null;for(a=0;a<c.length;a+=1){var u=c[a];for(d&&(f=joinLines(s,d,u[0],t,i)),d=u[u.length-1],o=0;o<u.length;o+=1)l=u[o],f&&pointEqual(l.points[0],f)?s.setXYAt(l.points[1][0],l.points[1][1],"o",s.length()-1):s.setTripleAt(l.points[0][0],l.points[0][1],l.points[1][0],l.points[1][1],l.points[0][0],l.points[0][1],s.length()),s.setTripleAt(l.points[3][0],l.points[3][1],l.points[3][0],l.points[3][1],l.points[2][0],l.points[2][1],s.length()),f=l.points[3]}return c.length&&joinLines(s,d,c[0][0],t,i),s},OffsetPathModifier.prototype.processShapes=function(r){var e,t,i=this.shapes.length,s,n,a=this.amount.v,o=this.miterLimit.v,l=this.lineJoin;if(a!==0){var c,f;for(t=0;t<i;t+=1){if(c=this.shapes[t],f=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!r))for(f.releaseShapes(),c.shape._mdf=!0,e=c.shape.paths.shapes,n=c.shape.paths._length,s=0;s<n;s+=1)f.addShape(this.processPath(e[s],a,l,o));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(r){for(var e=r.fStyle?r.fStyle.split(" "):[],t="normal",i="normal",s=e.length,n,a=0;a<s;a+=1)switch(n=e[a].toLowerCase(),n){case"italic":i="italic";break;case"bold":t="700";break;case"black":t="900";break;case"medium":t="500";break;case"regular":case"normal":t="400";break;case"light":case"thin":t="200";break}return{style:i,weight:r.fWeight||t}}var FontManager=function(){var r=5e3,e={w:0,size:0,shapes:[],data:{shapes:[]}},t=[];t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var i=127988,s=917631,n=917601,a=917626,o=65039,l=8205,c=127462,f=127487,d=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function u(L){var D=L.split(","),b,C=D.length,I=[];for(b=0;b<C;b+=1)D[b]!=="sans-serif"&&D[b]!=="monospace"&&I.push(D[b]);return I.join(",")}function g(L,D){var b=createTag("span");b.setAttribute("aria-hidden",!0),b.style.fontFamily=D;var C=createTag("span");C.innerText="giItT1WQy@!-/#",b.style.position="absolute",b.style.left="-10000px",b.style.top="-10000px",b.style.fontSize="300px",b.style.fontVariant="normal",b.style.fontStyle="normal",b.style.fontWeight="normal",b.style.letterSpacing="0",b.appendChild(C),document.body.appendChild(b);var I=C.offsetWidth;return C.style.fontFamily=u(L)+", "+D,{node:C,w:I,parent:b}}function p(){var L,D=this.fonts.length,b,C,I=D;for(L=0;L<D;L+=1)this.fonts[L].loaded?I-=1:this.fonts[L].fOrigin==="n"||this.fonts[L].origin===0?this.fonts[L].loaded=!0:(b=this.fonts[L].monoCase.node,C=this.fonts[L].monoCase.w,b.offsetWidth!==C?(I-=1,this.fonts[L].loaded=!0):(b=this.fonts[L].sansCase.node,C=this.fonts[L].sansCase.w,b.offsetWidth!==C&&(I-=1,this.fonts[L].loaded=!0)),this.fonts[L].loaded&&(this.fonts[L].sansCase.parent.parentNode.removeChild(this.fonts[L].sansCase.parent),this.fonts[L].monoCase.parent.parentNode.removeChild(this.fonts[L].monoCase.parent)));I!==0&&Date.now()-this.initTime<r?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function m(L,D){var b=document.body&&D?"svg":"canvas",C,I=getFontProperties(L);if(b==="svg"){var R=createNS("text");R.style.fontSize="100px",R.setAttribute("font-family",L.fFamily),R.setAttribute("font-style",I.style),R.setAttribute("font-weight",I.weight),R.textContent="1",L.fClass?(R.style.fontFamily="inherit",R.setAttribute("class",L.fClass)):R.style.fontFamily=L.fFamily,D.appendChild(R),C=R}else{var V=new OffscreenCanvas(500,500).getContext("2d");V.font=I.style+" "+I.weight+" 100px "+L.fFamily,C=V}function $(H){return b==="svg"?(C.textContent=H,C.getComputedTextLength()):C.measureText(H).width}return{measureText:$}}function S(L,D){if(!L){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=L.list;return}if(!document.body){this.isLoaded=!0,L.list.forEach(function(Y){Y.helper=m(Y),Y.cache={}}),this.fonts=L.list;return}var b=L.list,C,I=b.length,R=I;for(C=0;C<I;C+=1){var V=!0,$,H;if(b[C].loaded=!1,b[C].monoCase=g(b[C].fFamily,"monospace"),b[C].sansCase=g(b[C].fFamily,"sans-serif"),!b[C].fPath)b[C].loaded=!0,R-=1;else if(b[C].fOrigin==="p"||b[C].origin===3){if($=document.querySelectorAll('style[f-forigin="p"][f-family="'+b[C].fFamily+'"], style[f-origin="3"][f-family="'+b[C].fFamily+'"]'),$.length>0&&(V=!1),V){var z=createTag("style");z.setAttribute("f-forigin",b[C].fOrigin),z.setAttribute("f-origin",b[C].origin),z.setAttribute("f-family",b[C].fFamily),z.type="text/css",z.innerText="@font-face {font-family: "+b[C].fFamily+"; font-style: normal; src: url('"+b[C].fPath+"');}",D.appendChild(z)}}else if(b[C].fOrigin==="g"||b[C].origin===1){for($=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),H=0;H<$.length;H+=1)$[H].href.indexOf(b[C].fPath)!==-1&&(V=!1);if(V){var W=createTag("link");W.setAttribute("f-forigin",b[C].fOrigin),W.setAttribute("f-origin",b[C].origin),W.type="text/css",W.rel="stylesheet",W.href=b[C].fPath,document.body.appendChild(W)}}else if(b[C].fOrigin==="t"||b[C].origin===2){for($=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),H=0;H<$.length;H+=1)b[C].fPath===$[H].src&&(V=!1);if(V){var j=createTag("link");j.setAttribute("f-forigin",b[C].fOrigin),j.setAttribute("f-origin",b[C].origin),j.setAttribute("rel","stylesheet"),j.setAttribute("href",b[C].fPath),D.appendChild(j)}}b[C].helper=m(b[C],D),b[C].cache={},this.fonts.push(b[C])}R===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function y(L){if(!!L){this.chars||(this.chars=[]);var D,b=L.length,C,I=this.chars.length,R;for(D=0;D<b;D+=1){for(C=0,R=!1;C<I;)this.chars[C].style===L[D].style&&this.chars[C].fFamily===L[D].fFamily&&this.chars[C].ch===L[D].ch&&(R=!0),C+=1;R||(this.chars.push(L[D]),I+=1)}}}function x(L,D,b){for(var C=0,I=this.chars.length;C<I;){if(this.chars[C].ch===L&&this.chars[C].style===D&&this.chars[C].fFamily===b)return this.chars[C];C+=1}return(typeof L=="string"&&L.charCodeAt(0)!==13||!L)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",L,D,b)),e}function E(L,D,b){var C=this.getFontByName(D),I=L;if(!C.cache[I]){var R=C.helper;if(L===" "){var V=R.measureText("|"+L+"|"),$=R.measureText("||");C.cache[I]=(V-$)/100}else C.cache[I]=R.measureText(L)/100}return C.cache[I]*b}function T(L){for(var D=0,b=this.fonts.length;D<b;){if(this.fonts[D].fName===L)return this.fonts[D];D+=1}return this.fonts[0]}function A(L){var D=0,b=L.charCodeAt(0);if(b>=55296&&b<=56319){var C=L.charCodeAt(1);C>=56320&&C<=57343&&(D=(b-55296)*1024+C-56320+65536)}return D}function _(L,D){var b=L.toString(16)+D.toString(16);return d.indexOf(b)!==-1}function P(L){return L===l}function k(L){return L===o}function F(L){var D=A(L);return D>=c&&D<=f}function M(L){return F(L.substr(0,2))&&F(L.substr(2,2))}function B(L){return t.indexOf(L)!==-1}function N(L,D){var b=A(L.substr(D,2));if(b!==i)return!1;var C=0;for(D+=2;C<5;){if(b=A(L.substr(D,2)),b<n||b>a)return!1;C+=1,D+=2}return A(L.substr(D,2))===s}function G(){this.isLoaded=!0}var U=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};U.isModifier=_,U.isZeroWidthJoiner=P,U.isFlagEmoji=M,U.isRegionalCode=F,U.isCombinedCharacter=B,U.isRegionalFlag=N,U.isVariationSelector=k,U.BLACK_FLAG_CODE_POINT=i;var O={addChars:y,addFonts:S,getCharData:x,getFontByName:T,measureText:E,checkLoadedFonts:p,setIsLoaded:G};return U.prototype=O,U}();function SlotManager(r){this.animationData=r}SlotManager.prototype.getProp=function(r){return this.animationData.slots&&this.animationData.slots[r.sid]?Object.assign(r,this.animationData.slots[r.sid].p):r};function slotFactory(r){return new SlotManager(r)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(e){this.renderableComponents.indexOf(e)===-1&&this.renderableComponents.push(e)},removeRenderableComponent:function(e){this.renderableComponents.indexOf(e)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(e),1)},prepareRenderableFrame:function(e){this.checkLayerLimits(e)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(e){this.data.ip-this.data.st<=e&&this.data.op-this.data.st>e?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var e,t=this.renderableComponents.length;for(e=0;e<t;e+=1)this.renderableComponents[e].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var r={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(e){return r[e]||""}}();function SliderEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,0,0,t)}function AngleEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,0,0,t)}function ColorEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,1,0,t)}function PointEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,1,0,t)}function LayerIndexEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,0,0,t)}function MaskIndexEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,0,0,t)}function CheckboxEffect(r,e,t){this.p=PropertyFactory.getProp(e,r.v,0,0,t)}function NoValueEffect(){this.p={}}function EffectsManager(r,e){var t=r.ef||[];this.effectElements=[];var i,s=t.length,n;for(i=0;i<s;i+=1)n=new GroupEffect(t[i],e),this.effectElements.push(n)}function GroupEffect(r,e){this.init(r,e)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(r,e){this.data=r,this.effectElements=[],this.initDynamicPropertyContainer(e);var t,i=this.data.ef.length,s,n=this.data.ef;for(t=0;t<i;t+=1){switch(s=null,n[t].ty){case 0:s=new SliderEffect(n[t],e,this);break;case 1:s=new AngleEffect(n[t],e,this);break;case 2:s=new ColorEffect(n[t],e,this);break;case 3:s=new PointEffect(n[t],e,this);break;case 4:case 7:s=new CheckboxEffect(n[t],e,this);break;case 10:s=new LayerIndexEffect(n[t],e,this);break;case 11:s=new MaskIndexEffect(n[t],e,this);break;case 5:s=new EffectsManager(n[t],e);break;default:s=new NoValueEffect(n[t]);break}s&&this.effectElements.push(s)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var e=0,t=this.data.masksProperties.length;e<t;){if(this.data.masksProperties[e].mode!=="n"&&this.data.masksProperties[e].cl!==!1)return!0;e+=1}return!1},initExpressions:function(){var e=getExpressionInterfaces();if(!!e){var t=e("layer"),i=e("effects"),s=e("shape"),n=e("text"),a=e("comp");this.layerInterface=t(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var o=i.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(o),this.data.ty===0||this.data.xt?this.compInterface=a(this):this.data.ty===4?(this.layerInterface.shapeInterface=s(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=n(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var e=getBlendMode(this.data.bm),t=this.baseElement||this.layerElement;t.style["mix-blend-mode"]=e},initBaseData:function(e,t,i){this.globalData=t,this.comp=i,this.data=e,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(e,t){var i,s=this.dynamicProperties.length;for(i=0;i<s;i+=1)(t||this._isParent&&this.dynamicProperties[i].propType==="transform")&&(this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(e){this.dynamicProperties.indexOf(e)===-1&&this.dynamicProperties.push(e)}};function FootageElement(r,e,t){this.initFrame(),this.initRenderable(),this.assetData=e.getAssetData(r.refId),this.footageData=e.imageLoader.getAsset(this.assetData),this.initBaseData(r,e,t)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var r=getExpressionInterfaces();if(!!r){var e=r("footage");this.layerInterface=e(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(r,e,t){this.initFrame(),this.initRenderable(),this.assetData=e.getAssetData(r.refId),this.initBaseData(r,e,t),this._isPlaying=!1,this._canPlay=!1;var i=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(i),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=r.tm?PropertyFactory.getProp(this,r.tm,0,e.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,r.au&&r.au.lv?r.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(r){if(this.prepareRenderableFrame(r,!0),this.prepareProperties(r,!0),this.tm._placeholder)this._currentTime=r/this.data.sr;else{var e=this.tm.v;this._currentTime=e}this._volume=this.lv.v[0];var t=this._volume*this._volumeMultiplier;this._previousVolume!==t&&(this._previousVolume=t,this.audio.volume(t))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(r){this.audio.rate(r)},AudioElement.prototype.volume=function(r){this._volumeMultiplier=r,this._previousVolume=r*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(r){var e,t=this.layers.length,i;for(this.completeLayers=!0,e=t-1;e>=0;e-=1)this.elements[e]||(i=this.layers[e],i.ip-i.st<=r-this.layers[e].st&&i.op-i.st>r-this.layers[e].st&&this.buildItem(e)),this.completeLayers=this.elements[e]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(r){switch(r.ty){case 2:return this.createImage(r);case 0:return this.createComp(r);case 1:return this.createSolid(r);case 3:return this.createNull(r);case 4:return this.createShape(r);case 5:return this.createText(r);case 6:return this.createAudio(r);case 13:return this.createCamera(r);case 15:return this.createFootage(r);default:return this.createNull(r)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(r){return new AudioElement(r,this.globalData,this)},BaseRenderer.prototype.createFootage=function(r){return new FootageElement(r,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var r,e=this.layers.length;for(r=0;r<e;r+=1)this.buildItem(r);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(r){this.completeLayers=!1;var e,t=r.length,i,s=this.layers.length;for(e=0;e<t;e+=1)for(i=0;i<s;){if(this.layers[i].id===r[e].id){this.layers[i]=r[e];break}i+=1}},BaseRenderer.prototype.setProjectInterface=function(r){this.globalData.projectInterface=r},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(r,e,t){for(var i=this.elements,s=this.layers,n=0,a=s.length;n<a;)s[n].ind==e&&(!i[n]||i[n]===!0?(this.buildItem(n),this.addPendingElement(r)):(t.push(i[n]),i[n].setAsParent(),s[n].parent!==void 0?this.buildElementParenting(r,s[n].parent,t):r.setHierarchy(t))),n+=1},BaseRenderer.prototype.addPendingElement=function(r){this.pendingElements.push(r)},BaseRenderer.prototype.searchExtraCompositions=function(r){var e,t=r.length;for(e=0;e<t;e+=1)if(r[e].xt){var i=this.createComp(r[e]);i.initExpressions(),this.globalData.projectInterface.registerComposition(i)}},BaseRenderer.prototype.getElementById=function(r){var e,t=this.elements.length;for(e=0;e<t;e+=1)if(this.elements[e].data.ind===r)return this.elements[e];return null},BaseRenderer.prototype.getElementByPath=function(r){var e=r.shift(),t;if(typeof e=="number")t=this.elements[e];else{var i,s=this.elements.length;for(i=0;i<s;i+=1)if(this.elements[i].data.nm===e){t=this.elements[i];break}}return r.length===0?t:t.getElementByPath(r)},BaseRenderer.prototype.setupGlobalData=function(r,e){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(r),this.globalData.fontManager.addChars(r.chars),this.globalData.fontManager.addFonts(r.fonts,e),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=r.fr,this.globalData.nm=r.nm,this.globalData.compSize={w:r.w,h:r.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var e=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:e,localMat:e,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var e,t=this.finalTransform.mat,i=0,s=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;i<s;){if(this.hierarchy[i].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}i+=1}if(this.finalTransform._matMdf)for(e=this.finalTransform.mProp.v.props,t.cloneFromProps(e),i=0;i<s;i+=1)t.multiply(this.hierarchy[i].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var e=0,t=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;e<t;)this.localTransforms[e]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[e]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),e+=1;if(this.finalTransform._localMatMdf){var i=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(i),e=1;e<t;e+=1){var s=this.localTransforms[e].matrix;i.multiply(s)}i.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var n=this.finalTransform.localOpacity;for(e=0;e<t;e+=1)n*=this.localTransforms[e].opacity*.01;this.finalTransform.localOpacity=n}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var e=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(e.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var t=0,i=e.length;for(t=0;t<i;t+=1)this.localTransforms.push(e[t])}}},globalToLocal:function(e){var t=[];t.push(this.finalTransform);for(var i=!0,s=this.comp;i;)s.finalTransform?(s.data.hasMask&&t.splice(0,0,s.finalTransform),s=s.comp):i=!1;var n,a=t.length,o;for(n=0;n<a;n+=1)o=t[n].mat.applyToPointArray(0,0,0),e=[e[0]-o[0],e[1]-o[1],0];return e},mHelper:new Matrix};function MaskElement(r,e,t){this.data=r,this.element=e,this.globalData=t,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var i=this.globalData.defs,s,n=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(n),this.solidPath="";var a,o=this.masksProperties,l=0,c=[],f,d,u=createElementID(),g,p,m,S,y="clipPath",x="clip-path";for(s=0;s<n;s+=1)if((o[s].mode!=="a"&&o[s].mode!=="n"||o[s].inv||o[s].o.k!==100||o[s].o.x)&&(y="mask",x="mask"),(o[s].mode==="s"||o[s].mode==="i")&&l===0?(g=createNS("rect"),g.setAttribute("fill","#ffffff"),g.setAttribute("width",this.element.comp.data.w||0),g.setAttribute("height",this.element.comp.data.h||0),c.push(g)):g=null,a=createNS("path"),o[s].mode==="n")this.viewData[s]={op:PropertyFactory.getProp(this.element,o[s].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,o[s],3),elem:a,lastPath:""},i.appendChild(a);else{l+=1,a.setAttribute("fill",o[s].mode==="s"?"#000000":"#ffffff"),a.setAttribute("clip-rule","nonzero");var E;if(o[s].x.k!==0?(y="mask",x="mask",S=PropertyFactory.getProp(this.element,o[s].x,0,null,this.element),E=createElementID(),p=createNS("filter"),p.setAttribute("id",E),m=createNS("feMorphology"),m.setAttribute("operator","erode"),m.setAttribute("in","SourceGraphic"),m.setAttribute("radius","0"),p.appendChild(m),i.appendChild(p),a.setAttribute("stroke",o[s].mode==="s"?"#000000":"#ffffff")):(m=null,S=null),this.storedData[s]={elem:a,x:S,expan:m,lastPath:"",lastOperator:"",filterId:E,lastRadius:0},o[s].mode==="i"){d=c.length;var T=createNS("g");for(f=0;f<d;f+=1)T.appendChild(c[f]);var A=createNS("mask");A.setAttribute("mask-type","alpha"),A.setAttribute("id",u+"_"+l),A.appendChild(a),i.appendChild(A),T.setAttribute("mask","url("+getLocationHref()+"#"+u+"_"+l+")"),c.length=0,c.push(T)}else c.push(a);o[s].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[s]={elem:a,lastPath:"",op:PropertyFactory.getProp(this.element,o[s].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,o[s],3),invRect:g},this.viewData[s].prop.k||this.drawPath(o[s],this.viewData[s].prop.v,this.viewData[s])}for(this.maskElement=createNS(y),n=c.length,s=0;s<n;s+=1)this.maskElement.appendChild(c[s]);l>0&&(this.maskElement.setAttribute("id",u),this.element.maskedElement.setAttribute(x,"url("+getLocationHref()+"#"+u+")"),i.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(r){return this.viewData[r].prop},MaskElement.prototype.renderFrame=function(r){var e=this.element.finalTransform.mat,t,i=this.masksProperties.length;for(t=0;t<i;t+=1)if((this.viewData[t].prop._mdf||r)&&this.drawPath(this.masksProperties[t],this.viewData[t].prop.v,this.viewData[t]),(this.viewData[t].op._mdf||r)&&this.viewData[t].elem.setAttribute("fill-opacity",this.viewData[t].op.v),this.masksProperties[t].mode!=="n"&&(this.viewData[t].invRect&&(this.element.finalTransform.mProp._mdf||r)&&this.viewData[t].invRect.setAttribute("transform",e.getInverseMatrix().to2dCSS()),this.storedData[t].x&&(this.storedData[t].x._mdf||r))){var s=this.storedData[t].expan;this.storedData[t].x.v<0?(this.storedData[t].lastOperator!=="erode"&&(this.storedData[t].lastOperator="erode",this.storedData[t].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[t].filterId+")")),s.setAttribute("radius",-this.storedData[t].x.v)):(this.storedData[t].lastOperator!=="dilate"&&(this.storedData[t].lastOperator="dilate",this.storedData[t].elem.setAttribute("filter",null)),this.storedData[t].elem.setAttribute("stroke-width",this.storedData[t].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var r="M0,0 ";return r+=" h"+this.globalData.compSize.w,r+=" v"+this.globalData.compSize.h,r+=" h-"+this.globalData.compSize.w,r+=" v-"+this.globalData.compSize.h+" ",r},MaskElement.prototype.drawPath=function(r,e,t){var i=" M"+e.v[0][0]+","+e.v[0][1],s,n;for(n=e._length,s=1;s<n;s+=1)i+=" C"+e.o[s-1][0]+","+e.o[s-1][1]+" "+e.i[s][0]+","+e.i[s][1]+" "+e.v[s][0]+","+e.v[s][1];if(e.c&&n>1&&(i+=" C"+e.o[s-1][0]+","+e.o[s-1][1]+" "+e.i[0][0]+","+e.i[0][1]+" "+e.v[0][0]+","+e.v[0][1]),t.lastPath!==i){var a="";t.elem&&(e.c&&(a=r.inv?this.solidPath+i:i),t.elem.setAttribute("d",a)),t.lastPath=i}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var r={};r.createFilter=e,r.createAlphaToLuminanceFilter=t;function e(i,s){var n=createNS("filter");return n.setAttribute("id",i),s!==!0&&(n.setAttribute("filterUnits","objectBoundingBox"),n.setAttribute("x","0%"),n.setAttribute("y","0%"),n.setAttribute("width","100%"),n.setAttribute("height","100%")),n}function t(){var i=createNS("feColorMatrix");return i.setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),i}return r}(),featureSupport=function(){var r={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas!="undefined"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(r.maskType=!1),/firefox/i.test(navigator.userAgent)&&(r.svgLumaHidden=!1),r}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(r){var e,t="SourceGraphic",i=r.data.ef?r.data.ef.length:0,s=createElementID(),n=filtersFactory.createFilter(s,!0),a=0;this.filters=[];var o;for(e=0;e<i;e+=1){o=null;var l=r.data.ef[e].ty;if(registeredEffects$1[l]){var c=registeredEffects$1[l].effect;o=new c(n,r.effectsManager.effectElements[e],r,idPrefix+a,t),t=idPrefix+a,registeredEffects$1[l].countsAsEffect&&(a+=1)}o&&this.filters.push(o)}a&&(r.globalData.defs.appendChild(n),r.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+s+")")),this.filters.length&&r.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(r){var e,t=this.filters.length;for(e=0;e<t;e+=1)this.filters[e].renderFrame(r)},SVGEffects.prototype.getEffects=function(r){var e,t=this.filters.length,i=[];for(e=0;e<t;e+=1)this.filters[e].type===r&&i.push(this.filters[e]);return i};function registerEffect$1(r,e,t){registeredEffects$1[r]={effect:e,countsAsEffect:t}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var e=null;if(this.data.td){this.matteMasks={};var t=createNS("g");t.setAttribute("id",this.layerId),t.appendChild(this.layerElement),e=t,this.globalData.defs.appendChild(t)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),e=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var i=createNS("clipPath"),s=createNS("path");s.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var n=createElementID();if(i.setAttribute("id",n),i.appendChild(s),this.globalData.defs.appendChild(i),this.checkMasks()){var a=createNS("g");a.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),a.appendChild(this.layerElement),this.transformedElement=a,e?e.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(e){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[e]){var t=this.layerId+"_"+e,i,s,n,a;if(e===1||e===3){var o=createNS("mask");o.setAttribute("id",t),o.setAttribute("mask-type",e===3?"luminance":"alpha"),n=createNS("use"),n.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),o.appendChild(n),this.globalData.defs.appendChild(o),!featureSupport.maskType&&e===1&&(o.setAttribute("mask-type","luminance"),i=createElementID(),s=filtersFactory.createFilter(i),this.globalData.defs.appendChild(s),s.appendChild(filtersFactory.createAlphaToLuminanceFilter()),a=createNS("g"),a.appendChild(n),o.appendChild(a),a.setAttribute("filter","url("+getLocationHref()+"#"+i+")"))}else if(e===2){var l=createNS("mask");l.setAttribute("id",t),l.setAttribute("mask-type","alpha");var c=createNS("g");l.appendChild(c),i=createElementID(),s=filtersFactory.createFilter(i);var f=createNS("feComponentTransfer");f.setAttribute("in","SourceGraphic"),s.appendChild(f);var d=createNS("feFuncA");d.setAttribute("type","table"),d.setAttribute("tableValues","1.0 0.0"),f.appendChild(d),this.globalData.defs.appendChild(s);var u=createNS("rect");u.setAttribute("width",this.comp.data.w),u.setAttribute("height",this.comp.data.h),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("fill","#ffffff"),u.setAttribute("opacity","0"),c.setAttribute("filter","url("+getLocationHref()+"#"+i+")"),c.appendChild(u),n=createNS("use"),n.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),c.appendChild(n),featureSupport.maskType||(l.setAttribute("mask-type","luminance"),s.appendChild(filtersFactory.createAlphaToLuminanceFilter()),a=createNS("g"),c.appendChild(u),a.appendChild(this.layerElement),c.appendChild(a)),this.globalData.defs.appendChild(l)}this.matteMasks[e]=t}return this.matteMasks[e]},setMatte:function(e){!this.matteElement||this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+e+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(e){this.hierarchy=e},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var r={initElement:function(t,i,s){this.initFrame(),this.initBaseData(t,i,s),this.initTransform(t,i,s),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var t=this.baseElement||this.layerElement;t.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var t=this.baseElement||this.layerElement;t.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(r)],RenderableDOMElement)})();function IImageElement(r,e,t){this.assetData=e.getAssetData(r.refId),this.assetData&&this.assetData.sid&&(this.assetData=e.slotManager.getProp(this.assetData)),this.initElement(r,e,t),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var r=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",r),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(r,e){this.elem=r,this.pos=e}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(e){var t,i=this.shapeModifiers.length;for(t=0;t<i;t+=1)this.shapeModifiers[t].addShape(e)},isShapeInAnimatedModifiers:function(e){for(var t=0,i=this.shapeModifiers.length;t<i;)if(this.shapeModifiers[t].isAnimatedWithShape(e))return!0;return!1},renderModifiers:function(){if(!!this.shapeModifiers.length){var e,t=this.shapes.length;for(e=0;e<t;e+=1)this.shapes[e].sh.reset();t=this.shapeModifiers.length;var i;for(e=t-1;e>=0&&(i=this.shapeModifiers[e].processShapes(this._isFirstFrame),!i);e-=1);}},searchProcessedElement:function(e){for(var t=this.processedElements,i=0,s=t.length;i<s;){if(t[i].elem===e)return t[i].pos;i+=1}return 0},addProcessedElement:function(e,t){for(var i=this.processedElements,s=i.length;s;)if(s-=1,i[s].elem===e){i[s].pos=t;return}i.push(new ProcessedElement(e,t))},prepareFrame:function(e){this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(r,e,t){this.caches=[],this.styles=[],this.transformers=r,this.lStr="",this.sh=t,this.lvl=e,this._isAnimated=!!t.k;for(var i=0,s=r.length;i<s;){if(r[i].mProps.dynamicProperties.length){this._isAnimated=!0;break}i+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(r,e){this.data=r,this.type=r.ty,this.d="",this.lvl=e,this._mdf=!1,this.closed=r.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(r,e,t,i){this.elem=r,this.frameId=-1,this.dataProps=createSizedArray(e.length),this.renderer=t,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",e.length?e.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(i);var s,n=e.length||0,a;for(s=0;s<n;s+=1)a=PropertyFactory.getProp(r,e[s].v,0,0,this),this.k=a.k||this.k,this.dataProps[s]={n:e[s].n,p:a};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(r){if(!(this.elem.globalData.frameId===this.frameId&&!r)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||r,this._mdf)){var e=0,t=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),e=0;e<t;e+=1)this.dataProps[e].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[e].p.v:this.dashArray[e]=this.dataProps[e].p.v:this.dashoffset[0]=this.dataProps[e].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(r,e,t){this.initDynamicPropertyContainer(r),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(r,e.o,0,.01,this),this.w=PropertyFactory.getProp(r,e.w,0,null,this),this.d=new DashProperty(r,e.d||{},"svg",this),this.c=PropertyFactory.getProp(r,e.c,1,255,this),this.style=t,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(r,e,t){this.initDynamicPropertyContainer(r),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(r,e.o,0,.01,this),this.c=PropertyFactory.getProp(r,e.c,1,255,this),this.style=t}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(r,e,t){this.initDynamicPropertyContainer(r),this.getValue=this.iterateDynamicProperties,this.style=t}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(r,e,t){this.data=e,this.c=createTypedArray("uint8c",e.p*4);var i=e.k.k[0].s?e.k.k[0].s.length-e.p*4:e.k.k.length-e.p*4;this.o=createTypedArray("float32",i),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=i,this.initDynamicPropertyContainer(t),this.prop=PropertyFactory.getProp(r,e.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(r,e){for(var t=0,i=this.o.length/2,s;t<i;){if(s=Math.abs(r[t*4]-r[e*4+t*2]),s>.01)return!1;t+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var r=0,e=this.data.k.k.length;r<e;){if(!this.comparePoints(this.data.k.k[r].s,this.data.p))return!1;r+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(r){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||r){var e,t=this.data.p*4,i,s;for(e=0;e<t;e+=1)i=e%4===0?100:255,s=Math.round(this.prop.v[e]*i),this.c[e]!==s&&(this.c[e]=s,this._cmdf=!r);if(this.o.length)for(t=this.prop.v.length,e=this.data.p*4;e<t;e+=1)i=e%2===0?100:1,s=e%2===0?Math.round(this.prop.v[e]*100):this.prop.v[e],this.o[e-this.data.p*4]!==s&&(this.o[e-this.data.p*4]=s,this._omdf=!r);this._mdf=!r}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(r,e,t){this.initDynamicPropertyContainer(r),this.getValue=this.iterateDynamicProperties,this.initGradientData(r,e,t)}SVGGradientFillStyleData.prototype.initGradientData=function(r,e,t){this.o=PropertyFactory.getProp(r,e.o,0,.01,this),this.s=PropertyFactory.getProp(r,e.s,1,null,this),this.e=PropertyFactory.getProp(r,e.e,1,null,this),this.h=PropertyFactory.getProp(r,e.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(r,e.a||{k:0},0,degToRads,this),this.g=new GradientProperty(r,e.g,this),this.style=t,this.stops=[],this.setGradientData(t.pElem,e),this.setGradientOpacity(e,t),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(r,e){var t=createElementID(),i=createNS(e.t===1?"linearGradient":"radialGradient");i.setAttribute("id",t),i.setAttribute("spreadMethod","pad"),i.setAttribute("gradientUnits","userSpaceOnUse");var s=[],n,a,o;for(o=e.g.p*4,a=0;a<o;a+=4)n=createNS("stop"),i.appendChild(n),s.push(n);r.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+t+")"),this.gf=i,this.cst=s},SVGGradientFillStyleData.prototype.setGradientOpacity=function(r,e){if(this.g._hasOpacity&&!this.g._collapsable){var t,i,s,n=createNS("mask"),a=createNS("path");n.appendChild(a);var o=createElementID(),l=createElementID();n.setAttribute("id",l);var c=createNS(r.t===1?"linearGradient":"radialGradient");c.setAttribute("id",o),c.setAttribute("spreadMethod","pad"),c.setAttribute("gradientUnits","userSpaceOnUse"),s=r.g.k.k[0].s?r.g.k.k[0].s.length:r.g.k.k.length;var f=this.stops;for(i=r.g.p*4;i<s;i+=2)t=createNS("stop"),t.setAttribute("stop-color","rgb(255,255,255)"),c.appendChild(t),f.push(t);a.setAttribute(r.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+o+")"),r.ty==="gs"&&(a.setAttribute("stroke-linecap",lineCapEnum[r.lc||2]),a.setAttribute("stroke-linejoin",lineJoinEnum[r.lj||2]),r.lj===1&&a.setAttribute("stroke-miterlimit",r.ml)),this.of=c,this.ms=n,this.ost=f,this.maskId=l,e.msElem=a}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(r,e,t){this.initDynamicPropertyContainer(r),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(r,e.w,0,null,this),this.d=new DashProperty(r,e.d||{},"svg",this),this.initGradientData(r,e,t),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(r,e,t){this.transform={mProps:r,op:e,container:t},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(e,t,i,s){if(t===0)return"";var n=e.o,a=e.i,o=e.v,l,c=" M"+s.applyToPointStringified(o[0][0],o[0][1]);for(l=1;l<t;l+=1)c+=" C"+s.applyToPointStringified(n[l-1][0],n[l-1][1])+" "+s.applyToPointStringified(a[l][0],a[l][1])+" "+s.applyToPointStringified(o[l][0],o[l][1]);return i&&t&&(c+=" C"+s.applyToPointStringified(n[l-1][0],n[l-1][1])+" "+s.applyToPointStringified(a[0][0],a[0][1])+" "+s.applyToPointStringified(o[0][0],o[0][1]),c+="z"),c},SVGElementsRenderer=function(){var r=new Matrix,e=new Matrix,t={createRenderFunction:i};function i(d){switch(d.ty){case"fl":return o;case"gf":return c;case"gs":return l;case"st":return f;case"sh":case"el":case"rc":case"sr":return a;case"tr":return s;case"no":return n;default:return null}}function s(d,u,g){(g||u.transform.op._mdf)&&u.transform.container.setAttribute("opacity",u.transform.op.v),(g||u.transform.mProps._mdf)&&u.transform.container.setAttribute("transform",u.transform.mProps.v.to2dCSS())}function n(){}function a(d,u,g){var p,m,S,y,x,E,T=u.styles.length,A=u.lvl,_,P,k,F;for(E=0;E<T;E+=1){if(y=u.sh._mdf||g,u.styles[E].lvl<A){for(P=e.reset(),k=A-u.styles[E].lvl,F=u.transformers.length-1;!y&&k>0;)y=u.transformers[F].mProps._mdf||y,k-=1,F-=1;if(y)for(k=A-u.styles[E].lvl,F=u.transformers.length-1;k>0;)P.multiply(u.transformers[F].mProps.v),k-=1,F-=1}else P=r;if(_=u.sh.paths,m=_._length,y){for(S="",p=0;p<m;p+=1)x=_.shapes[p],x&&x._length&&(S+=buildShapeString(x,x._length,x.c,P));u.caches[E]=S}else S=u.caches[E];u.styles[E].d+=d.hd===!0?"":S,u.styles[E]._mdf=y||u.styles[E]._mdf}}function o(d,u,g){var p=u.style;(u.c._mdf||g)&&p.pElem.setAttribute("fill","rgb("+bmFloor(u.c.v[0])+","+bmFloor(u.c.v[1])+","+bmFloor(u.c.v[2])+")"),(u.o._mdf||g)&&p.pElem.setAttribute("fill-opacity",u.o.v)}function l(d,u,g){c(d,u,g),f(d,u,g)}function c(d,u,g){var p=u.gf,m=u.g._hasOpacity,S=u.s.v,y=u.e.v;if(u.o._mdf||g){var x=d.ty==="gf"?"fill-opacity":"stroke-opacity";u.style.pElem.setAttribute(x,u.o.v)}if(u.s._mdf||g){var E=d.t===1?"x1":"cx",T=E==="x1"?"y1":"cy";p.setAttribute(E,S[0]),p.setAttribute(T,S[1]),m&&!u.g._collapsable&&(u.of.setAttribute(E,S[0]),u.of.setAttribute(T,S[1]))}var A,_,P,k;if(u.g._cmdf||g){A=u.cst;var F=u.g.c;for(P=A.length,_=0;_<P;_+=1)k=A[_],k.setAttribute("offset",F[_*4]+"%"),k.setAttribute("stop-color","rgb("+F[_*4+1]+","+F[_*4+2]+","+F[_*4+3]+")")}if(m&&(u.g._omdf||g)){var M=u.g.o;for(u.g._collapsable?A=u.cst:A=u.ost,P=A.length,_=0;_<P;_+=1)k=A[_],u.g._collapsable||k.setAttribute("offset",M[_*2]+"%"),k.setAttribute("stop-opacity",M[_*2+1])}if(d.t===1)(u.e._mdf||g)&&(p.setAttribute("x2",y[0]),p.setAttribute("y2",y[1]),m&&!u.g._collapsable&&(u.of.setAttribute("x2",y[0]),u.of.setAttribute("y2",y[1])));else{var B;if((u.s._mdf||u.e._mdf||g)&&(B=Math.sqrt(Math.pow(S[0]-y[0],2)+Math.pow(S[1]-y[1],2)),p.setAttribute("r",B),m&&!u.g._collapsable&&u.of.setAttribute("r",B)),u.e._mdf||u.h._mdf||u.a._mdf||g){B||(B=Math.sqrt(Math.pow(S[0]-y[0],2)+Math.pow(S[1]-y[1],2)));var N=Math.atan2(y[1]-S[1],y[0]-S[0]),G=u.h.v;G>=1?G=.99:G<=-1&&(G=-.99);var U=B*G,O=Math.cos(N+u.a.v)*U+S[0],L=Math.sin(N+u.a.v)*U+S[1];p.setAttribute("fx",O),p.setAttribute("fy",L),m&&!u.g._collapsable&&(u.of.setAttribute("fx",O),u.of.setAttribute("fy",L))}}}function f(d,u,g){var p=u.style,m=u.d;m&&(m._mdf||g)&&m.dashStr&&(p.pElem.setAttribute("stroke-dasharray",m.dashStr),p.pElem.setAttribute("stroke-dashoffset",m.dashoffset[0])),u.c&&(u.c._mdf||g)&&p.pElem.setAttribute("stroke","rgb("+bmFloor(u.c.v[0])+","+bmFloor(u.c.v[1])+","+bmFloor(u.c.v[2])+")"),(u.o._mdf||g)&&p.pElem.setAttribute("stroke-opacity",u.o.v),(u.w._mdf||g)&&(p.pElem.setAttribute("stroke-width",u.w.v),p.msElem&&p.msElem.setAttribute("stroke-width",u.w.v))}return t}();function SVGShapeElement(r,e,t){this.shapes=[],this.shapesData=r.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(r,e,t),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var r,e=this.shapes.length,t,i,s=this.stylesList.length,n,a=[],o=!1;for(i=0;i<s;i+=1){for(n=this.stylesList[i],o=!1,a.length=0,r=0;r<e;r+=1)t=this.shapes[r],t.styles.indexOf(n)!==-1&&(a.push(t),o=t._isAnimated||o);a.length>1&&o&&this.setShapesAsAnimated(a)}},SVGShapeElement.prototype.setShapesAsAnimated=function(r){var e,t=r.length;for(e=0;e<t;e+=1)r[e].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(r,e){var t,i=new SVGStyleData(r,e),s=i.pElem;if(r.ty==="st")t=new SVGStrokeStyleData(this,r,i);else if(r.ty==="fl")t=new SVGFillStyleData(this,r,i);else if(r.ty==="gf"||r.ty==="gs"){var n=r.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;t=new n(this,r,i),this.globalData.defs.appendChild(t.gf),t.maskId&&(this.globalData.defs.appendChild(t.ms),this.globalData.defs.appendChild(t.of),s.setAttribute("mask","url("+getLocationHref()+"#"+t.maskId+")"))}else r.ty==="no"&&(t=new SVGNoStyleData(this,r,i));return(r.ty==="st"||r.ty==="gs")&&(s.setAttribute("stroke-linecap",lineCapEnum[r.lc||2]),s.setAttribute("stroke-linejoin",lineJoinEnum[r.lj||2]),s.setAttribute("fill-opacity","0"),r.lj===1&&s.setAttribute("stroke-miterlimit",r.ml)),r.r===2&&s.setAttribute("fill-rule","evenodd"),r.ln&&s.setAttribute("id",r.ln),r.cl&&s.setAttribute("class",r.cl),r.bm&&(s.style["mix-blend-mode"]=getBlendMode(r.bm)),this.stylesList.push(i),this.addToAnimatedContents(r,t),t},SVGShapeElement.prototype.createGroupElement=function(r){var e=new ShapeGroupData;return r.ln&&e.gr.setAttribute("id",r.ln),r.cl&&e.gr.setAttribute("class",r.cl),r.bm&&(e.gr.style["mix-blend-mode"]=getBlendMode(r.bm)),e},SVGShapeElement.prototype.createTransformElement=function(r,e){var t=TransformPropertyFactory.getTransformProperty(this,r,this),i=new SVGTransformData(t,t.o,e);return this.addToAnimatedContents(r,i),i},SVGShapeElement.prototype.createShapeElement=function(r,e,t){var i=4;r.ty==="rc"?i=5:r.ty==="el"?i=6:r.ty==="sr"&&(i=7);var s=ShapePropertyFactory.getShapeProp(this,r,i,this),n=new SVGShapeData(e,t,s);return this.shapes.push(n),this.addShapeToModifiers(n),this.addToAnimatedContents(r,n),n},SVGShapeElement.prototype.addToAnimatedContents=function(r,e){for(var t=0,i=this.animatedContents.length;t<i;){if(this.animatedContents[t].element===e)return;t+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(r),element:e,data:r})},SVGShapeElement.prototype.setElementStyles=function(r){var e=r.styles,t,i=this.stylesList.length;for(t=0;t<i;t+=1)this.stylesList[t].closed||e.push(this.stylesList[t])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var r,e=this.itemsData.length;for(r=0;r<e;r+=1)this.prevViewData[r]=this.itemsData[r];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),e=this.dynamicProperties.length,r=0;r<e;r+=1)this.dynamicProperties[r].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(r,e,t,i,s,n,a){var o=[].concat(n),l,c=r.length-1,f,d,u=[],g=[],p,m,S;for(l=c;l>=0;l-=1){if(S=this.searchProcessedElement(r[l]),S?e[l]=t[S-1]:r[l]._render=a,r[l].ty==="fl"||r[l].ty==="st"||r[l].ty==="gf"||r[l].ty==="gs"||r[l].ty==="no")S?e[l].style.closed=!1:e[l]=this.createStyleElement(r[l],s),r[l]._render&&e[l].style.pElem.parentNode!==i&&i.appendChild(e[l].style.pElem),u.push(e[l].style);else if(r[l].ty==="gr"){if(!S)e[l]=this.createGroupElement(r[l]);else for(d=e[l].it.length,f=0;f<d;f+=1)e[l].prevViewData[f]=e[l].it[f];this.searchShapes(r[l].it,e[l].it,e[l].prevViewData,e[l].gr,s+1,o,a),r[l]._render&&e[l].gr.parentNode!==i&&i.appendChild(e[l].gr)}else r[l].ty==="tr"?(S||(e[l]=this.createTransformElement(r[l],i)),p=e[l].transform,o.push(p)):r[l].ty==="sh"||r[l].ty==="rc"||r[l].ty==="el"||r[l].ty==="sr"?(S||(e[l]=this.createShapeElement(r[l],o,s)),this.setElementStyles(e[l])):r[l].ty==="tm"||r[l].ty==="rd"||r[l].ty==="ms"||r[l].ty==="pb"||r[l].ty==="zz"||r[l].ty==="op"?(S?(m=e[l],m.closed=!1):(m=ShapeModifiers.getModifier(r[l].ty),m.init(this,r[l]),e[l]=m,this.shapeModifiers.push(m)),g.push(m)):r[l].ty==="rp"&&(S?(m=e[l],m.closed=!0):(m=ShapeModifiers.getModifier(r[l].ty),e[l]=m,m.init(this,r,l,e),this.shapeModifiers.push(m),a=!1),g.push(m));this.addProcessedElement(r[l],l+1)}for(c=u.length,l=0;l<c;l+=1)u[l].closed=!0;for(c=g.length,l=0;l<c;l+=1)g[l].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var r,e=this.stylesList.length;for(r=0;r<e;r+=1)this.stylesList[r].reset();for(this.renderShape(),r=0;r<e;r+=1)(this.stylesList[r]._mdf||this._isFirstFrame)&&(this.stylesList[r].msElem&&(this.stylesList[r].msElem.setAttribute("d",this.stylesList[r].d),this.stylesList[r].d="M0 0"+this.stylesList[r].d),this.stylesList[r].pElem.setAttribute("d",this.stylesList[r].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var r,e=this.animatedContents.length,t;for(r=0;r<e;r+=1)t=this.animatedContents[r],(this._isFirstFrame||t.element._isAnimated)&&t.data!==!0&&t.fn(t.data,t.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(r,e,t,i,s,n){this.o=r,this.sw=e,this.sc=t,this.fc=i,this.m=s,this.p=n,this._mdf={o:!0,sw:!!e,sc:!!t,fc:!!i,m:!0,p:!0}}LetterProps.prototype.update=function(r,e,t,i,s,n){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var a=!1;return this.o!==r&&(this.o=r,this._mdf.o=!0,a=!0),this.sw!==e&&(this.sw=e,this._mdf.sw=!0,a=!0),this.sc!==t&&(this.sc=t,this._mdf.sc=!0,a=!0),this.fc!==i&&(this.fc=i,this._mdf.fc=!0,a=!0),this.m!==s&&(this.m=s,this._mdf.m=!0,a=!0),n.length&&(this.p[0]!==n[0]||this.p[1]!==n[1]||this.p[4]!==n[4]||this.p[5]!==n[5]||this.p[12]!==n[12]||this.p[13]!==n[13])&&(this.p=n,this._mdf.p=!0,a=!0),a};function TextProperty(r,e){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,e.d&&e.d.sid&&(e.d=r.globalData.slotManager.getProp(e.d)),this.data=e,this.elem=r,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(r,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r},TextProperty.prototype.setCurrentData=function(r){r.__complete||this.completeTextData(r),this.currentData=r,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(r){this.effectsSequence.push(r),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(r){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!r)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var e=this.currentData,t=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var i,s=this.effectsSequence.length,n=r||this.data.d.k[this.keysIndex].s;for(i=0;i<s;i+=1)t!==this.keysIndex?n=this.effectsSequence[i](n,n.t):n=this.effectsSequence[i](this.currentData,n.t);e!==n&&this.setCurrentData(n),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var r=this.data.d.k,e=this.elem.comp.renderedFrame,t=0,i=r.length;t<=i-1&&!(t===i-1||r[t+1].t>e);)t+=1;return this.keysIndex!==t&&(this.keysIndex=t),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(r){for(var e=[],t=0,i=r.length,s,n,a=!1,o=!1,l="";t<i;)a=o,o=!1,s=r.charCodeAt(t),l=r.charAt(t),FontManager.isCombinedCharacter(s)?a=!0:s>=55296&&s<=56319?FontManager.isRegionalFlag(r,t)?l=r.substr(t,14):(n=r.charCodeAt(t+1),n>=56320&&n<=57343&&(FontManager.isModifier(s,n)?(l=r.substr(t,2),a=!0):FontManager.isFlagEmoji(r.substr(t,4))?l=r.substr(t,4):l=r.substr(t,2))):s>56319?(n=r.charCodeAt(t+1),FontManager.isVariationSelector(s)&&(a=!0)):FontManager.isZeroWidthJoiner(s)&&(a=!0,o=!0),a?(e[e.length-1]+=l,a=!1):e.push(l),t+=l.length;return e},TextProperty.prototype.completeTextData=function(r){r.__complete=!0;var e=this.elem.globalData.fontManager,t=this.data,i=[],s,n,a,o=0,l,c=t.m.g,f=0,d=0,u=0,g=[],p=0,m=0,S,y,x=e.getFontByName(r.f),E,T=0,A=getFontProperties(x);r.fWeight=A.weight,r.fStyle=A.style,r.finalSize=r.s,r.finalText=this.buildFinalText(r.t),n=r.finalText.length,r.finalLineHeight=r.lh;var _=r.tr/1e3*r.finalSize,P;if(r.sz)for(var k=!0,F=r.sz[0],M=r.sz[1],B,N;k;){N=this.buildFinalText(r.t),B=0,p=0,n=N.length,_=r.tr/1e3*r.finalSize;var G=-1;for(s=0;s<n;s+=1)P=N[s].charCodeAt(0),a=!1,N[s]===" "?G=s:(P===13||P===3)&&(p=0,a=!0,B+=r.finalLineHeight||r.finalSize*1.2),e.chars?(E=e.getCharData(N[s],x.fStyle,x.fFamily),T=a?0:E.w*r.finalSize/100):T=e.measureText(N[s],r.f,r.finalSize),p+T>F&&N[s]!==" "?(G===-1?n+=1:s=G,B+=r.finalLineHeight||r.finalSize*1.2,N.splice(s,G===s?1:0,"\r"),G=-1,p=0):(p+=T,p+=_);B+=x.ascent*r.finalSize/100,this.canResize&&r.finalSize>this.minimumFontSize&&M<B?(r.finalSize-=1,r.finalLineHeight=r.finalSize*r.lh/r.s):(r.finalText=N,n=r.finalText.length,k=!1)}p=-_,T=0;var U=0,O;for(s=0;s<n;s+=1)if(a=!1,O=r.finalText[s],P=O.charCodeAt(0),P===13||P===3?(U=0,g.push(p),m=p>m?p:m,p=-2*_,l="",a=!0,u+=1):l=O,e.chars?(E=e.getCharData(O,x.fStyle,e.getFontByName(r.f).fFamily),T=a?0:E.w*r.finalSize/100):T=e.measureText(l,r.f,r.finalSize),O===" "?U+=T+_:(p+=T+_+U,U=0),i.push({l:T,an:T,add:f,n:a,anIndexes:[],val:l,line:u,animatorJustifyOffset:0}),c==2){if(f+=T,l===""||l===" "||s===n-1){for((l===""||l===" ")&&(f-=T);d<=s;)i[d].an=f,i[d].ind=o,i[d].extra=T,d+=1;o+=1,f=0}}else if(c==3){if(f+=T,l===""||s===n-1){for(l===""&&(f-=T);d<=s;)i[d].an=f,i[d].ind=o,i[d].extra=T,d+=1;f=0,o+=1}}else i[o].ind=o,i[o].extra=0,o+=1;if(r.l=i,m=p>m?p:m,g.push(p),r.sz)r.boxWidth=r.sz[0],r.justifyOffset=0;else switch(r.boxWidth=m,r.j){case 1:r.justifyOffset=-r.boxWidth;break;case 2:r.justifyOffset=-r.boxWidth/2;break;default:r.justifyOffset=0}r.lineWidths=g;var L=t.a,D,b;y=L.length;var C,I,R=[];for(S=0;S<y;S+=1){for(D=L[S],D.a.sc&&(r.strokeColorAnim=!0),D.a.sw&&(r.strokeWidthAnim=!0),(D.a.fc||D.a.fh||D.a.fs||D.a.fb)&&(r.fillColorAnim=!0),I=0,C=D.s.b,s=0;s<n;s+=1)b=i[s],b.anIndexes[S]=I,(C==1&&b.val!==""||C==2&&b.val!==""&&b.val!==" "||C==3&&(b.n||b.val==" "||s==n-1)||C==4&&(b.n||s==n-1))&&(D.s.rn===1&&R.push(I),I+=1);t.a[S].s.totalChars=I;var V=-1,$;if(D.s.rn===1)for(s=0;s<n;s+=1)b=i[s],V!=b.anIndexes[S]&&(V=b.anIndexes[S],$=R.splice(Math.floor(Math.random()*R.length),1)[0]),b.anIndexes[S]=$}r.yOffset=r.finalLineHeight||r.finalSize*1.2,r.ls=r.ls||0,r.ascent=x.ascent*r.finalSize/100},TextProperty.prototype.updateDocumentData=function(r,e){e=e===void 0?this.keysIndex:e;var t=this.copyData({},this.data.d.k[e].s);t=this.copyData(t,r),this.data.d.k[e].s=t,this.recalculate(e),this.setCurrentData(t),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(r){var e=this.data.d.k[r].s;e.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(e)},TextProperty.prototype.canResizeFont=function(r){this.canResize=r,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(r){this.minimumFontSize=Math.floor(r)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var r=Math.max,e=Math.min,t=Math.floor;function i(n,a){this._currentTextLength=-1,this.k=!1,this.data=a,this.elem=n,this.comp=n.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(n),this.s=PropertyFactory.getProp(n,a.s||{k:0},0,0,this),"e"in a?this.e=PropertyFactory.getProp(n,a.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(n,a.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(n,a.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(n,a.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(n,a.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(n,a.a,0,.01,this),this.dynamicProperties.length||this.getValue()}i.prototype={getMult:function(a){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var o=0,l=0,c=1,f=1;this.ne.v>0?o=this.ne.v/100:l=-this.ne.v/100,this.xe.v>0?c=1-this.xe.v/100:f=1+this.xe.v/100;var d=BezierFactory.getBezierEasing(o,l,c,f).get,u=0,g=this.finalS,p=this.finalE,m=this.data.sh;if(m===2)p===g?u=a>=p?1:0:u=r(0,e(.5/(p-g)+(a-g)/(p-g),1)),u=d(u);else if(m===3)p===g?u=a>=p?0:1:u=1-r(0,e(.5/(p-g)+(a-g)/(p-g),1)),u=d(u);else if(m===4)p===g?u=0:(u=r(0,e(.5/(p-g)+(a-g)/(p-g),1)),u<.5?u*=2:u=1-2*(u-.5)),u=d(u);else if(m===5){if(p===g)u=0;else{var S=p-g;a=e(r(0,a+.5-g),p-g);var y=-S/2+a,x=S/2;u=Math.sqrt(1-y*y/(x*x))}u=d(u)}else m===6?(p===g?u=0:(a=e(r(0,a+.5-g),p-g),u=(1+Math.cos(Math.PI+Math.PI*2*a/(p-g)))/2),u=d(u)):(a>=t(g)&&(a-g<0?u=r(0,e(e(p,1)-(g-a),1)):u=r(0,e(p-a,1))),u=d(u));if(this.sm.v!==100){var E=this.sm.v*.01;E===0&&(E=1e-8);var T=.5-E*.5;u<T?u=0:(u=(u-T)/E,u>1&&(u=1))}return u*this.a.v},getValue:function(a){this.iterateDynamicProperties(),this._mdf=a||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,a&&this.data.r===2&&(this.e.v=this._currentTextLength);var o=this.data.r===2?1:100/this.data.totalChars,l=this.o.v/o,c=this.s.v/o+l,f=this.e.v/o+l;if(c>f){var d=c;c=f,f=d}this.finalS=c,this.finalE=f}},extendPrototype([DynamicPropertyContainer],i);function s(n,a,o){return new i(n,a)}return{getTextSelectorProp:s}}();function TextAnimatorDataProperty(r,e,t){var i={propType:!1},s=PropertyFactory.getProp,n=e.a;this.a={r:n.r?s(r,n.r,0,degToRads,t):i,rx:n.rx?s(r,n.rx,0,degToRads,t):i,ry:n.ry?s(r,n.ry,0,degToRads,t):i,sk:n.sk?s(r,n.sk,0,degToRads,t):i,sa:n.sa?s(r,n.sa,0,degToRads,t):i,s:n.s?s(r,n.s,1,.01,t):i,a:n.a?s(r,n.a,1,0,t):i,o:n.o?s(r,n.o,0,.01,t):i,p:n.p?s(r,n.p,1,0,t):i,sw:n.sw?s(r,n.sw,0,0,t):i,sc:n.sc?s(r,n.sc,1,0,t):i,fc:n.fc?s(r,n.fc,1,0,t):i,fh:n.fh?s(r,n.fh,0,0,t):i,fs:n.fs?s(r,n.fs,0,.01,t):i,fb:n.fb?s(r,n.fb,0,.01,t):i,t:n.t?s(r,n.t,0,0,t):i},this.s=TextSelectorProp.getTextSelectorProp(r,e.s,t),this.s.t=e.s.t}function TextAnimatorProperty(r,e,t){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=r,this._renderType=e,this._elem=t,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(t)}TextAnimatorProperty.prototype.searchProperties=function(){var r,e=this._textData.a.length,t,i=PropertyFactory.getProp;for(r=0;r<e;r+=1)t=this._textData.a[r],this._animatorsData[r]=new TextAnimatorDataProperty(this._elem,t,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:i(this._elem,this._textData.p.a,0,0,this),f:i(this._elem,this._textData.p.f,0,0,this),l:i(this._elem,this._textData.p.l,0,0,this),r:i(this._elem,this._textData.p.r,0,0,this),p:i(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=i(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(r,e){if(this.lettersChangedFlag=e,!(!this._mdf&&!this._isFirstFrame&&!e&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var t=this._moreOptions.alignment.v,i=this._animatorsData,s=this._textData,n=this.mHelper,a=this._renderType,o=this.renderedLetters.length,l,c,f,d,u=r.l,g,p,m,S,y,x,E,T,A,_,P,k,F,M,B;if(this._hasMaskedPath){if(B=this._pathData.m,!this._pathData.n||this._pathData._mdf){var N=B.v;this._pathData.r.v&&(N=N.reverse()),g={tLength:0,segments:[]},d=N._length-1;var G;for(k=0,f=0;f<d;f+=1)G=bez.buildBezierData(N.v[f],N.v[f+1],[N.o[f][0]-N.v[f][0],N.o[f][1]-N.v[f][1]],[N.i[f+1][0]-N.v[f+1][0],N.i[f+1][1]-N.v[f+1][1]]),g.tLength+=G.segmentLength,g.segments.push(G),k+=G.segmentLength;f=d,B.v.c&&(G=bez.buildBezierData(N.v[f],N.v[0],[N.o[f][0]-N.v[f][0],N.o[f][1]-N.v[f][1]],[N.i[0][0]-N.v[0][0],N.i[0][1]-N.v[0][1]]),g.tLength+=G.segmentLength,g.segments.push(G),k+=G.segmentLength),this._pathData.pi=g}if(g=this._pathData.pi,p=this._pathData.f.v,E=0,x=1,S=0,y=!0,_=g.segments,p<0&&B.v.c)for(g.tLength<Math.abs(p)&&(p=-Math.abs(p)%g.tLength),E=_.length-1,A=_[E].points,x=A.length-1;p<0;)p+=A[x].partialLength,x-=1,x<0&&(E-=1,A=_[E].points,x=A.length-1);A=_[E].points,T=A[x-1],m=A[x],P=m.partialLength}d=u.length,l=0,c=0;var U=r.finalSize*1.2*.714,O=!0,L,D,b,C,I;C=i.length;var R,V=-1,$,H,z,W=p,j=E,Y=x,Q=-1,Z,X,ee,q,K,se,le,ne,ie="",ae=this.defaultPropsArray,oe;if(r.j===2||r.j===1){var J=0,he=0,ce=r.j===2?-.5:-1,te=0,fe=!0;for(f=0;f<d;f+=1)if(u[f].n){for(J&&(J+=he);te<f;)u[te].animatorJustifyOffset=J,te+=1;J=0,fe=!0}else{for(b=0;b<C;b+=1)L=i[b].a,L.t.propType&&(fe&&r.j===2&&(he+=L.t.v*ce),D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),R.length?J+=L.t.v*R[0]*ce:J+=L.t.v*R*ce);fe=!1}for(J&&(J+=he);te<f;)u[te].animatorJustifyOffset=J,te+=1}for(f=0;f<d;f+=1){if(n.reset(),Z=1,u[f].n)l=0,c+=r.yOffset,c+=O?1:0,p=W,O=!1,this._hasMaskedPath&&(E=j,x=Y,A=_[E].points,T=A[x-1],m=A[x],P=m.partialLength,S=0),ie="",ne="",se="",oe="",ae=this.defaultPropsArray;else{if(this._hasMaskedPath){if(Q!==u[f].line){switch(r.j){case 1:p+=k-r.lineWidths[u[f].line];break;case 2:p+=(k-r.lineWidths[u[f].line])/2;break}Q=u[f].line}V!==u[f].ind&&(u[V]&&(p+=u[V].extra),p+=u[f].an/2,V=u[f].ind),p+=t[0]*u[f].an*.005;var re=0;for(b=0;b<C;b+=1)L=i[b].a,L.p.propType&&(D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),R.length?re+=L.p.v[0]*R[0]:re+=L.p.v[0]*R),L.a.propType&&(D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),R.length?re+=L.a.v[0]*R[0]:re+=L.a.v[0]*R);for(y=!0,this._pathData.a.v&&(p=u[0].an*.5+(k-this._pathData.f.v-u[0].an*.5-u[u.length-1].an*.5)*V/(d-1),p+=this._pathData.f.v);y;)S+P>=p+re||!A?(F=(p+re-S)/m.partialLength,H=T.point[0]+(m.point[0]-T.point[0])*F,z=T.point[1]+(m.point[1]-T.point[1])*F,n.translate(-t[0]*u[f].an*.005,-(t[1]*U)*.01),y=!1):A&&(S+=m.partialLength,x+=1,x>=A.length&&(x=0,E+=1,_[E]?A=_[E].points:B.v.c?(x=0,E=0,A=_[E].points):(S-=m.partialLength,A=null)),A&&(T=m,m=A[x],P=m.partialLength));$=u[f].an/2-u[f].add,n.translate(-$,0,0)}else $=u[f].an/2-u[f].add,n.translate(-$,0,0),n.translate(-t[0]*u[f].an*.005,-t[1]*U*.01,0);for(b=0;b<C;b+=1)L=i[b].a,L.t.propType&&(D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),(l!==0||r.j!==0)&&(this._hasMaskedPath?R.length?p+=L.t.v*R[0]:p+=L.t.v*R:R.length?l+=L.t.v*R[0]:l+=L.t.v*R));for(r.strokeWidthAnim&&(ee=r.sw||0),r.strokeColorAnim&&(r.sc?X=[r.sc[0],r.sc[1],r.sc[2]]:X=[0,0,0]),r.fillColorAnim&&r.fc&&(q=[r.fc[0],r.fc[1],r.fc[2]]),b=0;b<C;b+=1)L=i[b].a,L.a.propType&&(D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),R.length?n.translate(-L.a.v[0]*R[0],-L.a.v[1]*R[1],L.a.v[2]*R[2]):n.translate(-L.a.v[0]*R,-L.a.v[1]*R,L.a.v[2]*R));for(b=0;b<C;b+=1)L=i[b].a,L.s.propType&&(D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),R.length?n.scale(1+(L.s.v[0]-1)*R[0],1+(L.s.v[1]-1)*R[1],1):n.scale(1+(L.s.v[0]-1)*R,1+(L.s.v[1]-1)*R,1));for(b=0;b<C;b+=1){if(L=i[b].a,D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),L.sk.propType&&(R.length?n.skewFromAxis(-L.sk.v*R[0],L.sa.v*R[1]):n.skewFromAxis(-L.sk.v*R,L.sa.v*R)),L.r.propType&&(R.length?n.rotateZ(-L.r.v*R[2]):n.rotateZ(-L.r.v*R)),L.ry.propType&&(R.length?n.rotateY(L.ry.v*R[1]):n.rotateY(L.ry.v*R)),L.rx.propType&&(R.length?n.rotateX(L.rx.v*R[0]):n.rotateX(L.rx.v*R)),L.o.propType&&(R.length?Z+=(L.o.v*R[0]-Z)*R[0]:Z+=(L.o.v*R-Z)*R),r.strokeWidthAnim&&L.sw.propType&&(R.length?ee+=L.sw.v*R[0]:ee+=L.sw.v*R),r.strokeColorAnim&&L.sc.propType)for(K=0;K<3;K+=1)R.length?X[K]+=(L.sc.v[K]-X[K])*R[0]:X[K]+=(L.sc.v[K]-X[K])*R;if(r.fillColorAnim&&r.fc){if(L.fc.propType)for(K=0;K<3;K+=1)R.length?q[K]+=(L.fc.v[K]-q[K])*R[0]:q[K]+=(L.fc.v[K]-q[K])*R;L.fh.propType&&(R.length?q=addHueToRGB(q,L.fh.v*R[0]):q=addHueToRGB(q,L.fh.v*R)),L.fs.propType&&(R.length?q=addSaturationToRGB(q,L.fs.v*R[0]):q=addSaturationToRGB(q,L.fs.v*R)),L.fb.propType&&(R.length?q=addBrightnessToRGB(q,L.fb.v*R[0]):q=addBrightnessToRGB(q,L.fb.v*R))}}for(b=0;b<C;b+=1)L=i[b].a,L.p.propType&&(D=i[b].s,R=D.getMult(u[f].anIndexes[b],s.a[b].s.totalChars),this._hasMaskedPath?R.length?n.translate(0,L.p.v[1]*R[0],-L.p.v[2]*R[1]):n.translate(0,L.p.v[1]*R,-L.p.v[2]*R):R.length?n.translate(L.p.v[0]*R[0],L.p.v[1]*R[1],-L.p.v[2]*R[2]):n.translate(L.p.v[0]*R,L.p.v[1]*R,-L.p.v[2]*R));if(r.strokeWidthAnim&&(se=ee<0?0:ee),r.strokeColorAnim&&(le="rgb("+Math.round(X[0]*255)+","+Math.round(X[1]*255)+","+Math.round(X[2]*255)+")"),r.fillColorAnim&&r.fc&&(ne="rgb("+Math.round(q[0]*255)+","+Math.round(q[1]*255)+","+Math.round(q[2]*255)+")"),this._hasMaskedPath){if(n.translate(0,-r.ls),n.translate(0,t[1]*U*.01+c,0),this._pathData.p.v){M=(m.point[1]-T.point[1])/(m.point[0]-T.point[0]);var ue=Math.atan(M)*180/Math.PI;m.point[0]<T.point[0]&&(ue+=180),n.rotate(-ue*Math.PI/180)}n.translate(H,z,0),p-=t[0]*u[f].an*.005,u[f+1]&&V!==u[f+1].ind&&(p+=u[f].an/2,p+=r.tr*.001*r.finalSize)}else{switch(n.translate(l,c,0),r.ps&&n.translate(r.ps[0],r.ps[1]+r.ascent,0),r.j){case 1:n.translate(u[f].animatorJustifyOffset+r.justifyOffset+(r.boxWidth-r.lineWidths[u[f].line]),0,0);break;case 2:n.translate(u[f].animatorJustifyOffset+r.justifyOffset+(r.boxWidth-r.lineWidths[u[f].line])/2,0,0);break}n.translate(0,-r.ls),n.translate($,0,0),n.translate(t[0]*u[f].an*.005,t[1]*U*.01,0),l+=u[f].l+r.tr*.001*r.finalSize}a==="html"?ie=n.toCSS():a==="svg"?ie=n.to2dCSS():ae=[n.props[0],n.props[1],n.props[2],n.props[3],n.props[4],n.props[5],n.props[6],n.props[7],n.props[8],n.props[9],n.props[10],n.props[11],n.props[12],n.props[13],n.props[14],n.props[15]],oe=Z}o<=f?(I=new LetterProps(oe,se,le,ne,ie,ae),this.renderedLetters.push(I),o+=1,this.lettersChangedFlag=!0):(I=this.renderedLetters[f],this.lettersChangedFlag=I.update(oe,se,le,ne,ie,ae)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(r,e,t){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(r,e,t),this.textProperty=new TextProperty(this,r.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(r.t,this.renderType,this),this.initTransform(r,e,t),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(r){this._mdf=!1,this.prepareRenderableFrame(r),this.prepareProperties(r,this.isInRange)},ITextElement.prototype.createPathShape=function(r,e){var t,i=e.length,s,n="";for(t=0;t<i;t+=1)e[t].ty==="sh"&&(s=e[t].ks.k,n+=buildShapeString(s,s.i.length,!0,r));return n},ITextElement.prototype.updateDocumentData=function(r,e){this.textProperty.updateDocumentData(r,e)},ITextElement.prototype.canResizeFont=function(r){this.textProperty.canResizeFont(r)},ITextElement.prototype.setMinimumFontSize=function(r){this.textProperty.setMinimumFontSize(r)},ITextElement.prototype.applyTextPropertiesToMatrix=function(r,e,t,i,s){switch(r.ps&&e.translate(r.ps[0],r.ps[1]+r.ascent,0),e.translate(0,-r.ls,0),r.j){case 1:e.translate(r.justifyOffset+(r.boxWidth-r.lineWidths[t]),0,0);break;case 2:e.translate(r.justifyOffset+(r.boxWidth-r.lineWidths[t])/2,0,0);break}e.translate(i,s,0)},ITextElement.prototype.buildColor=function(r){return"rgb("+Math.round(r[0]*255)+","+Math.round(r[1]*255)+","+Math.round(r[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(r,e,t){this.textSpans=[],this.renderType="svg",this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(r){for(var e=0,t=r.length,i=[],s="";e<t;)r[e]===String.fromCharCode(13)||r[e]===String.fromCharCode(3)?(i.push(s),s=""):s+=r[e],e+=1;return i.push(s),i},SVGTextLottieElement.prototype.buildShapeData=function(r,e){if(r.shapes&&r.shapes.length){var t=r.shapes[0];if(t.it){var i=t.it[t.it.length-1];i.s&&(i.s.k[0]=e,i.s.k[1]=e)}}return r},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var r,e,t=this.textProperty.currentData;this.renderedLetters=createSizedArray(t?t.l.length:0),t.fc?this.layerElement.setAttribute("fill",this.buildColor(t.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),t.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(t.sc)),this.layerElement.setAttribute("stroke-width",t.sw)),this.layerElement.setAttribute("font-size",t.finalSize);var i=this.globalData.fontManager.getFontByName(t.f);if(i.fClass)this.layerElement.setAttribute("class",i.fClass);else{this.layerElement.setAttribute("font-family",i.fFamily);var s=t.fWeight,n=t.fStyle;this.layerElement.setAttribute("font-style",n),this.layerElement.setAttribute("font-weight",s)}this.layerElement.setAttribute("aria-label",t.t);var a=t.l||[],o=!!this.globalData.fontManager.chars;e=a.length;var l,c=this.mHelper,f="",d=this.data.singleShape,u=0,g=0,p=!0,m=t.tr*.001*t.finalSize;if(d&&!o&&!t.sz){var S=this.textContainer,y="start";switch(t.j){case 1:y="end";break;case 2:y="middle";break;default:y="start";break}S.setAttribute("text-anchor",y),S.setAttribute("letter-spacing",m);var x=this.buildTextContents(t.finalText);for(e=x.length,g=t.ps?t.ps[1]+t.ascent:0,r=0;r<e;r+=1)l=this.textSpans[r].span||createNS("tspan"),l.textContent=x[r],l.setAttribute("x",0),l.setAttribute("y",g),l.style.display="inherit",S.appendChild(l),this.textSpans[r]||(this.textSpans[r]={span:null,glyph:null}),this.textSpans[r].span=l,g+=t.finalLineHeight;this.layerElement.appendChild(S)}else{var E=this.textSpans.length,T;for(r=0;r<e;r+=1){if(this.textSpans[r]||(this.textSpans[r]={span:null,childSpan:null,glyph:null}),!o||!d||r===0){if(l=E>r?this.textSpans[r].span:createNS(o?"g":"text"),E<=r){if(l.setAttribute("stroke-linecap","butt"),l.setAttribute("stroke-linejoin","round"),l.setAttribute("stroke-miterlimit","4"),this.textSpans[r].span=l,o){var A=createNS("g");l.appendChild(A),this.textSpans[r].childSpan=A}this.textSpans[r].span=l,this.layerElement.appendChild(l)}l.style.display="inherit"}if(c.reset(),d&&(a[r].n&&(u=-m,g+=t.yOffset,g+=p?1:0,p=!1),this.applyTextPropertiesToMatrix(t,c,a[r].line,u,g),u+=a[r].l||0,u+=m),o){T=this.globalData.fontManager.getCharData(t.finalText[r],i.fStyle,this.globalData.fontManager.getFontByName(t.f).fFamily);var _;if(T.t===1)_=new SVGCompElement(T.data,this.globalData,this);else{var P=emptyShapeData;T.data&&T.data.shapes&&(P=this.buildShapeData(T.data,t.finalSize)),_=new SVGShapeElement(P,this.globalData,this)}if(this.textSpans[r].glyph){var k=this.textSpans[r].glyph;this.textSpans[r].childSpan.removeChild(k.layerElement),k.destroy()}this.textSpans[r].glyph=_,_._debug=!0,_.prepareFrame(0),_.renderFrame(),this.textSpans[r].childSpan.appendChild(_.layerElement),T.t===1&&this.textSpans[r].childSpan.setAttribute("transform","scale("+t.finalSize/100+","+t.finalSize/100+")")}else d&&l.setAttribute("transform","translate("+c.props[12]+","+c.props[13]+")"),l.textContent=a[r].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}d&&l&&l.setAttribute("d",f)}for(;r<this.textSpans.length;)this.textSpans[r].span.style.display="none",r+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var r=this.layerElement.getBBox();this.bbox={top:r.y,left:r.x,width:r.width,height:r.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var r,e=this.textSpans.length,t;for(this.renderedFrame=this.comp.renderedFrame,r=0;r<e;r+=1)t=this.textSpans[r].glyph,t&&(t.prepareFrame(this.comp.renderedFrame-this.data.st),t._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var r,e,t=this.textAnimator.renderedLetters,i=this.textProperty.currentData.l;e=i.length;var s,n,a;for(r=0;r<e;r+=1)i[r].n||(s=t[r],n=this.textSpans[r].span,a=this.textSpans[r].glyph,a&&a.renderFrame(),s._mdf.m&&n.setAttribute("transform",s.m),s._mdf.o&&n.setAttribute("opacity",s.o),s._mdf.sw&&n.setAttribute("stroke-width",s.sw),s._mdf.sc&&n.setAttribute("stroke",s.sc),s._mdf.fc&&n.setAttribute("fill",s.fc))}};function ISolidElement(r,e,t){this.initElement(r,e,t)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var r=createNS("rect");r.setAttribute("width",this.data.sw),r.setAttribute("height",this.data.sh),r.setAttribute("fill",this.data.sc),this.layerElement.appendChild(r)};function NullElement(r,e,t){this.initFrame(),this.initBaseData(r,e,t),this.initFrame(),this.initTransform(r,e,t),this.initHierarchy()}NullElement.prototype.prepareFrame=function(r){this.prepareProperties(r,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(r){return new NullElement(r,this.globalData,this)},SVGRendererBase.prototype.createShape=function(r){return new SVGShapeElement(r,this.globalData,this)},SVGRendererBase.prototype.createText=function(r){return new SVGTextLottieElement(r,this.globalData,this)},SVGRendererBase.prototype.createImage=function(r){return new IImageElement(r,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(r){return new ISolidElement(r,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(r){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+r.w+" "+r.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",r.w),this.svgElement.setAttribute("height",r.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var e=this.globalData.defs;this.setupGlobalData(r,e),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=r;var t=createNS("clipPath"),i=createNS("rect");i.setAttribute("width",r.w),i.setAttribute("height",r.h),i.setAttribute("x",0),i.setAttribute("y",0);var s=createElementID();t.setAttribute("id",s),t.appendChild(i),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+s+")"),e.appendChild(t),this.layers=r.layers,this.elements=createSizedArray(r.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var r,e=this.layers?this.layers.length:0;for(r=0;r<e;r+=1)this.elements[r]&&this.elements[r].destroy&&this.elements[r].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(r){var e=0,t=this.layers.length;for(e=0;e<t;e+=1)if(this.layers[e].ind===r)return e;return-1},SVGRendererBase.prototype.buildItem=function(r){var e=this.elements;if(!(e[r]||this.layers[r].ty===99)){e[r]=!0;var t=this.createItem(this.layers[r]);if(e[r]=t,getExpressionsPlugin()&&(this.layers[r].ty===0&&this.globalData.projectInterface.registerComposition(t),t.initExpressions()),this.appendElementInPos(t,r),this.layers[r].tt){var i="tp"in this.layers[r]?this.findIndexByInd(this.layers[r].tp):r-1;if(i===-1)return;if(!this.elements[i]||this.elements[i]===!0)this.buildItem(i),this.addPendingElement(t);else{var s=e[i],n=s.getMatte(this.layers[r].tt);t.setMatte(n)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var r=this.pendingElements.pop();if(r.checkParenting(),r.data.tt)for(var e=0,t=this.elements.length;e<t;){if(this.elements[e]===r){var i="tp"in r.data?this.findIndexByInd(r.data.tp):e-1,s=this.elements[i],n=s.getMatte(this.layers[e].tt);r.setMatte(n);break}e+=1}}},SVGRendererBase.prototype.renderFrame=function(r){if(!(this.renderedFrame===r||this.destroyed)){r===null?r=this.renderedFrame:this.renderedFrame=r,this.globalData.frameNum=r,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=r,this.globalData._mdf=!1;var e,t=this.layers.length;for(this.completeLayers||this.checkLayers(r),e=t-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].prepareFrame(r-this.layers[e].st);if(this.globalData._mdf)for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(r,e){var t=r.getBaseElement();if(!!t){for(var i=0,s;i<e;)this.elements[i]&&this.elements[i]!==!0&&this.elements[i].getBaseElement()&&(s=this.elements[i].getBaseElement()),i+=1;s?this.layerElement.insertBefore(t,s):this.layerElement.appendChild(t)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(r,e,t){this.initFrame(),this.initBaseData(r,e,t),this.initTransform(r,e,t),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!e.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(r){if(this._mdf=!1,this.prepareRenderableFrame(r),this.prepareProperties(r,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=r/this.data.sr;else{var e=this.tm.v;e===this.data.op&&(e=this.data.op-1),this.renderedFrame=e}var t,i=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&(this.elements[t].prepareFrame(this.renderedFrame-this.layers[t].st),this.elements[t]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var r,e=this.layers.length;for(r=0;r<e;r+=1)(this.completeLayers||this.elements[r])&&this.elements[r].renderFrame()},ICompElement.prototype.setElements=function(r){this.elements=r},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var r,e=this.layers.length;for(r=0;r<e;r+=1)this.elements[r]&&this.elements[r].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(r,e,t){this.layers=r.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(r,e,t),this.tm=r.tm?PropertyFactory.getProp(this,r.tm,0,e.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(r){return new SVGCompElement(r,this.globalData,this)};function SVGRenderer(r,e){this.animationItem=r,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var t="";if(e&&e.title){var i=createNS("title"),s=createElementID();i.setAttribute("id",s),i.textContent=e.title,this.svgElement.appendChild(i),t+=s}if(e&&e.description){var n=createNS("desc"),a=createElementID();n.setAttribute("id",a),n.textContent=e.description,this.svgElement.appendChild(n),t+=" "+a}t&&this.svgElement.setAttribute("aria-labelledby",t);var o=createNS("defs");this.svgElement.appendChild(o);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:e&&e.contentVisibility||"visible",progressiveLoad:e&&e.progressiveLoad||!1,hideOnTransparent:!(e&&e.hideOnTransparent===!1),viewBoxOnly:e&&e.viewBoxOnly||!1,viewBoxSize:e&&e.viewBoxSize||!1,className:e&&e.className||"",id:e&&e.id||"",focusable:e&&e.focusable,filterSize:{width:e&&e.filterSize&&e.filterSize.width||"100%",height:e&&e.filterSize&&e.filterSize.height||"100%",x:e&&e.filterSize&&e.filterSize.x||"0%",y:e&&e.filterSize&&e.filterSize.y||"0%"},width:e&&e.width,height:e&&e.height,runExpressions:!e||e.runExpressions===void 0||e.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:o,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(r){return new SVGCompElement(r,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(e){var t,i=e.length,s="_";for(t=0;t<i;t+=1)s+=e[t].transform.key+"_";var n=this.sequences[s];return n||(n={transforms:[].concat(e),finalTransform:new Matrix,_mdf:!1},this.sequences[s]=n,this.sequenceList.push(n)),n},processSequence:function(e,t){for(var i=0,s=e.transforms.length,n=t;i<s&&!t;){if(e.transforms[i].transform.mProps._mdf){n=!0;break}i+=1}if(n)for(e.finalTransform.reset(),i=s-1;i>=0;i-=1)e.finalTransform.multiply(e.transforms[i].transform.mProps.v);e._mdf=n},processSequences:function(e){var t,i=this.sequenceList.length;for(t=0;t<i;t+=1)this.processSequence(this.sequenceList[t],e)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var e="__lottie_element_luma_buffer",t=null,i=null,s=null;function n(){var l=createNS("svg"),c=createNS("filter"),f=createNS("feColorMatrix");return c.setAttribute("id",e),f.setAttribute("type","matrix"),f.setAttribute("color-interpolation-filters","sRGB"),f.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),c.appendChild(f),l.appendChild(c),l.setAttribute("id",e+"_svg"),featureSupport.svgLumaHidden&&(l.style.display="none"),l}function a(){t||(s=n(),document.body.appendChild(s),t=createTag("canvas"),i=t.getContext("2d"),i.filter="url(#"+e+")",i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1))}function o(l){return t||a(),t.width=l.width,t.height=l.height,i.filter="url(#"+e+")",t}return{load:a,get:o}};function createCanvas(r,e){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(r,e);var t=createTag("canvas");return t.width=r,t.height=e,t}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(r){var e,t=r.data.ef?r.data.ef.length:0;this.filters=[];var i;for(e=0;e<t;e+=1){i=null;var s=r.data.ef[e].ty;if(registeredEffects[s]){var n=registeredEffects[s].effect;i=new n(r.effectsManager.effectElements[e],r)}i&&this.filters.push(i)}this.filters.length&&r.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(r){var e,t=this.filters.length;for(e=0;e<t;e+=1)this.filters[e].renderFrame(r)},CVEffects.prototype.getEffects=function(r){var e,t=this.filters.length,i=[];for(e=0;e<t;e+=1)this.filters[e].type===r&&i.push(this.filters[e]);return i};function registerEffect(r,e){registeredEffects[r]={effect:e}}function CVMaskElement(r,e){this.data=r,this.element=e,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var t,i=this.masksProperties.length,s=!1;for(t=0;t<i;t+=1)this.masksProperties[t].mode!=="n"&&(s=!0),this.viewData[t]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[t],3);this.hasMasks=s,s&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(!!this.hasMasks){var r=this.element.finalTransform.mat,e=this.element.canvasContext,t,i=this.masksProperties.length,s,n,a;for(e.beginPath(),t=0;t<i;t+=1)if(this.masksProperties[t].mode!=="n"){this.masksProperties[t].inv&&(e.moveTo(0,0),e.lineTo(this.element.globalData.compSize.w,0),e.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),e.lineTo(0,this.element.globalData.compSize.h),e.lineTo(0,0)),a=this.viewData[t].v,s=r.applyToPointArray(a.v[0][0],a.v[0][1],0),e.moveTo(s[0],s[1]);var o,l=a._length;for(o=1;o<l;o+=1)n=r.applyToTriplePoints(a.o[o-1],a.i[o],a.v[o]),e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);n=r.applyToTriplePoints(a.o[o-1],a.i[0],a.v[0]),e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}this.element.globalData.renderer.save(!0),e.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var e=this.globalData.canvasContext,t=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(t);var i=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(i),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var e=this.globalData;if(e.blendMode!==this.data.bm){e.blendMode=this.data.bm;var t=getBlendMode(this.data.bm);e.canvasContext.globalCompositeOperation=t}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(e){e.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var e=this.buffers[0],t=e.getContext("2d");this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var e=this.buffers[1],t=e.getContext("2d");this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var i=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(i.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var s=assetLoader.getLumaCanvas(this.canvasContext.canvas),n=s.getContext("2d");n.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(s,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(e,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(e){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!e)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var t=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(t),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(t),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(r,e,t,i){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var s=4;e.ty==="rc"?s=5:e.ty==="el"?s=6:e.ty==="sr"&&(s=7),this.sh=ShapePropertyFactory.getShapeProp(r,e,s,r);var n,a=t.length,o;for(n=0;n<a;n+=1)t[n].closed||(o={transforms:i.addTransformSequence(t[n].transforms),trNodes:[]},this.styledShapes.push(o),t[n].elements.push(o))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(r,e,t){this.shapes=[],this.shapesData=r.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(r,e){var t={data:r,type:r.ty,preTransforms:this.transformsManager.addTransformSequence(e),transforms:[],elements:[],closed:r.hd===!0},i={};if(r.ty==="fl"||r.ty==="st"?(i.c=PropertyFactory.getProp(this,r.c,1,255,this),i.c.k||(t.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")")):(r.ty==="gf"||r.ty==="gs")&&(i.s=PropertyFactory.getProp(this,r.s,1,null,this),i.e=PropertyFactory.getProp(this,r.e,1,null,this),i.h=PropertyFactory.getProp(this,r.h||{k:0},0,.01,this),i.a=PropertyFactory.getProp(this,r.a||{k:0},0,degToRads,this),i.g=new GradientProperty(this,r.g,this)),i.o=PropertyFactory.getProp(this,r.o,0,.01,this),r.ty==="st"||r.ty==="gs"){if(t.lc=lineCapEnum[r.lc||2],t.lj=lineJoinEnum[r.lj||2],r.lj==1&&(t.ml=r.ml),i.w=PropertyFactory.getProp(this,r.w,0,null,this),i.w.k||(t.wi=i.w.v),r.d){var s=new DashProperty(this,r.d,"canvas",this);i.d=s,i.d.k||(t.da=i.d.dashArray,t.do=i.d.dashoffset[0])}}else t.r=r.r===2?"evenodd":"nonzero";return this.stylesList.push(t),i.style=t,i},CVShapeElement.prototype.createGroupElement=function(){var r={it:[],prevViewData:[]};return r},CVShapeElement.prototype.createTransformElement=function(r){var e={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,r.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,r,this)}};return e},CVShapeElement.prototype.createShapeElement=function(r){var e=new CVShapeData(this,r,this.stylesList,this.transformsManager);return this.shapes.push(e),this.addShapeToModifiers(e),e},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var r,e=this.itemsData.length;for(r=0;r<e;r+=1)this.prevViewData[r]=this.itemsData[r];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),e=this.dynamicProperties.length,r=0;r<e;r+=1)this.dynamicProperties[r].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(r){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.push(r)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var r,e=this.stylesList.length;for(r=0;r<e;r+=1)this.stylesList[r].closed||this.stylesList[r].transforms.pop()},CVShapeElement.prototype.closeStyles=function(r){var e,t=r.length;for(e=0;e<t;e+=1)r[e].closed=!0},CVShapeElement.prototype.searchShapes=function(r,e,t,i,s){var n,a=r.length-1,o,l,c=[],f=[],d,u,g,p=[].concat(s);for(n=a;n>=0;n-=1){if(d=this.searchProcessedElement(r[n]),d?e[n]=t[d-1]:r[n]._shouldRender=i,r[n].ty==="fl"||r[n].ty==="st"||r[n].ty==="gf"||r[n].ty==="gs")d?e[n].style.closed=!1:e[n]=this.createStyleElement(r[n],p),c.push(e[n].style);else if(r[n].ty==="gr"){if(!d)e[n]=this.createGroupElement(r[n]);else for(l=e[n].it.length,o=0;o<l;o+=1)e[n].prevViewData[o]=e[n].it[o];this.searchShapes(r[n].it,e[n].it,e[n].prevViewData,i,p)}else r[n].ty==="tr"?(d||(g=this.createTransformElement(r[n]),e[n]=g),p.push(e[n]),this.addTransformToStyleList(e[n])):r[n].ty==="sh"||r[n].ty==="rc"||r[n].ty==="el"||r[n].ty==="sr"?d||(e[n]=this.createShapeElement(r[n])):r[n].ty==="tm"||r[n].ty==="rd"||r[n].ty==="pb"||r[n].ty==="zz"||r[n].ty==="op"?(d?(u=e[n],u.closed=!1):(u=ShapeModifiers.getModifier(r[n].ty),u.init(this,r[n]),e[n]=u,this.shapeModifiers.push(u)),f.push(u)):r[n].ty==="rp"&&(d?(u=e[n],u.closed=!0):(u=ShapeModifiers.getModifier(r[n].ty),e[n]=u,u.init(this,r,n,e),this.shapeModifiers.push(u),i=!1),f.push(u));this.addProcessedElement(r[n],n+1)}for(this.removeTransformFromStyleList(),this.closeStyles(c),a=f.length,n=0;n<a;n+=1)f[n].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(r,e){(r._opMdf||e.op._mdf||this._isFirstFrame)&&(e.opacity=r.opacity,e.opacity*=e.op.v,e._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var r,e=this.stylesList.length,t,i,s,n,a,o,l=this.globalData.renderer,c=this.globalData.canvasContext,f,d;for(r=0;r<e;r+=1)if(d=this.stylesList[r],f=d.type,!((f==="st"||f==="gs")&&d.wi===0||!d.data._shouldRender||d.coOp===0||this.globalData.currentGlobalAlpha===0)){for(l.save(),a=d.elements,f==="st"||f==="gs"?(l.ctxStrokeStyle(f==="st"?d.co:d.grd),l.ctxLineWidth(d.wi),l.ctxLineCap(d.lc),l.ctxLineJoin(d.lj),l.ctxMiterLimit(d.ml||0)):l.ctxFillStyle(f==="fl"?d.co:d.grd),l.ctxOpacity(d.coOp),f!=="st"&&f!=="gs"&&c.beginPath(),l.ctxTransform(d.preTransforms.finalTransform.props),i=a.length,t=0;t<i;t+=1){for((f==="st"||f==="gs")&&(c.beginPath(),d.da&&(c.setLineDash(d.da),c.lineDashOffset=d.do)),o=a[t].trNodes,n=o.length,s=0;s<n;s+=1)o[s].t==="m"?c.moveTo(o[s].p[0],o[s].p[1]):o[s].t==="c"?c.bezierCurveTo(o[s].pts[0],o[s].pts[1],o[s].pts[2],o[s].pts[3],o[s].pts[4],o[s].pts[5]):c.closePath();(f==="st"||f==="gs")&&(l.ctxStroke(),d.da&&c.setLineDash(this.dashResetter))}f!=="st"&&f!=="gs"&&this.globalData.renderer.ctxFill(d.r),l.restore()}},CVShapeElement.prototype.renderShape=function(r,e,t,i){var s,n=e.length-1,a;for(a=r,s=n;s>=0;s-=1)e[s].ty==="tr"?(a=t[s].transform,this.renderShapeTransform(r,a)):e[s].ty==="sh"||e[s].ty==="el"||e[s].ty==="rc"||e[s].ty==="sr"?this.renderPath(e[s],t[s]):e[s].ty==="fl"?this.renderFill(e[s],t[s],a):e[s].ty==="st"?this.renderStroke(e[s],t[s],a):e[s].ty==="gf"||e[s].ty==="gs"?this.renderGradientFill(e[s],t[s],a):e[s].ty==="gr"?this.renderShape(a,e[s].it,t[s].it):e[s].ty;i&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(r,e){if(this._isFirstFrame||e._mdf||r.transforms._mdf){var t=r.trNodes,i=e.paths,s,n,a,o=i._length;t.length=0;var l=r.transforms.finalTransform;for(a=0;a<o;a+=1){var c=i.shapes[a];if(c&&c.v){for(n=c._length,s=1;s<n;s+=1)s===1&&t.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),t.push({t:"c",pts:l.applyToTriplePoints(c.o[s-1],c.i[s],c.v[s])});n===1&&t.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),c.c&&n&&(t.push({t:"c",pts:l.applyToTriplePoints(c.o[s-1],c.i[0],c.v[0])}),t.push({t:"z"}))}}r.trNodes=t}},CVShapeElement.prototype.renderPath=function(r,e){if(r.hd!==!0&&r._shouldRender){var t,i=e.styledShapes.length;for(t=0;t<i;t+=1)this.renderStyledShape(e.styledShapes[t],e.sh)}},CVShapeElement.prototype.renderFill=function(r,e,t){var i=e.style;(e.c._mdf||this._isFirstFrame)&&(i.co="rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||t._opMdf||this._isFirstFrame)&&(i.coOp=e.o.v*t.opacity)},CVShapeElement.prototype.renderGradientFill=function(r,e,t){var i=e.style,s;if(!i.grd||e.g._mdf||e.s._mdf||e.e._mdf||r.t!==1&&(e.h._mdf||e.a._mdf)){var n=this.globalData.canvasContext,a=e.s.v,o=e.e.v;if(r.t===1)s=n.createLinearGradient(a[0],a[1],o[0],o[1]);else{var l=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)),c=Math.atan2(o[1]-a[1],o[0]-a[0]),f=e.h.v;f>=1?f=.99:f<=-1&&(f=-.99);var d=l*f,u=Math.cos(c+e.a.v)*d+a[0],g=Math.sin(c+e.a.v)*d+a[1];s=n.createRadialGradient(u,g,0,a[0],a[1],l)}var p,m=r.g.p,S=e.g.c,y=1;for(p=0;p<m;p+=1)e.g._hasOpacity&&e.g._collapsable&&(y=e.g.o[p*2+1]),s.addColorStop(S[p*4]/100,"rgba("+S[p*4+1]+","+S[p*4+2]+","+S[p*4+3]+","+y+")");i.grd=s}i.coOp=e.o.v*t.opacity},CVShapeElement.prototype.renderStroke=function(r,e,t){var i=e.style,s=e.d;s&&(s._mdf||this._isFirstFrame)&&(i.da=s.dashArray,i.do=s.dashoffset[0]),(e.c._mdf||this._isFirstFrame)&&(i.co="rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||t._opMdf||this._isFirstFrame)&&(i.coOp=e.o.v*t.opacity),(e.w._mdf||this._isFirstFrame)&&(i.wi=e.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(r,e,t){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var r=this.textProperty.currentData;this.renderedLetters=createSizedArray(r.l?r.l.length:0);var e=!1;r.fc?(e=!0,this.values.fill=this.buildColor(r.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=e;var t=!1;r.sc&&(t=!0,this.values.stroke=this.buildColor(r.sc),this.values.sWidth=r.sw);var i=this.globalData.fontManager.getFontByName(r.f),s,n,a=r.l,o=this.mHelper;this.stroke=t,this.values.fValue=r.finalSize+"px "+this.globalData.fontManager.getFontByName(r.f).fFamily,n=r.finalText.length;var l,c,f,d,u,g,p,m,S,y,x=this.data.singleShape,E=r.tr*.001*r.finalSize,T=0,A=0,_=!0,P=0;for(s=0;s<n;s+=1){l=this.globalData.fontManager.getCharData(r.finalText[s],i.fStyle,this.globalData.fontManager.getFontByName(r.f).fFamily),c=l&&l.data||{},o.reset(),x&&a[s].n&&(T=-E,A+=r.yOffset,A+=_?1:0,_=!1),u=c.shapes?c.shapes[0].it:[],p=u.length,o.scale(r.finalSize/100,r.finalSize/100),x&&this.applyTextPropertiesToMatrix(r,o,a[s].line,T,A),S=createSizedArray(p-1);var k=0;for(g=0;g<p;g+=1)if(u[g].ty==="sh"){for(d=u[g].ks.k.i.length,m=u[g].ks.k,y=[],f=1;f<d;f+=1)f===1&&y.push(o.applyToX(m.v[0][0],m.v[0][1],0),o.applyToY(m.v[0][0],m.v[0][1],0)),y.push(o.applyToX(m.o[f-1][0],m.o[f-1][1],0),o.applyToY(m.o[f-1][0],m.o[f-1][1],0),o.applyToX(m.i[f][0],m.i[f][1],0),o.applyToY(m.i[f][0],m.i[f][1],0),o.applyToX(m.v[f][0],m.v[f][1],0),o.applyToY(m.v[f][0],m.v[f][1],0));y.push(o.applyToX(m.o[f-1][0],m.o[f-1][1],0),o.applyToY(m.o[f-1][0],m.o[f-1][1],0),o.applyToX(m.i[0][0],m.i[0][1],0),o.applyToY(m.i[0][0],m.i[0][1],0),o.applyToX(m.v[0][0],m.v[0][1],0),o.applyToY(m.v[0][0],m.v[0][1],0)),S[k]=y,k+=1}x&&(T+=a[s].l,T+=E),this.textSpans[P]?this.textSpans[P].elem=S:this.textSpans[P]={elem:S},P+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var r=this.canvasContext;r.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var e,t,i,s,n,a,o=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;t=l.length;var c,f=null,d=null,u=null,g,p,m=this.globalData.renderer;for(e=0;e<t;e+=1)if(!l[e].n){if(c=o[e],c&&(m.save(),m.ctxTransform(c.p),m.ctxOpacity(c.o)),this.fill){for(c&&c.fc?f!==c.fc&&(m.ctxFillStyle(c.fc),f=c.fc):f!==this.values.fill&&(f=this.values.fill,m.ctxFillStyle(this.values.fill)),g=this.textSpans[e].elem,s=g.length,this.globalData.canvasContext.beginPath(),i=0;i<s;i+=1)for(p=g[i],a=p.length,this.globalData.canvasContext.moveTo(p[0],p[1]),n=2;n<a;n+=6)this.globalData.canvasContext.bezierCurveTo(p[n],p[n+1],p[n+2],p[n+3],p[n+4],p[n+5]);this.globalData.canvasContext.closePath(),m.ctxFill()}if(this.stroke){for(c&&c.sw?u!==c.sw&&(u=c.sw,m.ctxLineWidth(c.sw)):u!==this.values.sWidth&&(u=this.values.sWidth,m.ctxLineWidth(this.values.sWidth)),c&&c.sc?d!==c.sc&&(d=c.sc,m.ctxStrokeStyle(c.sc)):d!==this.values.stroke&&(d=this.values.stroke,m.ctxStrokeStyle(this.values.stroke)),g=this.textSpans[e].elem,s=g.length,this.globalData.canvasContext.beginPath(),i=0;i<s;i+=1)for(p=g[i],a=p.length,this.globalData.canvasContext.moveTo(p[0],p[1]),n=2;n<a;n+=6)this.globalData.canvasContext.bezierCurveTo(p[n],p[n+1],p[n+2],p[n+3],p[n+4],p[n+5]);this.globalData.canvasContext.closePath(),m.ctxStroke()}c&&this.globalData.renderer.restore()}};function CVImageElement(r,e,t){this.assetData=e.getAssetData(r.refId),this.img=e.imageLoader.getAsset(this.assetData),this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var r=createTag("canvas");r.width=this.assetData.w,r.height=this.assetData.h;var e=r.getContext("2d"),t=this.img.width,i=this.img.height,s=t/i,n=this.assetData.w/this.assetData.h,a,o,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;s>n&&l==="xMidYMid slice"||s<n&&l!=="xMidYMid slice"?(o=i,a=o*n):(a=t,o=a/n),e.drawImage(this.img,(t-a)/2,(i-o)/2,a,o,0,0,this.assetData.w,this.assetData.h),this.img=r}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(r,e,t){this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(r){return new CVShapeElement(r,this.globalData,this)},CanvasRendererBase.prototype.createText=function(r){return new CVTextElement(r,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(r){return new CVImageElement(r,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(r){return new CVSolidElement(r,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(r){r[0]===1&&r[1]===0&&r[4]===0&&r[5]===1&&r[12]===0&&r[13]===0||this.canvasContext.transform(r[0],r[1],r[4],r[5],r[12],r[13])},CanvasRendererBase.prototype.ctxOpacity=function(r){this.canvasContext.globalAlpha*=r<0?0:r},CanvasRendererBase.prototype.ctxFillStyle=function(r){this.canvasContext.fillStyle=r},CanvasRendererBase.prototype.ctxStrokeStyle=function(r){this.canvasContext.strokeStyle=r},CanvasRendererBase.prototype.ctxLineWidth=function(r){this.canvasContext.lineWidth=r},CanvasRendererBase.prototype.ctxLineCap=function(r){this.canvasContext.lineCap=r},CanvasRendererBase.prototype.ctxLineJoin=function(r){this.canvasContext.lineJoin=r},CanvasRendererBase.prototype.ctxMiterLimit=function(r){this.canvasContext.miterLimit=r},CanvasRendererBase.prototype.ctxFill=function(r){this.canvasContext.fill(r)},CanvasRendererBase.prototype.ctxFillRect=function(r,e,t,i){this.canvasContext.fillRect(r,e,t,i)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(r){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}r&&(this.globalData.blendMode="source-over"),this.contextData.restore(r)},CanvasRendererBase.prototype.configAnimation=function(r){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var e=this.animationItem.container.style;e.width="100%",e.height="100%";var t="0px 0px 0px";e.transformOrigin=t,e.mozTransformOrigin=t,e.webkitTransformOrigin=t,e["-webkit-transform"]=t,e.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=r,this.layers=r.layers,this.transformCanvas={w:r.w,h:r.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(r,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(r.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(r,e){this.reset();var t,i;r?(t=r,i=e,this.canvasContext.canvas.width=t,this.canvasContext.canvas.height=i):(this.animationItem.wrapper&&this.animationItem.container?(t=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight):(t=this.canvasContext.canvas.width,i=this.canvasContext.canvas.height),this.canvasContext.canvas.width=t*this.renderConfig.dpr,this.canvasContext.canvas.height=i*this.renderConfig.dpr);var s,n;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var a=this.renderConfig.preserveAspectRatio.split(" "),o=a[1]||"meet",l=a[0]||"xMidYMid",c=l.substr(0,4),f=l.substr(4);s=t/i,n=this.transformCanvas.w/this.transformCanvas.h,n>s&&o==="meet"||n<s&&o==="slice"?(this.transformCanvas.sx=t/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=t/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=i/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=i/(this.transformCanvas.h/this.renderConfig.dpr)),c==="xMid"&&(n<s&&o==="meet"||n>s&&o==="slice")?this.transformCanvas.tx=(t-this.transformCanvas.w*(i/this.transformCanvas.h))/2*this.renderConfig.dpr:c==="xMax"&&(n<s&&o==="meet"||n>s&&o==="slice")?this.transformCanvas.tx=(t-this.transformCanvas.w*(i/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,f==="YMid"&&(n>s&&o==="meet"||n<s&&o==="slice")?this.transformCanvas.ty=(i-this.transformCanvas.h*(t/this.transformCanvas.w))/2*this.renderConfig.dpr:f==="YMax"&&(n>s&&o==="meet"||n<s&&o==="slice")?this.transformCanvas.ty=(i-this.transformCanvas.h*(t/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=t/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=i/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var r,e=this.layers?this.layers.length:0;for(r=e-1;r>=0;r-=1)this.elements[r]&&this.elements[r].destroy&&this.elements[r].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(r,e){if(!(this.renderedFrame===r&&this.renderConfig.clearCanvas===!0&&!e||this.destroyed||r===-1)){this.renderedFrame=r,this.globalData.frameNum=r-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||e,this.globalData.projectInterface.currentFrame=r;var t,i=this.layers.length;for(this.completeLayers||this.checkLayers(r),t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(r-this.layers[t].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(r){var e=this.elements;if(!(e[r]||this.layers[r].ty===99)){var t=this.createItem(this.layers[r],this,this.globalData);e[r]=t,t.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var r=this.pendingElements.pop();r.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var r,e=15;for(r=0;r<e;r+=1){var t=new CanvasContext;this.stack[r]=t}this._length=e,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var r=this._length*2,e=0;for(e=this._length;e<r;e+=1)this.stack[e]=new CanvasContext;this._length=r},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(r){this.cArrPos-=1;var e=this.stack[this.cArrPos],t=e.transform,i,s=this.cTr.props;for(i=0;i<16;i+=1)s[i]=t[i];if(r){this.nativeContext.restore();var n=this.stack[this.cArrPos+1];this.appliedFillStyle=n.fillStyle,this.appliedStrokeStyle=n.strokeStyle,this.appliedLineWidth=n.lineWidth,this.appliedLineCap=n.lineCap,this.appliedLineJoin=n.lineJoin,this.appliedMiterLimit=n.miterLimit}this.nativeContext.setTransform(t[0],t[1],t[4],t[5],t[12],t[13]),(r||e.opacity!==-1&&this.currentOpacity!==e.opacity)&&(this.nativeContext.globalAlpha=e.opacity,this.currentOpacity=e.opacity),this.currentFillStyle=e.fillStyle,this.currentStrokeStyle=e.strokeStyle,this.currentLineWidth=e.lineWidth,this.currentLineCap=e.lineCap,this.currentLineJoin=e.lineJoin,this.currentMiterLimit=e.miterLimit},CVContextData.prototype.save=function(r){r&&this.nativeContext.save();var e=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var t=this.stack[this.cArrPos],i;for(i=0;i<16;i+=1)t.transform[i]=e[i];this.cArrPos+=1;var s=this.stack[this.cArrPos];s.opacity=t.opacity,s.fillStyle=t.fillStyle,s.strokeStyle=t.strokeStyle,s.lineWidth=t.lineWidth,s.lineCap=t.lineCap,s.lineJoin=t.lineJoin,s.miterLimit=t.miterLimit},CVContextData.prototype.setOpacity=function(r){this.stack[this.cArrPos].opacity=r},CVContextData.prototype.setContext=function(r){this.nativeContext=r},CVContextData.prototype.fillStyle=function(r){this.stack[this.cArrPos].fillStyle!==r&&(this.currentFillStyle=r,this.stack[this.cArrPos].fillStyle=r)},CVContextData.prototype.strokeStyle=function(r){this.stack[this.cArrPos].strokeStyle!==r&&(this.currentStrokeStyle=r,this.stack[this.cArrPos].strokeStyle=r)},CVContextData.prototype.lineWidth=function(r){this.stack[this.cArrPos].lineWidth!==r&&(this.currentLineWidth=r,this.stack[this.cArrPos].lineWidth=r)},CVContextData.prototype.lineCap=function(r){this.stack[this.cArrPos].lineCap!==r&&(this.currentLineCap=r,this.stack[this.cArrPos].lineCap=r)},CVContextData.prototype.lineJoin=function(r){this.stack[this.cArrPos].lineJoin!==r&&(this.currentLineJoin=r,this.stack[this.cArrPos].lineJoin=r)},CVContextData.prototype.miterLimit=function(r){this.stack[this.cArrPos].miterLimit!==r&&(this.currentMiterLimit=r,this.stack[this.cArrPos].miterLimit=r)},CVContextData.prototype.transform=function(r){this.transformMat.cloneFromProps(r);var e=this.cTr;this.transformMat.multiply(e),e.cloneFromProps(this.transformMat.props);var t=e.props;this.nativeContext.setTransform(t[0],t[1],t[4],t[5],t[12],t[13])},CVContextData.prototype.opacity=function(r){var e=this.stack[this.cArrPos].opacity;e*=r<0?0:r,this.stack[this.cArrPos].opacity!==e&&(this.currentOpacity!==r&&(this.nativeContext.globalAlpha=r,this.currentOpacity=r),this.stack[this.cArrPos].opacity=e)},CVContextData.prototype.fill=function(r){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(r)},CVContextData.prototype.fillRect=function(r,e,t,i){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(r,e,t,i)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(r,e,t){this.completeLayers=!1,this.layers=r.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(r,e,t),this.tm=r.tm?PropertyFactory.getProp(this,r.tm,0,e.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var r=this.canvasContext;r.beginPath(),r.moveTo(0,0),r.lineTo(this.data.w,0),r.lineTo(this.data.w,this.data.h),r.lineTo(0,this.data.h),r.lineTo(0,0),r.clip();var e,t=this.layers.length;for(e=t-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},CVCompElement.prototype.destroy=function(){var r,e=this.layers.length;for(r=e-1;r>=0;r-=1)this.elements[r]&&this.elements[r].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(r){return new CVCompElement(r,this.globalData,this)};function CanvasRenderer(r,e){this.animationItem=r,this.renderConfig={clearCanvas:e&&e.clearCanvas!==void 0?e.clearCanvas:!0,context:e&&e.context||null,progressiveLoad:e&&e.progressiveLoad||!1,preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:e&&e.contentVisibility||"visible",className:e&&e.className||"",id:e&&e.id||"",runExpressions:!e||e.runExpressions===void 0||e.runExpressions},this.renderConfig.dpr=e&&e.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=e&&e.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(r){return new CVCompElement(r,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var e=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var t=this.finalTransform.mat.toCSS();e.transform=t,e.webkitTransform=t}this.finalTransform._opMdf&&(e.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(r,e,t){this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var r;this.data.hasMask?(r=createNS("rect"),r.setAttribute("width",this.data.sw),r.setAttribute("height",this.data.sh),r.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(r=createTag("div"),r.style.width=this.data.sw+"px",r.style.height=this.data.sh+"px",r.style.backgroundColor=this.data.sc),this.layerElement.appendChild(r)};function HShapeElement(r,e,t){this.shapes=[],this.shapesData=r.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(r,e,t),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var r;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),r=this.svgElement;else{r=createNS("svg");var e=this.comp.data?this.comp.data:this.globalData.compSize;r.setAttribute("width",e.w),r.setAttribute("height",e.h),r.appendChild(this.shapesContainer),this.layerElement.appendChild(r)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=r},HShapeElement.prototype.getTransformedPoint=function(r,e){var t,i=r.length;for(t=0;t<i;t+=1)e=r[t].mProps.v.applyToPointArray(e[0],e[1],0);return e},HShapeElement.prototype.calculateShapeBoundingBox=function(r,e){var t=r.sh.v,i=r.transformers,s,n=t._length,a,o,l,c;if(!(n<=1)){for(s=0;s<n-1;s+=1)a=this.getTransformedPoint(i,t.v[s]),o=this.getTransformedPoint(i,t.o[s]),l=this.getTransformedPoint(i,t.i[s+1]),c=this.getTransformedPoint(i,t.v[s+1]),this.checkBounds(a,o,l,c,e);t.c&&(a=this.getTransformedPoint(i,t.v[s]),o=this.getTransformedPoint(i,t.o[s]),l=this.getTransformedPoint(i,t.i[0]),c=this.getTransformedPoint(i,t.v[0]),this.checkBounds(a,o,l,c,e))}},HShapeElement.prototype.checkBounds=function(r,e,t,i,s){this.getBoundsOfCurve(r,e,t,i);var n=this.shapeBoundingBox;s.x=bmMin(n.left,s.x),s.xMax=bmMax(n.right,s.xMax),s.y=bmMin(n.top,s.y),s.yMax=bmMax(n.bottom,s.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(r,e,t,i){for(var s=[[r[0],i[0]],[r[1],i[1]]],n,a,o,l,c,f,d,u=0;u<2;++u)a=6*r[u]-12*e[u]+6*t[u],n=-3*r[u]+9*e[u]-9*t[u]+3*i[u],o=3*e[u]-3*r[u],a|=0,n|=0,o|=0,n===0&&a===0||(n===0?(l=-o/a,l>0&&l<1&&s[u].push(this.calculateF(l,r,e,t,i,u))):(c=a*a-4*o*n,c>=0&&(f=(-a+bmSqrt(c))/(2*n),f>0&&f<1&&s[u].push(this.calculateF(f,r,e,t,i,u)),d=(-a-bmSqrt(c))/(2*n),d>0&&d<1&&s[u].push(this.calculateF(d,r,e,t,i,u)))));this.shapeBoundingBox.left=bmMin.apply(null,s[0]),this.shapeBoundingBox.top=bmMin.apply(null,s[1]),this.shapeBoundingBox.right=bmMax.apply(null,s[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,s[1])},HShapeElement.prototype.calculateF=function(r,e,t,i,s,n){return bmPow(1-r,3)*e[n]+3*bmPow(1-r,2)*r*t[n]+3*(1-r)*bmPow(r,2)*i[n]+bmPow(r,3)*s[n]},HShapeElement.prototype.calculateBoundingBox=function(r,e){var t,i=r.length;for(t=0;t<i;t+=1)r[t]&&r[t].sh?this.calculateShapeBoundingBox(r[t],e):r[t]&&r[t].it?this.calculateBoundingBox(r[t].it,e):r[t]&&r[t].style&&r[t].w&&this.expandStrokeBoundingBox(r[t].w,e)},HShapeElement.prototype.expandStrokeBoundingBox=function(r,e){var t=0;if(r.keyframes){for(var i=0;i<r.keyframes.length;i+=1){var s=r.keyframes[i].s;s>t&&(t=s)}t*=r.mult}else t=r.v*r.mult;e.x-=t,e.xMax+=t,e.y-=t,e.yMax+=t},HShapeElement.prototype.currentBoxContains=function(r){return this.currentBBox.x<=r.x&&this.currentBBox.y<=r.y&&this.currentBBox.width+this.currentBBox.x>=r.x+r.width&&this.currentBBox.height+this.currentBBox.y>=r.y+r.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var r=this.tempBoundingBox,e=999999;if(r.x=e,r.xMax=-e,r.y=e,r.yMax=-e,this.calculateBoundingBox(this.itemsData,r),r.width=r.xMax<r.x?0:r.xMax-r.x,r.height=r.yMax<r.y?0:r.yMax-r.y,this.currentBoxContains(r))return;var t=!1;if(this.currentBBox.w!==r.width&&(this.currentBBox.w=r.width,this.shapeCont.setAttribute("width",r.width),t=!0),this.currentBBox.h!==r.height&&(this.currentBBox.h=r.height,this.shapeCont.setAttribute("height",r.height),t=!0),t||this.currentBBox.x!==r.x||this.currentBBox.y!==r.y){this.currentBBox.w=r.width,this.currentBBox.h=r.height,this.currentBBox.x=r.x,this.currentBBox.y=r.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var i=this.shapeCont.style,s="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";i.transform=s,i.webkitTransform=s}}};function HTextElement(r,e,t){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var r=createNS("g");this.maskedElement.appendChild(r),this.innerElem=r}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var r=this.textProperty.currentData;this.renderedLetters=createSizedArray(r.l?r.l.length:0);var e=this.innerElem.style,t=r.fc?this.buildColor(r.fc):"rgba(0,0,0,0)";e.fill=t,e.color=t,r.sc&&(e.stroke=this.buildColor(r.sc),e.strokeWidth=r.sw+"px");var i=this.globalData.fontManager.getFontByName(r.f);if(!this.globalData.fontManager.chars)if(e.fontSize=r.finalSize+"px",e.lineHeight=r.finalSize+"px",i.fClass)this.innerElem.className=i.fClass;else{e.fontFamily=i.fFamily;var s=r.fWeight,n=r.fStyle;e.fontStyle=n,e.fontWeight=s}var a,o,l=r.l;o=l.length;var c,f,d,u=this.mHelper,g,p="",m=0;for(a=0;a<o;a+=1){if(this.globalData.fontManager.chars?(this.textPaths[m]?c=this.textPaths[m]:(c=createNS("path"),c.setAttribute("stroke-linecap",lineCapEnum[1]),c.setAttribute("stroke-linejoin",lineJoinEnum[2]),c.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[m]?(f=this.textSpans[m],d=f.children[0]):(f=createTag("div"),f.style.lineHeight=0,d=createNS("svg"),d.appendChild(c),styleDiv(f)))):this.isMasked?c=this.textPaths[m]?this.textPaths[m]:createNS("text"):this.textSpans[m]?(f=this.textSpans[m],c=this.textPaths[m]):(f=createTag("span"),styleDiv(f),c=createTag("span"),styleDiv(c),f.appendChild(c)),this.globalData.fontManager.chars){var S=this.globalData.fontManager.getCharData(r.finalText[a],i.fStyle,this.globalData.fontManager.getFontByName(r.f).fFamily),y;if(S?y=S.data:y=null,u.reset(),y&&y.shapes&&y.shapes.length&&(g=y.shapes[0].it,u.scale(r.finalSize/100,r.finalSize/100),p=this.createPathShape(u,g),c.setAttribute("d",p)),this.isMasked)this.innerElem.appendChild(c);else{if(this.innerElem.appendChild(f),y&&y.shapes){document.body.appendChild(d);var x=d.getBBox();d.setAttribute("width",x.width+2),d.setAttribute("height",x.height+2),d.setAttribute("viewBox",x.x-1+" "+(x.y-1)+" "+(x.width+2)+" "+(x.height+2));var E=d.style,T="translate("+(x.x-1)+"px,"+(x.y-1)+"px)";E.transform=T,E.webkitTransform=T,l[a].yOffset=x.y-1}else d.setAttribute("width",1),d.setAttribute("height",1);f.appendChild(d)}}else if(c.textContent=l[a].val,c.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(c);else{this.innerElem.appendChild(f);var A=c.style,_="translate3d(0,"+-r.finalSize/1.2+"px,0)";A.transform=_,A.webkitTransform=_}this.isMasked?this.textSpans[m]=c:this.textSpans[m]=f,this.textSpans[m].style.display="block",this.textPaths[m]=c,m+=1}for(;m<this.textSpans.length;)this.textSpans[m].style.display="none",m+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var r;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),r=this.svgElement.style;var e="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";r.transform=e,r.webkitTransform=e}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var t,i,s=0,n=this.textAnimator.renderedLetters,a=this.textProperty.currentData.l;i=a.length;var o,l,c;for(t=0;t<i;t+=1)a[t].n?s+=1:(l=this.textSpans[t],c=this.textPaths[t],o=n[s],s+=1,o._mdf.m&&(this.isMasked?l.setAttribute("transform",o.m):(l.style.webkitTransform=o.m,l.style.transform=o.m)),l.style.opacity=o.o,o.sw&&o._mdf.sw&&c.setAttribute("stroke-width",o.sw),o.sc&&o._mdf.sc&&c.setAttribute("stroke",o.sc),o.fc&&o._mdf.fc&&(c.setAttribute("fill",o.fc),c.style.color=o.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var f=this.innerElem.getBBox();this.currentBBox.w!==f.width&&(this.currentBBox.w=f.width,this.svgElement.setAttribute("width",f.width)),this.currentBBox.h!==f.height&&(this.currentBBox.h=f.height,this.svgElement.setAttribute("height",f.height));var d=1;if(this.currentBBox.w!==f.width+d*2||this.currentBBox.h!==f.height+d*2||this.currentBBox.x!==f.x-d||this.currentBBox.y!==f.y-d){this.currentBBox.w=f.width+d*2,this.currentBBox.h=f.height+d*2,this.currentBBox.x=f.x-d,this.currentBBox.y=f.y-d,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),r=this.svgElement.style;var u="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";r.transform=u,r.webkitTransform=u}}}};function HCameraElement(r,e,t){this.initFrame(),this.initBaseData(r,e,t),this.initHierarchy();var i=PropertyFactory.getProp;if(this.pe=i(this,r.pe,0,0,this),r.ks.p.s?(this.px=i(this,r.ks.p.x,1,0,this),this.py=i(this,r.ks.p.y,1,0,this),this.pz=i(this,r.ks.p.z,1,0,this)):this.p=i(this,r.ks.p,1,0,this),r.ks.a&&(this.a=i(this,r.ks.a,1,0,this)),r.ks.or.k.length&&r.ks.or.k[0].to){var s,n=r.ks.or.k.length;for(s=0;s<n;s+=1)r.ks.or.k[s].to=null,r.ks.or.k[s].ti=null}this.or=i(this,r.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=i(this,r.ks.rx,0,degToRads,this),this.ry=i(this,r.ks.ry,0,degToRads,this),this.rz=i(this,r.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var r,e=this.comp.threeDElements.length,t,i,s;for(r=0;r<e;r+=1)if(t=this.comp.threeDElements[r],t.type==="3d"){i=t.perspectiveElem.style,s=t.container.style;var n=this.pe.v+"px",a="0px 0px 0px",o="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";i.perspective=n,i.webkitPerspective=n,s.transformOrigin=a,s.mozTransformOrigin=a,s.webkitTransformOrigin=a,i.transform=o,i.webkitTransform=o}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var r=this._isFirstFrame,e,t;if(this.hierarchy)for(t=this.hierarchy.length,e=0;e<t;e+=1)r=this.hierarchy[e].finalTransform.mProp._mdf||r;if(r||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(t=this.hierarchy.length-1,e=t;e>=0;e-=1){var i=this.hierarchy[e].finalTransform.mProp;this.mat.translate(-i.p.v[0],-i.p.v[1],i.p.v[2]),this.mat.rotateX(-i.or.v[0]).rotateY(-i.or.v[1]).rotateZ(i.or.v[2]),this.mat.rotateX(-i.rx.v).rotateY(-i.ry.v).rotateZ(i.rz.v),this.mat.scale(1/i.s.v[0],1/i.s.v[1],1/i.s.v[2]),this.mat.translate(i.a.v[0],i.a.v[1],i.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var s;this.p?s=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:s=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var n=Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2)),a=[s[0]/n,s[1]/n,s[2]/n],o=Math.sqrt(a[2]*a[2]+a[0]*a[0]),l=Math.atan2(a[1],o),c=Math.atan2(a[0],-a[2]);this.mat.rotateY(c).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var f=!this._prevMat.equals(this.mat);if((f||this.pe._mdf)&&this.comp.threeDElements){t=this.comp.threeDElements.length;var d,u,g;for(e=0;e<t;e+=1)if(d=this.comp.threeDElements[e],d.type==="3d"){if(f){var p=this.mat.toCSS();g=d.container.style,g.transform=p,g.webkitTransform=p}this.pe._mdf&&(u=d.perspectiveElem.style,u.perspective=this.pe.v+"px",u.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(r){this.prepareProperties(r,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(r,e,t){this.assetData=e.getAssetData(r.refId),this.initElement(r,e,t)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var r=this.globalData.getAssetsPath(this.assetData),e=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",r),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(e),e.crossOrigin="anonymous",e.src=r,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(r,e){this.animationItem=r,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:e&&e.className||"",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(e&&e.hideOnTransparent===!1),filterSize:{width:e&&e.filterSize&&e.filterSize.width||"400%",height:e&&e.filterSize&&e.filterSize.height||"400%",x:e&&e.filterSize&&e.filterSize.x||"-100%",y:e&&e.filterSize&&e.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var r=this.pendingElements.pop();r.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(r,e){var t=r.getBaseElement();if(!!t){var i=this.layers[e];if(!i.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(t,e);else{for(var s=0,n,a,o;s<e;)this.elements[s]&&this.elements[s]!==!0&&this.elements[s].getBaseElement&&(a=this.elements[s],o=this.layers[s].ddd?this.getThreeDContainerByPos(s):a.getBaseElement(),n=o||n),s+=1;n?(!i.ddd||!this.supports3d)&&this.layerElement.insertBefore(t,n):(!i.ddd||!this.supports3d)&&this.layerElement.appendChild(t)}else this.addTo3dContainer(t,e)}},HybridRendererBase.prototype.createShape=function(r){return this.supports3d?new HShapeElement(r,this.globalData,this):new SVGShapeElement(r,this.globalData,this)},HybridRendererBase.prototype.createText=function(r){return this.supports3d?new HTextElement(r,this.globalData,this):new SVGTextLottieElement(r,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(r){return this.camera=new HCameraElement(r,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(r){return this.supports3d?new HImageElement(r,this.globalData,this):new IImageElement(r,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(r){return this.supports3d?new HSolidElement(r,this.globalData,this):new ISolidElement(r,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(r){for(var e=0,t=this.threeDElements.length;e<t;){if(this.threeDElements[e].startPos<=r&&this.threeDElements[e].endPos>=r)return this.threeDElements[e].perspectiveElem;e+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(r,e){var t=createTag("div"),i,s;styleDiv(t);var n=createTag("div");if(styleDiv(n),e==="3d"){i=t.style,i.width=this.globalData.compSize.w+"px",i.height=this.globalData.compSize.h+"px";var a="50% 50%";i.webkitTransformOrigin=a,i.mozTransformOrigin=a,i.transformOrigin=a,s=n.style;var o="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";s.transform=o,s.webkitTransform=o}t.appendChild(n);var l={container:n,perspectiveElem:t,startPos:r,endPos:r,type:e};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var r,e=this.layers.length,t,i="";for(r=0;r<e;r+=1)this.layers[r].ddd&&this.layers[r].ty!==3?(i!=="3d"&&(i="3d",t=this.createThreeDContainer(r,"3d")),t.endPos=Math.max(t.endPos,r)):(i!=="2d"&&(i="2d",t=this.createThreeDContainer(r,"2d")),t.endPos=Math.max(t.endPos,r));for(e=this.threeDElements.length,r=e-1;r>=0;r-=1)this.resizerElem.appendChild(this.threeDElements[r].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(r,e){for(var t=0,i=this.threeDElements.length;t<i;){if(e<=this.threeDElements[t].endPos){for(var s=this.threeDElements[t].startPos,n;s<e;)this.elements[s]&&this.elements[s].getBaseElement&&(n=this.elements[s].getBaseElement()),s+=1;n?this.threeDElements[t].container.insertBefore(r,n):this.threeDElements[t].container.appendChild(r);break}t+=1}},HybridRendererBase.prototype.configAnimation=function(r){var e=createTag("div"),t=this.animationItem.wrapper,i=e.style;i.width=r.w+"px",i.height=r.h+"px",this.resizerElem=e,styleDiv(e),i.transformStyle="flat",i.mozTransformStyle="flat",i.webkitTransformStyle="flat",this.renderConfig.className&&e.setAttribute("class",this.renderConfig.className),t.appendChild(e),i.overflow="hidden";var s=createNS("svg");s.setAttribute("width","1"),s.setAttribute("height","1"),styleDiv(s),this.resizerElem.appendChild(s);var n=createNS("defs");s.appendChild(n),this.data=r,this.setupGlobalData(r,s),this.globalData.defs=n,this.layers=r.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var r,e=this.layers?this.layers.length:0;for(r=0;r<e;r+=1)this.elements[r]&&this.elements[r].destroy&&this.elements[r].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var r=this.animationItem.wrapper.offsetWidth,e=this.animationItem.wrapper.offsetHeight,t=r/e,i=this.globalData.compSize.w/this.globalData.compSize.h,s,n,a,o;i>t?(s=r/this.globalData.compSize.w,n=r/this.globalData.compSize.w,a=0,o=(e-this.globalData.compSize.h*(r/this.globalData.compSize.w))/2):(s=e/this.globalData.compSize.h,n=e/this.globalData.compSize.h,a=(r-this.globalData.compSize.w*(e/this.globalData.compSize.h))/2,o=0);var l=this.resizerElem.style;l.webkitTransform="matrix3d("+s+",0,0,0,0,"+n+",0,0,0,0,1,0,"+a+","+o+",0,1)",l.transform=l.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var r=this.globalData.compSize.w,e=this.globalData.compSize.h,t,i=this.threeDElements.length;for(t=0;t<i;t+=1){var s=this.threeDElements[t].perspectiveElem.style;s.webkitPerspective=Math.sqrt(Math.pow(r,2)+Math.pow(e,2))+"px",s.perspective=s.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(r){var e,t=r.length,i=createTag("div");for(e=0;e<t;e+=1)if(r[e].xt){var s=this.createComp(r[e],i,this.globalData.comp,null);s.initExpressions(),this.globalData.projectInterface.registerComposition(s)}};function HCompElement(r,e,t){this.layers=r.layers,this.supports3d=!r.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(r,e,t),this.tm=r.tm?PropertyFactory.getProp(this,r.tm,0,e.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(r,e){for(var t=0,i;t<e;)this.elements[t]&&this.elements[t].getBaseElement&&(i=this.elements[t].getBaseElement()),t+=1;i?this.layerElement.insertBefore(r,i):this.layerElement.appendChild(r)},HCompElement.prototype.createComp=function(r){return this.supports3d?new HCompElement(r,this.globalData,this):new SVGCompElement(r,this.globalData,this)};function HybridRenderer(r,e){this.animationItem=r,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:e&&e.className||"",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(e&&e.hideOnTransparent===!1),filterSize:{width:e&&e.filterSize&&e.filterSize.width||"400%",height:e&&e.filterSize&&e.filterSize.height||"400%",x:e&&e.filterSize&&e.filterSize.x||"-100%",y:e&&e.filterSize&&e.filterSize.y||"-100%"},runExpressions:!e||e.runExpressions===void 0||e.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(r){return this.supports3d?new HCompElement(r,this.globalData,this):new SVGCompElement(r,this.globalData,this)};var CompExpressionInterface=function(){return function(r){function e(t){for(var i=0,s=r.layers.length;i<s;){if(r.layers[i].nm===t||r.layers[i].ind===t)return r.elements[i].layerInterface;i+=1}return null}return Object.defineProperty(e,"_name",{value:r.data.nm}),e.layer=e,e.pixelAspect=1,e.height=r.data.h||r.globalData.compSize.h,e.width=r.data.w||r.globalData.compSize.w,e.pixelAspect=1,e.frameDuration=1/r.globalData.frameRate,e.displayStartTime=0,e.numLayers=r.layers.length,e}}();function _typeof$2(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$2=function(t){return typeof t}:_typeof$2=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$2(r)}function seedRandom(r,e){var t=this,i=256,s=6,n=52,a="random",o=e.pow(i,s),l=e.pow(2,n),c=l*2,f=i-1,d;function u(E,T,A){var _=[];T=T===!0?{entropy:!0}:T||{};var P=S(m(T.entropy?[E,x(r)]:E===null?y():E,3),_),k=new g(_),F=function(){for(var B=k.g(s),N=o,G=0;B<l;)B=(B+G)*i,N*=i,G=k.g(1);for(;B>=c;)B/=2,N/=2,G>>>=1;return(B+G)/N};return F.int32=function(){return k.g(4)|0},F.quick=function(){return k.g(4)/4294967296},F.double=F,S(x(k.S),r),(T.pass||A||function(M,B,N,G){return G&&(G.S&&p(G,k),M.state=function(){return p(k,{})}),N?(e[a]=M,B):M})(F,P,"global"in T?T.global:this==e,T.state)}e["seed"+a]=u;function g(E){var T,A=E.length,_=this,P=0,k=_.i=_.j=0,F=_.S=[];for(A||(E=[A++]);P<i;)F[P]=P++;for(P=0;P<i;P++)F[P]=F[k=f&k+E[P%A]+(T=F[P])],F[k]=T;_.g=function(M){for(var B,N=0,G=_.i,U=_.j,O=_.S;M--;)B=O[G=f&G+1],N=N*i+O[f&(O[G]=O[U=f&U+B])+(O[U]=B)];return _.i=G,_.j=U,N}}function p(E,T){return T.i=E.i,T.j=E.j,T.S=E.S.slice(),T}function m(E,T){var A=[],_=_typeof$2(E),P;if(T&&_=="object")for(P in E)try{A.push(m(E[P],T-1))}catch{}return A.length?A:_=="string"?E:E+"\0"}function S(E,T){for(var A=E+"",_,P=0;P<A.length;)T[f&P]=f&(_^=T[f&P]*19)+A.charCodeAt(P++);return x(T)}function y(){try{var E=new Uint8Array(i);return(t.crypto||t.msCrypto).getRandomValues(E),x(E)}catch{var T=t.navigator,A=T&&T.plugins;return[+new Date,t,A,t.screen,x(r)]}}function x(E){return String.fromCharCode.apply(0,E)}S(e.random(),r)}function initialize$2(r){seedRandom([],r)}var propTypes={SHAPE:"shape"};function _typeof$1(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$1=function(t){return typeof t}:_typeof$1=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$1(r)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(r){return r.constructor===Array||r.constructor===Float32Array}function isNumerable(r,e){return r==="number"||e instanceof Number||r==="boolean"||r==="string"}function $bm_neg(r){var e=_typeof$1(r);if(e==="number"||r instanceof Number||e==="boolean")return-r;if($bm_isInstanceOfArray(r)){var t,i=r.length,s=[];for(t=0;t<i;t+=1)s[t]=-r[t];return s}return r.propType?r.v:-r}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(r,e){var t=_typeof$1(r),i=_typeof$1(e);if(isNumerable(t,r)&&isNumerable(i,e)||t==="string"||i==="string")return r+e;if($bm_isInstanceOfArray(r)&&isNumerable(i,e))return r=r.slice(0),r[0]+=e,r;if(isNumerable(t,r)&&$bm_isInstanceOfArray(e))return e=e.slice(0),e[0]=r+e[0],e;if($bm_isInstanceOfArray(r)&&$bm_isInstanceOfArray(e)){for(var s=0,n=r.length,a=e.length,o=[];s<n||s<a;)(typeof r[s]=="number"||r[s]instanceof Number)&&(typeof e[s]=="number"||e[s]instanceof Number)?o[s]=r[s]+e[s]:o[s]=e[s]===void 0?r[s]:r[s]||e[s],s+=1;return o}return 0}var add=sum;function sub(r,e){var t=_typeof$1(r),i=_typeof$1(e);if(isNumerable(t,r)&&isNumerable(i,e))return t==="string"&&(r=parseInt(r,10)),i==="string"&&(e=parseInt(e,10)),r-e;if($bm_isInstanceOfArray(r)&&isNumerable(i,e))return r=r.slice(0),r[0]-=e,r;if(isNumerable(t,r)&&$bm_isInstanceOfArray(e))return e=e.slice(0),e[0]=r-e[0],e;if($bm_isInstanceOfArray(r)&&$bm_isInstanceOfArray(e)){for(var s=0,n=r.length,a=e.length,o=[];s<n||s<a;)(typeof r[s]=="number"||r[s]instanceof Number)&&(typeof e[s]=="number"||e[s]instanceof Number)?o[s]=r[s]-e[s]:o[s]=e[s]===void 0?r[s]:r[s]||e[s],s+=1;return o}return 0}function mul(r,e){var t=_typeof$1(r),i=_typeof$1(e),s;if(isNumerable(t,r)&&isNumerable(i,e))return r*e;var n,a;if($bm_isInstanceOfArray(r)&&isNumerable(i,e)){for(a=r.length,s=createTypedArray("float32",a),n=0;n<a;n+=1)s[n]=r[n]*e;return s}if(isNumerable(t,r)&&$bm_isInstanceOfArray(e)){for(a=e.length,s=createTypedArray("float32",a),n=0;n<a;n+=1)s[n]=r*e[n];return s}return 0}function div(r,e){var t=_typeof$1(r),i=_typeof$1(e),s;if(isNumerable(t,r)&&isNumerable(i,e))return r/e;var n,a;if($bm_isInstanceOfArray(r)&&isNumerable(i,e)){for(a=r.length,s=createTypedArray("float32",a),n=0;n<a;n+=1)s[n]=r[n]/e;return s}if(isNumerable(t,r)&&$bm_isInstanceOfArray(e)){for(a=e.length,s=createTypedArray("float32",a),n=0;n<a;n+=1)s[n]=r/e[n];return s}return 0}function mod(r,e){return typeof r=="string"&&(r=parseInt(r,10)),typeof e=="string"&&(e=parseInt(e,10)),r%e}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(r,e,t){if(e>t){var i=t;t=e,e=i}return Math.min(Math.max(r,e),t)}function radiansToDegrees(r){return r/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(r){return r*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(r,e){if(typeof r=="number"||r instanceof Number)return e=e||0,Math.abs(r-e);e||(e=helperLengthArray);var t,i=Math.min(r.length,e.length),s=0;for(t=0;t<i;t+=1)s+=Math.pow(e[t]-r[t],2);return Math.sqrt(s)}function normalize(r){return div(r,length(r))}function rgbToHsl(r){var e=r[0],t=r[1],i=r[2],s=Math.max(e,t,i),n=Math.min(e,t,i),a,o,l=(s+n)/2;if(s===n)a=0,o=0;else{var c=s-n;switch(o=l>.5?c/(2-s-n):c/(s+n),s){case e:a=(t-i)/c+(t<i?6:0);break;case t:a=(i-e)/c+2;break;case i:a=(e-t)/c+4;break}a/=6}return[a,o,l,r[3]]}function hue2rgb(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function hslToRgb(r){var e=r[0],t=r[1],i=r[2],s,n,a;if(t===0)s=i,a=i,n=i;else{var o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;s=hue2rgb(l,o,e+1/3),n=hue2rgb(l,o,e),a=hue2rgb(l,o,e-1/3)}return[s,n,a,r[3]]}function linear(r,e,t,i,s){if((i===void 0||s===void 0)&&(i=e,s=t,e=0,t=1),t<e){var n=t;t=e,e=n}if(r<=e)return i;if(r>=t)return s;var a=t===e?0:(r-e)/(t-e);if(!i.length)return i+(s-i)*a;var o,l=i.length,c=createTypedArray("float32",l);for(o=0;o<l;o+=1)c[o]=i[o]+(s[o]-i[o])*a;return c}function random(r,e){if(e===void 0&&(r===void 0?(r=0,e=1):(e=r,r=void 0)),e.length){var t,i=e.length;r||(r=createTypedArray("float32",i));var s=createTypedArray("float32",i),n=BMMath.random();for(t=0;t<i;t+=1)s[t]=r[t]+n*(e[t]-r[t]);return s}r===void 0&&(r=0);var a=BMMath.random();return r+a*(e-r)}function createPath(r,e,t,i){var s,n=r.length,a=shapePool.newElement();a.setPathData(!!i,n);var o=[0,0],l,c;for(s=0;s<n;s+=1)l=e&&e[s]?e[s]:o,c=t&&t[s]?t[s]:o,a.setTripleAt(r[s][0],r[s][1],c[0]+r[s][0],c[1]+r[s][1],l[0]+r[s][0],l[1]+r[s][1],s,!0);return a}function initiateExpression(elem,data,property){function noOp(r){return r}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=function r(e,t){var i,s,n=this.pv.length?this.pv.length:1,a=createTypedArray("float32",n);e=5;var o=Math.floor(time*e);for(i=0,s=0;i<o;){for(s=0;s<n;s+=1)a[s]+=-t+t*2*BMMath.random();i+=1}var l=time*e,c=l-Math.floor(l),f=createTypedArray("float32",n);if(n>1){for(s=0;s<n;s+=1)f[s]=this.pv[s]+a[s]+(-t+t*2*BMMath.random())*c;return f}return this.pv+a[0]+(-t+t*2*BMMath.random())*c}.bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(r,e){return loopIn(r,e,!0)}function loopOutDuration(r,e){return loopOut(r,e,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(r,e){var t=[e[0]-r[0],e[1]-r[1],e[2]-r[2]],i=Math.atan2(t[0],Math.sqrt(t[1]*t[1]+t[2]*t[2]))/degToRads,s=-Math.atan2(t[1],t[2])/degToRads;return[s,i,0]}function easeOut(r,e,t,i,s){return applyEase(easeOutBez,r,e,t,i,s)}function easeIn(r,e,t,i,s){return applyEase(easeInBez,r,e,t,i,s)}function ease(r,e,t,i,s){return applyEase(easeInOutBez,r,e,t,i,s)}function applyEase(r,e,t,i,s,n){s===void 0?(s=t,n=i):e=(e-t)/(i-t),e>1?e=1:e<0&&(e=0);var a=r(e);if($bm_isInstanceOfArray(s)){var o,l=s.length,c=createTypedArray("float32",l);for(o=0;o<l;o+=1)c[o]=(n[o]-s[o])*a+s[o];return c}return(n-s)*a+s}function nearestKey(r){var e,t=data.k.length,i,s;if(!data.k.length||typeof data.k[0]=="number")i=0,s=0;else if(i=-1,r*=elem.comp.globalData.frameRate,r<data.k[0].t)i=1,s=data.k[0].t;else{for(e=0;e<t-1;e+=1)if(r===data.k[e].t){i=e+1,s=data.k[e].t;break}else if(r>data.k[e].t&&r<data.k[e+1].t){r-data.k[e].t>data.k[e+1].t-r?(i=e+2,s=data.k[e+1].t):(i=e+1,s=data.k[e].t);break}i===-1&&(i=e+1,s=data.k[e].t)}var n={};return n.index=i,n.time=s/elem.comp.globalData.frameRate,n}function key(r){var e,t,i;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+r);r-=1,e={time:data.k[r].t/elem.comp.globalData.frameRate,value:[]};var s=Object.prototype.hasOwnProperty.call(data.k[r],"s")?data.k[r].s:data.k[r-1].e;for(i=s.length,t=0;t<i;t+=1)e[t]=s[t],e.value[t]=s[t];return e}function framesToTime(r,e){return e||(e=elem.comp.globalData.frameRate),r/e}function timeToFrames(r,e){return!r&&r!==0&&(r=time),e||(e=elem.comp.globalData.frameRate),r*e}function seedRandom(r){BMMath.seedrandom(randSeed+r)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(r,e){return typeof value=="string"?e===void 0?value.substring(r):value.substring(r,e):""}function substr(r,e){return typeof value=="string"?e===void 0?value.substr(r):value.substr(r,e):""}function posterizeTime(r){time=r===0?0:Math.floor(time*r)/r,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(r){return value=r,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var r={};r.initExpressions=e,r.resetFrame=ExpressionManager.resetFrame;function e(t){var i=0,s=[];function n(){i+=1}function a(){i-=1,i===0&&l()}function o(c){s.indexOf(c)===-1&&s.push(c)}function l(){var c,f=s.length;for(c=0;c<f;c+=1)s[c].release();s.length=0}t.renderer.compInterface=CompExpressionInterface(t.renderer),t.renderer.globalData.projectInterface.registerComposition(t.renderer),t.renderer.globalData.pushExpression=n,t.renderer.globalData.popExpression=a,t.renderer.globalData.registerExpressionProperty=o}return r}(),MaskManagerInterface=function(){function r(t,i){this._mask=t,this._data=i}Object.defineProperty(r.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(r.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var e=function(i){var s=createSizedArray(i.viewData.length),n,a=i.viewData.length;for(n=0;n<a;n+=1)s[n]=new r(i.viewData[n],i.masksProperties[n]);var o=function(c){for(n=0;n<a;){if(i.masksProperties[n].nm===c)return s[n];n+=1}return null};return o};return e}(),ExpressionPropertyInterface=function(){var r={pv:0,v:0,mult:1},e={pv:[0,0,0],v:[0,0,0],mult:1};function t(a,o,l){Object.defineProperty(a,"velocity",{get:function(){return o.getVelocityAtTime(o.comp.currentFrame)}}),a.numKeys=o.keyframes?o.keyframes.length:0,a.key=function(c){if(!a.numKeys)return 0;var f="";"s"in o.keyframes[c-1]?f=o.keyframes[c-1].s:"e"in o.keyframes[c-2]?f=o.keyframes[c-2].e:f=o.keyframes[c-2].s;var d=l==="unidimensional"?new Number(f):Object.assign({},f);return d.time=o.keyframes[c-1].t/o.elem.comp.globalData.frameRate,d.value=l==="unidimensional"?f[0]:f,d},a.valueAtTime=o.getValueAtTime,a.speedAtTime=o.getSpeedAtTime,a.velocityAtTime=o.getVelocityAtTime,a.propertyGroup=o.propertyGroup}function i(a){(!a||!("pv"in a))&&(a=r);var o=1/a.mult,l=a.pv*o,c=new Number(l);return c.value=l,t(c,a,"unidimensional"),function(){return a.k&&a.getValue(),l=a.v*o,c.value!==l&&(c=new Number(l),c.value=l,t(c,a,"unidimensional")),c}}function s(a){(!a||!("pv"in a))&&(a=e);var o=1/a.mult,l=a.data&&a.data.l||a.pv.length,c=createTypedArray("float32",l),f=createTypedArray("float32",l);return c.value=f,t(c,a,"multidimensional"),function(){a.k&&a.getValue();for(var d=0;d<l;d+=1)f[d]=a.v[d]*o,c[d]=f[d];return c}}function n(){return r}return function(a){return a?a.propType==="unidimensional"?i(a):s(a):n}}(),TransformExpressionInterface=function(){return function(r){function e(a){switch(a){case"scale":case"Scale":case"ADBE Scale":case 6:return e.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return e.rotation;case"ADBE Rotate X":return e.xRotation;case"ADBE Rotate Y":return e.yRotation;case"position":case"Position":case"ADBE Position":case 2:return e.position;case"ADBE Position_0":return e.xPosition;case"ADBE Position_1":return e.yPosition;case"ADBE Position_2":return e.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return e.anchorPoint;case"opacity":case"Opacity":case 11:return e.opacity;default:return null}}Object.defineProperty(e,"rotation",{get:ExpressionPropertyInterface(r.r||r.rz)}),Object.defineProperty(e,"zRotation",{get:ExpressionPropertyInterface(r.rz||r.r)}),Object.defineProperty(e,"xRotation",{get:ExpressionPropertyInterface(r.rx)}),Object.defineProperty(e,"yRotation",{get:ExpressionPropertyInterface(r.ry)}),Object.defineProperty(e,"scale",{get:ExpressionPropertyInterface(r.s)});var t,i,s,n;return r.p?n=ExpressionPropertyInterface(r.p):(t=ExpressionPropertyInterface(r.px),i=ExpressionPropertyInterface(r.py),r.pz&&(s=ExpressionPropertyInterface(r.pz))),Object.defineProperty(e,"position",{get:function(){return r.p?n():[t(),i(),s?s():0]}}),Object.defineProperty(e,"xPosition",{get:ExpressionPropertyInterface(r.px)}),Object.defineProperty(e,"yPosition",{get:ExpressionPropertyInterface(r.py)}),Object.defineProperty(e,"zPosition",{get:ExpressionPropertyInterface(r.pz)}),Object.defineProperty(e,"anchorPoint",{get:ExpressionPropertyInterface(r.a)}),Object.defineProperty(e,"opacity",{get:ExpressionPropertyInterface(r.o)}),Object.defineProperty(e,"skew",{get:ExpressionPropertyInterface(r.sk)}),Object.defineProperty(e,"skewAxis",{get:ExpressionPropertyInterface(r.sa)}),Object.defineProperty(e,"orientation",{get:ExpressionPropertyInterface(r.or)}),e}}(),LayerExpressionInterface=function(){function r(c){var f=new Matrix;if(c!==void 0){var d=this._elem.finalTransform.mProp.getValueAtTime(c);d.clone(f)}else{var u=this._elem.finalTransform.mProp;u.applyToMatrix(f)}return f}function e(c,f){var d=this.getMatrix(f);return d.props[12]=0,d.props[13]=0,d.props[14]=0,this.applyPoint(d,c)}function t(c,f){var d=this.getMatrix(f);return this.applyPoint(d,c)}function i(c,f){var d=this.getMatrix(f);return d.props[12]=0,d.props[13]=0,d.props[14]=0,this.invertPoint(d,c)}function s(c,f){var d=this.getMatrix(f);return this.invertPoint(d,c)}function n(c,f){if(this._elem.hierarchy&&this._elem.hierarchy.length){var d,u=this._elem.hierarchy.length;for(d=0;d<u;d+=1)this._elem.hierarchy[d].finalTransform.mProp.applyToMatrix(c)}return c.applyToPointArray(f[0],f[1],f[2]||0)}function a(c,f){if(this._elem.hierarchy&&this._elem.hierarchy.length){var d,u=this._elem.hierarchy.length;for(d=0;d<u;d+=1)this._elem.hierarchy[d].finalTransform.mProp.applyToMatrix(c)}return c.inversePoint(f)}function o(c){var f=new Matrix;if(f.reset(),this._elem.finalTransform.mProp.applyToMatrix(f),this._elem.hierarchy&&this._elem.hierarchy.length){var d,u=this._elem.hierarchy.length;for(d=0;d<u;d+=1)this._elem.hierarchy[d].finalTransform.mProp.applyToMatrix(f);return f.inversePoint(c)}return f.inversePoint(c)}function l(){return[1,1,1,1]}return function(c){var f;function d(m){g.mask=new MaskManagerInterface(m,c)}function u(m){g.effect=m}function g(m){switch(m){case"ADBE Root Vectors Group":case"Contents":case 2:return g.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return f;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return g.effect;case"ADBE Text Properties":return g.textInterface;default:return null}}g.getMatrix=r,g.invertPoint=a,g.applyPoint=n,g.toWorld=t,g.toWorldVec=e,g.fromWorld=s,g.fromWorldVec=i,g.toComp=t,g.fromComp=o,g.sampleImage=l,g.sourceRectAtTime=c.sourceRectAtTime.bind(c),g._elem=c,f=TransformExpressionInterface(c.finalTransform.mProp);var p=getDescriptor(f,"anchorPoint");return Object.defineProperties(g,{hasParent:{get:function(){return c.hierarchy.length}},parent:{get:function(){return c.hierarchy[0].layerInterface}},rotation:getDescriptor(f,"rotation"),scale:getDescriptor(f,"scale"),position:getDescriptor(f,"position"),opacity:getDescriptor(f,"opacity"),anchorPoint:p,anchor_point:p,transform:{get:function(){return f}},active:{get:function(){return c.isInRange}}}),g.startTime=c.data.st,g.index=c.data.ind,g.source=c.data.refId,g.height=c.data.ty===0?c.data.h:100,g.width=c.data.ty===0?c.data.w:100,g.inPoint=c.data.ip/c.comp.globalData.frameRate,g.outPoint=c.data.op/c.comp.globalData.frameRate,g._name=c.data.nm,g.registerMaskInterface=d,g.registerEffectsInterface=u,g}}(),propertyGroupFactory=function(){return function(r,e){return function(t){return t=t===void 0?1:t,t<=0?r:e(t-1)}}}(),PropertyInterface=function(){return function(r,e){var t={_name:r};function i(s){return s=s===void 0?1:s,s<=0?t:e(s-1)}return i}}(),EffectsExpressionInterface=function(){var r={createEffectsInterface:e};function e(s,n){if(s.effectsManager){var a=[],o=s.data.ef,l,c=s.effectsManager.effectElements.length;for(l=0;l<c;l+=1)a.push(t(o[l],s.effectsManager.effectElements[l],n,s));var f=s.data.ef||[],d=function(g){for(l=0,c=f.length;l<c;){if(g===f[l].nm||g===f[l].mn||g===f[l].ix)return a[l];l+=1}return null};return Object.defineProperty(d,"numProperties",{get:function(){return f.length}}),d}return null}function t(s,n,a,o){function l(g){for(var p=s.ef,m=0,S=p.length;m<S;){if(g===p[m].nm||g===p[m].mn||g===p[m].ix)return p[m].ty===5?f[m]:f[m]();m+=1}throw new Error}var c=propertyGroupFactory(l,a),f=[],d,u=s.ef.length;for(d=0;d<u;d+=1)s.ef[d].ty===5?f.push(t(s.ef[d],n.effectElements[d],n.effectElements[d].propertyGroup,o)):f.push(i(n.effectElements[d],s.ef[d].ty,o,c));return s.mn==="ADBE Color Control"&&Object.defineProperty(l,"color",{get:function(){return f[0]()}}),Object.defineProperties(l,{numProperties:{get:function(){return s.np}},_name:{value:s.nm},propertyGroup:{value:c}}),l.enabled=s.en!==0,l.active=l.enabled,l}function i(s,n,a,o){var l=ExpressionPropertyInterface(s.p);function c(){return n===10?a.comp.compInterface(s.p.v):l()}return s.p.setGroupProperty&&s.p.setGroupProperty(PropertyInterface("",o)),c}return r}(),ShapePathInterface=function(){return function(e,t,i){var s=t.sh;function n(o){return o==="Shape"||o==="shape"||o==="Path"||o==="path"||o==="ADBE Vector Shape"||o===2?n.path:null}var a=propertyGroupFactory(n,i);return s.setGroupProperty(PropertyInterface("Path",a)),Object.defineProperties(n,{path:{get:function(){return s.k&&s.getValue(),s}},shape:{get:function(){return s.k&&s.getValue(),s}},_name:{value:e.nm},ix:{value:e.ix},propertyIndex:{value:e.ix},mn:{value:e.mn},propertyGroup:{value:i}}),n}}(),ShapeExpressionInterface=function(){function r(p,m,S){var y=[],x,E=p?p.length:0;for(x=0;x<E;x+=1)p[x].ty==="gr"?y.push(t(p[x],m[x],S)):p[x].ty==="fl"?y.push(i(p[x],m[x],S)):p[x].ty==="st"?y.push(a(p[x],m[x],S)):p[x].ty==="tm"?y.push(o(p[x],m[x],S)):p[x].ty==="tr"||(p[x].ty==="el"?y.push(c(p[x],m[x],S)):p[x].ty==="sr"?y.push(f(p[x],m[x],S)):p[x].ty==="sh"?y.push(ShapePathInterface(p[x],m[x],S)):p[x].ty==="rc"?y.push(d(p[x],m[x],S)):p[x].ty==="rd"?y.push(u(p[x],m[x],S)):p[x].ty==="rp"?y.push(g(p[x],m[x],S)):p[x].ty==="gf"?y.push(s(p[x],m[x],S)):y.push(n(p[x],m[x])));return y}function e(p,m,S){var y,x=function(A){for(var _=0,P=y.length;_<P;){if(y[_]._name===A||y[_].mn===A||y[_].propertyIndex===A||y[_].ix===A||y[_].ind===A)return y[_];_+=1}return typeof A=="number"?y[A-1]:null};x.propertyGroup=propertyGroupFactory(x,S),y=r(p.it,m.it,x.propertyGroup),x.numProperties=y.length;var E=l(p.it[p.it.length-1],m.it[m.it.length-1],x.propertyGroup);return x.transform=E,x.propertyIndex=p.cix,x._name=p.nm,x}function t(p,m,S){var y=function(A){switch(A){case"ADBE Vectors Group":case"Contents":case 2:return y.content;default:return y.transform}};y.propertyGroup=propertyGroupFactory(y,S);var x=e(p,m,y.propertyGroup),E=l(p.it[p.it.length-1],m.it[m.it.length-1],y.propertyGroup);return y.content=x,y.transform=E,Object.defineProperty(y,"_name",{get:function(){return p.nm}}),y.numProperties=p.np,y.propertyIndex=p.ix,y.nm=p.nm,y.mn=p.mn,y}function i(p,m,S){function y(x){return x==="Color"||x==="color"?y.color:x==="Opacity"||x==="opacity"?y.opacity:null}return Object.defineProperties(y,{color:{get:ExpressionPropertyInterface(m.c)},opacity:{get:ExpressionPropertyInterface(m.o)},_name:{value:p.nm},mn:{value:p.mn}}),m.c.setGroupProperty(PropertyInterface("Color",S)),m.o.setGroupProperty(PropertyInterface("Opacity",S)),y}function s(p,m,S){function y(x){return x==="Start Point"||x==="start point"?y.startPoint:x==="End Point"||x==="end point"?y.endPoint:x==="Opacity"||x==="opacity"?y.opacity:null}return Object.defineProperties(y,{startPoint:{get:ExpressionPropertyInterface(m.s)},endPoint:{get:ExpressionPropertyInterface(m.e)},opacity:{get:ExpressionPropertyInterface(m.o)},type:{get:function(){return"a"}},_name:{value:p.nm},mn:{value:p.mn}}),m.s.setGroupProperty(PropertyInterface("Start Point",S)),m.e.setGroupProperty(PropertyInterface("End Point",S)),m.o.setGroupProperty(PropertyInterface("Opacity",S)),y}function n(){function p(){return null}return p}function a(p,m,S){var y=propertyGroupFactory(P,S),x=propertyGroupFactory(_,y);function E(k){Object.defineProperty(_,p.d[k].nm,{get:ExpressionPropertyInterface(m.d.dataProps[k].p)})}var T,A=p.d?p.d.length:0,_={};for(T=0;T<A;T+=1)E(T),m.d.dataProps[T].p.setGroupProperty(x);function P(k){return k==="Color"||k==="color"?P.color:k==="Opacity"||k==="opacity"?P.opacity:k==="Stroke Width"||k==="stroke width"?P.strokeWidth:null}return Object.defineProperties(P,{color:{get:ExpressionPropertyInterface(m.c)},opacity:{get:ExpressionPropertyInterface(m.o)},strokeWidth:{get:ExpressionPropertyInterface(m.w)},dash:{get:function(){return _}},_name:{value:p.nm},mn:{value:p.mn}}),m.c.setGroupProperty(PropertyInterface("Color",y)),m.o.setGroupProperty(PropertyInterface("Opacity",y)),m.w.setGroupProperty(PropertyInterface("Stroke Width",y)),P}function o(p,m,S){function y(E){return E===p.e.ix||E==="End"||E==="end"?y.end:E===p.s.ix?y.start:E===p.o.ix?y.offset:null}var x=propertyGroupFactory(y,S);return y.propertyIndex=p.ix,m.s.setGroupProperty(PropertyInterface("Start",x)),m.e.setGroupProperty(PropertyInterface("End",x)),m.o.setGroupProperty(PropertyInterface("Offset",x)),y.propertyIndex=p.ix,y.propertyGroup=S,Object.defineProperties(y,{start:{get:ExpressionPropertyInterface(m.s)},end:{get:ExpressionPropertyInterface(m.e)},offset:{get:ExpressionPropertyInterface(m.o)},_name:{value:p.nm}}),y.mn=p.mn,y}function l(p,m,S){function y(E){return p.a.ix===E||E==="Anchor Point"?y.anchorPoint:p.o.ix===E||E==="Opacity"?y.opacity:p.p.ix===E||E==="Position"?y.position:p.r.ix===E||E==="Rotation"||E==="ADBE Vector Rotation"?y.rotation:p.s.ix===E||E==="Scale"?y.scale:p.sk&&p.sk.ix===E||E==="Skew"?y.skew:p.sa&&p.sa.ix===E||E==="Skew Axis"?y.skewAxis:null}var x=propertyGroupFactory(y,S);return m.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",x)),m.transform.mProps.p.setGroupProperty(PropertyInterface("Position",x)),m.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",x)),m.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",x)),m.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",x)),m.transform.mProps.sk&&(m.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",x)),m.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",x))),m.transform.op.setGroupProperty(PropertyInterface("Opacity",x)),Object.defineProperties(y,{opacity:{get:ExpressionPropertyInterface(m.transform.mProps.o)},position:{get:ExpressionPropertyInterface(m.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(m.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(m.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(m.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(m.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(m.transform.mProps.sa)},_name:{value:p.nm}}),y.ty="tr",y.mn=p.mn,y.propertyGroup=S,y}function c(p,m,S){function y(T){return p.p.ix===T?y.position:p.s.ix===T?y.size:null}var x=propertyGroupFactory(y,S);y.propertyIndex=p.ix;var E=m.sh.ty==="tm"?m.sh.prop:m.sh;return E.s.setGroupProperty(PropertyInterface("Size",x)),E.p.setGroupProperty(PropertyInterface("Position",x)),Object.defineProperties(y,{size:{get:ExpressionPropertyInterface(E.s)},position:{get:ExpressionPropertyInterface(E.p)},_name:{value:p.nm}}),y.mn=p.mn,y}function f(p,m,S){function y(T){return p.p.ix===T?y.position:p.r.ix===T?y.rotation:p.pt.ix===T?y.points:p.or.ix===T||T==="ADBE Vector Star Outer Radius"?y.outerRadius:p.os.ix===T?y.outerRoundness:p.ir&&(p.ir.ix===T||T==="ADBE Vector Star Inner Radius")?y.innerRadius:p.is&&p.is.ix===T?y.innerRoundness:null}var x=propertyGroupFactory(y,S),E=m.sh.ty==="tm"?m.sh.prop:m.sh;return y.propertyIndex=p.ix,E.or.setGroupProperty(PropertyInterface("Outer Radius",x)),E.os.setGroupProperty(PropertyInterface("Outer Roundness",x)),E.pt.setGroupProperty(PropertyInterface("Points",x)),E.p.setGroupProperty(PropertyInterface("Position",x)),E.r.setGroupProperty(PropertyInterface("Rotation",x)),p.ir&&(E.ir.setGroupProperty(PropertyInterface("Inner Radius",x)),E.is.setGroupProperty(PropertyInterface("Inner Roundness",x))),Object.defineProperties(y,{position:{get:ExpressionPropertyInterface(E.p)},rotation:{get:ExpressionPropertyInterface(E.r)},points:{get:ExpressionPropertyInterface(E.pt)},outerRadius:{get:ExpressionPropertyInterface(E.or)},outerRoundness:{get:ExpressionPropertyInterface(E.os)},innerRadius:{get:ExpressionPropertyInterface(E.ir)},innerRoundness:{get:ExpressionPropertyInterface(E.is)},_name:{value:p.nm}}),y.mn=p.mn,y}function d(p,m,S){function y(T){return p.p.ix===T?y.position:p.r.ix===T?y.roundness:p.s.ix===T||T==="Size"||T==="ADBE Vector Rect Size"?y.size:null}var x=propertyGroupFactory(y,S),E=m.sh.ty==="tm"?m.sh.prop:m.sh;return y.propertyIndex=p.ix,E.p.setGroupProperty(PropertyInterface("Position",x)),E.s.setGroupProperty(PropertyInterface("Size",x)),E.r.setGroupProperty(PropertyInterface("Rotation",x)),Object.defineProperties(y,{position:{get:ExpressionPropertyInterface(E.p)},roundness:{get:ExpressionPropertyInterface(E.r)},size:{get:ExpressionPropertyInterface(E.s)},_name:{value:p.nm}}),y.mn=p.mn,y}function u(p,m,S){function y(T){return p.r.ix===T||T==="Round Corners 1"?y.radius:null}var x=propertyGroupFactory(y,S),E=m;return y.propertyIndex=p.ix,E.rd.setGroupProperty(PropertyInterface("Radius",x)),Object.defineProperties(y,{radius:{get:ExpressionPropertyInterface(E.rd)},_name:{value:p.nm}}),y.mn=p.mn,y}function g(p,m,S){function y(T){return p.c.ix===T||T==="Copies"?y.copies:p.o.ix===T||T==="Offset"?y.offset:null}var x=propertyGroupFactory(y,S),E=m;return y.propertyIndex=p.ix,E.c.setGroupProperty(PropertyInterface("Copies",x)),E.o.setGroupProperty(PropertyInterface("Offset",x)),Object.defineProperties(y,{copies:{get:ExpressionPropertyInterface(E.c)},offset:{get:ExpressionPropertyInterface(E.o)},_name:{value:p.nm}}),y.mn=p.mn,y}return function(p,m,S){var y;function x(T){if(typeof T=="number")return T=T===void 0?1:T,T===0?S:y[T-1];for(var A=0,_=y.length;A<_;){if(y[A]._name===T)return y[A];A+=1}return null}function E(){return S}return x.propertyGroup=propertyGroupFactory(x,E),y=r(p,m,x.propertyGroup),x.numProperties=y.length,x._name="Contents",x}}(),TextExpressionInterface=function(){return function(r){var e;function t(i){switch(i){case"ADBE Text Document":return t.sourceText;default:return null}}return Object.defineProperty(t,"sourceText",{get:function(){r.textProperty.getValue();var s=r.textProperty.currentData.t;return(!e||s!==e.value)&&(e=new String(s),e.value=s||new String(s),Object.defineProperty(e,"style",{get:function(){return{fillColor:r.textProperty.currentData.fc}}})),e}}),t}}();function _typeof(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(t){return typeof t}:_typeof=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(r)}var FootageInterface=function(){var r=function(i){var s="",n=i.getFootageData();function a(){return s="",n=i.getFootageData(),o}function o(l){if(n[l])return s=l,n=n[l],_typeof(n)==="object"?o:n;var c=l.indexOf(s);if(c!==-1){var f=parseInt(l.substr(c+s.length),10);return n=n[f],_typeof(n)==="object"?o:n}return""}return a},e=function(i){function s(n){return n==="Outline"?s.outlineInterface():null}return s._name="Outline",s.outlineInterface=r(i),s};return function(t){function i(s){return s==="Data"?i.dataInterface:null}return i._name="Data",i.dataInterface=e(t),i}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(r){return interfaces[r]||null}var expressionHelpers=function(){function r(a,o,l){o.x&&(l.k=!0,l.x=!0,l.initiateExpression=ExpressionManager.initiateExpression,l.effectsSequence.push(l.initiateExpression(a,o,l).bind(l)))}function e(a){return a*=this.elem.globalData.frameRate,a-=this.offsetTime,a!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<a?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(a,this._cachingAtTime),this._cachingAtTime.lastFrame=a),this._cachingAtTime.value}function t(a){var o=-.01,l=this.getValueAtTime(a),c=this.getValueAtTime(a+o),f=0;if(l.length){var d;for(d=0;d<l.length;d+=1)f+=Math.pow(c[d]-l[d],2);f=Math.sqrt(f)*100}else f=0;return f}function i(a){if(this.vel!==void 0)return this.vel;var o=-.001,l=this.getValueAtTime(a),c=this.getValueAtTime(a+o),f;if(l.length){f=createTypedArray("float32",l.length);var d;for(d=0;d<l.length;d+=1)f[d]=(c[d]-l[d])/o}else f=(c-l)/o;return f}function s(){return this.pv}function n(a){this.propertyGroup=a}return{searchExpressions:r,getSpeedAtTime:t,getVelocityAtTime:i,getValueAtTime:e,getStaticValueAtTime:s,setGroupProperty:n}}();function addPropertyDecorator(){function r(u,g,p){if(!this.k||!this.keyframes)return this.pv;u=u?u.toLowerCase():"";var m=this.comp.renderedFrame,S=this.keyframes,y=S[S.length-1].t;if(m<=y)return this.pv;var x,E;p?(g?x=Math.abs(y-this.elem.comp.globalData.frameRate*g):x=Math.max(0,y-this.elem.data.ip),E=y-x):((!g||g>S.length-1)&&(g=S.length-1),E=S[S.length-1-g].t,x=y-E);var T,A,_;if(u==="pingpong"){var P=Math.floor((m-E)/x);if(P%2!==0)return this.getValueAtTime((x-(m-E)%x+E)/this.comp.globalData.frameRate,0)}else if(u==="offset"){var k=this.getValueAtTime(E/this.comp.globalData.frameRate,0),F=this.getValueAtTime(y/this.comp.globalData.frameRate,0),M=this.getValueAtTime(((m-E)%x+E)/this.comp.globalData.frameRate,0),B=Math.floor((m-E)/x);if(this.pv.length){for(_=new Array(k.length),A=_.length,T=0;T<A;T+=1)_[T]=(F[T]-k[T])*B+M[T];return _}return(F-k)*B+M}else if(u==="continue"){var N=this.getValueAtTime(y/this.comp.globalData.frameRate,0),G=this.getValueAtTime((y-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(_=new Array(N.length),A=_.length,T=0;T<A;T+=1)_[T]=N[T]+(N[T]-G[T])*((m-y)/this.comp.globalData.frameRate)/5e-4;return _}return N+(N-G)*((m-y)/.001)}return this.getValueAtTime(((m-E)%x+E)/this.comp.globalData.frameRate,0)}function e(u,g,p){if(!this.k)return this.pv;u=u?u.toLowerCase():"";var m=this.comp.renderedFrame,S=this.keyframes,y=S[0].t;if(m>=y)return this.pv;var x,E;p?(g?x=Math.abs(this.elem.comp.globalData.frameRate*g):x=Math.max(0,this.elem.data.op-y),E=y+x):((!g||g>S.length-1)&&(g=S.length-1),E=S[g].t,x=E-y);var T,A,_;if(u==="pingpong"){var P=Math.floor((y-m)/x);if(P%2===0)return this.getValueAtTime(((y-m)%x+y)/this.comp.globalData.frameRate,0)}else if(u==="offset"){var k=this.getValueAtTime(y/this.comp.globalData.frameRate,0),F=this.getValueAtTime(E/this.comp.globalData.frameRate,0),M=this.getValueAtTime((x-(y-m)%x+y)/this.comp.globalData.frameRate,0),B=Math.floor((y-m)/x)+1;if(this.pv.length){for(_=new Array(k.length),A=_.length,T=0;T<A;T+=1)_[T]=M[T]-(F[T]-k[T])*B;return _}return M-(F-k)*B}else if(u==="continue"){var N=this.getValueAtTime(y/this.comp.globalData.frameRate,0),G=this.getValueAtTime((y+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(_=new Array(N.length),A=_.length,T=0;T<A;T+=1)_[T]=N[T]+(N[T]-G[T])*(y-m)/.001;return _}return N+(N-G)*(y-m)/.001}return this.getValueAtTime((x-((y-m)%x+y))/this.comp.globalData.frameRate,0)}function t(u,g){if(!this.k)return this.pv;if(u=(u||.4)*.5,g=Math.floor(g||5),g<=1)return this.pv;var p=this.comp.renderedFrame/this.comp.globalData.frameRate,m=p-u,S=p+u,y=g>1?(S-m)/(g-1):1,x=0,E=0,T;this.pv.length?T=createTypedArray("float32",this.pv.length):T=0;for(var A;x<g;){if(A=this.getValueAtTime(m+x*y),this.pv.length)for(E=0;E<this.pv.length;E+=1)T[E]+=A[E];else T+=A;x+=1}if(this.pv.length)for(E=0;E<this.pv.length;E+=1)T[E]/=g;else T/=g;return T}function i(u){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var g=this._transformCachingAtTime.v;if(g.cloneFromProps(this.pre.props),this.appliedTransformations<1){var p=this.a.getValueAtTime(u);g.translate(-p[0]*this.a.mult,-p[1]*this.a.mult,p[2]*this.a.mult)}if(this.appliedTransformations<2){var m=this.s.getValueAtTime(u);g.scale(m[0]*this.s.mult,m[1]*this.s.mult,m[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var S=this.sk.getValueAtTime(u),y=this.sa.getValueAtTime(u);g.skewFromAxis(-S*this.sk.mult,y*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var x=this.r.getValueAtTime(u);g.rotate(-x*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var E=this.rz.getValueAtTime(u),T=this.ry.getValueAtTime(u),A=this.rx.getValueAtTime(u),_=this.or.getValueAtTime(u);g.rotateZ(-E*this.rz.mult).rotateY(T*this.ry.mult).rotateX(A*this.rx.mult).rotateZ(-_[2]*this.or.mult).rotateY(_[1]*this.or.mult).rotateX(_[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var P=this.px.getValueAtTime(u),k=this.py.getValueAtTime(u);if(this.data.p.z){var F=this.pz.getValueAtTime(u);g.translate(P*this.px.mult,k*this.py.mult,-F*this.pz.mult)}else g.translate(P*this.px.mult,k*this.py.mult,0)}else{var M=this.p.getValueAtTime(u);g.translate(M[0]*this.p.mult,M[1]*this.p.mult,-M[2]*this.p.mult)}return g}function s(){return this.v.clone(new Matrix)}var n=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(u,g,p){var m=n(u,g,p);return m.dynamicProperties.length?m.getValueAtTime=i.bind(m):m.getValueAtTime=s.bind(m),m.setGroupProperty=expressionHelpers.setGroupProperty,m};var a=PropertyFactory.getProp;PropertyFactory.getProp=function(u,g,p,m,S){var y=a(u,g,p,m,S);y.kf?y.getValueAtTime=expressionHelpers.getValueAtTime.bind(y):y.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(y),y.setGroupProperty=expressionHelpers.setGroupProperty,y.loopOut=r,y.loopIn=e,y.smooth=t,y.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(y),y.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(y),y.numKeys=g.a===1?g.k.length:0,y.propertyIndex=g.ix;var x=0;return p!==0&&(x=createTypedArray("float32",g.a===1?g.k[0].s.length:g.k.length)),y._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:x},expressionHelpers.searchExpressions(u,g,y),y.k&&S.addDynamicProperty(y),y};function o(u){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),u*=this.elem.globalData.frameRate,u-=this.offsetTime,u!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<u?this._caching.lastIndex:0,this._cachingAtTime.lastTime=u,this.interpolateShape(u,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var l=ShapePropertyFactory.getConstructorFunction(),c=ShapePropertyFactory.getKeyframedConstructorFunction();function f(){}f.prototype={vertices:function(g,p){this.k&&this.getValue();var m=this.v;p!==void 0&&(m=this.getValueAtTime(p,0));var S,y=m._length,x=m[g],E=m.v,T=createSizedArray(y);for(S=0;S<y;S+=1)g==="i"||g==="o"?T[S]=[x[S][0]-E[S][0],x[S][1]-E[S][1]]:T[S]=[x[S][0],x[S][1]];return T},points:function(g){return this.vertices("v",g)},inTangents:function(g){return this.vertices("i",g)},outTangents:function(g){return this.vertices("o",g)},isClosed:function(){return this.v.c},pointOnPath:function(g,p){var m=this.v;p!==void 0&&(m=this.getValueAtTime(p,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(m));for(var S=this._segmentsLength,y=S.lengths,x=S.totalLength*g,E=0,T=y.length,A=0,_;E<T;){if(A+y[E].addedLength>x){var P=E,k=m.c&&E===T-1?0:E+1,F=(x-A)/y[E].addedLength;_=bez.getPointInSegment(m.v[P],m.v[k],m.o[P],m.i[k],F,y[E]);break}else A+=y[E].addedLength;E+=1}return _||(_=m.c?[m.v[0][0],m.v[0][1]]:[m.v[m._length-1][0],m.v[m._length-1][1]]),_},vectorOnPath:function(g,p,m){g==1?g=this.v.c:g==0&&(g=.999);var S=this.pointOnPath(g,p),y=this.pointOnPath(g+.001,p),x=y[0]-S[0],E=y[1]-S[1],T=Math.sqrt(Math.pow(x,2)+Math.pow(E,2));if(T===0)return[0,0];var A=m==="tangent"?[x/T,E/T]:[-E/T,x/T];return A},tangentOnPath:function(g,p){return this.vectorOnPath(g,p,"tangent")},normalOnPath:function(g,p){return this.vectorOnPath(g,p,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([f],l),extendPrototype([f],c),c.prototype.getValueAtTime=o,c.prototype.initiateExpression=ExpressionManager.initiateExpression;var d=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(u,g,p,m,S){var y=d(u,g,p,m,S);return y.propertyIndex=g.ix,y.lock=!1,p===3?expressionHelpers.searchExpressions(u,g.pt,y):p===4&&expressionHelpers.searchExpressions(u,g.ks,y),y.k&&u.addDynamicProperty(y),y}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function r(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(e,t){var i=this.calculateExpression(t);if(e.t!==i){var s={};return this.copyData(s,e),s.t=i.toString(),s.__complete=!1,s}return e},TextProperty.prototype.searchProperty=function(){var e=this.searchKeyframes(),t=this.searchExpressions();return this.kf=e||t,this.kf},TextProperty.prototype.searchExpressions=r}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function r(e,t){var i=createNS("feMerge");i.setAttribute("result",e);var s,n;for(n=0;n<t.length;n+=1)s=createNS("feMergeNode"),s.setAttribute("in",t[n]),i.appendChild(s),i.appendChild(s);return i}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(r,e,t,i,s){this.filterManager=e;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","linearRGB"),n.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=n,n.setAttribute("result",i+"_tint_1"),r.appendChild(n),n=createNS("feColorMatrix"),n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),n.setAttribute("result",i+"_tint_2"),r.appendChild(n),this.matrixFilter=n;var a=this.createMergeNode(i,[s,i+"_tint_1",i+"_tint_2"]);r.appendChild(a)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(r){if(r||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,t=this.filterManager.effectElements[1].p.v,i=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+i+" 0"),this.matrixFilter.setAttribute("values",t[0]-e[0]+" 0 0 0 "+e[0]+" "+(t[1]-e[1])+" 0 0 0 "+e[1]+" "+(t[2]-e[2])+" 0 0 0 "+e[2]+" 0 0 0 1 0")}};function SVGFillFilter(r,e,t,i){this.filterManager=e;var s=createNS("feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),s.setAttribute("result",i),r.appendChild(s),this.matrixFilter=s}SVGFillFilter.prototype.renderFrame=function(r){if(r||this.filterManager._mdf){var e=this.filterManager.effectElements[2].p.v,t=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+e[0]+" 0 0 0 0 "+e[1]+" 0 0 0 0 "+e[2]+" 0 0 0 "+t+" 0")}};function SVGStrokeEffect(r,e,t){this.initialized=!1,this.filterManager=e,this.elem=t,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var r=this.elem.layerElement.children||this.elem.layerElement.childNodes,e,t,i,s;for(this.filterManager.effectElements[1].p.v===1?(s=this.elem.maskManager.masksProperties.length,i=0):(i=this.filterManager.effectElements[0].p.v-1,s=i+1),t=createNS("g"),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-dashoffset",1),i;i<s;i+=1)e=createNS("path"),t.appendChild(e),this.paths.push({p:e,m:i});if(this.filterManager.effectElements[10].p.v===3){var n=createNS("mask"),a=createElementID();n.setAttribute("id",a),n.setAttribute("mask-type","alpha"),n.appendChild(t),this.elem.globalData.defs.appendChild(n);var o=createNS("g");for(o.setAttribute("mask","url("+getLocationHref()+"#"+a+")");r[0];)o.appendChild(r[0]);this.elem.layerElement.appendChild(o),this.masker=n,t.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(r=this.elem.layerElement.children||this.elem.layerElement.childNodes;r.length;)this.elem.layerElement.removeChild(r[0]);this.elem.layerElement.appendChild(t),this.elem.layerElement.removeAttribute("mask"),t.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=t},SVGStrokeEffect.prototype.renderFrame=function(r){this.initialized||this.initialize();var e,t=this.paths.length,i,s;for(e=0;e<t;e+=1)if(this.paths[e].m!==-1&&(i=this.elem.maskManager.viewData[this.paths[e].m],s=this.paths[e].p,(r||this.filterManager._mdf||i.prop._mdf)&&s.setAttribute("d",i.lastPath),r||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||i.prop._mdf)){var n;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var a=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,o=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,l=s.getTotalLength();n="0 0 0 "+l*a+" ";var c=l*(o-a),f=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,d=Math.floor(c/f),u;for(u=0;u<d;u+=1)n+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";n+="0 "+l*10+" 0 0"}else n="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;s.setAttribute("stroke-dasharray",n)}if((r||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(r||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(r||this.filterManager.effectElements[3].p._mdf)){var g=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(g[0]*255)+","+bmFloor(g[1]*255)+","+bmFloor(g[2]*255)+")")}};function SVGTritoneFilter(r,e,t,i){this.filterManager=e;var s=createNS("feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","linearRGB"),s.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),r.appendChild(s);var n=createNS("feComponentTransfer");n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("result",i),this.matrixFilter=n;var a=createNS("feFuncR");a.setAttribute("type","table"),n.appendChild(a),this.feFuncR=a;var o=createNS("feFuncG");o.setAttribute("type","table"),n.appendChild(o),this.feFuncG=o;var l=createNS("feFuncB");l.setAttribute("type","table"),n.appendChild(l),this.feFuncB=l,r.appendChild(n)}SVGTritoneFilter.prototype.renderFrame=function(r){if(r||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,t=this.filterManager.effectElements[1].p.v,i=this.filterManager.effectElements[2].p.v,s=i[0]+" "+t[0]+" "+e[0],n=i[1]+" "+t[1]+" "+e[1],a=i[2]+" "+t[2]+" "+e[2];this.feFuncR.setAttribute("tableValues",s),this.feFuncG.setAttribute("tableValues",n),this.feFuncB.setAttribute("tableValues",a)}};function SVGProLevelsFilter(r,e,t,i){this.filterManager=e;var s=this.filterManager.effectElements,n=createNS("feComponentTransfer");(s[10].p.k||s[10].p.v!==0||s[11].p.k||s[11].p.v!==1||s[12].p.k||s[12].p.v!==1||s[13].p.k||s[13].p.v!==0||s[14].p.k||s[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",n)),(s[17].p.k||s[17].p.v!==0||s[18].p.k||s[18].p.v!==1||s[19].p.k||s[19].p.v!==1||s[20].p.k||s[20].p.v!==0||s[21].p.k||s[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",n)),(s[24].p.k||s[24].p.v!==0||s[25].p.k||s[25].p.v!==1||s[26].p.k||s[26].p.v!==1||s[27].p.k||s[27].p.v!==0||s[28].p.k||s[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",n)),(s[31].p.k||s[31].p.v!==0||s[32].p.k||s[32].p.v!==1||s[33].p.k||s[33].p.v!==1||s[34].p.k||s[34].p.v!==0||s[35].p.k||s[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",n)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(n.setAttribute("color-interpolation-filters","sRGB"),r.appendChild(n)),(s[3].p.k||s[3].p.v!==0||s[4].p.k||s[4].p.v!==1||s[5].p.k||s[5].p.v!==1||s[6].p.k||s[6].p.v!==0||s[7].p.k||s[7].p.v!==1)&&(n=createNS("feComponentTransfer"),n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("result",i),r.appendChild(n),this.feFuncRComposed=this.createFeFunc("feFuncR",n),this.feFuncGComposed=this.createFeFunc("feFuncG",n),this.feFuncBComposed=this.createFeFunc("feFuncB",n))}SVGProLevelsFilter.prototype.createFeFunc=function(r,e){var t=createNS(r);return t.setAttribute("type","table"),e.appendChild(t),t},SVGProLevelsFilter.prototype.getTableValue=function(r,e,t,i,s){for(var n=0,a=256,o,l=Math.min(r,e),c=Math.max(r,e),f=Array.call(null,{length:a}),d,u=0,g=s-i,p=e-r;n<=256;)o=n/256,o<=l?d=p<0?s:i:o>=c?d=p<0?i:s:d=i+g*Math.pow((o-r)/p,1/t),f[u]=d,u+=1,n+=256/(a-1);return f.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(r){if(r||this.filterManager._mdf){var e,t=this.filterManager.effectElements;this.feFuncRComposed&&(r||t[3].p._mdf||t[4].p._mdf||t[5].p._mdf||t[6].p._mdf||t[7].p._mdf)&&(e=this.getTableValue(t[3].p.v,t[4].p.v,t[5].p.v,t[6].p.v,t[7].p.v),this.feFuncRComposed.setAttribute("tableValues",e),this.feFuncGComposed.setAttribute("tableValues",e),this.feFuncBComposed.setAttribute("tableValues",e)),this.feFuncR&&(r||t[10].p._mdf||t[11].p._mdf||t[12].p._mdf||t[13].p._mdf||t[14].p._mdf)&&(e=this.getTableValue(t[10].p.v,t[11].p.v,t[12].p.v,t[13].p.v,t[14].p.v),this.feFuncR.setAttribute("tableValues",e)),this.feFuncG&&(r||t[17].p._mdf||t[18].p._mdf||t[19].p._mdf||t[20].p._mdf||t[21].p._mdf)&&(e=this.getTableValue(t[17].p.v,t[18].p.v,t[19].p.v,t[20].p.v,t[21].p.v),this.feFuncG.setAttribute("tableValues",e)),this.feFuncB&&(r||t[24].p._mdf||t[25].p._mdf||t[26].p._mdf||t[27].p._mdf||t[28].p._mdf)&&(e=this.getTableValue(t[24].p.v,t[25].p.v,t[26].p.v,t[27].p.v,t[28].p.v),this.feFuncB.setAttribute("tableValues",e)),this.feFuncA&&(r||t[31].p._mdf||t[32].p._mdf||t[33].p._mdf||t[34].p._mdf||t[35].p._mdf)&&(e=this.getTableValue(t[31].p.v,t[32].p.v,t[33].p.v,t[34].p.v,t[35].p.v),this.feFuncA.setAttribute("tableValues",e))}};function SVGDropShadowEffect(r,e,t,i,s){var n=e.container.globalData.renderConfig.filterSize,a=e.data.fs||n;r.setAttribute("x",a.x||n.x),r.setAttribute("y",a.y||n.y),r.setAttribute("width",a.width||n.width),r.setAttribute("height",a.height||n.height),this.filterManager=e;var o=createNS("feGaussianBlur");o.setAttribute("in","SourceAlpha"),o.setAttribute("result",i+"_drop_shadow_1"),o.setAttribute("stdDeviation","0"),this.feGaussianBlur=o,r.appendChild(o);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",i+"_drop_shadow_1"),l.setAttribute("result",i+"_drop_shadow_2"),this.feOffset=l,r.appendChild(l);var c=createNS("feFlood");c.setAttribute("flood-color","#00ff00"),c.setAttribute("flood-opacity","1"),c.setAttribute("result",i+"_drop_shadow_3"),this.feFlood=c,r.appendChild(c);var f=createNS("feComposite");f.setAttribute("in",i+"_drop_shadow_3"),f.setAttribute("in2",i+"_drop_shadow_2"),f.setAttribute("operator","in"),f.setAttribute("result",i+"_drop_shadow_4"),r.appendChild(f);var d=this.createMergeNode(i,[i+"_drop_shadow_4",s]);r.appendChild(d)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(r){if(r||this.filterManager._mdf){if((r||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),r||this.filterManager.effectElements[0].p._mdf){var e=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(e[0]*255),Math.round(e[1]*255),Math.round(e[2]*255)))}if((r||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),r||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var t=this.filterManager.effectElements[3].p.v,i=(this.filterManager.effectElements[2].p.v-90)*degToRads,s=t*Math.cos(i),n=t*Math.sin(i);this.feOffset.setAttribute("dx",s),this.feOffset.setAttribute("dy",n)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(r,e,t){this.initialized=!1,this.filterManager=e,this.filterElem=r,this.elem=t,t.matteElement=createNS("g"),t.matteElement.appendChild(t.layerElement),t.matteElement.appendChild(t.transformedElement),t.baseElement=t.matteElement}SVGMatte3Effect.prototype.findSymbol=function(r){for(var e=0,t=_svgMatteSymbols.length;e<t;){if(_svgMatteSymbols[e]===r)return _svgMatteSymbols[e];e+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(r,e){var t=r.layerElement.parentNode;if(!!t){for(var i=t.children,s=0,n=i.length;s<n&&i[s]!==r.layerElement;)s+=1;var a;s<=n-2&&(a=i[s+1]);var o=createNS("use");o.setAttribute("href","#"+e),a?t.insertBefore(o,a):t.appendChild(o)}},SVGMatte3Effect.prototype.setElementAsMask=function(r,e){if(!this.findSymbol(e)){var t=createElementID(),i=createNS("mask");i.setAttribute("id",e.layerId),i.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(e);var s=r.globalData.defs;s.appendChild(i);var n=createNS("symbol");n.setAttribute("id",t),this.replaceInParent(e,t),n.appendChild(e.layerElement),s.appendChild(n);var a=createNS("use");a.setAttribute("href","#"+t),i.appendChild(a),e.data.hd=!1,e.show()}r.setMatte(e.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var r=this.filterManager.effectElements[0].p.v,e=this.elem.comp.elements,t=0,i=e.length;t<i;)e[t]&&e[t].data.ind===r&&this.setElementAsMask(this.elem,e[t]),t+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(r,e,t,i){r.setAttribute("x","-100%"),r.setAttribute("y","-100%"),r.setAttribute("width","300%"),r.setAttribute("height","300%"),this.filterManager=e;var s=createNS("feGaussianBlur");s.setAttribute("result",i),r.appendChild(s),this.feGaussianBlur=s}SVGGaussianBlurEffect.prototype.renderFrame=function(r){if(r||this.filterManager._mdf){var e=.3,t=this.filterManager.effectElements[0].p.v*e,i=this.filterManager.effectElements[1].p.v,s=i==3?0:t,n=i==2?0:t;this.feGaussianBlur.setAttribute("stdDeviation",s+" "+n);var a=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",a)}};function TransformEffect(){}TransformEffect.prototype.init=function(r){this.effectsManager=r,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(r){if(this._opMdf=!1,this._mdf=!1,r||this.effectsManager._mdf){var e=this.effectsManager.effectElements,t=e[0].p.v,i=e[1].p.v,s=e[2].p.v===1,n=e[3].p.v,a=s?n:e[4].p.v,o=e[5].p.v,l=e[6].p.v,c=e[7].p.v;this.matrix.reset(),this.matrix.translate(-t[0],-t[1],t[2]),this.matrix.scale(a*.01,n*.01,1),this.matrix.rotate(-c*degToRads),this.matrix.skewFromAxis(-o*degToRads,(l+90)*degToRads),this.matrix.translate(i[0],i[1],0),this._mdf=!0,this.opacity!==e[8].p.v&&(this.opacity=e[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(r,e){this.init(e)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(r){this.init(r)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie,lottie.exports);var Lottie=lottie.exports;(function(){try{if(typeof document!="undefined"){var r=document.createElement("style");r.appendChild(document.createTextNode(".lottie-animation-container{width:var(--lottie-animation-container-width);height:var(--lottie-animation-container-height);background-color:var(--lottie-animation-container-background-color);overflow:hidden;margin:var(--lottie-animation-margin)}.lottie-animation-container svg{transform:scale(var(--lottie-animation-scale))}")),document.head.appendChild(r)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(r,e,t)=>e in r?__defProp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,__spreadValues=(r,e)=>{for(var t in e||(e={}))__hasOwnProp.call(e,t)&&__defNormalProp(r,t,e[t]);if(__getOwnPropSymbols)for(var t of __getOwnPropSymbols(e))__propIsEnum.call(e,t)&&__defNormalProp(r,t,e[t]);return r},__spreadProps=(r,e)=>__defProps(r,__getOwnPropDescs(e)),es6=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,s,n;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!r(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!r(s[1],t.get(s[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(n=Object.keys(e),i=n.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[s]))return!1;for(s=i;s--!==0;){var a=n[s];if(!r(e[a],t[a]))return!1}return!0}return e!==e&&t!==t};function klona(r){var e,t,i;if(Array.isArray(r)){for(t=Array(e=r.length);e--;)t[e]=(i=r[e])&&typeof i=="object"?klona(i):i;return t}if(Object.prototype.toString.call(r)==="[object Object]"){t={};for(e in r)e==="__proto__"?Object.defineProperty(t,e,{value:klona(r[e]),configurable:!0,enumerable:!0,writable:!0}):t[e]=(i=r[e])&&typeof i=="object"?klona(i):i;return t}return r}var _export_sfc=(r,e)=>{const t=r.__vccOpts||r;for(const[i,s]of e)t[i]=s;return t};const _sfc_main$2=defineComponent({props:{animationData:{type:Object,default:()=>({})},animationLink:{type:String,default:""},loop:{type:[Boolean,Number],default:!0},autoPlay:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},speed:{type:Number,default:1},delay:{type:Number,default:0},direction:{type:String,default:"forward"},pauseOnHover:{type:Boolean,default:!1},playOnHover:{type:Boolean,default:!1},backgroundColor:{type:String,default:"transparent"},pauseAnimation:{type:Boolean,default:!1},noMargin:{type:Boolean,default:!1},scale:{type:Number,default:1},renderer:{type:String,default:"svg"},rendererSettings:{type:Object,default:()=>({})},assetsPath:{type:String,default:""}},emits:{onComplete:null,onLoopComplete:null,onEnterFrame:null,onSegmentStart:null,onAnimationLoaded:null},setup(r,{emit:e}){const t=ref();let i,s=null,n=1;watchEffect(async()=>{if(!!t.value){if(r.animationLink!="")try{i=await(await fetch(r.animationLink)).json()}catch(_){console.error(_);return}else if(es6(r.animationData,{})===!1)i=klona(r.animationData);else throw new Error("You must provide either animationLink or animationData");a()}});const a=()=>{if(!t.value||!i)return;s==null||s.destroy(),s=null;let _=r.autoPlay,P=r.loop;r.playOnHover&&(_=!1),typeof P=="number"&&P>0&&(P=P-1),r.delay>0&&(_=!1);const k={container:t.value,renderer:r.renderer,loop:P,autoplay:_,animationData:i,assetsPath:r.assetsPath};es6(r.rendererSettings,{})===!1&&(k.rendererSettings=r.rendererSettings),r.scale!==1&&(k.rendererSettings=__spreadProps(__spreadValues({},k.rendererSettings),{viewBoxOnly:!0})),s=Lottie.loadAnimation(k),setTimeout(()=>{_=r.autoPlay,r.playOnHover?s==null||s.pause():_?s==null||s.play():s==null||s.pause(),e("onAnimationLoaded")},r.delay),s.setSpeed(r.speed),r.direction==="reverse"&&s.setDirection(-1),r.direction==="normal"&&s.setDirection(1),(r.pauseAnimation||r.playOnHover)&&s.pause(),s.addEventListener("loopComplete",()=>{r.direction==="alternate"&&(s==null||s.stop(),n=n===-1?1:-1,s==null||s.setDirection(n),s==null||s.play()),e("onLoopComplete")}),s.addEventListener("complete",()=>{e("onComplete")}),s.addEventListener("enterFrame",()=>{e("onEnterFrame")}),s.addEventListener("segmentStart",()=>{e("onSegmentStart")})},o=computed(()=>{let _=r.width,P=r.height;return typeof r.width=="number"&&(_=`${r.width}px`),typeof r.height=="number"&&(P=`${r.height}px`),{"--lottie-animation-container-width":_,"--lottie-animation-container-height":P,"--lottie-animation-container-background-color":r.backgroundColor,"--lottie-animation-margin":r.noMargin?"0":"0 auto","--lottie-animation-scale":r.scale!=1?r.scale:""}}),l=()=>{s&&r.pauseOnHover&&s.pause(),s&&r.playOnHover&&s.play()},c=()=>{s&&r.pauseOnHover&&s.play(),s&&r.playOnHover&&s.pause()};return watch(()=>r.pauseAnimation,()=>{if((r.pauseOnHover||r.playOnHover)&&r.pauseAnimation){console.error("If you are using pauseAnimation prop for Vue3-Lottie, please remove the props pauseOnHover and playOnHover");return}s&&(r.pauseAnimation?s.pause():s.play())}),{lottieAnimationContainer:t,hoverEnded:c,hoverStarted:l,getCurrentStyle:o,play:()=>{s&&s.play()},pause:()=>{s&&s.pause()},stop:()=>{s&&s.stop()},destroy:()=>{s&&s.destroy()},setSpeed:(_=1)=>{if(_<=0)throw new Error("Speed must be greater than 0");s&&s.setSpeed(_)},setDirection:_=>{s&&(_==="forward"?s.setDirection(1):_==="reverse"&&s.setDirection(-1))},goToAndStop:(_,P=!0)=>{s&&s.goToAndStop(_,P)},goToAndPlay:(_,P=!0)=>{s&&s.goToAndPlay(_,P)},playSegments:(_,P=!1)=>{s&&s.playSegments(_,P)},setSubFrame:(_=!0)=>{s&&s.setSubframe(_)},getDuration:(_=!0)=>{if(s)return s.getDuration(_)},updateDocumentData:(_,P=0)=>{s&&s.renderer.elements[P].updateDocumentData(_)}}}});function _sfc_render$1(r,e,t,i,s,n){return openBlock(),createElementBlock("div",{ref:"lottieAnimationContainer",class:"lottie-animation-container",style:normalizeStyle(r.getCurrentStyle),onMouseenter:e[0]||(e[0]=(...a)=>r.hoverStarted&&r.hoverStarted(...a)),onMouseleave:e[1]||(e[1]=(...a)=>r.hoverEnded&&r.hoverEnded(...a))},null,36)}var Vue3Lottie=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]);const v="5.9.6",fr=30,ip=0,op=151,w=1200,h=1200,nm="Search",ddd=0,assets=[],layers=[{ddd:0,ind:1,ty:4,nm:"Magnify Glass 2",parent:3,td:1,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[723.307,725.984,0],ix:2,l:2},a:{a:0,k:[723.307,725.984,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-115.596,0],[0,-115.596],[115.596,0],[0,115.596]],o:[[115.596,0],[0,115.596],[-115.596,0],[0,-115.596]],v:[[0,-209.304],[209.304,0],[0,209.304],[-209.304,0]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.831372559071,.929411768913,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[424.921,428.674],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 17",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:20,op:80,st:20,ct:1,bm:0},{ddd:0,ind:2,ty:4,nm:"Shape Layer 1",parent:1,tt:1,sr:1,ks:{o:{a:0,k:50,ix:11},r:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},t:0,s:[39]},{t:20,s:[-42]}],ix:10},p:{a:0,k:[187.128,623.25,0],ix:2,l:2},a:{a:0,k:[-91,-47,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ty:"rc",d:1,s:{a:0,k:[62,676],ix:2},p:{a:0,k:[0,0],ix:3},r:{a:0,k:0,ix:4},nm:"Rectangle Path 1",mn:"ADBE Vector Shape - Rect",hd:!1},{ty:"st",c:{a:0,k:[.2588239782,.698038976333,.984314024682,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:0,ix:5},lc:1,lj:1,ml:4,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:1,k:[{i:{x:0,y:1},o:{x:.333,y:0},t:20,s:[-145.666,-47.922],to:[120.611,-.032],ti:[-120.611,.032]},{t:60,s:[577.999,-48.112]}],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Rectangle 2",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"rc",d:1,s:{a:0,k:[122,674],ix:2},p:{a:0,k:[0,0],ix:3},r:{a:0,k:0,ix:4},nm:"Rectangle Path 1",mn:"ADBE Vector Shape - Rect",hd:!1},{ty:"st",c:{a:0,k:[.2588239782,.698038976333,.984314024682,1],ix:3},o:{a:0,k:100,ix:4},w:{a:0,k:0,ix:5},lc:1,lj:1,ml:4,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:1,k:[{i:{x:0,y:1},o:{x:.333,y:0},t:25,s:[-143,-49],to:[105.636,0],ti:[-105.636,0]},{t:65,s:[490.818,-49]}],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Rectangle 1",np:3,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:20,op:80,st:20,ct:1,bm:0},{ddd:0,ind:3,ty:4,nm:"Magnify Glass",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:1,k:[{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},t:0,s:[0]},{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},t:20,s:[81]},{i:{x:[0],y:[1]},o:{x:[.333],y:[0]},t:80,s:[81]},{t:100,s:[0]}],ix:10},p:{a:1,k:[{i:{x:0,y:1},o:{x:.333,y:0},t:0,s:[823.307,825.984,0],to:[-70.36,116.617,0],ti:[76.942,110.098,0]},{i:{x:0,y:1},o:{x:.333,y:0},t:20,s:[441.437,852.411,0],to:[-36.545,-52.293,0],ti:[0,0,0]},{i:{x:0,y:1},o:{x:.333,y:0},t:40,s:[389.571,758.109,0],to:[0,0,0],ti:[-10.898,-42.43,0]},{i:{x:0,y:1},o:{x:.333,y:0},t:60,s:[479.158,1059.877,0],to:[10.155,-47.229,0],ti:[-16.672,47.233,0]},{i:{x:0,y:1},o:{x:.333,y:0},t:80,s:[556.958,814.69,0],to:[-39.328,37.767,0],ti:[-123.307,228.016,0]},{t:100,s:[823.307,825.984,0]}],ix:2,l:2},a:{a:0,k:[723.307,725.984,0],ix:1,l:2},s:{a:1,k:[{i:{x:[0,0,0],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:0,s:[100,100,100]},{i:{x:[0,0,0],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:20,s:[80,80,100]},{i:{x:[0,0,0],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:80,s:[80,80,100]},{t:100,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[1.911,.002],[-.001,3.978],[-1.35,1.35],[0,0],[-2.812,-2.812],[2.812,-2.812],[0,0]],o:[[-3.978,-.001],[0,-1.909],[0,0],[2.812,-2.812],[2.812,2.812],[0,0],[-1.349,1.353]],v:[[-5.093,12.296],[-12.294,5.092],[-10.185,.001],[0,-10.187],[10.185,-10.187],[10.185,-.002],[0,10.186]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.427450984716,.427450984716,.666666686535,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[681.27,628.239],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[1.911,.002],[-.001,3.978],[-1.35,1.35],[0,0],[-2.812,-2.812],[2.812,-2.812],[0,0],[0,0]],o:[[-3.978,-.001],[0,-1.909],[0,0],[2.812,-2.812],[2.812,2.812],[0,0],[0,0],[-1.349,1.353]],v:[[-17.824,25.027],[-25.025,17.823],[-22.916,12.732],[12.731,-22.918],[22.916,-22.918],[22.916,-12.733],[22.916,-12.733],[-12.731,22.917]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.427450984716,.427450984716,.666666686535,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[637.978,671.528],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[3.82,-.007],[2.702,-2.703],[0,0],[-5.624,-5.626],[-.001,-.001],[0,0],[-5.699,5.444],[0,0],[0,0],[5.624,5.626],[.001,.001],[0,0]],o:[[-3.822,-.008],[0,0],[-5.626,5.624],[.001,.001],[0,0],[5.699,5.444],[0,0],[0,0],[5.626,-5.624],[-.001,-.001],[0,0],[-2.7,-2.701]],v:[[-64.64,-114.696],[-74.831,-110.486],[-110.478,-74.836],[-110.481,-54.466],[-110.478,-54.463],[54.455,110.47],[74.825,110.47],[110.479,74.82],[110.479,74.82],[110.482,54.45],[110.479,54.447],[-54.455,-110.486]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[7.645,.023],[5.39,5.422],[0,0],[-11.246,11.251],[-.003,.003],[0,0],[-11.26,-11.233],[0,0],[11.246,-11.251],[.003,-.003],[0,0]],o:[[-7.645,.021],[0,0],[-11.251,-11.246],[.003,-.003],[0,0],[11.26,-11.233],[0,0],[11.251,11.246],[-.003,.003],[0,0],[-5.388,5.424]],v:[[64.64,129.096],[44.27,120.655],[-120.663,-44.278],[-120.671,-85.013],[-120.663,-85.021],[-85.016,-120.671],[-44.27,-120.671],[120.663,44.262],[120.671,84.997],[120.663,85.005],[85.009,120.655]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.427450984716,.427450984716,.666666686535,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[730.632,733.63],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:3,cix:2,bm:0,ix:3,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-5.626,5.626],[0,0],[-5.626,-5.626],[0,0],[5.626,-5.626],[0,0],[5.626,5.626],[0,0]],o:[[0,0],[5.626,-5.626],[0,0],[5.626,5.626],[0,0],[-5.626,5.626],[0,0],[-5.626,-5.626]],v:[[-97.746,-97.746],[-97.746,-97.746],[-77.374,-97.746],[97.746,77.374],[97.746,97.746],[97.746,97.746],[77.374,97.746],[-97.746,-77.374]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[738.271,725.984],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:50,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:4,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[5.625,5.625],[0,0],[-5.626,5.626],[0,0],[0,0],[-8.438,-8.438],[0,0],[-8.438,8.438],[0,0]],o:[[0,0],[-5.626,-5.625],[0,0],[0,0],[-8.438,8.438],[0,0],[8.438,8.438],[0,0],[-5.625,5.625]],v:[[85.632,89.489],[-89.488,-85.631],[-89.488,-106.003],[-89.488,-106.003],[-99.674,-95.817],[-99.674,-65.26],[65.26,99.674],[95.817,99.674],[106.003,89.489]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.172549024224,.29411765933,.458823531866,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[714.735,749.521],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:20,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:5,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-8.438,8.438],[0,0],[-8.438,-8.438],[0,0],[8.438,-8.438],[0,0],[8.438,8.438],[0,0]],o:[[0,0],[8.438,-8.438],[0,0],[8.438,8.438],[0,0],[-8.438,8.438],[0,0],[-8.438,-8.438]],v:[[-115.571,-79.921],[-79.921,-115.571],[-49.363,-115.571],[115.571,49.363],[115.571,79.921],[79.921,115.571],[49.363,115.571],[-115.571,-49.363]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.807843148708,.847058832645,.933333337307,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[730.632,733.624],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:6,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[111.488,.003],[0,0],[-.182,-111.618],[-111.485,-.007],[0,0],[.182,111.618]],o:[[0,0],[-111.618,.182],[.182,111.485],[0,0],[111.618,-.182],[-.182,-111.487]],v:[[0,-202.092],[-.33,-202.092],[-202.104,.34],[-.014,202.113],[.324,202.113],[202.097,-.319]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,0],[-.001,119.574],[-119.438,.191],[0,0],[-.003,-119.574],[119.44,-.191]],o:[[-119.574,-.001],[.001,-119.438],[0,0],[119.574,-.003],[.003,119.441],[0,0]],v:[[-.014,216.519],[-216.52,.008],[-.359,-216.497],[0,-216.497],[216.513,.006],[.352,216.519]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ind:2,ty:"sh",ix:3,ks:{a:0,k:{i:[[128.558,.03],[0,0],[-.233,-128.744],[-128.56,-.027],[0,0],[.232,128.744]],o:[[0,0],[-128.744,.233],[.232,128.56],[0,0],[128.744,-.232],[-.232,-128.558]],v:[[.014,-233.111],[-.38,-233.111],[-233.069,.421],[-.007,233.111],[.38,233.111],[233.07,-.421]],c:!0},ix:2},nm:"Path 3",mn:"ADBE Vector Shape - Group",hd:!1},{ind:3,ty:"sh",ix:4,ks:{a:0,k:{i:[[0,0],[-.024,136.699],[-136.512,.241],[0,0],[.024,-136.699],[136.512,-.241]],o:[[-136.699,-.024],[.024,-136.512],[0,0],[136.699,.024],[-.024,136.512],[0,0]],v:[[-.014,247.516],[-247.487,-.043],[-.408,-247.516],[.014,-247.516],[247.487,.043],[.408,247.516]],c:!0},ix:2},nm:"Path 4",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.427450984716,.427450984716,.666666686535,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[424.779,428.817],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 7",np:5,cix:2,bm:0,ix:7,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[8.451,-7.401],[0,0],[0,0],[0,0]],o:[[0,0],[0,0],[0,0],[-7.375,8.474]],v:[[-25.908,-2.057],[2.592,26.345],[26.352,2.507],[-2.141,-25.898]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[1.914,.003],[1.349,1.347],[0,0],[-2.809,2.818],[-.185,.152],[-9.848,12.075],[-2.033,.104],[-1.43,-1.455],[0,0],[2.809,-2.817],[0,0],[0,0]],o:[[-1.907,.003],[0,0],[-2.818,-2.809],[.169,-.169],[12.043,-9.888],[1.286,-1.577],[2.036,-.128],[0,0],[2.817,2.809],[0,0],[0,0],[-1.349,1.358]],v:[[2.607,43.732],[-2.479,41.632],[-41.621,2.62],[-41.638,-7.568],[-41.108,-8.05],[-8.19,-41.077],[-2.978,-43.718],[2.48,-41.629],[41.623,-2.613],[41.637,7.575],[41.637,7.575],[7.706,41.615]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.427450984716,.427450984716,.666666686535,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[613.672,617.092],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 8",np:3,cix:2,bm:0,ix:8,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-103.495,23.67],[-34.985,-9.165],[-7.089,-105.993],[.009,5.48],[132.721,-.217],[-.217,-132.721],[0,0],[-.34,-5.163]],o:[[34.975,-9.203],[103.583,23.567],[.352,-5.389],[-.217,-132.721],[-132.721,.217],[0,0],[.009,5.247],[7.039,-105.934]],v:[[-53.488,-90.217],[53.23,-90.274],[239.729,128.054],[240.313,111.766],[-.393,-128.154],[-240.313,112.553],[-240.313,112.553],[-239.729,128.154]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[1,1,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[424.778,316.657],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 9",np:1,cix:2,bm:0,ix:9,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[126.561,-.222],[8.198,126.555],[-.009,-5.325],[-132.721,.217],[.217,132.721],[0,0],[.321,5.018]],o:[[-126.82,.194],[-.332,5.239],[.217,132.721],[132.721,-.217],[0,0],[-.008,-5.098],[-8.116,126.301]],v:[[.393,96.941],[-239.763,-127.816],[-240.313,-111.986],[.393,127.934],[240.313,-112.772],[240.313,-112.772],[239.763,-127.934]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.172549024224,.29411765933,.458823531866,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"tr",p:{a:0,k:[424.779,541.196],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:20,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 10",np:1,cix:2,bm:0,ix:10,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[115.595,-.189],[.19,115.596],[-115.596,.19],[-.19,-115.596],[0,0]],o:[[-115.596,.19],[-.19,-115.596],[115.596,-.19],[0,.001],[.189,115.595]],v:[[.339,209.316],[-209.309,.355],[-.348,-209.293],[209.3,-.332],[209.3,-.331]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ind:1,ty:"sh",ix:2,ks:{a:0,k:{i:[[0,0],[-.217,-132.721],[-132.721,.217],[.217,132.721],[132.721,-.217]],o:[[-132.721,.217],[.217,132.721],[132.721,-.217],[-.217,-132.721],[0,0]],v:[[-.394,-240.313],[-240.313,.394],[.394,240.313],[240.313,-.394],[-.393,-240.313]],c:!0},ix:2},nm:"Path 2",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.933333337307,.964705884457,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[424.779,428.817],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 11",np:3,cix:2,bm:0,ix:11,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-10.143,12.435],[0,0],[12.413,-10.192],[0,0]],o:[[0,0],[-10.151,12.446],[0,0],[12.401,-10.185]],v:[[25.796,-8.177],[8.135,-25.837],[-25.796,8.204],[-8.104,25.837]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.172549024224,.29411765933,.458823531866,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[602.933,606.404],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:20,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 12",np:2,cix:2,bm:0,ix:12,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0],[12.413,-10.192],[0,0]],o:[[0,0],[-10.151,12.446],[0,0],[0,0]],v:[[36.536,2.487],[-2.605,-36.528],[-36.536,-2.486],[2.607,36.528]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.933333337307,.964705884457,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[613.674,617.094],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 13",np:2,cix:2,bm:0,ix:13,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-109.959,.014],[-7.596,-109.697],[0,4.875],[115.596,-.07],[.07,-115.497],[-.328,-4.791]],o:[[109.959,.014],[.328,-4.791],[-.07,-115.596],[-115.497,.07],[0,4.875],[7.596,-109.697]],v:[[0,-82.988],[208.75,111.832],[209.304,97.347],[-.126,-111.832],[-209.304,97.347],[-208.75,111.832]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.172549024224,.29411765933,.458823531866,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[424.921,331.327],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:20,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 16",np:2,cix:2,bm:0,ix:16,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-115.596,0],[0,-115.596],[115.596,0],[0,115.596]],o:[[115.596,0],[0,115.596],[-115.596,0],[0,-115.596]],v:[[0,-209.304],[209.304,0],[0,209.304],[-209.304,0]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.831372559071,.929411768913,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[424.921,428.674],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 17",np:2,cix:2,bm:0,ix:17,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:4,ty:4,nm:"Group 1",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[586.971,922.325,0],ix:2,l:2},a:{a:0,k:[486.971,822.325,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-40,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-15,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:10,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:35,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:60,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:85,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:110,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:135,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:160,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:185,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:210,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:235,s:[50,50,100]},{t:260,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-3.694,-11.081],[-10.619,-3.232],[11.081,-3.694],[3.232,-10.619],[3.694,11.081],[10.619,3.232],[-11.081,3.694],[-3.232,10.619]],o:[[3.232,10.619],[11.081,3.694],[-10.619,3.232],[-3.694,11.081],[-3.232,-10.619],[-11.081,-3.694],[10.619,-3.232],[3.694,-11.081]],v:[[5.54,-27.702],[27.702,-5.54],[27.702,5.54],[5.54,27.702],[-5.54,27.702],[-27.702,5.54],[-27.702,-5.54],[-5.54,-27.702]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.588235318661,.843137264252,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[486.971,822.325],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:5,ty:4,nm:"Group 2",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[947.697,395.941,0],ix:2,l:2},a:{a:0,k:[847.697,295.941,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-32,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-7,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:18,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:43,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:68,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:93,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:118,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:143,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:168,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:193,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:218,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:243,s:[50,50,100]},{t:268,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-2.828,-8.484],[-8.13,-2.475],[8.484,-2.828],[2.474,-8.13],[2.828,8.484],[8.13,2.474],[-8.484,2.828],[-2.474,8.13]],o:[[2.474,8.13],[8.484,2.828],[-8.13,2.475],[-2.828,8.484],[-2.474,-8.13],[-8.484,-2.828],[8.13,-2.474],[2.828,-8.484]],v:[[4.242,-21.209],[21.209,-4.242],[21.209,4.242],[4.242,21.209],[-4.242,21.209],[-21.209,4.242],[-21.209,-4.242],[-4.242,-21.209]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.588235318661,.843137264252,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[847.697,295.941],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 2",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:6,ty:4,nm:"Group 3",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[752.629,259.693,0],ix:2,l:2},a:{a:0,k:[652.629,159.693,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-24,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:1,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:26,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:51,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:76,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:101,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:126,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:151,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:176,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:201,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:226,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:251,s:[50,50,100]},{t:276,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-2.955,-8.865],[-8.495,-2.586],[8.865,-2.955],[2.586,-8.495],[2.955,8.865],[8.495,2.586],[-8.865,2.955],[-2.585,8.495]],o:[[2.586,8.495],[8.865,2.955],[-8.495,2.586],[-2.955,8.865],[-2.585,-8.495],[-8.865,-2.955],[8.495,-2.586],[2.955,-8.865]],v:[[4.432,-22.162],[22.162,-4.432],[22.162,4.432],[4.432,22.162],[-4.432,22.162],[-22.162,4.432],[-22.162,-4.432],[-4.432,-22.162]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.588235318661,.843137264252,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[652.629,159.693],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 3",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:7,ty:4,nm:"Group 4",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[248.453,771.072,0],ix:2,l:2},a:{a:0,k:[148.453,671.072,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-16,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:9,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:34,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:59,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:84,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:109,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:134,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:159,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:184,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:209,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:234,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:259,s:[50,50,100]},{t:284,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-2.955,-8.865],[-8.495,-2.586],[8.865,-2.955],[2.586,-8.495],[2.955,8.865],[8.495,2.586],[-8.865,2.955],[-2.585,8.495]],o:[[2.586,8.495],[8.865,2.955],[-8.495,2.586],[-2.955,8.865],[-2.585,-8.495],[-8.865,-2.955],[8.495,-2.586],[2.955,-8.865]],v:[[4.432,-22.162],[22.162,-4.432],[22.162,4.432],[4.432,22.162],[-4.432,22.162],[-22.162,4.432],[-22.162,-4.432],[-4.432,-22.162]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.78823530674,.75686275959,.960784316063,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[148.453,671.072],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 4",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:8,ty:4,nm:"Group 5",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[291.668,317.313,0],ix:2,l:2},a:{a:0,k:[191.668,217.313,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:-8,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:17,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:42,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:67,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:92,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:117,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:142,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:167,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:192,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:217,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:242,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:267,s:[50,50,100]},{t:292,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-2.955,-8.865],[-8.495,-2.586],[8.865,-2.955],[2.586,-8.495],[2.955,8.865],[8.495,2.586],[-8.865,2.955],[-2.585,8.495]],o:[[2.586,8.495],[8.865,2.955],[-8.495,2.586],[-2.955,8.865],[-2.585,-8.495],[-8.865,-2.955],[8.495,-2.586],[2.955,-8.865]],v:[[4.432,-22.162],[22.162,-4.432],[22.162,4.432],[4.432,22.162],[-4.432,22.162],[-22.162,4.432],[-22.162,-4.432],[-4.432,-22.162]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.78823530674,.75686275959,.960784316063,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[191.668,217.313],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 5",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:9,ty:4,nm:"Group 6",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[925.489,598.211,0],ix:2,l:2},a:{a:0,k:[825.489,498.211,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:0,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:25,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:50,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:75,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:100,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:125,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:150,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:175,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:200,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:225,s:[50,50,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:250,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:275,s:[50,50,100]},{t:300,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[-4.432,-13.297],[-12.743,-3.878],[13.297,-4.432],[3.878,-12.743],[4.432,13.297],[12.743,3.878],[-13.297,4.432],[-3.878,12.743]],o:[[3.878,12.743],[13.297,4.432],[-12.743,3.878],[-4.432,13.297],[-3.878,-12.743],[-13.297,-4.432],[12.743,-3.878],[4.432,-13.297]],v:[[6.648,-33.242],[33.242,-6.648],[33.242,6.648],[6.648,33.242],[-6.648,33.242],[-33.242,6.648],[-33.242,-6.648],[-6.648,-33.242]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.78823530674,.75686275959,.960784316063,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[825.489,498.211],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 6",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0},{ddd:0,ind:10,ty:4,nm:"Bg",sr:1,ks:{o:{a:0,k:30,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[611.583,608.517,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[5.601,38.169],[70.119,14.754],[16.043,18.986],[88.82,-75.221],[10.39,-43.775],[30.979,-15.726],[-73.503,-102.064],[-14.162,-6.219],[-10.687,-26.999],[-82.947,33.849],[-9.757,6.775],[-32.481,-8.611],[-23.982,87.991],[5.185,25.347],[-14.514,24.146]],o:[[-10.3,-70.91],[-24.31,-5.185],[-75.221,-88.82],[-34.334,29.077],[-8.372,33.718],[-80.645,41.9],[9.589,12.137],[26.034,12.861],[33.849,82.947],[10.998,-4.488],[27.551,-19.238],[87.991,23.982],[6.803,-24.962],[-5.313,-27.667],[19.474,-33.302]],v:[[354.128,-87.306],[220.25,-229.917],[157.998,-267.205],[-139.024,-291.829],[-207.876,-179.676],[-269.84,-101.817],[-317.385,150.906],[-281.214,178.861],[-224.162,240.79],[-12.684,329.691],[18.544,312.745],[113.201,295.989],[315.946,180.089],[318.407,103.57],[332.696,23.103]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.592156887054,.75686275959,1,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:300,st:0,ct:1,bm:0}],markers=[];var AstronautJSON={v,fr,ip,op,w,h,nm,ddd,assets,layers,markers},MovieGrid_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main$1={props:{hots:{type:Array,required:!0}}},_hoisted_1$1={class:"q-pa-md"},_hoisted_2={class:"grid-container"},_hoisted_3={class:"absolute-bottom text-subtitle1 text-center text-yellow-6"};function _sfc_render(r,e,t,i,s,n){return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(t.hots,a=>(openBlock(),createElementBlock("div",{key:a},[createVNode(QImg,{class:"hover-zoom",src:a.cover,height:"240px",fit:"cover",onClick:o=>r.$emit("hot_click",a)},{default:withCtx(()=>[withDirectives(createVNode(QChip,{class:"absolute",rounded:"",dense:"",style:{top:"4px",right:"4px"}},{default:withCtx(()=>[createTextVNode(toDisplayString(a.rate),1)]),_:2},1536),[[vShow,a.rate]]),createBaseVNode("div",_hoisted_3,toDisplayString(a.title),1)]),_:2},1032,["src","onClick"])]))),128))])])}var MovieGrid=_export_sfc$1(_sfc_main$1,[["render",_sfc_render],["__scopeId","data-v-5fd64655"]]),Search_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1={style:{"max-width":"1000px",margin:"auto"},class:"q-pa-md"},_sfc_main=Object.assign({components:{Vue3Lottie},name:"Search"},{__name:"Search",setup(r){const e=lookup("/search"),t=ref(""),i=ref([]),s=ref([]),n=ref(0);let a=1,o=null;const l=ref(!1),c=()=>{n.value=0,o&&clearInterval(o),l.value=!1},f=p=>{if(l.value=!0,o&&clearInterval(o),p>=100){c();return}o=setInterval(()=>{n.value<p?n.value++:(clearInterval(o),o=null)},50)},d=()=>{if(n.value>0){showTips("\u8BF7\u7B49\u5F85\u641C\u7D22\u5B8C\u6210");return}i.value=[],f(5),e.emit("search",{wd:t.value},p=>{p.code==="200"?a=p.data:showError(p.msg)})},u=()=>{e.emit("hots",{},p=>{p.code==="200"?s.value=p.data:showError(p.msg)})};e.on("search_event",p=>{p.code==="200"?(i.value=i.value.concat(p.data),f(i.value.length/a*100),console.log(i.value)):showError(p.msg)}),u();const g=p=>{t.value=p.title,d()};return(p,m)=>(openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",{class:"progress-container",style:normalizeStyle({"--progress-width":n.value+"%"})},[createVNode(QInput,{color:"orage",rounded:"",outlined:"",modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=S=>t.value=S),dense:"",placeholder:"\u8F93\u5165\u5F71\u7247\u540D\u79F0",onKeydown:withKeys(d,["enter"]),"hide-bottom-space":"",loading:n.value>0,clearable:"",class:"content",style:{"border-radius":"30px"}},null,8,["modelValue","loading"])],4),withDirectives(createVNode(MovieGrid,{hots:s.value,onHot_click:g},null,8,["hots"]),[[vShow,!l.value&&(t.value===null||t.value===""||i.value.length===0)]]),withDirectives(createVNode(unref(Vue3Lottie),{animationData:unref(AstronautJSON),height:200,width:200},null,8,["animationData"]),[[vShow,l.value]]),withDirectives(createVNode(_sfc_main$3,{searchs:i.value},null,8,["searchs"]),[[vShow,i.value.length>0]])]))}});var Search=_export_sfc$1(_sfc_main,[["__scopeId","data-v-7a613472"]]);export{Search as default};
